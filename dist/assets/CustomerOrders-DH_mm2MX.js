import{d as X,j as e,l as j}from"./index-DRC3F7i0.js";import{r as c}from"./router-BPBaD_i0.js";import{F as Z,m as ge,C as G,r as I,ar as Y,as as Te,Z as ee,at as Oe,g as ce,I as E,M as Fe,K as A,a3 as de,s as Ee,u as oe,au as xe,av as Ie,p as me,a1 as Re}from"./index-CprmGC-M.js";import{h as $e,g as Ue,i as Le,m as Xe,j as qe,k as Be,l as _e,n as ze}from"./retailerMarketplaceService-JKOUhufm.js";import{g as Ke,a as Qe}from"./deliveryEmployeeService-DSIf8GOm.js";import{c as he,q as Ve,o as He,p as Je,d as pe,l as ue,s as J,b as We}from"./firebase-DWi1MSv1.js";import{m as y}from"./proxy-BgUy8BPw.js";import{A as W}from"./index-DSciU07p.js";import"./vendor-Ckhrjn13.js";import"./index.esm-Bux_mLJ0.js";const Ze=({order:i,onClose:R})=>{const[T,q]=c.useState([]),[m,P]=c.useState(""),[a,w]=c.useState(!1),[p,o]=c.useState("store"),[B,O]=c.useState(!0),_=c.useRef(null),z=c.useRef(null),K=()=>{_.current?.scrollIntoView({behavior:"smooth"})};c.useEffect(()=>{K()},[T]),c.useEffect(()=>{if(!i?.id)return;(async()=>{const f=pe(X,"orderChats",i.id);try{await ue(f,{orderId:i.id,orderNumber:i.orderNumber||i.id.slice(-8),customerId:i.customerId,customerName:i.customerName,customerPhone:i.customerPhone,storeId:i.storeId,storeName:i.storeName,deliveryAgent:i.deliveryAgent||null,createdAt:J()},{merge:!0})}catch(b){console.error("Error initializing chat:",b)}})();const x=he(X,"orderChats",i.id,"messages"),S=Ve(x,He("createdAt","asc")),C=Je(S,f=>{const b=f.docs.map(D=>({id:D.id,...D.data(),createdAt:D.data().createdAt?.toDate()||new Date}));q(b)},f=>{console.error("Error fetching chat:",f)});return()=>C()},[i?.id]);const N=async()=>{if(!m.trim()||a)return;const l=m.trim();P(""),w(!0);try{const x=he(X,"orderChats",i.id,"messages"),S=p==="delivery"?i.deliveryAgent?.name||"Delivery Agent":i.storeName||"Store";await We(x,{text:l,senderId:j.currentUser?.uid||"store",senderName:S,senderType:p,createdAt:J(),read:!1});const C=pe(X,"orderChats",i.id);await ue(C,{lastMessage:l,lastMessageAt:J(),lastMessageBy:p},{merge:!0})}catch(x){console.error("Error sending message:",x),P(l)}finally{w(!1),z.current?.focus()}},k=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),N())},F=l=>l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),u=p==="delivery"?["I'm on my way","Arriving in 5 minutes","I'm at your location","Please come to collect","Unable to reach you"]:["Order is being prepared","Order will be ready soon","Delivery partner assigned","Please provide landmark","Thank you for ordering!"];return e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:R,children:e.jsxs(y.div,{initial:{scale:.95,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.95,opacity:0,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"bg-slate-900 rounded-2xl w-full max-w-md h-[85vh] max-h-[700px] flex flex-col overflow-hidden shadow-2xl border border-white/10",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"bg-gradient-to-r from-emerald-600 to-teal-500 px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-full bg-white/20 flex items-center justify-center text-white text-lg",children:i.customerName?.charAt(0)?.toUpperCase()||e.jsx(Z,{})}),e.jsxs("div",{className:"text-white",children:[e.jsx("h3",{className:"font-semibold text-base",children:i.customerName||"Customer"}),e.jsxs("p",{className:"text-xs text-white/70",children:["Order #",i.id?.slice(-6).toUpperCase()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i.customerPhone&&e.jsx("a",{href:`tel:${i.customerPhone}`,className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-white hover:bg-white/30 transition-all hover:scale-105",children:e.jsx(ge,{className:"text-sm"})}),e.jsx("button",{onClick:R,className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-white hover:bg-red-500/50 transition-all hover:scale-105",children:e.jsx(G,{})})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-white/60 text-xs",children:"Reply as:"}),e.jsxs("div",{className:"flex gap-2 flex-1",children:[e.jsxs("button",{onClick:()=>o("store"),className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2 ${p==="store"?"bg-white text-emerald-600 shadow-lg":"bg-white/10 text-white/80 hover:bg-white/20"}`,children:[e.jsx(I,{className:"text-xs"}),"Store"]}),i.deliveryAgent&&e.jsxs("button",{onClick:()=>o("delivery"),className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2 ${p==="delivery"?"bg-white text-cyan-600 shadow-lg":"bg-white/10 text-white/80 hover:bg-white/20"}`,children:[e.jsx(Y,{className:"text-xs"}),i.deliveryAgent.name?.split(" ")[0]||"Delivery"]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 bg-slate-800/50",style:{backgroundImage:"radial-gradient(circle at 50% 50%, rgba(16, 185, 129, 0.03) 0%, transparent 50%)"},children:T.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center px-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-emerald-500/20 to-cyan-500/20 flex items-center justify-center mb-4",children:e.jsx(Z,{className:"text-3xl text-emerald-400/60"})}),e.jsx("h3",{className:"font-semibold text-white text-lg mb-2",children:"Start the conversation"}),e.jsx("p",{className:"text-sm text-white/50 max-w-xs leading-relaxed",children:"Send order updates or coordinate delivery with the customer"})]}):e.jsxs("div",{className:"space-y-4",children:[T.map(l=>{const x=l.senderType==="customer",S=l.senderType==="delivery";return e.jsx(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${x?"justify-start":"justify-end"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-2xl px-4 py-3 shadow-md ${x?"bg-slate-700 text-white rounded-tl-sm":S?"bg-gradient-to-br from-cyan-500 to-cyan-600 text-white rounded-tr-sm":"bg-gradient-to-br from-emerald-500 to-emerald-600 text-white rounded-tr-sm"}`,children:[e.jsx("p",{className:`text-xs font-medium mb-1 ${x?"text-emerald-400":"text-white/80"}`,children:x?l.senderName||"Customer":l.senderName}),e.jsx("p",{className:"text-sm leading-relaxed",children:l.text}),e.jsxs("div",{className:`flex items-center justify-end gap-1.5 mt-2 ${x?"text-white/50":"text-white/70"}`,children:[e.jsx("span",{className:"text-[10px]",children:F(l.createdAt)}),!x&&(l.read?e.jsx(Te,{className:"text-[10px]"}):e.jsx(ee,{className:"text-[10px]"}))]})]})},l.id)}),e.jsx("div",{ref:_})]})}),B&&e.jsxs("div",{className:"px-3 py-2 bg-slate-800 border-t border-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-[10px] text-white/40 uppercase tracking-wide",children:"Quick Replies"}),e.jsx("button",{onClick:()=>O(!1),className:"text-white/30 hover:text-white/60 text-xs",children:"Hide"})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 scrollbar-hide",children:u.map((l,x)=>e.jsx("button",{onClick:()=>{P(l),O(!1)},className:"px-3 py-1.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-full text-xs text-white/70 whitespace-nowrap transition-all hover:border-emerald-500/50 hover:text-emerald-400",children:l},x))})]}),e.jsxs("div",{className:"bg-slate-900 border-t border-white/10 px-3 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[!B&&e.jsx("button",{onClick:()=>O(!0),className:"w-10 h-10 rounded-xl bg-white/5 hover:bg-white/10 flex items-center justify-center text-white/50 hover:text-white/80 transition-all text-lg",title:"Quick replies",children:"âš¡"}),e.jsx("div",{className:"flex-1 relative",children:e.jsx("input",{ref:z,type:"text",value:m,onChange:l=>P(l.target.value),onKeyPress:k,onFocus:()=>O(!1),placeholder:"Type a message...",className:"w-full px-4 py-3 bg-white/5 rounded-xl text-white placeholder-white/30 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 border border-white/10 focus:border-emerald-500/50 transition-all text-sm"})}),e.jsx("button",{onClick:N,disabled:!m.trim()||a,className:`w-11 h-11 rounded-xl flex items-center justify-center transition-all ${m.trim()?p==="delivery"?"bg-gradient-to-br from-cyan-500 to-cyan-600 text-white shadow-lg shadow-cyan-500/30 hover:shadow-cyan-500/50 hover:scale-105":"bg-gradient-to-br from-emerald-500 to-emerald-600 text-white shadow-lg shadow-emerald-500/30 hover:shadow-emerald-500/50 hover:scale-105":"bg-white/5 text-white/30 cursor-not-allowed"}`,children:e.jsx(Oe,{className:`text-sm ${a?"animate-pulse":""}`})})]}),e.jsx("div",{className:"mt-2 flex items-center justify-center",children:e.jsxs("span",{className:`text-[10px] transition-all ${p==="delivery"?"text-cyan-400/60":"text-emerald-400/60"}`,children:["Replying as ",p==="delivery"?i.deliveryAgent?.name||"Delivery Agent":"Store"]})})]})]})})},ct=()=>{const[i,R]=c.useState([]),[T,q]=c.useState(!0),[m,P]=c.useState("all"),[a,w]=c.useState(null),[p,o]=c.useState(null),[B,O]=c.useState({}),[_,z]=c.useState({}),[K,N]=c.useState(!1),[k,F]=c.useState(null),[u,l]=c.useState({name:"",phone:"",vehicleNumber:""}),[x,S]=c.useState([]),[C,f]=c.useState(""),[b,D]=c.useState(!1),[te,Q]=c.useState(null),[se,ye]=c.useState(null),V=t=>{if(t.orderType==="pickup")return null;const s=Number(se?.baseDeliveryTime)||30,n=Number(se?.estimatedDeliveryPerKm)||5,r=t.customerDistance;return r!=null&&r>=0?Math.round(s+r*n):s};c.useEffect(()=>{const t=j.currentUser?.uid;if(!t)return;const s=$e(t,n=>{R(n),q(!1)});return()=>s()},[]),c.useEffect(()=>{const t=j.currentUser?.uid;t&&Ue(t).then(s=>{s&&ye(s)}).catch(()=>{})},[]),c.useEffect(()=>{const t=j.currentUser?.uid;t&&Ke(t).then(s=>{S(s)}).catch(s=>{console.error("Error fetching employees:",s)})},[]);const ae=i.filter(t=>m==="all"?!0:m==="new"?t.status==="pending":m==="active"?["confirmed","preparing","ready","out_for_delivery"].includes(t.status):m==="completed"?t.status==="delivered":m==="cancelled"?t.status==="cancelled":!0),$=i.filter(t=>t.status==="pending").length,le=i.filter(t=>["confirmed","preparing","ready","out_for_delivery"].includes(t.status)).length,re=(t,s="delivery")=>{const n=s==="pickup";return{pending:{label:"New Order",color:"yellow",icon:ce},confirmed:{label:"Confirmed",color:"blue",icon:ee},preparing:{label:"Preparing",color:"orange",icon:Re},ready:{label:n?"Ready for Pickup":"Ready",color:"purple",icon:n?I:me},out_for_delivery:{label:"Out for Delivery",color:"cyan",icon:Y},delivered:{label:n?"Picked Up":"Delivered",color:"green",icon:me},cancelled:{label:"Cancelled",color:"red",icon:Ie}}[t]||{label:t,color:"gray",icon:A}},fe=async t=>{const s=t?.id;if(!s)return;o(s);const n=V(t),r=n??30;await ze(j.currentUser?.uid,s,r),o(null)},be=async t=>{o(t),await _e(j.currentUser?.uid,t),o(null)},je=async t=>{o(t),await Be(j.currentUser?.uid,t),o(null)},ve=t=>{F(t),l({name:"",phone:"",vehicleNumber:""}),f(""),D(!1),N(!0)},we=async()=>{const t=j.currentUser?.uid;if(b&&C){try{o(k),await Qe(t,k,C),o(null),N(!1),F(null),f(""),D(!1)}catch(s){console.error("Error assigning to employee:",s),alert(s.message||"Failed to assign order to employee"),o(null)}return}if(!u.name||!u.phone){alert("Please enter delivery agent name and phone, or select an employee");return}o(k),await Xe(t,k,{partnerName:u.name,partnerPhone:u.phone,vehicleNumber:u.vehicleNumber||""}),o(null),N(!1),F(null)},ie=async t=>{o(t),await qe(j.currentUser?.uid,t),o(null)},Ne=async(t,s="Cancelled by store")=>{o(t),await Le(j.currentUser?.uid,t,s),o(null)},ke=t=>{const s=t.orderType==="pickup";switch(t.status){case"pending":return{label:"Accept Order",action:()=>fe(t),color:"emerald"};case"confirmed":return{label:"Start Preparing",action:()=>be(t.id),color:"orange"};case"preparing":return{label:s?"Ready for Pickup":"Mark Ready",action:()=>je(t.id),color:"purple"};case"ready":return s?{label:"Customer Picked Up",action:()=>ie(t.id),color:"green"}:{label:"Out for Delivery",action:()=>ve(t.id),color:"cyan"};case"out_for_delivery":return{label:"Mark Delivered",action:()=>ie(t.id),color:"green"};default:return null}},Ce=t=>{if(!t)return"";const s=t.toDate?t.toDate():new Date(t),r=Math.floor((new Date-s)/1e3);return r<60?"Just now":r<3600?`${Math.floor(r/60)}m ago`:r<86400?`${Math.floor(r/3600)}h ago`:s.toLocaleDateString()},Ae=t=>{if(t.orderType==="pickup"||!t.estimatedDeliveryMinutes&&!t.estimatedMins)return null;const s=t.estimatedDeliveryMinutes||t.estimatedMins||0,n=t.createdAt?.toDate?t.createdAt.toDate():new Date(t.createdAt),h=Math.floor((new Date-n)/(1e3*60));return Math.max(0,s-h)},Se=t=>t===null?"gray":t<=5?"red":t<=15?"orange":t<=30?"yellow":"green",De=(t,s,n,r)=>{const d=(n-t)*Math.PI/180,v=(r-s)*Math.PI/180,M=Math.sin(d/2)*Math.sin(d/2)+Math.cos(t*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(v/2)*Math.sin(v/2);return 6371*(2*Math.atan2(Math.sqrt(M),Math.sqrt(1-M)))},Me=()=>{const t=i.filter(r=>r.orderType==="delivery"&&["confirmed","preparing","ready"].includes(r.status));if(t.length<2)return[];const s=[],n=new Set;for(let r=0;r<t.length;r++){if(n.has(t[r].id))continue;const h=t[r],d=[h];n.add(h.id);const v=h.deliveryAddress?.lat,M=h.deliveryAddress?.lng,H=h.deliveryAddress?.pincode,ne=h.deliveryAddress?.city;for(let U=r+1;U<t.length;U++){if(n.has(t[U].id))continue;const g=t[U];let L=!1;v&&M&&g.deliveryAddress?.lat&&g.deliveryAddress?.lng?De(v,M,g.deliveryAddress.lat,g.deliveryAddress.lng)<=2&&(L=!0):(H&&g.deliveryAddress?.pincode&&H===g.deliveryAddress.pincode&&ne&&g.deliveryAddress?.city&&ne===g.deliveryAddress.city||h.customerDistance!=null&&g.customerDistance!=null&&Math.abs(h.customerDistance-g.customerDistance)<=1)&&(L=!0),L&&(d.push(g),n.add(g.id))}d.length>=2&&d.length<=3&&s.push(d)}return s};return T?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium text-gray-500 uppercase tracking-wider mb-2",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-3",children:[e.jsx(y.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:`rounded-xl p-3 border ${$>0?"bg-yellow-500/20 border-yellow-500/30":"bg-white/5 border-white/10"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-xs",children:"New"}),e.jsx("p",{className:"text-lg font-bold text-white",children:$})]}),$>0&&e.jsx(y.div,{animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:1.5},className:"w-8 h-8 rounded-full bg-yellow-500/30 flex items-center justify-center",children:e.jsx(ce,{className:"text-yellow-400 text-sm"})})]})}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-3 border border-white/10",children:[e.jsx("p",{className:"text-white/60 text-xs",children:"Active"}),e.jsx("p",{className:"text-lg font-bold text-blue-400",children:le})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-3 border border-white/10",children:[e.jsx("p",{className:"text-white/60 text-xs",children:"Completed"}),e.jsx("p",{className:"text-lg font-bold text-emerald-400",children:i.filter(t=>t.status==="delivered").length})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-3 border border-white/10",children:[e.jsx("p",{className:"text-white/60 text-xs",children:"Total"}),e.jsx("p",{className:"text-lg font-bold text-white",children:i.length})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium text-gray-500 uppercase tracking-wider mb-2",children:"Filter"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 scrollbar-hide -mx-1",children:[{id:"all",label:"All"},{id:"new",label:"New",count:$},{id:"active",label:"Active",count:le},{id:"completed",label:"Completed"},{id:"cancelled",label:"Cancelled"}].map(t=>e.jsxs("button",{onClick:()=>P(t.id),className:`flex-shrink-0 px-3 py-2 rounded-xl text-sm font-medium whitespace-nowrap transition ${m===t.id?"bg-emerald-500 text-white":"bg-white/10 text-white/80"}`,children:[t.label,t.count!=null&&t.count>0&&e.jsx("span",{className:`ml-1.5 px-1.5 py-0.5 rounded-full text-[10px] ${m===t.id?"bg-white/25":"bg-white/20"}`,children:t.count})]},t.id))})]}),(()=>{const t=Me();return t.length===0||m!=="active"&&m!=="all"?null:e.jsxs(y.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-emerald-500/20 via-blue-500/20 to-cyan-500/20 border-2 border-emerald-500/40 rounded-xl p-5 shadow-lg shadow-emerald-500/10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-500/30 flex items-center justify-center",children:e.jsx(E,{className:"text-emerald-400 text-lg"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-bold text-lg",children:"ðŸšš Batch Delivery Suggestions"}),e.jsx("p",{className:"text-white/60 text-xs",children:"Deliver multiple orders together to save time & fuel"})]})]}),e.jsx("div",{className:"space-y-3",children:t.map((s,n)=>e.jsxs(y.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:n*.1},className:"bg-white/10 rounded-lg p-4 border border-emerald-500/30 hover:border-emerald-500/50 transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-white font-semibold text-sm mb-1",children:["Combine ",s.length," orders for efficient delivery:"]}),e.jsx("p",{className:"text-emerald-300 text-xs",children:"Customers are located nearby - can be delivered in one trip"})]}),e.jsxs("span",{className:"px-2.5 py-1 bg-emerald-500/30 text-emerald-300 rounded-lg text-xs font-bold",children:[s.length," orders"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:s.map(r=>e.jsxs("div",{className:"px-3 py-1.5 bg-emerald-500/20 border border-emerald-500/40 rounded-lg text-emerald-300 text-xs font-mono font-semibold hover:bg-emerald-500/30 transition cursor-pointer",onClick:()=>w(r),children:["#",r.id?.slice(-6).toUpperCase()]},r.id))}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-white/60",children:[s[0].deliveryAddress?.pincode&&e.jsxs("span",{children:["ðŸ“ Pincode: ",s[0].deliveryAddress.pincode]}),s[0].customerDistance!=null&&e.jsxs("span",{children:["ðŸ“ ~",s[0].customerDistance.toFixed(1),"km from store"]})]})]},n))})]})})(),ae.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Fe,{className:"text-4xl text-white/20 mx-auto mb-3"}),e.jsx("p",{className:"text-white/60",children:"No orders found"}),e.jsx("p",{className:"text-sm text-white/40 mt-1",children:m==="new"?"Waiting for new customer orders...":"Orders will appear here"})]}):e.jsx("div",{className:"space-y-4",children:ae.map(t=>{const s=re(t.status,t.orderType),n=s.icon,r=ke(t),h=p===t.id;return t.orderType,e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`bg-white/5 rounded-xl border overflow-hidden ${t.status==="pending"?"border-yellow-500/50 shadow-lg shadow-yellow-500/10":"border-white/10"}`,children:[e.jsxs("div",{className:"p-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-mono text-sm",children:["#",t.id?.slice(-6).toUpperCase()]}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium bg-${s.color}-500/20 text-${s.color}-300 flex items-center gap-1`,children:[e.jsx(n,{className:"text-xs"}),s.label]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white/50 text-sm",children:Ce(t.createdAt)}),(()=>{const d=Ae(t);if(d===null)return null;const v=Se(d),M={red:"bg-red-500/20 text-red-300 border-red-500/40",orange:"bg-orange-500/20 text-orange-300 border-orange-500/40",yellow:"bg-yellow-500/20 text-yellow-300 border-yellow-500/40",green:"bg-green-500/20 text-green-300 border-green-500/40",gray:"bg-gray-500/20 text-gray-300 border-gray-500/40"};return e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-semibold border flex items-center gap-1 ${M[v]}`,children:[e.jsx(A,{className:"text-xs"}),d>0?`${d}m left`:"Overdue"]})})()]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-white/70",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"text-white/40"}),t.customerName||"Customer"]}),t.customerPhone&&e.jsxs("a",{href:`tel:${t.customerPhone}`,className:"flex items-center gap-1 text-emerald-400 hover:text-emerald-300",children:[e.jsx(ge,{className:"text-xs"}),t.customerPhone]})]})]}),e.jsxs("div",{className:"p-4 border-b border-white/10",children:[e.jsxs("div",{className:"space-y-2",children:[(t.items||[]).slice(0,3).map((d,v)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-white/80",children:[d.quantity,"x ",d.name]}),e.jsxs("span",{className:"text-white/60",children:["â‚¹",d.total||d.price*d.quantity]})]},v)),(t.items||[]).length>3&&e.jsxs("p",{className:"text-white/40 text-sm",children:["+",t.items.length-3," more items"]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10 flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"Total"}),e.jsxs("span",{className:"text-emerald-400 font-bold text-lg",children:["â‚¹",t.total||0]})]})]}),t.orderType==="pickup"?e.jsxs("div",{className:"px-4 py-3 bg-purple-500/10 border-b border-purple-500/20",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs("div",{className:"px-2 py-1 bg-purple-500/20 rounded-full flex items-center gap-1.5",children:[e.jsx(I,{className:"text-purple-400 text-xs"}),e.jsx("span",{className:"text-purple-300 text-xs font-medium",children:"Store Pickup"})]})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"text-purple-400"}),e.jsx("span",{className:"text-white/80",children:t.pickupDateLabel||"Today"})]}),t.pickupSlot?.time&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"text-purple-400"}),e.jsx("span",{className:"text-white/80",children:t.pickupSlot.time})]})]})]}):t.deliveryAddress?e.jsxs("div",{className:"px-4 py-3 bg-cyan-500/10 border-b border-cyan-500/20",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs("div",{className:"px-2 py-1 bg-cyan-500/20 rounded-full flex items-center gap-1.5",children:[e.jsx(E,{className:"text-cyan-400 text-xs"}),e.jsx("span",{className:"text-cyan-300 text-xs font-medium",children:"Delivery"})]})}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(Ee,{className:"text-cyan-400 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80",children:t.deliveryAddress.label||"Delivery Address"}),e.jsxs("p",{className:"text-white/50 text-xs",children:[t.deliveryAddress.address,", ",t.deliveryAddress.city," - ",t.deliveryAddress.pincode]})]})]}),t.deliverySlot&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm",children:[e.jsx(A,{className:"text-cyan-400"}),e.jsxs("span",{className:"text-white/60",children:["Delivery: ",t.deliverySlot]})]}),t.orderType!=="pickup"&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm",children:[e.jsx(A,{className:"text-amber-400"}),e.jsxs("span",{className:"px-2.5 py-1 rounded-lg bg-amber-500/20 text-amber-300 text-xs font-semibold border border-amber-500/30",children:["Suggested: ~",V(t)," min"]})]})]}):null,t.status!=="delivered"&&t.status!=="cancelled"&&e.jsxs("div",{className:"p-4 flex flex-wrap gap-2",children:[r&&e.jsx("button",{onClick:r.action,disabled:h,className:`flex-1 min-w-[140px] px-4 py-2.5 bg-${r.color}-500 text-white font-medium rounded-lg hover:opacity-90 transition disabled:opacity-50 flex items-center justify-center gap-2`,children:h?e.jsx(oe,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),r.label]})}),t.status==="pending"&&e.jsxs("button",{onClick:()=>Ne(t.id),disabled:h,className:"px-4 py-2.5 bg-red-500/20 text-red-300 font-medium rounded-lg hover:bg-red-500/30 transition disabled:opacity-50 flex items-center gap-2",children:[e.jsx(G,{}),"Reject"]}),e.jsxs("button",{onClick:()=>Q(t),className:"px-4 py-2.5 bg-blue-500/20 text-blue-300 font-medium rounded-lg hover:bg-blue-500/30 transition flex items-center gap-2",children:[e.jsx(xe,{}),"Chat"]}),e.jsx("button",{onClick:()=>w(t),className:"px-4 py-2.5 bg-white/10 text-white/70 font-medium rounded-lg hover:bg-white/20 transition",children:"View Details"})]})]},t.id)})}),e.jsx(W,{children:a&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>w(null),children:e.jsxs(y.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-slate-800 rounded-2xl max-w-lg w-full max-h-[80vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"p-5 border-b border-white/10 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Order #",a.id?.slice(-6).toUpperCase()]}),e.jsx("button",{onClick:()=>w(null),className:"p-2 hover:bg-white/10 rounded-lg transition",children:e.jsx(G,{className:"text-white/60"})})]}),e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[(()=>{const t=re(a.status,a.orderType),s=t.icon;return e.jsxs("span",{className:`px-3 py-1.5 rounded-full text-sm font-medium bg-${t.color}-500/20 text-${t.color}-300 flex items-center gap-2`,children:[e.jsx(s,{}),t.label]})})(),a.orderType==="pickup"&&e.jsxs("span",{className:"px-3 py-1.5 rounded-full text-sm font-medium bg-purple-500/20 text-purple-300 flex items-center gap-2",children:[e.jsx(I,{className:"text-xs"}),"Pickup Order"]})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm text-white/60 mb-2",children:"Customer"}),e.jsx("p",{className:"text-white font-medium",children:a.customerName}),e.jsx("p",{className:"text-white/60 text-sm",children:a.customerPhone})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm text-white/60 mb-3",children:"Items"}),e.jsx("div",{className:"space-y-2",children:(a.items||[]).map((t,s)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-white",children:[t.quantity,"x ",t.name]}),e.jsxs("span",{className:"text-white/60",children:["â‚¹",t.total||t.price*t.quantity]})]},s))}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10",children:[e.jsxs("div",{className:"flex justify-between text-sm text-white/60 mb-1",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["â‚¹",a.subtotal||a.total]})]}),a.deliveryFee>0&&e.jsxs("div",{className:"flex justify-between text-sm text-white/60 mb-1",children:[e.jsx("span",{children:"Delivery"}),e.jsxs("span",{children:["â‚¹",a.deliveryFee]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{className:"text-white",children:"Total"}),e.jsxs("span",{className:"text-emerald-400",children:["â‚¹",a.total]})]})]})]}),a.orderType==="pickup"?e.jsxs("div",{className:"bg-purple-500/10 rounded-xl p-4 border border-purple-500/20",children:[e.jsxs("h4",{className:"text-sm text-purple-400 mb-3 flex items-center gap-2",children:[e.jsx(I,{}),"Store Pickup"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"text-purple-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:a.pickupDateLabel||"Today"}),e.jsx("p",{className:"text-white/50 text-xs",children:"Pickup Date"})]})]}),a.pickupSlot?.time&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"text-purple-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:a.pickupSlot.time}),e.jsx("p",{className:"text-white/50 text-xs",children:"Pickup Time"})]})]})]}),a.pickupInstructions&&e.jsx("p",{className:"text-white/60 text-sm mt-3 pt-3 border-t border-purple-500/20",children:a.pickupInstructions})]}):a.deliveryAddress?e.jsxs("div",{className:"bg-white/5 rounded-xl p-4",children:[e.jsxs("h4",{className:"text-sm text-white/60 mb-2 flex items-center gap-2",children:[e.jsx(E,{}),"Delivery Address"]}),e.jsx("p",{className:"text-white",children:a.deliveryAddress.label}),e.jsx("p",{className:"text-white/60 text-sm",children:a.deliveryAddress.address}),e.jsxs("p",{className:"text-white/60 text-sm",children:[a.deliveryAddress.city," - ",a.deliveryAddress.pincode]}),a.deliverySlot&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 pt-2 border-t border-white/10",children:[e.jsx(A,{className:"text-white/40"}),e.jsxs("span",{className:"text-white/60 text-sm",children:["Delivery: ",a.deliverySlot]})]}),a.orderType!=="pickup"&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 pt-2 border-t border-white/10",children:[e.jsx(A,{className:"text-amber-400"}),e.jsxs("span",{className:"px-2.5 py-1 rounded-lg bg-amber-500/20 text-amber-300 text-sm font-semibold border border-amber-500/30",children:["Suggested delivery: ~",V(a)," min"]})]})]}):null,e.jsxs("div",{className:"bg-white/5 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm text-white/60 mb-2",children:"Payment"}),e.jsx("p",{className:"text-white capitalize",children:a.paymentMethod||"Cash on Delivery"}),e.jsx("p",{className:"text-white/60 text-sm capitalize",children:a.paymentStatus||"pending"})]}),a.deliveryAgent&&e.jsxs("div",{className:"bg-cyan-500/10 rounded-xl p-4 border border-cyan-500/30",children:[e.jsxs("h4",{className:"text-sm text-cyan-400 mb-2 flex items-center gap-2",children:[e.jsx(Y,{}),"Delivery Agent"]}),e.jsx("p",{className:"text-white font-medium",children:a.deliveryAgent.name}),e.jsx("p",{className:"text-white/60 text-sm",children:a.deliveryAgent.phone}),a.deliveryAgent.vehicleNumber&&e.jsx("p",{className:"text-white/40 text-xs mt-1",children:a.deliveryAgent.vehicleNumber})]}),e.jsxs("button",{onClick:()=>{w(null),Q(a)},className:"w-full py-3 bg-blue-500 text-white font-medium rounded-xl hover:bg-blue-600 transition flex items-center justify-center gap-2",children:[e.jsx(xe,{}),"Chat with Customer"]})]})]})})}),e.jsx(W,{children:K&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>N(!1),children:e.jsxs(y.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-slate-800 rounded-2xl max-w-md w-full",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"p-5 border-b border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(E,{className:"text-cyan-400"}),"Assign Delivery Agent"]}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Enter delivery person details before dispatching"})]}),e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-xl border border-white/10",children:[e.jsx("input",{type:"checkbox",id:"assignToEmployee",checked:b,onChange:t=>{D(t.target.checked),t.target.checked?l({name:"",phone:"",vehicleNumber:""}):f("")},className:"w-4 h-4 accent-cyan-500"}),e.jsx("label",{htmlFor:"assignToEmployee",className:"text-white/80 text-sm cursor-pointer",children:"Assign to Employee"})]}),b&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/70 text-sm mb-2",children:"Select Employee *"}),e.jsxs("select",{value:C,onChange:t=>{f(t.target.value);const s=x.find(n=>n.id===t.target.value);s&&l({name:s.name||"",phone:s.phone||"",vehicleNumber:""})},className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"",children:"Select Employee"}),x.map(t=>e.jsxs("option",{value:t.id,className:"bg-slate-800",children:[t.name||t.flypEmployeeId||t.id," ",t.phone?`- ${t.phone}`:""]},t.id))]}),x.length===0&&e.jsx("p",{className:"text-yellow-400 text-xs mt-2",children:"No active employees found. Add employees from Employee Management."})]}),!b&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/70 text-sm mb-2",children:"Delivery Person Name *"}),e.jsx("input",{type:"text",value:u.name,onChange:t=>l(s=>({...s,name:t.target.value})),placeholder:"Enter name",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/40 focus:outline-none focus:border-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/70 text-sm mb-2",children:"Phone Number *"}),e.jsx("input",{type:"tel",value:u.phone,onChange:t=>l(s=>({...s,phone:t.target.value})),placeholder:"+91 XXXXXXXXXX",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/40 focus:outline-none focus:border-cyan-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/70 text-sm mb-2",children:"Vehicle Number (Optional)"}),e.jsx("input",{type:"text",value:u.vehicleNumber,onChange:t=>l(s=>({...s,vehicleNumber:t.target.value})),placeholder:"MH XX AB 1234",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/40 focus:outline-none focus:border-cyan-500"})]})]}),e.jsxs("div",{className:"p-5 border-t border-white/10 flex gap-3",children:[e.jsx("button",{onClick:()=>N(!1),className:"flex-1 px-4 py-3 bg-white/10 text-white/70 font-medium rounded-xl hover:bg-white/20 transition",children:"Cancel"}),e.jsx("button",{onClick:we,disabled:p===k||(b?!C:!u.name||!u.phone),className:"flex-1 px-4 py-3 bg-cyan-500 text-white font-medium rounded-xl hover:bg-cyan-600 transition disabled:opacity-50 flex items-center justify-center gap-2",children:p===k?e.jsx(oe,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(E,{}),b?"Assign to Employee":"Dispatch Order"]})})]})]})})}),e.jsx(W,{children:te&&e.jsx(Ze,{order:te,onClose:()=>Q(null)})})]})};export{ct as default};
