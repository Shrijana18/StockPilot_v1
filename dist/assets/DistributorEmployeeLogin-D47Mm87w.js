import{j as e,e as S,b as d,i as x,k as E,y as N}from"./index-DRC3F7i0.js";import{r as p,b as L,u as k}from"./router-BPBaD_i0.js";import{httpsCallable as D}from"./index.esm-Bux_mLJ0.js";import{f as P,h as C}from"./firebase-DWi1MSv1.js";import{m as _}from"./proxy-BgUy8BPw.js";import"./vendor-Ckhrjn13.js";const q=()=>{const[n,f]=p.useState({employeeId:"",pin:""}),[g,i]=p.useState(!1),[h,o]=p.useState(""),[y]=L(),w=k(),a=y.get("distributorId"),c=y.get("empId");p.useEffect(()=>{if(c){f(s=>({...s,employeeId:c.toUpperCase()}));const l=document.querySelector('input[name="pin"]');l&&setTimeout(()=>l.focus(),100)}},[c]);const I=async l=>{l.preventDefault(),o(""),i(!0);try{if(!n.employeeId.trim()||!n.pin.trim()){o("Please enter both Employee ID and PIN"),i(!1);return}const m=await D(S,"distributorEmployeeLogin")({...a&&{distributorId:a},employeeId:n.employeeId.toUpperCase(),pin:n.pin});if(!m.data.success){o(m.data.message||"Login failed. Please try again."),i(!1);return}const{employeeData:t,customToken:u}=m.data;if(!u||typeof u!="string"||u.trim().length===0){console.error("[DistributorEmployeeLogin] ❌ Invalid custom token received"),o("Login failed: Invalid authentication token. Please try again."),i(!1);return}try{if(!d){console.error("[DistributorEmployeeLogin] ❌ empAuth instance is null/undefined"),o("Login failed: Authentication service unavailable. Please try again."),i(!1);return}if(d.currentUser)try{await P(d),await new Promise(r=>setTimeout(r,200))}catch(r){console.warn("[DistributorEmployeeLogin] Sign out failed (non-fatal):",r)}if(await C(d,u),!d.currentUser){console.error("[DistributorEmployeeLogin] ❌ Auth not set after signInWithCustomToken"),o("Login failed: Authentication not set. Please try again."),i(!1);return}console.log("[DistributorEmployeeLogin] ✅ Signed in successfully:",d.currentUser.uid)}catch(r){console.error("[DistributorEmployeeLogin] ❌ signInWithCustomToken failed:",r),o(r?.message||"Login failed: Authentication error. Please try again."),i(!1);return}x({employeeId:String(t.id||"").trim(),distributorId:String(t.distributorId||a||"").trim(),name:t.name||"",role:t.role||"Employee",flypEmployeeId:String(t.flypEmployeeId||t.id||"").trim(),accessSections:t.accessSections||{}}),E();try{localStorage.setItem("__flyp_commit_check",Date.now().toString()),localStorage.removeItem("__flyp_commit_check"),localStorage.getItem("flyp_distributor_employee_session")||(console.warn("[Login] Session storage verification failed, retrying..."),x({employeeId:String(t.id||"").trim(),distributorId:String(t.distributorId||a||"").trim(),name:t.name||"",role:t.role||"Employee",flypEmployeeId:String(t.flypEmployeeId||t.id||"").trim(),accessSections:t.accessSections||{}}))}catch(r){console.error("[Login] Failed to verify localStorage commit:",r)}N.success("Login successful! Redirecting...");const j=typeof window<"u"&&window.Capacitor,v=window.location.hostname!=="localhost";j?setTimeout(()=>{w("/distributor-employee-dashboard",{replace:!0})},300):setTimeout(()=>{window.location.href="/distributor-employee-dashboard"},v?1e3:500)}catch(s){console.error("Login error:",s),o(s.message||"Login failed. Please try again."),i(!1)}},b=l=>{const{name:s,value:m}=l.target;f(t=>({...t,[s]:m}))};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4",children:e.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-md",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 shadow-2xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-emerald-500/20 rounded-full mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Distributor Employee Login"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Enter your credentials to access the system"})]}),e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[h&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/30 text-red-300 px-4 py-3 rounded-lg text-sm",children:h}),a&&c&&e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/30 text-emerald-300 px-4 py-3 rounded-lg text-sm",children:[e.jsx("p",{className:"font-medium",children:"✓ Using Shared Link"}),e.jsx("p",{className:"text-xs mt-1",children:"Your Employee ID has been pre-filled from the link."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/90 mb-2",children:"Employee ID"}),e.jsx("input",{type:"text",name:"employeeId",value:n.employeeId,onChange:b,className:"w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all",placeholder:"FLYP-DIST-XXXXXX",required:!0}),a&&c&&e.jsx("p",{className:"text-xs text-emerald-300 mt-1",children:"Pre-filled from shared link"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/90 mb-2",children:"PIN"}),e.jsx("input",{type:"password",name:"pin",value:n.pin,onChange:b,className:"w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all",placeholder:"Enter your PIN",required:!0})]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full py-3 px-4 bg-emerald-500 hover:bg-emerald-600 disabled:bg-emerald-500/50 text-white font-semibold rounded-lg transition-colors duration-200 disabled:cursor-not-allowed",children:g?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Signing In..."]}):"Sign In"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-white/50 text-xs",children:"Need help? Contact your manager for assistance."})})]})})})};export{q as default};
