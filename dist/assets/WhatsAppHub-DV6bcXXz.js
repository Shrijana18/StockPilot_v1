import{l as ge,d as T,j as e,y as f,r as Qe,s as Xe,a as Ss,u as Cs,g as ks,w as hs}from"./index-DRC3F7i0.js";import{r,R as Es,u as zs}from"./router-BPBaD_i0.js";import{c as Y,q as ue,o as ke,p as ye,u as Fe,d as ae,s as te,g as oe,e as fe,b as we,a as Is,v as Ae,w as is,m as Os,l as Me}from"./firebase-DWi1MSv1.js";import{g as Te,s as He,a as $s,W as Ke}from"./whatsappService-BELSGllU.js";import{R as Le,Z as os,e as Ce,B as Je,ay as _e,v as qe,_ as Ds,S as cs,C as Ie,q as gs,b5 as ze,au as Pe,W as Fs,b6 as Hs,b7 as Ks,A as Ms,X as Ge,as as As,aI as Gs,m as ds,aq as qs,aY as $e,b8 as as,b2 as Se,am as Ze,b9 as Vs,ba as Ys,at as es,bb as Qs,p as Ne,ae as ss,aT as xs,o as bs,a as _s,u as fs,b3 as Us,b4 as Xs,ak as Re,aW as Ts,ah as Ps,h as ms,V as rs,P as Js,N as js,a_ as Zs,ax as et,y as xe,z as me,bc as ns,a3 as us,g as Rs,d as We,ac as st,aj as tt,aL as at,T as ls,K as rt,I as nt,U as lt}from"./index-CprmGC-M.js";import{m as ne}from"./proxy-BgUy8BPw.js";import{A as ve}from"./index-DSciU07p.js";import{httpsCallable as ys}from"./index.esm-Bux_mLJ0.js";import{a as Ns,H as De}from"./index-CNZ3HuWf.js";import{W as it}from"./WhatsAppConnection-C8P9Ymrj.js";import"./vendor-Ckhrjn13.js";import"./whatsappConfig-B767RKqS.js";const he={STOCK_REMINDER:"stock_reminder",PRICE_CHANGE:"price_change",PRODUCT_UPDATE:"product_update",PROMOTIONAL:"promotional",CUSTOM:"custom"},ps=(E,B={})=>{let u=E.message||"";return Object.keys(B).forEach(I=>{const d=new RegExp(`\\{${I}\\}`,"g");u=u.replace(d,B[I]||"")}),E.title&&(u=`*${E.title}*

${u}`),E.linkUrl&&E.linkText&&(u+=`

ðŸ”— ${E.linkText}: ${E.linkUrl}`),u},ot=({onTemplateSelect:E,mode:B="manage"})=>{const[u,I]=r.useState([]),[d,_]=r.useState(!0),[D,$]=r.useState(!1),[i,F]=r.useState(null),[O,Q]=r.useState(!1),[L,y]=r.useState(null),[p,l]=r.useState(new Set),[b,H]=r.useState(!1),[P,n]=r.useState([]),[g,K]=r.useState(""),[v,N]=r.useState({name:"",type:he.STOCK_REMINDER,title:"",message:"",imageUrl:"",videoUrl:"",linkUrl:"",linkText:"",variables:[],metaApprovalStatus:"not_required",metaTemplateName:""}),m=ge.currentUser?.uid,R=[{name:"Stock Reminder - Low Stock Alert",type:he.STOCK_REMINDER,title:"ðŸ“¦ Stock Reminder",message:`Hello!

Your product *{productName}* is running low on stock.

ðŸ“Š Current Stock: {stock}

ðŸ’¡ We recommend placing an order soon to avoid stockout.

Reply to this message to place your order!

_Powered by FLYP_`,variables:["productName","stock"],metaApprovalStatus:"not_required",metaTemplateName:""},{name:"Price Change Notification",type:he.PRICE_CHANGE,title:"ðŸ’° Price Update",message:`Hello!

We have an important update regarding *{productName}*:

ðŸ’° *New Price:* {newPrice}
~~Old Price: {oldPrice}~~

ðŸ“‰ *Discount:* {discount}%

ðŸ›’ Order now to avail this special price!

_Powered by FLYP_`,variables:["productName","oldPrice","newPrice","discount"],metaApprovalStatus:"not_required",metaTemplateName:""},{name:"Product Update Announcement",type:he.PRODUCT_UPDATE,title:"ðŸ†• Product Update",message:`Hello!

We have exciting news about *{productName}*:

âœ¨ {updateDetails}

ðŸ“¦ *Price:* {price}
ðŸ“Š *Stock Available:* {stock}

Interested? Reply to this message to place your order!

_Powered by FLYP_`,variables:["productName","updateDetails","price","stock"],metaApprovalStatus:"not_required",metaTemplateName:""},{name:"Special Offer - Promotional",type:he.PROMOTIONAL,title:"ðŸŽ‰ Special Offer!",message:`Hello!

ðŸŽ‰ *{offerTitle}*

{offerDescription}

ðŸ’° *Discount:* {discount}
ðŸ“… *Valid Until:* {validUntil}

ðŸ›’ Don't miss out on this amazing deal!

Reply to this message to place your order!

_Powered by FLYP_`,variables:["offerTitle","offerDescription","discount","validUntil"],metaApprovalStatus:"not_required",metaTemplateName:""},{name:"Bulk Stock Reminder",type:he.STOCK_REMINDER,title:"ðŸ“¦ Multiple Products Low Stock",message:`Hello!

You have *{productCount} products* running low on stock:

{productList}

ðŸ’¡ We recommend placing an order soon to avoid stockout.

Reply to this message to place your order!

_Powered by FLYP_`,variables:["productCount","productList"],metaApprovalStatus:"not_required",metaTemplateName:""}],X=async()=>{if(!m)return!1;try{const t=Y(T,"businesses",m,"whatsappTemplates");if((await oe(t)).empty){console.log("ðŸ“ Initializing default templates for distributor:",m);const h=R.map(S=>we(t,{...S,createdAt:te(),updatedAt:te(),isDefault:!0}));return await Promise.all(h),console.log("âœ… Default templates created successfully"),f.success("âœ… Default templates created! You can customize them anytime."),!0}return!1}catch(t){return console.error("âŒ Error initializing default templates:",t),f.error(`Failed to create default templates: ${t.message}`),!1}};r.useEffect(()=>{if(!m)return;let t=!1;const x=async()=>{if(!t){t=!0;try{const s=Y(T,"businesses",m,"whatsappTemplates"),c=await oe(s);console.log("ðŸ” Checking for existing templates...",c.empty?"None found":`Found ${c.size} templates`),c.empty&&(console.log("ðŸ“ No templates found, initializing defaults..."),await X()&&console.log("âœ… Default templates initialization completed"))}catch(s){console.error("âŒ Error checking/initializing templates:",s),f.error(`Template initialization error: ${s.message}`)}}},h=Y(T,"businesses",m,"whatsappTemplates"),S=ue(h,ke("createdAt","desc")),C=ye(S,async s=>{const c=s.docs.map(k=>({id:k.id,...k.data()}));if(console.log("ðŸ“‹ Templates loaded from Firestore:",c.length),c.length===0&&!t){console.log("ðŸ”„ Listener detected no templates, initializing..."),await x();return}I(c),_(!1)},s=>{console.error("âŒ Error in template listener:",s),_(!1),s.code==="permission-denied"&&(console.log("âš ï¸ Permission denied, but attempting initialization..."),x())});return x(),()=>C()},[m]),r.useEffect(()=>{if(!m||B!=="manage")return;(async()=>{try{const x=Y(T,"businesses",m,"connectedRetailers"),S=(await oe(x)).docs.map(async s=>{const c=s.data(),k=s.id;let a=c.phone||c.retailerPhone||"";if(!a&&k)try{const j=ae(T,"businesses",k),U=await fe(j);if(U.exists()){const W=U.data();a=W.phone||W.ownerPhone||""}}catch(j){console.warn("Could not fetch phone:",j)}return{id:k,...c,phone:a,businessName:c.businessName||c.retailerName||""}}),C=await Promise.all(S);n(C)}catch(x){console.error("Error loading retailers:",x)}})()},[m,B]);const M=async t=>{if(t){Q(!0);try{const x=Qe(Xe,`whatsapp-templates/${m}/${Date.now()}_${t.name}`);await Cs(x,t);const h=await ks(x);N(S=>({...S,imageUrl:h})),f.success("âœ… Image uploaded!")}catch(x){console.error("Error uploading image:",x),f.error("âŒ Failed to upload image")}finally{Q(!1)}}},Z=async t=>{if(t){Q(!0);try{const x=Qe(Xe,`whatsapp-templates/${m}/${Date.now()}_${t.name}`);await Cs(x,t);const h=await ks(x);N(S=>({...S,videoUrl:h})),f.success("âœ… Video uploaded!")}catch(x){console.error("Error uploading video:",x),f.error("âŒ Failed to upload video")}finally{Q(!1)}}},G=async()=>{if(!v.name||!v.message){f.error("Please fill in template name and message");return}try{const t={...v,createdAt:i?void 0:te(),updatedAt:te()};i?(await Fe(ae(T,"businesses",m,"whatsappTemplates",i.id),t),f.success("âœ… Template updated!")):(await we(Y(T,"businesses",m,"whatsappTemplates"),t),f.success("âœ… Template created!")),$(!1),F(null),N({name:"",type:he.STOCK_REMINDER,title:"",message:"",imageUrl:"",videoUrl:"",linkUrl:"",linkText:"",variables:[]})}catch(t){console.error("Error saving template:",t),f.error("âŒ Failed to save template")}},A=async(t,x,h)=>{if(window.confirm("Are you sure you want to delete this template?"))try{if(await Is(ae(T,"businesses",m,"whatsappTemplates",t)),x)try{const S=Qe(Xe,x);await Ss(S)}catch(S){console.warn("Could not delete image:",S)}if(h)try{const S=Qe(Xe,h);await Ss(S)}catch(S){console.warn("Could not delete video:",S)}f.success("âœ… Template deleted!")}catch(S){console.error("Error deleting template:",S),f.error("âŒ Failed to delete template")}},o=t=>{F(t),N({name:t.name||"",type:t.type||he.STOCK_REMINDER,title:t.title||"",message:t.message||"",imageUrl:t.imageUrl||"",videoUrl:t.videoUrl||"",linkUrl:t.linkUrl||"",linkText:t.linkText||"",variables:t.variables||[],metaApprovalStatus:t.metaApprovalStatus||"not_required",metaTemplateName:t.metaTemplateName||""}),$(!0)},w=t=>{E&&E(t)},z=async()=>{if(!L){f.error("Please select a template");return}const t=P.filter(s=>p.has(s.id)&&s.phone),x=g.trim().split(",").map(s=>s.trim()).filter(s=>s.length>=10);if(t.length===0&&x.length===0){f.error("Please select at least one retailer or enter phone numbers");return}const h=await Te(m);if(!h||!h.enabled){f.warning("WhatsApp not configured. Please set it up in Profile Settings.");return}H(!0);let S=0,C=0;try{for(const s of t)try{const c=ps(L,{retailerName:s.businessName||"Retailer"});(await He(m,s.phone,c,{messageType:L.type||"custom",metadata:{templateId:L.id,templateName:L.name,imageUrl:L.imageUrl,videoUrl:L.videoUrl,linkUrl:L.linkUrl,retailerId:s.id,retailerName:s.businessName},logMessage:!0})).success?S++:C++}catch(c){console.error("Error sending message:",c),C++}for(const s of x)try{const c=ps(L,{});(await He(m,s,c,{messageType:L.type||"custom",metadata:{templateId:L.id,templateName:L.name},logMessage:!0})).success?S++:C++}catch(c){console.error("Error sending message:",c),C++}S>0&&(f.success(`âœ… Successfully sent to ${S} recipient(s)!`),y(null),l(new Set),K("")),C>0&&f.warning(`âš ï¸ Failed to send to ${C} recipient(s)`)}catch(s){console.error("Error in quick send:",s),f.error("âŒ Failed to send messages")}finally{H(!1)}};return d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 border-2 border-[#00a884] border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŽ¨"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Message Templates"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Create beautiful templates with images, videos, and links"})]})]}),B==="manage"&&e.jsxs("button",{onClick:()=>{F(null),N({name:"",type:he.STOCK_REMINDER,title:"",message:"",imageUrl:"",videoUrl:"",linkUrl:"",linkText:"",variables:[]}),$(!0)},className:"px-4 py-2 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white rounded-lg font-semibold text-sm flex items-center gap-2",children:[e.jsx(Le,{})," Create Template"]})]}),B==="manage"&&u.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-emerald-900/20 via-teal-900/10 to-cyan-900/20 border border-emerald-500/30 rounded-xl p-6 mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-1 flex items-center gap-2",children:[e.jsx("span",{children:"âš¡"}),"Quick Send - Ready to Use Templates"]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Select a template, choose retailers/phone numbers, and send instantly - No setup needed!"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:"Step 1: Choose a Template"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:u.slice(0,6).map(t=>e.jsxs("button",{onClick:()=>{y(t)},className:`p-4 rounded-lg border text-left transition-all ${L?.id===t.id?"bg-emerald-500/20 border-emerald-500/50 ring-2 ring-emerald-500/50":"bg-slate-800/60 border-white/10 hover:border-emerald-500/30 hover:bg-slate-700/60"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-white text-sm flex-1",children:t.name}),L?.id===t.id&&e.jsx(os,{className:"text-emerald-400 flex-shrink-0 ml-2"})]}),t.title&&e.jsxs("p",{className:"text-xs text-gray-300 mb-1",children:["*",t.title,"*"]}),e.jsx("p",{className:"text-xs text-gray-400 line-clamp-2 mb-2",children:t.message}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs bg-emerald-500/20 text-emerald-300 px-2 py-0.5 rounded",children:t.type?.replace("_"," ")}),t.isDefault&&e.jsx("span",{className:"text-xs bg-blue-500/20 text-blue-300 px-2 py-0.5 rounded",children:"Default"}),t.metaApprovalStatus==="verified"&&e.jsxs("span",{className:"text-xs bg-green-500/20 text-green-300 px-2 py-0.5 rounded flex items-center gap-1",children:[e.jsx(os,{className:"text-[10px]"}),"Meta Verified"]}),t.metaApprovalStatus==="pending"&&e.jsx("span",{className:"text-xs bg-yellow-500/20 text-yellow-300 px-2 py-0.5 rounded",children:"â³ Pending Approval"}),t.metaApprovalStatus==="rejected"&&e.jsx("span",{className:"text-xs bg-red-500/20 text-red-300 px-2 py-0.5 rounded",children:"âŒ Rejected"})]})]},t.id))})]}),L&&e.jsxs("div",{className:"space-y-3 pt-4 border-t border-white/10",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Step 2: Select Retailers or Enter Phone Numbers"}),e.jsx("div",{className:"max-h-40 overflow-y-auto border border-white/10 rounded-lg p-3 bg-slate-800/40 space-y-2",children:P.length===0?e.jsx("p",{className:"text-sm text-gray-400",children:"No retailers connected"}):P.map(t=>{const x=!!t.phone;return e.jsxs("label",{className:`flex items-center gap-2 p-2 rounded cursor-pointer ${x?p.has(t.id)?"bg-emerald-500/20":"hover:bg-slate-700/30":"opacity-60 cursor-not-allowed"}`,children:[e.jsx("input",{type:"checkbox",checked:p.has(t.id),onChange:h=>{if(!x)return;const S=new Set(p);h.target.checked?S.add(t.id):S.delete(t.id),l(S)},disabled:!x,className:"rounded"}),e.jsx("span",{className:"text-sm text-white flex-1",children:t.businessName||"Retailer"}),!x&&e.jsx("span",{className:"text-xs text-red-400",children:"No Phone"})]},t.id)})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Or Enter Phone Numbers (comma-separated)"}),e.jsx("input",{type:"text",value:g,onChange:t=>K(t.target.value),placeholder:"+918329690931, +919876543210",className:"w-full bg-slate-800/60 border border-white/10 text-white px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-sm"})]}),L&&e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3 text-xs",children:[e.jsx("p",{className:"text-blue-300 mb-1",children:e.jsx("strong",{children:"ðŸ“‹ Template Status:"})}),L.metaApprovalStatus==="verified"?e.jsx("p",{className:"text-green-300",children:"âœ… This template is Meta-verified and can be sent to any recipient (even outside 24-hour window)"}):L.metaApprovalStatus==="pending"?e.jsx("p",{className:"text-yellow-300",children:"â³ This template is pending Meta approval. It will be sent as a session message (only to users who messaged you in last 24 hours)."}):e.jsxs("p",{className:"text-gray-300",children:["â„¹ï¸ This template will be sent as a ",e.jsx("strong",{children:"session message"}),' (only to users who messaged you in the last 24 hours). To send to anyone, mark it as "Verified by Meta" and add the Meta template name.']})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{onClick:z,disabled:b||p.size===0&&!g.trim(),className:"w-full px-6 py-3 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white rounded-lg font-semibold flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{}),"Send to ",p.size+(g.trim()?g.split(",").filter(t=>t.trim().length>=10).length:0)," Recipient(s)"]})})})]})]})]}),B==="manage"&&u.length>0&&e.jsxs("div",{className:"flex items-center gap-4 my-6",children:[e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-transparent via-white/20 to-transparent"}),e.jsx("span",{className:"text-xs text-gray-400 uppercase tracking-wider",children:"Or Manage Templates"}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-transparent via-white/20 to-transparent"})]}),u.length===0?e.jsxs("div",{className:"bg-slate-900/80 border border-white/10 rounded-xl p-12 text-center",children:[e.jsx(Ce,{className:"text-[#8696a0] text-5xl mx-auto mb-4"}),e.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"No Templates Yet"}),e.jsx("p",{className:"text-[#8696a0] mb-4",children:B==="manage"?"Create default templates to get started, or create your own custom template":"Create your first template to start sending beautiful messages"}),B==="manage"&&e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsxs("button",{onClick:async()=>{_(!0),await X()?setTimeout(()=>_(!1),2e3):_(!1)},className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg font-semibold flex items-center gap-2",children:[e.jsx(Le,{})," Create Default Templates"]}),e.jsx("span",{className:"text-gray-500",children:"or"}),e.jsx("button",{onClick:()=>$(!0),className:"px-6 py-3 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white rounded-lg font-semibold",children:"Create Custom Template"})]})]}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(t=>e.jsxs(ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`bg-slate-900/80 border border-white/10 rounded-xl overflow-hidden ${B==="select"?"cursor-pointer hover:border-emerald-500/50":""}`,onClick:B==="select"?()=>w(t):void 0,children:[t.imageUrl&&e.jsxs("div",{className:"relative h-40 bg-slate-800",children:[e.jsx("img",{src:t.imageUrl,alt:t.name,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/50 px-2 py-1 rounded text-xs text-white flex items-center gap-1",children:[e.jsx(Je,{})," Image"]})]}),t.videoUrl&&!t.imageUrl&&e.jsxs("div",{className:"relative h-40 bg-slate-800 flex items-center justify-center",children:[e.jsx(_e,{className:"text-4xl text-gray-400"}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/50 px-2 py-1 rounded text-xs text-white flex items-center gap-1",children:[e.jsx(_e,{})," Video"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-white",children:t.name}),t.isDefault&&e.jsx("span",{className:"text-xs bg-blue-500/20 text-blue-300 px-2 py-0.5 rounded",title:"Default template - you can customize it",children:"Default"})]}),e.jsx("span",{className:"text-xs bg-emerald-500/20 text-emerald-300 px-2 py-1 rounded",children:t.type?.replace("_"," ")})]})}),t.title&&e.jsxs("p",{className:"text-sm text-gray-300 mb-2",children:["*",t.title,"*"]}),e.jsx("p",{className:"text-xs text-gray-400 line-clamp-2 mb-3",children:t.message}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap text-xs text-gray-500",children:[t.imageUrl&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Je,{})," Image"]}),t.videoUrl&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_e,{})," Video"]}),t.linkUrl&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(qe,{})," Link"]})]}),B==="manage"&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"Meta Approval:"}),e.jsxs("select",{value:t.metaApprovalStatus||"not_required",onChange:async x=>{try{await Fe(ae(T,"businesses",m,"whatsappTemplates",t.id),{metaApprovalStatus:x.target.value,updatedAt:te()}),f.success("âœ… Approval status updated")}catch(h){console.error("Error updating approval status:",h),f.error("âŒ Failed to update status")}},onClick:x=>x.stopPropagation(),className:"text-xs bg-slate-800/60 border border-white/10 text-white px-2 py-1 rounded focus:outline-none focus:ring-1 focus:ring-emerald-500",children:[e.jsx("option",{value:"not_required",children:"Not Required (Session Message)"}),e.jsx("option",{value:"pending",children:"Pending Approval"}),e.jsx("option",{value:"verified",children:"Verified by Meta"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),t.metaApprovalStatus==="verified"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("input",{type:"text",placeholder:"Meta Template Name (e.g., stock_reminder_v1)",value:t.metaTemplateName||"",onChange:async x=>{try{await Fe(ae(T,"businesses",m,"whatsappTemplates",t.id),{metaTemplateName:x.target.value,updatedAt:te()})}catch(h){console.error("Error updating template name:",h)}},onClick:x=>x.stopPropagation(),className:"w-full text-xs bg-slate-800/60 border border-white/10 text-white px-2 py-1 rounded focus:outline-none focus:ring-1 focus:ring-emerald-500"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:"Enter the exact template name as approved in Meta Business Manager"})]})]}),B==="manage"&&e.jsxs("div",{className:"flex items-center gap-2 mt-4 pt-4 border-t border-white/10",children:[e.jsxs("button",{onClick:x=>{x.stopPropagation(),o(t)},className:"flex-1 px-3 py-2 bg-blue-600/20 border border-blue-500/50 text-blue-300 rounded-lg hover:bg-blue-600/30 text-sm flex items-center justify-center gap-2",children:[e.jsx(Ds,{})," Edit"]}),e.jsx("button",{onClick:x=>{x.stopPropagation(),A(t.id,t.imageUrl,t.videoUrl)},className:"px-3 py-2 bg-red-600/20 border border-red-500/50 text-red-300 rounded-lg hover:bg-red-600/30 text-sm",children:e.jsx(cs,{})})]})]})]},t.id))}),e.jsx(ve,{children:D&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>$(!1),children:e.jsxs(ne.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:t=>t.stopPropagation(),className:"bg-slate-900 rounded-2xl border border-white/10 w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-white/10 flex items-center justify-between sticky top-0 bg-slate-900 z-10",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:i?"Edit Template":"Create Template"}),e.jsx("button",{onClick:()=>$(!1),className:"p-2 rounded-lg hover:bg-slate-800 text-gray-400 hover:text-white",children:e.jsx(Ie,{})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Template Name *"}),e.jsx("input",{type:"text",value:v.name,onChange:t=>N(x=>({...x,name:t.target.value})),placeholder:"e.g., Stock Reminder - Low Stock",className:"w-full bg-slate-800/60 border border-white/10 text-white px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Template Type"}),e.jsxs("select",{value:v.type,onChange:t=>N(x=>({...x,type:t.target.value})),className:"w-full bg-slate-800/60 border border-white/10 text-white px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500",children:[e.jsx("option",{value:he.STOCK_REMINDER,children:"Stock Reminder"}),e.jsx("option",{value:he.PRICE_CHANGE,children:"Price Change"}),e.jsx("option",{value:he.PRODUCT_UPDATE,children:"Product Update"}),e.jsx("option",{value:he.PROMOTIONAL,children:"Promotional"}),e.jsx("option",{value:he.CUSTOM,children:"Custom"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Title (Optional - shown in bold)"}),e.jsx("input",{type:"text",value:v.title,onChange:t=>N(x=>({...x,title:t.target.value})),placeholder:"e.g., ðŸŽ‰ Special Offer!",className:"w-full bg-slate-800/60 border border-white/10 text-white px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Message * (Use ","{variableName}"," for dynamic content)"]}),e.jsx("textarea",{value:v.message,onChange:t=>N(x=>({...x,message:t.target.value})),placeholder:"e.g., Hello! Your product {productName} is running low. Current stock: {stock} units.",rows:6,className:"w-full bg-slate-800/60 border border-white/10 text-white px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Tip: Use variables like ","{productName}",", ","{price}",", ","{stock}",", ","{oldPrice}",", ","{newPrice}"," for dynamic content"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Image (Optional)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>{const x=t.target.files?.[0];x&&M(x)},className:"w-full bg-slate-800/60 border border-white/10 text-white px-4 py-2 rounded-lg",disabled:O}),v.imageUrl&&e.jsxs("div",{className:"mt-2 relative",children:[e.jsx("img",{src:v.imageUrl,alt:"Preview",className:"max-w-xs rounded-lg"}),e.jsx("button",{onClick:()=>N(t=>({...t,imageUrl:""})),className:"absolute top-2 right-2 p-1 bg-red-600 rounded text-white",children:e.jsx(Ie,{})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Video (Optional)"}),e.jsx("input",{type:"file",accept:"video/*",onChange:t=>{const x=t.target.files?.[0];x&&Z(x)},className:"w-full bg-slate-800/60 border border-white/10 text-white px-4 py-2 rounded-lg",disabled:O}),v.videoUrl&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm text-emerald-300",children:["âœ… Video uploaded: ",v.videoUrl.substring(0,50),"..."]}),e.jsx("button",{onClick:()=>N(t=>({...t,videoUrl:""})),className:"mt-2 px-3 py-1 bg-red-600/20 border border-red-500/50 text-red-300 rounded-lg text-sm",children:"Remove Video"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Link URL (Optional)"}),e.jsx("input",{type:"url",value:v.linkUrl,onChange:t=>N(x=>({...x,linkUrl:t.target.value})),placeholder:"https://example.com",className:"w-full bg-slate-800/60 border border-white/10 text-white px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Link Text (Optional)"}),e.jsx("input",{type:"text",value:v.linkText,onChange:t=>N(x=>({...x,linkText:t.target.value})),placeholder:"e.g., View Catalog",className:"w-full bg-slate-800/60 border border-white/10 text-white px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"})]})]}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“‹"}),e.jsx("h4",{className:"text-sm font-semibold text-blue-300",children:"Meta WhatsApp Template Approval"})]}),e.jsxs("p",{className:"text-xs text-gray-400 mb-3",children:[e.jsx("strong",{children:"Note:"}),` Meta requires templates to be pre-approved before sending to users who haven't messaged you in 24 hours. If marked as "Verified by Meta", the template will use Meta's template API. Otherwise, it will be sent as a session message.`]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Approval Status"}),e.jsxs("select",{value:v.metaApprovalStatus||"not_required",onChange:t=>N(x=>({...x,metaApprovalStatus:t.target.value})),className:"w-full bg-slate-800/60 border border-white/10 text-white px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500",children:[e.jsx("option",{value:"not_required",children:"Not Required (Session Message Only)"}),e.jsx("option",{value:"pending",children:"Pending Meta Approval"}),e.jsx("option",{value:"verified",children:"Verified by Meta"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),v.metaApprovalStatus==="verified"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Meta Template Name *"}),e.jsx("input",{type:"text",value:v.metaTemplateName||"",onChange:t=>N(x=>({...x,metaTemplateName:t.target.value})),placeholder:"e.g., stock_reminder_v1 (exact name from Meta Business Manager)",className:"w-full bg-slate-800/60 border border-white/10 text-white px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter the exact template name as it appears in your Meta Business Manager after approval."})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-white/10 flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>$(!1),className:"px-4 py-2 bg-slate-800/60 border border-white/10 text-white rounded-lg hover:bg-slate-700/60",children:"Cancel"}),e.jsx("button",{onClick:G,disabled:O||!v.name||!v.message,className:"px-6 py-2 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white rounded-lg font-semibold flex items-center gap-2 disabled:opacity-50",children:O?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gs,{})," ",i?"Update":"Create"," Template"]})})]})]})})})]})},ct=()=>{const[E,B]=r.useState([]),[u,I]=r.useState(new Set),[d,_]=r.useState([]),[D,$]=r.useState(new Set),[i,F]=r.useState(!0),[O,Q]=r.useState(!1),[L,y]=r.useState(10),[p,l]=r.useState([]),[b,H]=r.useState(null),[P,n]=r.useState(!1),g=ge.currentUser?.uid;r.useEffect(()=>{if(!g)return;const m=Y(T,"businesses",g,"products"),R=ye(m,M=>{const Z=M.docs.map(G=>({id:G.id,...G.data()})).filter(G=>{const A=Number(G.quantity||0);return A>0&&A<=L}).sort((G,A)=>(G.quantity||0)-(A.quantity||0));B(Z),F(!1)}),X=Y(T,"businesses",g,"connectedRetailers");return oe(X).then(async M=>{const Z=M.docs.map(async A=>{const o=A.data(),w=A.id;let z=o.phone||o.retailerPhone||o.retailer?.phone||"";if(!z&&w)try{const t=ae(T,"businesses",w),x=await fe(t);if(x.exists()){const h=x.data();z=h.phone||h.ownerPhone||""}}catch(t){console.warn("Could not fetch phone from retailer document:",t)}return{id:w,...o,phone:z,businessName:o.businessName||o.retailerName||o.retailer?.businessName||"",retailerName:o.retailerName||o.businessName||o.retailer?.retailerName||""}}),G=await Promise.all(Z);_(G)}).catch(M=>{console.error("Error fetching retailers:",M),M.code!=="permission-denied"&&f.error("Failed to load retailers. Please refresh the page.")}),()=>R()},[g,L]),r.useEffect(()=>{if(!g)return;const m=Y(T,"businesses",g,"whatsappTemplates"),R=ue(m,ke("createdAt","desc")),X=ye(R,M=>{const Z=M.docs.map(G=>({id:G.id,...G.data()})).filter(G=>G.type===he.STOCK_REMINDER||G.type===he.PRICE_CHANGE||G.type===he.PRODUCT_UPDATE);l(Z),Z.length>0&&!b&&H(Z[0])},M=>{console.error("Error loading templates:",M),M.code==="permission-denied"?(console.warn("Template access denied - using default messages only"),l([])):(f.error("Failed to load templates. Using default messages."),l([]))});return()=>X()},[g]);const K=async()=>{if(!g)return;const m=await Te(g);if(!m||!m.enabled){f.warning("WhatsApp Business API is not configured. Please set it up in Profile Settings.");return}if(u.size===0||D.size===0){f.error("Please select at least one product and one retailer");return}const R=d.filter(A=>D.has(A.id)&&A.phone),X=d.filter(A=>D.has(A.id)&&!A.phone);if(X.length>0&&R.length===0){f.error("âŒ None of the selected retailers have phone numbers. Please add phone numbers to retailers first.");return}X.length>0&&f.warning(`âš ï¸ ${X.length} retailer(s) don't have phone numbers. They will be skipped.`),Q(!0);let M=0,Z=0;const G=[];try{const A=Array.from(u).map(o=>E.find(w=>w.id===o)).filter(o=>o);if(A.length===0){f.error("No products selected"),Q(!1);return}for(const o of D){const w=d.find(z=>z.id===o);if(!w||!w.phone){Z++;continue}try{let z;if(P&&b){const t={};if(A.length===1){const h=A[0];t.productName=h.name||h.productName||"Product",t.price=`â‚¹${h.sellingPrice||h.mrp||h.price||0}`,t.stock=`${h.quantity||0} ${h.unit||"units"}`}else t.productName=`${A.length} products`,t.productCount=A.length;const x=ps(b,t);z=await He(g,w.phone,x,{messageType:b.type||"stock_reminder",metadata:{templateId:b.id,templateName:b.name,productIds:A.map(h=>h.id),imageUrl:b.imageUrl,videoUrl:b.videoUrl,linkUrl:b.linkUrl,retailerId:w.id,retailerName:w.businessName},logMessage:!0})}else z=await $s(g,A,w.phone,w.businessName||w.retailerName);(z.method==="direct"||z.method==="direct_fallback")&&z.link&&G.push({link:z.link,retailer:w.businessName||w.retailerName,productCount:A.length}),M++}catch(z){console.error("Error sending reminder:",z),Z++}}if(G.length>0&&m.provider===Ke.DIRECT?(G[0].link&&window.open(G[0].link,"_blank"),G.length>1?(f.info(`ðŸ“± WhatsApp Web opened! ${G.length-1} more message(s) will open in new tabs. Each message contains ${A.length} product(s). Please send each one.`,{autoClose:5e3}),G.slice(1).forEach((o,w)=>{setTimeout(()=>{o.link&&window.open(o.link,"_blank")},(w+1)*1e3)})):f.success(`ðŸ“± WhatsApp Web opened! Message contains ${A.length} product(s). Please click "Send" to send the reminder.`)):M>0&&f.success(`âœ… Successfully sent ${M} reminder(s) to ${M} retailer(s)! Each message contained ${A.length} product(s).`),Z>0){const o=X.length>0?`${Z} reminder(s) failed - retailers missing phone numbers`:`Failed to send ${Z} reminder(s)`;f.warning(`âš ï¸ ${o}`)}I(new Set),$(new Set)}catch(A){console.error("Error sending reminders:",A),f.error(`âŒ Failed to send reminders: ${A.message||"Unknown error"}`)}finally{Q(!1)}},v=m=>{const R=new Set(u);R.has(m)?R.delete(m):R.add(m),I(R)},N=m=>{const R=new Set(D);R.has(m)?R.delete(m):R.add(m),$(R)};return i?e.jsx("div",{className:"text-white",children:e.jsx("div",{className:"animate-pulse",children:"Loading stock data..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“¦"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Stock Refill Reminders"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Send bulk reminders about low stock, price changes, or product updates"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("span",{className:"text-gray-400",children:[u.size," products"]}),e.jsx("span",{className:"text-gray-500",children:"â€¢"}),e.jsxs("span",{className:"text-gray-400",children:[D.size," retailers"]})]})]}),e.jsxs("div",{className:"bg-slate-900/80 border border-white/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-1 flex items-center gap-2",children:[e.jsx(ze,{className:"text-emerald-400"}),"Use Template (Optional)"]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Select a beautiful template with images, videos, or links for your messages"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:m=>n(m.target.checked),className:"w-5 h-5 text-emerald-600 rounded focus:ring-emerald-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Use Template"})]})]}),P&&e.jsx("div",{className:"space-y-3",children:p.length===0?e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-amber-300 mb-2",children:e.jsx("strong",{children:"No templates available yet."})}),e.jsxs("p",{className:"text-xs text-amber-200/70 mb-3",children:["Create beautiful templates with images, videos, and links in the ",e.jsx("strong",{children:"Templates"})," tab."]}),e.jsx("p",{className:"text-xs text-gray-400",children:"You can still send reminders using the default message format below."})]}):e.jsxs("div",{children:[e.jsxs("select",{value:b?.id||"",onChange:m=>{const R=p.find(X=>X.id===m.target.value);H(R||null)},className:"w-full bg-slate-800/60 border border-white/10 text-white px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500",children:[e.jsx("option",{value:"",children:"Select a template..."}),p.map(m=>e.jsxs("option",{value:m.id,children:[m.name," (",m.type?.replace("_"," "),")"]},m.id))]}),b&&e.jsx("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-lg p-4 mt-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[b.imageUrl&&e.jsx("img",{src:b.imageUrl,alt:"Template",className:"w-20 h-20 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-white mb-1",children:b.name}),b.title&&e.jsxs("p",{className:"text-sm text-gray-300 mb-2",children:["*",b.title,"*"]}),e.jsx("p",{className:"text-xs text-gray-400 line-clamp-2 mb-2",children:b.message}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[b.imageUrl&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Je,{})," Image"]}),b.videoUrl&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_e,{})," Video"]}),b.linkUrl&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(qe,{})," Link"]})]})]})]})})]})})]}),e.jsxs("div",{className:"bg-slate-900/80 border border-white/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-1",children:"Low Stock Threshold"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Set the minimum stock level to trigger reminders"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"number",value:L,onChange:m=>y(Number(m.target.value)||0),min:"1",className:"w-24 bg-slate-700/60 border border-white/10 text-white px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-center font-semibold"}),e.jsx("span",{className:"text-gray-400",children:"units"})]})]}),e.jsx("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-emerald-300",children:["ðŸ“Š ",e.jsx("strong",{children:E.length})," products found with stock â‰¤ ",L," units"]})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-slate-900/80 border border-white/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-emerald-300 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“¦"}),"Low Stock Products"]}),e.jsxs("span",{className:"text-sm bg-emerald-500/20 text-emerald-300 px-3 py-1 rounded-full",children:[E.length," items"]})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:E.length===0?e.jsx("p",{className:"text-sm text-gray-400",children:"No low stock products found"}):E.map(m=>e.jsx("div",{onClick:()=>v(m.id),className:`p-3 rounded-lg border cursor-pointer transition-all ${u.has(m.id)?"bg-emerald-500/20 border-emerald-500/50":"bg-slate-800/60 border-white/10 hover:bg-slate-700/60"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:m.name||"Unnamed Product"}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Stock: ",m.quantity||0," ",m.unit||"units"]})]}),e.jsx("input",{type:"checkbox",checked:u.has(m.id),onChange:()=>{},className:"w-4 h-4 text-emerald-600 rounded focus:ring-emerald-500"})]})},m.id))})]}),e.jsxs("div",{className:"bg-slate-900/80 border border-white/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-300 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ‘¥"}),"Connected Retailers"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm bg-blue-500/20 text-blue-300 px-3 py-1 rounded-full",children:[d.length," total"]}),d.filter(m=>!m.phone).length>0&&e.jsxs("span",{className:"text-xs text-amber-400 bg-amber-900/30 px-2 py-1 rounded-full",children:["âš ï¸ ",d.filter(m=>!m.phone).length," without phone"]})]})]}),d.filter(m=>!m.phone).length>0&&e.jsx("div",{className:"mb-3 p-3 bg-amber-900/20 border border-amber-500/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"âš ï¸"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm text-amber-200 font-medium mb-1",children:[d.filter(m=>!m.phone).length," retailer(s) missing phone numbers"]}),e.jsx("p",{className:"text-xs text-amber-300 mb-2",children:"They won't receive WhatsApp messages. Add phone numbers to enable sending."}),e.jsx("a",{href:"#/distributor-dashboard?tab=retailerRequests",className:"text-xs text-blue-400 hover:text-blue-300 underline",children:"â†’ Go to Retailer Panel to add phone numbers"})]})]})}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:d.length===0?e.jsx("p",{className:"text-sm text-gray-400",children:"No connected retailers found"}):d.map(m=>{const R=!!m.phone;return e.jsx("div",{onClick:()=>R&&N(m.id),className:`p-3 rounded-lg border transition-all ${R?D.has(m.id)?"bg-blue-500/20 border-blue-500/50 cursor-pointer":"bg-slate-800/60 border-white/10 hover:bg-slate-700/60 cursor-pointer":"opacity-60 cursor-not-allowed bg-slate-800/40 border-red-500/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:m.businessName||m.retailerName||"Retailer"}),!R&&e.jsx("span",{className:"text-xs text-red-400 bg-red-900/30 px-2 py-0.5 rounded",children:"No Phone"})]}),e.jsx("p",{className:`text-xs ${R?"text-gray-400":"text-red-400"}`,children:m.phone||"âŒ Phone number required"})]}),R&&e.jsx("input",{type:"checkbox",checked:D.has(m.id),onChange:()=>{},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),!R&&e.jsx("span",{className:"text-xs text-red-400",children:"âš ï¸"})]})},m.id)})})]})]}),e.jsx("div",{className:"bg-slate-900/80 border border-white/10 rounded-xl p-6",children:(()=>{const m=d.filter(M=>D.has(M.id)&&M.phone),R=m.length,X=d.filter(M=>D.has(M.id)&&!M.phone);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-300",children:u.size}),e.jsx("p",{className:"text-xs text-gray-400",children:"Products Selected"})]}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-300",children:m.length}),e.jsx("p",{className:"text-xs text-gray-400",children:"Retailers Ready"})]}),e.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-300",children:R}),e.jsx("p",{className:"text-xs text-gray-400",children:"Messages to Send"})]})]}),X.length>0&&e.jsx("div",{className:"bg-amber-900/20 border border-amber-500/30 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-amber-300",children:["âš ï¸ ",X.length," retailer(s) will be skipped (no phone number)"]})}),e.jsx("button",{onClick:K,disabled:O||u.size===0||m.length===0,className:"w-full px-6 py-4 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white rounded-xl font-semibold transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-3 text-lg",children:O?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Sending Reminders..."})]}):R>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"ðŸ“¤"}),e.jsxs("span",{children:["Send ",R," Reminder",R>1?"s":""]})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"ðŸ“¦"}),e.jsx("span",{children:"Select Products & Retailers"})]})})]})})()})]})},dt=`
  @import url('https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;500;600;700&display=swap');
  
  .wa-inbox-root {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    height: calc(100vh - 200px);
    min-height: 500px;
    width: 100%;
    display: flex;
    position: relative;
    overflow: hidden;
    background: #111b21;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }
  
  /* Chat list panel */
  .wa-chat-list {
    width: 35%;
    min-width: 320px;
    max-width: 420px;
    height: 100%;
    display: flex;
    flex-direction: column;
    background: #111b21;
    border-right: 1px solid rgba(134, 150, 160, 0.15);
  }
  
  /* Chat area panel */
  .wa-chat-area {
    flex: 1;
    height: 100%;
    display: flex;
    flex-direction: column;
    position: relative;
    background: #0b141a;
  }
  
  /* WhatsApp doodle background pattern */
  .wa-chat-bg {
    position: absolute;
    inset: 0;
    background-color: #0b141a;
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAAeCAYAAABwmH1PAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFFmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAAGBAQEBQQGBQUGCQYFBgkLCAYGCAsMCgoLCgoMEAwMDAwMDBAMDg8QDw4MExMUFBMTHBsbGxwfHx8fHx8fHx8fAQcHBw0MDRgQEBgaFREVGh8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx//wAARCAAeADwDAREAAhEBAxEB/8QAewABAQEBAQAAAAAAAAAAAAAAAAcIBgQBAQAAAAAAAAAAAAAAAAAAAAAQAAEDAwMCBAUEAgMAAAAAAAECAwQABQYREgchCBMxQVEUImFxkSMyQlKBobFyFREBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8A0lQKBQRPl3mq44Lk1kx2DjLl1ul0ZefCXpKI7TLKFbFLKkKUolStgA0PhkUHQcecgycqxSLkN4sDuPPvPPNtwn5DT77aGXVNhTi2SlKSspKgE6j3Jqg71AoFAoFBmLyN8pu4fPLpgeJW9i23Kw7m7tfccU6086h4obKkoSEBsJCQdCo9dexArRjQcNxa7uyLKxKkPOyH3obDrrzzhW444ttKlLWtRJUpR1JJOpoOhoFAoMheRXkC8Ye/wAPeY3jcYWYKuSrU/fnILb5mmFvqihDSXt6G1oU3qF6FJPj6UGu6BQKCDeTXlCXwvlFoxJeHi+C5QnXlOm4+QI2xnG2/wBvxlav3df6j/tBuugUCgjnJGQ3Czx/brYXXYJu7qoT8pgqS4GGQVOPLQR7K0SI+v0cVQb1x+6wrxYLXdLcFi33KGxPihYAWGX2kurQFAkbglaRuHv7UCgUH/9k=");
    opacity: 0.04;
    pointer-events: none;
  }
  
  /* Message bubbles - WhatsApp exact colors */
  .wa-msg-incoming {
    background: #202c33;
    border-radius: 8px;
    border-top-left-radius: 0;
  }
  
  .wa-msg-outgoing {
    background: #005c4b;
    border-radius: 8px;
    border-top-right-radius: 0;
  }
  
  /* Scrollbar - WhatsApp style */
  .wa-scrollbar::-webkit-scrollbar {
    width: 6px;
  }
  .wa-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }
  .wa-scrollbar::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.15);
    border-radius: 3px;
  }
  .wa-scrollbar::-webkit-scrollbar-thumb:hover {
    background: rgba(255,255,255,0.25);
  }
  
  /* Conversation hover */
  .wa-conv-item {
    transition: all 0.15s ease;
  }
  .wa-conv-item:hover {
    background: rgba(32, 44, 51, 0.8);
  }
  .wa-conv-item.active {
    background: #2a3942;
  }
  
  /* Header style */
  .wa-header {
    background: #202c33;
    height: 60px;
    min-height: 60px;
  }
  
  /* Input area */
  .wa-input-area {
    background: #202c33;
    padding: 10px 16px;
  }
  
  .wa-input-box {
    background: #2a3942;
    border-radius: 8px;
  }
  
  /* Animations */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .wa-conv-item {
    animation: fadeInUp 0.2s ease forwards;
  }
`,xt=()=>{const[E,B]=r.useState([]),[u,I]=r.useState(null),[d,_]=r.useState([]),[D,$]=r.useState(""),[i,F]=r.useState(!0),[O,Q]=r.useState(!1),[L,y]=r.useState([]),[p,l]=r.useState(""),[b,H]=r.useState(!1),[P,n]=r.useState(null),[g,K]=r.useState(!1),[v,N]=r.useState(!1),[m,R]=r.useState(null),X=r.useRef(null),M=r.useRef(null),Z=r.useRef(null),G=r.useRef(null),A=ge.currentUser?.uid;r.useEffect(()=>{G.current=u},[u]),r.useEffect(()=>{if(!A)return;const a=async()=>{try{const U=ae(T,"businesses",A,"whatsappBot","orderConfig"),W=await fe(U),ee=W.exists()&&W.data()?.enabled===!0,ie=Y(T,"businesses",A,"whatsappFlows"),le=(await oe(ue(ie,is("isActive","==",!0)))).size>0;R(ee||le)}catch(U){console.error("Error checking bot status:",U)}};a();const j=setInterval(a,1e4);return()=>clearInterval(j)},[A]);const o=async()=>{if(A)try{const a=ae(T,"businesses",A),j=ae(T,"businesses",A,"whatsappBot","orderConfig"),U=Y(T,"businesses",A,"whatsappFlows"),[W,ee,ie]=await Promise.all([fe(a),fe(j),oe(ue(U,is("isActive","==",!0)))]),ce=Y(T,"businesses",A,"whatsappInbox"),le=Y(T,"businesses",A,"whatsappMessages"),[q,be]=await Promise.all([oe(ue(ce,Ae(100))),oe(ue(le,Ae(100)))]);let pe="None",J="";if(q.docs.length>0){const de=q.docs[0].data();pe=de.from||de.phoneNumber||"Unknown",J=(de.text||de.message||"").substring(0,30)}const Oe=ee.exists()&&ee.data()?.enabled===!0,se=ie.size;if(W.exists()){const de=W.data();n({phoneNumberId:de.whatsappPhoneNumberId||"NOT SET âŒ",wabaId:de.whatsappBusinessAccountId||"NOT SET âŒ",phoneNumber:de.whatsappPhoneNumber||"NOT SET",enabled:de.whatsappEnabled?"Yes âœ…":"No âŒ",provider:de.whatsappProvider||"NOT SET",phoneRegistered:de.whatsappPhoneRegistered?"Yes âœ…":"No âŒ",accountReviewStatus:de.whatsappAccountReviewStatus||"UNKNOWN",inboxCount:q.size,sentCount:be.size,lastInboxFrom:pe,lastInboxText:J,webhookUrl:"https://us-central1-stockpilotv1.cloudfunctions.net/whatsappWebhook",webhookRepaired:de.webhookSubscriptionStatus==="repaired"?"Yes âœ…":"No",botEnabled:Oe?"Yes âœ…":"No âŒ",activeFlows:se.toString()})}}catch(a){console.error("Debug check error:",a),n({error:a.message})}},w=async()=>{K(!0),_([]),B([]),F(!0),setTimeout(()=>{K(!1)},1e3)},z=async()=>{if(!v){N(!0);try{const j=await ys(hs,"repairWebhookSubscription")();j.data?.success?(f.success("Webhook subscription repaired! Please test by sending a message from a customer phone."),await o()):f.error(j.data?.message||"Repair failed")}catch(a){console.error("Repair error:",a),f.error("Failed to repair: "+(a.message||"Unknown error"))}finally{N(!1)}}},t=u?d.filter(a=>{const j=(a.from||a.to||"").replace(/\D/g,""),U=u.phone.replace(/\D/g,"");if(!j||!U)return!1;const W=j.slice(-10),ee=U.slice(-10);return W===ee||j.includes(U)||U.includes(j)}).sort((a,j)=>{const U=W=>W.rawTime?.toMillis?W.rawTime.toMillis():typeof W.rawTime=="number"?W.rawTime:W.rawTime?.seconds?W.rawTime.seconds*1e3:W.timestamp?.toMillis?W.timestamp.toMillis():W.createdAt?.toMillis?W.createdAt.toMillis():0;return U(a)-U(j)}):[];r.useEffect(()=>{if(!A)return;(async()=>{try{const j=Y(T,"businesses",A,"connectedRetailers"),U=await oe(j);y(U.docs.map(W=>({id:W.id,...W.data(),cleanPhone:(W.data().phone||"").replace(/\D/g,"")})))}catch(j){console.error("Retailer fetch error",j)}})()},[A]),r.useEffect(()=>{if(!A)return;const a=Y(T,"businesses",A,"whatsappInbox"),j=Y(T,"businesses",A,"whatsappMessages"),U=ie=>{_(ce=>{const le=new Map;ce.forEach(se=>le.set(se.id,se)),ie.forEach(se=>le.set(se.id,se));const q=Array.from(le.values()),be=new Map,pe=new Map;q.forEach(se=>{const de=se.from||se.to||"";if(!de)return;const Ee=de.replace(/\D/g,"");if(!Ee||Ee.length<10)return;const ws=L.find(Ve=>{const Ye=Ve.cleanPhone||(Ve.phone||"").replace(/\D/g,"");if(!Ye)return!1;const Ws=Ye.slice(-10),Ls=Ee.slice(-10);return Ws===Ls||Ye.includes(Ee)||Ee.includes(Ye)}),ts=ws?.businessName||ws?.retailerName||`+${Ee}`,Ue=Ee.slice(-10);let Be=0;se.rawTime?.toMillis?Be=se.rawTime.toMillis():typeof se.rawTime=="number"?Be=se.rawTime:se.rawTime?.seconds&&(Be=se.rawTime.seconds*1e3),se.direction==="incoming"&&se.read!==!0&&!se.read&&pe.set(Ue,(pe.get(Ue)||0)+1);const vs=be.get(Ue);if(!vs||Be>vs.lastMessageTime){const Ve=se.text||se.message||"";be.set(Ue,{id:Ue,phone:de,displayName:ts,lastMessage:Ve||(se.type==="image"?"ðŸ“· Image":"Message"),lastMessageTime:Be,lastMessageDirection:se.direction,avatarChar:ts.charAt(0).toUpperCase(),avatarHue:ts.charCodeAt(0)*137%360})}});const J=G.current,Oe=Array.from(be.values()).map(se=>{const de=J&&se.id===J.id;return{...se,unreadCount:de?0:pe.get(se.id)||0}});return B(Oe.sort((se,de)=>de.lastMessageTime-se.lastMessageTime)),F(!1),q})},W=ye(ue(a,Ae(500)),ie=>{const ce=ie.docs.map(le=>{const q=le.data();return{id:le.id,...q,direction:"incoming",from:q.from||q.phoneNumber||"",text:q.text||q.message||"",rawTime:q.timestamp||q.receivedAt||q.createdAt,read:q.read===!0||q.read==="true",isInteractiveResponse:q.type==="interactive"||q.context||!1,interactiveType:q.type==="interactive"?q.media?.button_reply?"button":"list":null}});U(ce)},ie=>{console.error("âŒ Error listening to inbox:",ie)}),ee=ye(ue(j,Ae(500)),ie=>{const ce=ie.docs.map(le=>{const q=le.data();return{id:le.id,...q,direction:"outgoing",to:q.to||"",text:q.message||q.text||"",rawTime:q.createdAt||q.timestamp,read:q.read||q.status==="read",delivered:q.delivered||q.status==="delivered",status:q.status||"sent",messageType:q.messageType||"text",isInteractiveMessage:["flow_buttons","flow_catalog","order_bot_welcome"].includes(q.messageType)}});U(ce)},ie=>{console.error("âŒ Error listening to sent messages:",ie)});return()=>{W(),ee()}},[A,L]),r.useEffect(()=>{if(M.current&&u){const a=M.current;a.scrollTop=a.scrollHeight}},[t.length,u?.id]);const x=async()=>{if(!(!D.trim()||!u)){Q(!0);try{if(!(await Te(A))?.enabled)throw new Error("WhatsApp not configured");(await He(A,u.phone,D,{messageType:"text"})).success&&$("")}catch(a){f.error("Failed: "+a.message)}finally{Q(!1),Z.current?.focus()}}},h=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),x())},S=a=>{if(!a)return"";const j=new Date(a),U=new Date;if(j.toDateString()===U.toDateString())return j.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});const W=new Date(U);return W.setDate(W.getDate()-1),j.toDateString()===W.toDateString()?"Yesterday":j.toLocaleDateString([],{month:"short",day:"numeric"})},C=a=>a.rawTime?.toMillis?a.rawTime.toMillis():typeof a.rawTime=="number"?a.rawTime:a.rawTime?.seconds?a.rawTime.seconds*1e3:a.timestamp?.toMillis?a.timestamp.toMillis():a.createdAt?.toMillis?a.createdAt.toMillis():0,s=E.filter(a=>a.displayName.toLowerCase().includes(p.toLowerCase())||a.phone.includes(p)),c=async a=>{if(!(!A||!a))try{const j=(a.phone||"").replace(/\D/g,"");if(!j||j.length<10)return;const U=j.slice(-10),W=Y(T,"businesses",A,"whatsappInbox"),ee=ue(W,Ae(1e3)),ie=await oe(ee),ce=Os(T);let le=0;const q=500;ie.docs.forEach(be=>{const pe=be.data();(pe.from||pe.phoneNumber||"").replace(/\D/g,"").slice(-10)===U&&!pe.read&&pe.read!==!0&&le<q&&(ce.update(be.ref,{read:!0,readAt:new Date}),le++)}),le>0&&(await ce.commit(),console.log(`âœ… Marked ${le} messages as read for ${a.displayName}`))}catch(j){console.error("Error marking messages as read:",j)}},k=async a=>{G.current=a;const j=document.querySelector("main");if(j){const W=j.scrollTop;I(a),requestAnimationFrame(()=>{j&&(j.scrollTop=W)}),setTimeout(()=>{j&&(j.scrollTop=W)},100)}else I(a);const U=(a.phone||"").replace(/\D/g,"").slice(-10);_(W=>W.map(ee=>{const ce=(ee.from||"").replace(/\D/g,"").slice(-10);return ee.direction==="incoming"&&ce===U?{...ee,read:!0}:ee})),B(W=>W.map(ee=>ee.id===a.id?{...ee,unreadCount:0}:ee)),c(a)};return e.jsxs("div",{className:"wa-inbox-root",children:[e.jsx("style",{children:dt}),e.jsxs("div",{className:`wa-chat-list ${u?"hidden md:flex":"flex"} flex-col`,children:[e.jsxs("div",{className:"wa-header flex items-center justify-between px-4 border-b border-[#222d34]/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-[#00a884] to-[#075e54] flex items-center justify-center shadow-lg shadow-[#00a884]/20",children:e.jsx(Pe,{className:"text-white text-base"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-white font-medium text-[15px]",children:"Chats"}),e.jsxs("p",{className:"text-[#8696a0] text-[11px]",children:[E.length," conversations"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:w,disabled:g,className:"w-9 h-9 rounded-full flex items-center justify-center text-[#aebac1] hover:bg-[#202c33] hover:text-white transition-all",title:"Refresh",children:e.jsx(Fs,{size:14,className:g?"animate-spin":""})}),e.jsx("button",{onClick:()=>{H(!b),o()},className:`w-9 h-9 rounded-full flex items-center justify-center transition-all ${b?"text-[#00a884] bg-[#00a884]/10":"text-[#aebac1] hover:bg-[#202c33] hover:text-white"}`,title:"Debug Info",children:e.jsx(Hs,{size:14})})]})]}),e.jsx(ve,{children:b&&P&&e.jsx(ne.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-b border-[#222d34] flex-shrink-0",children:e.jsxs("div",{className:"p-3 bg-[#111b21] text-xs space-y-2",children:[e.jsx("h3",{className:"text-[#00a884] font-medium mb-2",children:"Debug Info"}),P.error?e.jsxs("p",{className:"text-red-400",children:["Error: ",P.error]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1 text-[#8696a0]",children:[e.jsx("span",{children:"Phone ID:"}),e.jsx("span",{className:"text-[#e9edef] font-mono text-[10px] truncate",children:P.phoneNumberId}),e.jsx("span",{children:"Inbox:"}),e.jsx("span",{className:P.inboxCount>0?"text-[#00a884]":"text-[#e9edef]",children:P.inboxCount}),e.jsx("span",{children:"Bot Enabled:"}),e.jsx("span",{className:P.botEnabled?.includes("Yes")?"text-[#00a884]":"text-[#ef4444]",children:P.botEnabled||"Unknown"}),e.jsx("span",{children:"Active Flows:"}),e.jsx("span",{className:"text-[#e9edef]",children:P.activeFlows||"0"})]}),P.botEnabled?.includes("No")&&e.jsx("div",{className:"mt-2 p-2 bg-[#f59e0b]/20 border border-[#f59e0b]/30 rounded text-[#f59e0b] text-[10px]",children:'âš ï¸ Bot is not enabled. Go to "Bot Setup" tab to enable it.'}),e.jsxs("button",{onClick:z,disabled:v,className:"mt-2 w-full py-1.5 px-3 rounded bg-[#00a884]/20 text-[#00a884] text-xs hover:bg-[#00a884]/30 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ks,{className:v?"animate-spin":"",size:10}),v?"Repairing...":"Repair Webhook"]})]})]})})}),m===!1&&e.jsx("div",{className:"mx-3 mt-2 p-3 bg-[#f59e0b]/20 border border-[#f59e0b]/40 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ms,{className:"text-[#f59e0b] text-sm mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[#f59e0b] text-xs font-medium",children:"Bot Not Enabled"}),e.jsxs("p",{className:"text-[#f59e0b]/80 text-[10px] mt-0.5",children:[`Customers sending "Hi" won't receive automated responses. Enable bot in `,e.jsx("strong",{children:"Bot Setup"})," tab."]})]})]})}),e.jsx("div",{className:"px-3 py-2.5 bg-[#111b21]",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none",children:e.jsx(Ge,{className:"text-[#8696a0] text-xs"})}),e.jsx("input",{type:"text",placeholder:"Search or start new chat",className:"w-full bg-[#202c33] text-[#e9edef] text-[13px] rounded-lg pl-10 pr-4 py-2.5 focus:outline-none focus:ring-1 focus:ring-[#00a884]/30 placeholder-[#8696a0] transition-all",value:p,onChange:a=>l(a.target.value)}),p&&e.jsx("button",{onClick:()=>l(""),className:"absolute inset-y-0 right-0 pr-3.5 flex items-center text-[#8696a0] hover:text-[#e9edef] transition-colors",children:e.jsx(Ie,{size:12})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto wa-scrollbar",children:i?e.jsxs("div",{className:"flex flex-col items-center justify-center pt-20 gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-[#00a884]/20 flex items-center justify-center",children:e.jsx("div",{className:"w-5 h-5 border-2 border-[#00a884] border-t-transparent rounded-full animate-spin"})}),e.jsx("span",{className:"text-[#8696a0] text-sm",children:"Loading chats..."})]}):s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center pt-20 px-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-[#202c33] flex items-center justify-center mb-4",children:e.jsx(Pe,{className:"text-[#8696a0] text-2xl"})}),e.jsx("p",{className:"text-[#e9edef] font-medium mb-1",children:"No conversations yet"}),e.jsx("p",{className:"text-[#8696a0] text-xs",children:"Messages from customers will appear here"})]}):e.jsx("div",{children:s.map(a=>{const j=a.unreadCount>0,U=u?.id===a.id;return e.jsxs("div",{onClick:()=>k(a),className:`wa-conv-item flex items-center gap-3 px-3 py-3 cursor-pointer border-b border-[#222d34]/60 ${U?"active":""}`,children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-medium text-lg",style:{background:`hsl(${a.avatarHue}, 45%, 35%)`},children:a.avatarChar}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-5 h-5 bg-[#00a884] rounded-full flex items-center justify-center border-2 border-[#111b21]",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"+"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:`font-normal text-[15px] truncate ${j?"text-white":"text-[#e9edef]"}`,children:a.displayName}),e.jsx("span",{className:`text-xs flex-shrink-0 ml-2 ${j?"text-[#00a884] font-medium":"text-[#8696a0]"}`,children:S(a.lastMessageTime)})]}),e.jsxs("div",{className:"flex justify-between items-center gap-2 mt-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1 flex-1 min-w-0",children:[a.lastMessageDirection==="outgoing"&&e.jsx(As,{size:14,className:"text-[#53bdeb] flex-shrink-0"}),e.jsx("span",{className:`text-sm truncate ${j?"text-[#d1d7db]":"text-[#8696a0]"}`,children:a.lastMessage})]}),j&&e.jsx("span",{className:"bg-[#00a884] text-[#111b21] text-[11px] font-bold min-w-[20px] h-5 px-1.5 rounded-full flex items-center justify-center flex-shrink-0",children:a.unreadCount>99?"99+":a.unreadCount})]})]})]},a.id)})})})]}),u?e.jsxs("div",{className:"wa-chat-area",children:[e.jsx("div",{className:"wa-chat-bg"}),e.jsxs("div",{className:"wa-header flex items-center justify-between px-4 relative z-10 border-b border-[#222d34]",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("button",{onClick:()=>I(null),className:"md:hidden w-10 h-10 rounded-full flex items-center justify-center text-[#aebac1] hover:bg-[#202c33] flex-shrink-0",children:e.jsx(Gs,{size:16})}),e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-medium flex-shrink-0",style:{background:`hsl(${u.avatarHue}, 50%, 40%)`},children:u.avatarChar}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-[#e9edef] font-normal text-base truncate",children:u.displayName}),e.jsx("p",{className:"text-[#8696a0] text-xs truncate",children:u.phone})]})]}),e.jsx("div",{className:"flex gap-1 flex-shrink-0",children:[_e,ds,Ge,qs].map((a,j)=>e.jsx("button",{className:"w-10 h-10 rounded-full flex items-center justify-center text-[#aebac1] hover:bg-[#202c33] transition-all",children:e.jsx(a,{size:j===3?16:18})},j))})]}),e.jsx("div",{ref:M,className:"flex-1 overflow-y-auto wa-scrollbar px-4 md:px-[8%] py-2 relative z-10",children:t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-[#202c33] flex items-center justify-center mb-4",children:e.jsx(Ns,{className:"text-[#00a884] text-2xl"})}),e.jsx("h3",{className:"text-[#e9edef] font-normal mb-1",children:"Start the conversation"}),e.jsxs("p",{className:"text-[#8696a0] text-sm",children:["Send a message to ",u.displayName]})]}):e.jsxs("div",{className:"space-y-1",children:[t.map((a,j)=>{const U=a.direction==="incoming",W=C(a),ee=a.text||a.message||"",ie=a.messageType&&["flow_buttons","flow_catalog","order_bot_welcome"].includes(a.messageType)||a.isInteractiveMessage,ce=U&&(a.isInteractiveResponse||a.interactiveType),le=["Browse Products","My Orders","Get Help","View Cart","Checkout","Add More","Clear Cart","Contact Support","Track Order","Continue Shopping","Main Menu","Confirm Order","Cancel"],q=U&&ee&&le.some(pe=>ee.includes(pe)),be=U&&ee.length>10&&!le.some(pe=>ee.includes(pe))&&!["hi","hello","catalog","browse","products","orders","help","yes","no"].includes(ee.toLowerCase().trim());return e.jsx("div",{className:`flex ${U?"justify-start":"justify-end"}`,children:e.jsxs("div",{className:`relative max-w-[65%] px-3 py-1.5 shadow-sm ${U?"wa-msg-incoming":"wa-msg-outgoing"}`,children:[!U&&ie&&e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5 pb-1.5 border-b border-white/10",children:[a.messageType==="flow_catalog"&&e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"text-[#00a884] text-xs"}),e.jsx("span",{className:"text-[#00a884] text-[10px] font-medium",children:"Product List Sent"})]}),a.messageType==="flow_buttons"&&e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"text-[#00a884] text-xs"}),e.jsx("span",{className:"text-[#00a884] text-[10px] font-medium",children:"Interactive Buttons Sent"})]}),a.messageType==="order_bot_welcome"&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"text-[#00a884] text-xs"}),e.jsx("span",{className:"text-[#00a884] text-[10px] font-medium",children:"Welcome Menu Sent"})]})]}),U&&(ce||q||be)&&e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5 pb-1.5 border-b border-white/10",children:[ce&&a.interactiveType==="button"&&e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"text-[#8696a0] text-xs"}),e.jsx("span",{className:"text-[#8696a0] text-[10px]",children:"Clicked button"})]}),ce&&a.interactiveType==="list"&&e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"text-[#00a884] text-xs"}),e.jsx("span",{className:"text-[#00a884] text-[10px]",children:"Selected from list"})]}),!ce&&q&&e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"text-[#8696a0] text-xs"}),e.jsx("span",{className:"text-[#8696a0] text-[10px]",children:"Selected option"})]}),!ce&&be&&e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"text-[#00a884] text-xs"}),e.jsx("span",{className:"text-[#00a884] text-[10px]",children:"Product selected"})]})]}),e.jsx("p",{className:"text-[#e9edef] text-sm leading-relaxed whitespace-pre-wrap",children:ee}),a.messageType&&a.messageType!=="text"&&!ie&&e.jsxs("p",{className:"text-[#8696a0] text-[10px] mt-1 italic",children:[a.messageType==="cart_update"&&"ðŸ›’ Cart updated",a.messageType==="order_confirmed"&&"âœ… Order confirmed",a.messageType==="cart_view"&&"ðŸ“¦ Cart viewed",a.messageType==="checkout"&&"ðŸ›ï¸ Checkout initiated"]}),e.jsxs("div",{className:"flex items-center justify-end gap-1 mt-0.5",children:[e.jsx("span",{className:"text-[11px] text-[#8696a0]",children:S(W)}),!U&&e.jsx("span",{className:a.read?"text-[#53bdeb]":"text-[#8696a0]",children:a.read?e.jsx(As,{size:12}):e.jsx(os,{size:12})})]})]})},a.id||j)}),e.jsx("div",{ref:X})]})}),e.jsxs("div",{className:"wa-input-area relative z-10 flex items-center gap-2",children:[e.jsx("button",{className:"w-10 h-10 rounded-full flex items-center justify-center text-[#8696a0] hover:text-[#e9edef] hover:bg-[#202c33] transition-all flex-shrink-0",children:e.jsx(Vs,{size:22})}),e.jsx("button",{className:"w-10 h-10 rounded-full flex items-center justify-center text-[#8696a0] hover:text-[#e9edef] hover:bg-[#202c33] transition-all flex-shrink-0",children:e.jsx(Ys,{size:20})}),e.jsx("div",{className:"flex-1 wa-input-box",children:e.jsx("textarea",{ref:Z,value:D,onChange:a=>$(a.target.value),onKeyDown:h,placeholder:"Type a message",rows:1,className:"w-full bg-transparent text-[#e9edef] px-4 py-2.5 text-sm focus:outline-none placeholder-[#8696a0] resize-none",style:{minHeight:"42px",maxHeight:"100px"},onInput:a=>{a.target.style.height="auto",a.target.style.height=Math.min(a.target.scrollHeight,100)+"px"}})}),D.trim()?e.jsx("button",{onClick:x,disabled:O,className:"w-10 h-10 rounded-full bg-[#00a884] flex items-center justify-center hover:bg-[#06cf9c] transition-all flex-shrink-0",children:O?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(es,{className:"text-white text-base"})}):e.jsx("button",{className:"w-10 h-10 rounded-full flex items-center justify-center text-[#8696a0] hover:text-[#e9edef] hover:bg-[#202c33] transition-all flex-shrink-0",children:e.jsx(Qs,{size:20})})]})]}):e.jsxs("div",{className:"wa-chat-area hidden md:flex flex-col items-center justify-center",children:[e.jsx("div",{className:"wa-chat-bg"}),e.jsxs("div",{className:"relative z-10 text-center max-w-md px-6",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-[#00a884]/20 to-[#075e54]/10 flex items-center justify-center border border-[#00a884]/20",children:e.jsx(Pe,{className:"text-[#00a884] text-4xl"})}),e.jsx("h1",{className:"text-[#e9edef] text-2xl font-medium mb-3",children:"WhatsApp Web"}),e.jsxs("p",{className:"text-[#8696a0] text-sm leading-relaxed mb-6",children:["Send and receive messages without keeping your phone online.",e.jsx("br",{}),"Use WhatsApp on up to 4 linked devices and 1 phone at the same time."]}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-[#00a884]/10 border border-[#00a884]/20",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-[#00a884] animate-pulse"}),e.jsx("span",{className:"text-[#00a884] text-xs font-medium",children:"End-to-end encrypted"})]})]})]})]})},mt=()=>{const[E,B]=r.useState([]),[u,I]=r.useState(!1),[d,_]=r.useState([]),[D,$]=r.useState(new Set),[i,F]=r.useState([]),[O,Q]=r.useState(""),[L,y]=r.useState(""),[p,l]=r.useState({name:"",goal:"engagement",targetRetailers:"selected",message:"",scheduledFor:""}),b=ge.currentUser?.uid;r.useEffect(()=>{if(!b)return;(async()=>{try{const g=Y(T,"businesses",b,"connectedRetailers"),v=(await oe(g)).docs.map(N=>{const m=N.data();return{id:N.id,...m,phone:m.phone||m.retailerPhone||"",businessName:m.businessName||m.retailerName||""}});_(v)}catch(g){console.error("Error loading retailers:",g)}})()},[b]),r.useEffect(()=>{b&&H()},[b]);const H=async()=>{try{const n=Y(T,"businesses",b,"whatsappCampaigns"),g=ue(n,ke("createdAt","desc")),v=(await oe(g)).docs.map(N=>({id:N.id,...N.data()}));B(v)}catch(n){console.error("Error loading campaigns:",n)}},P=async()=>{if(!p.name||!p.message){f.error("Please fill in campaign name and message");return}if(p.targetRetailers==="selected"&&D.size===0&&i.length===0){f.error("Please select at least one retailer or enter a phone number");return}try{const g={retailerIds:Array.from(D),customPhoneNumbers:i.map(v=>({phone:v.phone,name:v.name}))},K=Y(T,"businesses",b,"whatsappCampaigns");await we(K,{...p,recipients:g,status:"draft",sent:0,delivered:0,opened:0,converted:0,createdAt:te()}),f.success("Campaign created!"),I(!1),l({name:"",goal:"engagement",targetRetailers:"selected",message:"",scheduledFor:""}),$(new Set),F([]),Q(""),y(""),H()}catch(n){console.error("Error creating campaign:",n),f.error("Failed to create campaign")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",children:"ðŸ“Š Campaign Management"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Create, track, and optimize message campaigns"})]}),e.jsx("button",{onClick:()=>I(!0),className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors",children:"+ Create Campaign"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:E.map(n=>e.jsxs("div",{className:"bg-slate-900/80 border border-white/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:n.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${n.status==="active"?"bg-emerald-500/20 text-emerald-300":n.status==="completed"?"bg-blue-500/20 text-blue-300":"bg-gray-500/20 text-gray-300"}`,children:n.status})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-4 line-clamp-2",children:n.message}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Sent:"}),e.jsx("span",{className:"text-white",children:n.sent||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Delivered:"}),e.jsx("span",{className:"text-white",children:n.delivered||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Opened:"}),e.jsx("span",{className:"text-emerald-400",children:n.opened||0})]}),n.goal==="sales"&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Converted:"}),e.jsx("span",{className:"text-purple-400",children:n.converted||0})]})]})]},n.id))}),E.length===0&&e.jsxs("div",{className:"text-center py-12 bg-slate-900/80 rounded-xl border border-white/10",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸ“Š"}),e.jsx("p",{className:"text-gray-400",children:"No campaigns yet"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Create your first campaign to get started"})]}),u&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70",children:e.jsxs(ne.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-slate-900 border border-white/10 rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Create New Campaign"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Campaign Name"}),e.jsx("input",{type:"text",value:p.name,onChange:n=>l({...p,name:n.target.value}),className:"w-full bg-slate-800/60 border border-white/10 text-white px-3 py-2 rounded",placeholder:"e.g., Diwali Sale 2025"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Campaign Goal"}),e.jsxs("select",{value:p.goal,onChange:n=>l({...p,goal:n.target.value}),className:"w-full bg-slate-800/60 border border-white/10 text-white px-3 py-2 rounded",children:[e.jsx("option",{value:"engagement",children:"Engagement"}),e.jsx("option",{value:"sales",children:"Sales"}),e.jsx("option",{value:"awareness",children:"Awareness"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Select Recipients"}),e.jsxs("select",{value:p.targetRetailers,onChange:n=>l({...p,targetRetailers:n.target.value}),className:"w-full bg-slate-800/60 border border-white/10 text-white px-3 py-2 rounded mb-3",children:[e.jsx("option",{value:"all",children:"All Retailers"}),e.jsx("option",{value:"selected",children:"Selected Retailers / Custom Numbers"})]}),p.targetRetailers==="selected"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"Connected Retailers:"}),e.jsx("div",{className:"max-h-40 overflow-y-auto border border-white/10 rounded-lg p-2 bg-slate-800/40",children:d.length===0?e.jsx("p",{className:"text-sm text-gray-400 p-2",children:"No retailers connected yet"}):d.map(n=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-slate-700/30 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:D.has(n.id),onChange:g=>{const K=new Set(D);g.target.checked?K.add(n.id):K.delete(n.id),$(K)},className:"rounded"}),e.jsx("span",{className:"text-sm flex-1",children:n.businessName||n.retailerName||n.phone}),n.phone&&e.jsx("span",{className:"text-xs text-gray-400",children:n.phone})]},n.id))})]}),e.jsxs("div",{className:"border-t border-white/10 pt-3",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"Or Enter New Phone Number:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Name (optional)",value:L,onChange:n=>y(n.target.value),className:"flex-1 bg-slate-800/60 border border-white/10 text-white placeholder-gray-400 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-sm"}),e.jsx("input",{type:"tel",placeholder:"+91XXXXXXXXXX",value:O,onChange:n=>Q(n.target.value),className:"flex-1 bg-slate-800/60 border border-white/10 text-white placeholder-gray-400 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-sm"}),e.jsx("button",{onClick:()=>{if(O.trim()){const n=O.trim().replace(/[^0-9+]/g,"");if(n.length>=10){const g={phone:n.startsWith("+")?n:`+91${n}`,name:L.trim()||"Custom Contact",id:`custom_${Date.now()}`};F([...i,g]),Q(""),y(""),f.success("Phone number added")}else f.error("Please enter a valid phone number")}},className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-sm font-medium transition-colors",children:"Add"})]}),i.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:i.map((n,g)=>e.jsxs("div",{className:"flex items-center justify-between bg-emerald-900/20 border border-emerald-500/30 rounded-lg p-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-white",children:n.name}),e.jsx("p",{className:"text-xs text-gray-400",children:n.phone})]}),e.jsx("button",{onClick:()=>{F(i.filter((K,v)=>v!==g))},className:"text-red-400 hover:text-red-300 text-sm px-2",children:"Remove"})]},n.id))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Message"}),e.jsx("textarea",{value:p.message,onChange:n=>l({...p,message:n.target.value}),rows:6,className:"w-full bg-slate-800/60 border border-white/10 text-white px-3 py-2 rounded",placeholder:"Enter your campaign message..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Schedule For (Optional)"}),e.jsx("input",{type:"datetime-local",value:p.scheduledFor,onChange:n=>l({...p,scheduledFor:n.target.value}),className:"w-full bg-slate-800/60 border border-white/10 text-white px-3 py-2 rounded"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:P,className:"flex-1 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium",children:"Create Campaign"}),e.jsx("button",{onClick:()=>I(!1),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg",children:"Cancel"})]})]})})]})},ut=()=>{const[E,B]=r.useState([]),[u,I]=r.useState(!1),[d,_]=r.useState({message:"",recipients:[],scheduledFor:"",timezone:"Asia/Kolkata",repeat:"once"}),D=ge.currentUser?.uid;r.useEffect(()=>{D&&$()},[D]);const $=async()=>{try{const F=Y(T,"businesses",D,"whatsappScheduled"),O=ue(F,ke("scheduledFor","asc")),L=(await oe(O)).docs.map(y=>({id:y.id,...y.data()}));B(L)}catch(F){console.error("Error loading scheduled messages:",F)}},i=async()=>{if(!d.message||!d.scheduledFor){f.error("Please fill in message and schedule time");return}try{const F=Y(T,"businesses",D,"whatsappScheduled");await we(F,{...d,status:"scheduled",createdAt:te()}),f.success("Message scheduled!"),I(!1),_({message:"",recipients:[],scheduledFor:"",timezone:"Asia/Kolkata",repeat:"once"}),$()}catch(F){console.error("Error scheduling message:",F),f.error("Failed to schedule message")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",children:"â° Smart Scheduling"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Schedule messages for optimal times"})]}),e.jsx("button",{onClick:()=>I(!0),className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors",children:"+ Schedule Message"})]}),e.jsx("div",{className:"space-y-3",children:E.map(F=>e.jsx("div",{className:"bg-slate-900/80 border border-white/10 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-300 mb-1 line-clamp-2",children:F.message}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-400 mt-2",children:[e.jsxs("span",{children:["ðŸ“… ",new Date(F.scheduledFor).toLocaleString()]}),e.jsxs("span",{children:["ðŸ‘¥ ",F.recipients?.length||0," recipients"]}),F.repeat!=="once"&&e.jsxs("span",{children:["ðŸ”„ ",F.repeat]})]})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${F.status==="scheduled"?"bg-blue-500/20 text-blue-300":F.status==="sent"?"bg-emerald-500/20 text-emerald-300":"bg-gray-500/20 text-gray-300"}`,children:F.status})]})},F.id))}),E.length===0&&e.jsxs("div",{className:"text-center py-12 bg-slate-900/80 rounded-xl border border-white/10",children:[e.jsx("div",{className:"text-4xl mb-3",children:"â°"}),e.jsx("p",{className:"text-gray-400",children:"No scheduled messages"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Schedule your first message to send at the perfect time"})]}),u&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70",children:e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-xl p-6 max-w-2xl w-full",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Schedule Message"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Message"}),e.jsx("textarea",{value:d.message,onChange:F=>_({...d,message:F.target.value}),rows:4,className:"w-full bg-slate-800/60 border border-white/10 text-white px-3 py-2 rounded",placeholder:"Enter message to schedule..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Schedule For"}),e.jsx("input",{type:"datetime-local",value:d.scheduledFor,onChange:F=>_({...d,scheduledFor:F.target.value}),className:"w-full bg-slate-800/60 border border-white/10 text-white px-3 py-2 rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Repeat"}),e.jsxs("select",{value:d.repeat,onChange:F=>_({...d,repeat:F.target.value}),className:"w-full bg-slate-800/60 border border-white/10 text-white px-3 py-2 rounded",children:[e.jsx("option",{value:"once",children:"Once"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:i,className:"flex-1 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium",children:"Schedule"}),e.jsx("button",{onClick:()=>I(!1),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg",children:"Cancel"})]})]})})]})},pt=()=>{const[E,B]=r.useState(!1),u=ge.currentUser?.uid;Es.useEffect(()=>{(async()=>{if(!u)return;const _=await Te(u);B((_?.provider===Ke.META_TECH_PROVIDER||_?.provider===Ke.META)&&_?.verified)})()},[u]);const I=[{name:"Full Automation",current:"âŒ Manual clicks required",withAPI:"âœ… Fully automated, zero clicks",icon:"ðŸ¤–",impact:"10x productivity"},{name:"Message Status Tracking",current:"âŒ No status tracking",withAPI:"âœ… See sent, delivered, read status",icon:"ðŸ“Š",impact:"Know exactly what happened"},{name:"Rich Media",current:"âŒ Text + image URLs only",withAPI:"âœ… Images, documents, videos, location",icon:"ðŸŽ¨",impact:"Professional messaging"},{name:"Two-Way Communication",current:"âŒ Can only send",withAPI:"âœ… Receive & respond to messages",icon:"ðŸ’¬",impact:"Complete WhatsApp management"},{name:"WhatsApp Chat Interface",current:"âŒ No chat view",withAPI:"âœ… Mirror WhatsApp in dashboard",icon:"ðŸ“±",impact:"Native WhatsApp experience"},{name:"Message Templates",current:"âŒ Custom messages only",withAPI:"âœ… Official pre-approved templates",icon:"ðŸ“",impact:"Send anytime, not just 24hr window"},{name:"True Scheduling",current:"âŒ Links only (manual send)",withAPI:"âœ… Actual scheduled sending",icon:"â°",impact:"Send at perfect times automatically"},{name:"Bulk Messaging",current:"âŒ Limited by manual clicks",withAPI:"âœ… Send to 10,000+ instantly",icon:"âš¡",impact:"Enterprise scale"},{name:"Advanced Analytics",current:"âŒ Basic message count",withAPI:"âœ… Delivery rates, read rates, conversion",icon:"ðŸ“ˆ",impact:"Data-driven optimization"},{name:"Business Profile",current:"âŒ No business identity",withAPI:"âœ… Verified badge, business hours, location",icon:"ðŸ¢",impact:"Professional appearance"},{name:"Webhook Integration",current:"âŒ No real-time updates",withAPI:"âœ… Real-time status & incoming messages",icon:"ðŸ”Œ",impact:"Instant responsiveness"},{name:"Auto-Responses",current:"âŒ Manual replies only",withAPI:"âœ… Automated responses & workflows",icon:"ðŸ”„",impact:"24/7 automated support"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-900/20 to-purple-900/20 rounded-xl p-6 border border-blue-500/20",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-semibold mb-2 text-blue-300",children:"ðŸš€ Meta WhatsApp Business API"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Unlock powerful features with official WhatsApp Business API integration"})]}),E?e.jsx("span",{className:"px-4 py-2 bg-emerald-500/20 text-emerald-300 rounded-lg border border-emerald-500/50",children:"âœ… API Enabled"}):e.jsx("a",{href:"#/distributor-dashboard?tab=profile&section=whatsapp",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Upgrade to API â†’"})]})}),e.jsx("div",{className:"space-y-4",children:I.map((d,_)=>e.jsx(ne.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:_*.1},className:"bg-slate-900/80 border border-white/10 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"text-3xl",children:d.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-white mb-3",children:d.name}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-red-300 font-medium mb-2",children:"Current (Simple Mode)"}),e.jsx("p",{className:"text-sm text-gray-300",children:d.current})]}),e.jsxs("div",{className:"bg-emerald-900/20 border border-emerald-500/30 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-emerald-300 font-medium mb-2",children:"With Meta API"}),e.jsx("p",{className:"text-sm text-gray-300",children:d.withAPI}),e.jsxs("p",{className:"text-xs text-emerald-400 mt-2",children:["ðŸ’¡ ",d.impact]})]})]})]})]})},d.name))}),e.jsxs("div",{className:"bg-gradient-to-r from-emerald-900/20 to-teal-900/20 rounded-xl p-6 border border-emerald-500/20",children:[e.jsx("h4",{className:"text-xl font-semibold mb-4 text-emerald-300",children:"ðŸŽ¯ Key Benefits"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-slate-900/60 rounded-lg p-4",children:[e.jsx("div",{className:"text-3xl mb-2",children:"âš¡"}),e.jsx("p",{className:"font-semibold mb-1",children:"10x Faster"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Fully automated, no manual work"})]}),e.jsxs("div",{className:"bg-slate-900/60 rounded-lg p-4",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“Š"}),e.jsx("p",{className:"font-semibold mb-1",children:"Complete Analytics"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Track every message in detail"})]}),e.jsxs("div",{className:"bg-slate-900/60 rounded-lg p-4",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ’¬"}),e.jsx("p",{className:"font-semibold mb-1",children:"Two-Way Chat"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Receive and manage messages"})]})]})]}),!E&&e.jsxs("div",{className:"text-center bg-gradient-to-r from-blue-900/30 to-purple-900/30 rounded-xl p-8 border border-blue-500/30",children:[e.jsx("div",{className:"text-5xl mb-4",children:"ðŸš€"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Ready to Unlock Premium Features?"}),e.jsx("p",{className:"text-gray-300 mb-6 max-w-2xl mx-auto",children:"Upgrade to Meta WhatsApp Business API to get full automation, two-way communication, rich media support, and advanced analytics. Transform your WhatsApp from a simple sender to a complete business communication platform."}),e.jsx("a",{href:"#/distributor-dashboard?tab=profile&section=whatsapp",className:"inline-block px-8 py-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold rounded-xl shadow-lg transform transition-all hover:scale-105",children:"Upgrade to Meta API â†’"})]})]})},ht={whatsappEnabled:!1,whatsappProvider:"meta_tech_provider",whatsappBusinessAccountId:"",whatsappPhoneNumberId:"",whatsappPhoneNumber:"",whatsappPhoneRegistered:!1,whatsappPhoneVerificationStatus:"not_registered",whatsappVerified:!1,whatsappAccountReviewStatus:"PENDING"},Bs=({onSetupComplete:E})=>{const[B,u]=r.useState(ge.currentUser),[I,d]=r.useState(ht),_=r.useRef(!1);return r.useEffect(()=>{const D=ge.onAuthStateChanged($=>{u($)});return()=>D()},[]),r.useEffect(()=>{if(!B?.uid)return;(async()=>{const $=await fe(ae(T,"businesses",B.uid));if($.exists()){const i=$.data();d(F=>({...F,whatsappEnabled:i.whatsappEnabled||!1,whatsappProvider:i.whatsappProvider||"meta_tech_provider",whatsappBusinessAccountId:i.whatsappBusinessAccountId||"",whatsappPhoneNumberId:i.whatsappPhoneNumberId||"",whatsappPhoneNumber:i.whatsappPhoneNumber||"",whatsappPhoneRegistered:i.whatsappPhoneRegistered||!1,whatsappPhoneVerificationStatus:i.whatsappPhoneVerificationStatus||"not_registered",whatsappVerified:i.whatsappVerified||!1,whatsappAccountReviewStatus:i.whatsappAccountReviewStatus||"PENDING"}))}})()},[B?.uid]),r.useEffect(()=>{!E||!I.whatsappBusinessAccountId||_.current||(_.current=!0,E({success:!0,wabaId:I.whatsappBusinessAccountId,phoneNumberId:I.whatsappPhoneNumberId,phoneNumber:I.whatsappPhoneNumber}))},[I.whatsappBusinessAccountId,I.whatsappPhoneNumberId,I.whatsappPhoneNumber,E]),e.jsx(it,{user:B,formData:I,setFormData:d})},gt=({embedded:E=!1,onSetupComplete:B})=>{const[u,I]=r.useState("connection"),[d,_]=r.useState(!1),[D,$]=r.useState(null),[i,F]=r.useState(!1),[O,Q]=r.useState(!1),[L,y]=r.useState(""),[p,l]=r.useState(""),[b,H]=r.useState(!1),[P,n]=r.useState(!1),[g,K]=r.useState(""),[v,N]=r.useState("UTILITY"),[m,R]=r.useState("en"),[X,M]=r.useState(""),[Z,G]=r.useState(!1),[A,o]=r.useState(!1),w=ge.currentUser?.uid;r.useEffect(()=>{z()},[w]);const z=async()=>{if(w)try{const S=await fe(ae(T,"businesses",w));if(S.exists()){const C=S.data();C.whatsappBusinessAccountId&&C.whatsappPhoneNumberId&&(_(!0),$({wabaId:C.whatsappBusinessAccountId,phoneNumberId:C.whatsappPhoneNumberId,phoneNumber:C.whatsappPhoneNumber}))}}catch(S){console.error("Error checking WABA connection:",S)}},t=async S=>{S?.success&&(_(!0),$({wabaId:S.wabaId,phoneNumberId:S.phoneNumberId,phoneNumber:S.phoneNumber}),f.success("âœ… WhatsApp Business Account connected!"),I("messaging"))},x=async()=>{if(!L||!p.trim()){f.error("Please enter recipient phone number and message");return}if(!w){f.error("Please log in to continue");return}H(!0);try{let S=L.replace(/[^0-9+]/g,"");S.startsWith("+")||(S=`+91${S.replace(/^91/,"").replace(/^0/,"")}`);const C=await He(w,S,p,{messageType:"review_demo",metadata:{demoMode:!0,api:"whatsapp_business_messaging"}});if(C.success){n(!0);const s=C.messageId||"N/A";f.success(`âœ… Message sent successfully! Message ID: ${s}`),console.log("Message sent successfully:",{messageId:s,method:C.method,canTrackStatus:C.canTrackStatus,recipient:S}),setTimeout(()=>{n(!1),l("")},5e3)}else{const s=C.error||"Failed to send message",c=C.errorCode;let k=s;throw c==="RECIPIENT_NOT_ALLOWED"?k="Recipient phone number not in allowed list. Add this number to your WABA's allowed list in Meta Business Suite.":c==="PERMISSION_DENIED"&&(k="App does not have permission. Request Production Access in Meta Business Suite."),new Error(k)}}catch(S){console.error("Error sending message:",S),f.error(S.message||"Failed to send message")}finally{H(!1)}},h=async()=>{if(!g.trim()||!X.trim()){f.error("Please fill in template name and body");return}if(!w||!D?.wabaId){f.error("WABA not connected. Please connect first.");return}G(!0);try{const C=await ys(hs,"createWhatsAppMessageTemplate")({wabaId:D.wabaId,name:g,category:v,language:m,body:X});if(C.data?.success)o(!0),f.success("âœ… Message template created successfully!"),setTimeout(()=>{o(!1),K(""),M("")},3e3);else throw new Error(C.data?.error||"Failed to create template")}catch(S){console.error("Error creating template:",S),f.error(S.message||"Failed to create message template")}finally{G(!1)}};return e.jsx("div",{className:`${E?"":"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-6"}`,children:e.jsxs("div",{className:`${E?"":"max-w-6xl mx-auto"}`,children:[e.jsxs(ne.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:E?"mb-6":"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`${E?"text-2xl":"text-4xl"} font-bold text-white mb-2`,children:"Meta App Review Dashboard"}),e.jsx("p",{className:"text-gray-400",children:"Review flow for WhatsApp Business API integration"})]}),!E&&e.jsxs("button",{onClick:()=>Q(!O),className:`px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 ${O?"bg-red-600 hover:bg-red-700 text-white":"bg-gray-700 hover:bg-gray-600 text-white"}`,children:[e.jsx(_e,{}),O?"ðŸ”´ Recording...":"Start Recording"]})]}),e.jsxs("div",{className:"flex items-center gap-4 bg-slate-800/50 rounded-lg p-4 border border-white/10",children:[e.jsx("button",{onClick:()=>I("connection"),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${u==="connection"?"bg-blue-600 text-white":"bg-slate-700 text-gray-300 hover:bg-slate-600"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d?e.jsx(Ne,{}):e.jsx(qe,{}),e.jsx("span",{children:"1. Connection"})]})}),e.jsx(ss,{className:"text-gray-400"}),e.jsx("button",{onClick:()=>I("messaging"),disabled:!d,className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${u==="messaging"?"bg-emerald-600 text-white":d?"bg-slate-700 text-gray-300 hover:bg-slate-600":"bg-slate-800 text-gray-500 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(es,{}),e.jsx("span",{children:"2. Messaging"})]})}),e.jsx(ss,{className:"text-gray-400"}),e.jsx("button",{onClick:()=>I("management"),disabled:!d,className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${u==="management"?"bg-purple-600 text-white":d?"bg-slate-700 text-gray-300 hover:bg-slate-600":"bg-slate-800 text-gray-500 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(xs,{}),e.jsx("span",{children:"3. Management"})]})})]})]}),e.jsx(ve,{mode:"wait",children:e.jsxs(ne.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"bg-gradient-to-br from-slate-800/90 to-slate-900/90 rounded-2xl p-8 border border-white/10 shadow-2xl",children:[u==="connection"&&e.jsx(bt,{wabaConnected:d,wabaInfo:D,onSetupComplete:t}),u==="messaging"&&d&&e.jsx(ft,{wabaInfo:D,messageRecipient:L,setMessageRecipient:y,messageText:p,setMessageText:l,sendingMessage:b,messageSent:P,onSendMessage:x}),u==="management"&&d&&e.jsx(jt,{wabaInfo:D,templateName:g,setTemplateName:K,templateCategory:v,setTemplateCategory:N,templateLanguage:m,setTemplateLanguage:R,templateBody:X,setTemplateBody:M,creatingTemplate:Z,templateCreated:A,onCreateTemplate:h})]},u)})]})})},bt=({wabaConnected:E,wabaInfo:B,onSetupComplete:u})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/30 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(qe,{}),"Stage 1: Connect WhatsApp Business Account"]}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Use Meta's Embedded Signup flow to connect your WhatsApp Business Account. This will store the WABA_ID and Phone_Number_ID for use in messaging and management features."}),E?e.jsxs("div",{className:"bg-emerald-900/30 border border-emerald-500/50 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ne,{className:"text-3xl text-emerald-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Connected!"}),e.jsx("p",{className:"text-gray-300",children:"WhatsApp Business Account is ready"})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"WABA ID:"}),e.jsx("span",{className:"text-white font-mono",children:B?.wabaId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Phone Number ID:"}),e.jsx("span",{className:"text-white font-mono",children:B?.phoneNumberId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Phone Number:"}),e.jsx("span",{className:"text-white font-mono",children:B?.phoneNumber})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-900/30 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-200",children:["âœ… ",e.jsx("strong",{children:"Data Stored:"})," WABA_ID and Phone_Number_ID have been saved to your account. You can now proceed to the Messaging and Management stages."]})})]}):e.jsxs("div",{children:[e.jsx(Bs,{onSetupComplete:u}),e.jsx("div",{className:"mt-4 p-4 bg-yellow-900/20 border border-yellow-500/30 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-200",children:[e.jsx(bs,{className:"inline mr-2"}),e.jsx("strong",{children:"For Review:"}),' Click "Connect with Facebook" to start the Embedded Signup flow. After connection, WABA_ID and Phone_Number_ID will be automatically stored.']})})]})]})}),ft=({wabaInfo:E,messageRecipient:B,setMessageRecipient:u,messageText:I,setMessageText:d,sendingMessage:_,messageSent:D,onSendMessage:$})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-emerald-900/20 border border-emerald-500/30 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(es,{}),"Stage 2: Send Message (whatsapp_business_messaging API)"]}),e.jsxs("p",{className:"text-gray-300 mb-4",children:["Send a WhatsApp message to demonstrate the ",e.jsx("strong",{children:"whatsapp_business_messaging"})," API. Enter a phone number from your WABA's allowed list and send a test message."]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Connected WABA"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-slate-700/50 rounded-lg",children:[e.jsx(_s,{className:"text-emerald-400"}),e.jsx("span",{className:"text-white font-mono text-sm",children:E?.wabaId})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Recipient Phone Number"}),e.jsx("input",{type:"text",value:B,onChange:i=>u(i.target.value),placeholder:"+91 9876543210",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Enter a phone number that's added to your WABA's allowed list"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Message Text"}),e.jsx("textarea",{value:I,onChange:i=>d(i.target.value),placeholder:"Type your message here...",rows:6,className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 resize-none"})]}),e.jsx("button",{onClick:$,disabled:_||D||!B||!I.trim(),className:`w-full px-6 py-4 rounded-lg font-bold text-white transition-colors flex items-center justify-center gap-2 ${D?"bg-emerald-600":"bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700"} disabled:opacity-50 disabled:cursor-not-allowed`,children:_?e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"animate-spin"}),"Sending..."]}):D?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{}),"Message Sent Successfully!"]}):e.jsxs(e.Fragment,{children:[e.jsx(es,{}),"Send Message via whatsapp_business_messaging API"]})}),D&&e.jsx("div",{className:"p-4 bg-emerald-900/30 border border-emerald-500/50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-emerald-200",children:["âœ… ",e.jsx("strong",{children:"Success!"})," Message sent using whatsapp_business_messaging API. Check the recipient's phone to verify delivery. This demonstrates the messaging capability."]})}),e.jsxs("div",{className:"p-4 bg-blue-900/20 border border-blue-500/30 rounded-lg space-y-2",children:[e.jsxs("p",{className:"text-sm text-blue-200",children:[e.jsx(bs,{className:"inline mr-2"}),e.jsx("strong",{children:"For Review:"})," Record this step showing the message being sent and received on a real phone. This proves the whatsapp_business_messaging API integration works end-to-end."]}),e.jsxs("div",{className:"text-xs text-blue-300/80 space-y-1 mt-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"Message Delivery Troubleshooting:"})}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsx("li",{children:"Ensure recipient phone is in WABA's allowed list (Meta Business Suite â†’ WhatsApp â†’ API Setup)"}),e.jsx("li",{children:"Check if WABA has production access (not just development mode)"}),e.jsx("li",{children:"Verify phone number format: +91XXXXXXXXXX (10 digits after +91)"}),e.jsx("li",{children:"Check message status in History tab for delivery updates"}),e.jsx("li",{children:"If error #131030: Add recipient to allowed list in Meta Business Suite"}),e.jsx("li",{children:"If error #10: Request Production Access in Meta App Review"})]})]})]})]})]})}),jt=({wabaInfo:E,templateName:B,setTemplateName:u,templateCategory:I,setTemplateCategory:d,templateLanguage:_,setTemplateLanguage:D,templateBody:$,setTemplateBody:i,creatingTemplate:F,templateCreated:O,onCreateTemplate:Q})=>{const L=[{value:"UTILITY",label:"Utility"},{value:"MARKETING",label:"Marketing"},{value:"AUTHENTICATION",label:"Authentication"}],y=[{value:"en",label:"English"},{value:"en_US",label:"English (US)"},{value:"en_GB",label:"English (UK)"},{value:"hi",label:"Hindi"}];return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-purple-900/20 border border-purple-500/30 rounded-lg p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(xs,{}),"Stage 3: Create Message Template (whatsapp_business_management API)"]}),e.jsxs("p",{className:"text-gray-300 mb-4",children:["Create a WhatsApp message template to demonstrate the ",e.jsx("strong",{children:"whatsapp_business_management"})," API. Templates must be approved by Meta before use."]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Connected WABA"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-slate-700/50 rounded-lg",children:[e.jsx(_s,{className:"text-purple-400"}),e.jsx("span",{className:"text-white font-mono text-sm",children:E?.wabaId})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Template Name *"}),e.jsx("input",{type:"text",value:B,onChange:p=>u(p.target.value),placeholder:"e.g., order_status_update",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Use lowercase letters, numbers, and underscores only"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Category *"}),e.jsx("select",{value:I,onChange:p=>d(p.target.value),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:L.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Language *"}),e.jsx("select",{value:_,onChange:p=>D(p.target.value),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:y.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Template Body *"}),e.jsx("textarea",{value:$,onChange:p=>i(p.target.value),placeholder:"Enter your template message text here...",rows:6,className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Use ","{{1}}",' for variables. Example: "Hello ',"{{1}}",", your order ","{{2}}",' is ready!"']})]}),e.jsx("button",{onClick:Q,disabled:F||O||!B.trim()||!$.trim(),className:`w-full px-6 py-4 rounded-lg font-bold text-white transition-colors flex items-center justify-center gap-2 ${O?"bg-purple-600":"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700"} disabled:opacity-50 disabled:cursor-not-allowed`,children:F?e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"animate-spin"}),"Creating Template..."]}):O?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{}),"Template Created Successfully!"]}):e.jsxs(e.Fragment,{children:[e.jsx(xs,{}),"Create Template via whatsapp_business_management API"]})}),O&&e.jsx("div",{className:"p-4 bg-purple-900/30 border border-purple-500/50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-purple-200",children:["âœ… ",e.jsx("strong",{children:"Success!"})," Template created using whatsapp_business_management API. The template will be submitted to Meta for approval."]})}),e.jsx("div",{className:"p-4 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-200",children:[e.jsx(bs,{className:"inline mr-2"}),e.jsx("strong",{children:"For Review:"})," Record this step showing the template creation form and API call. This proves the whatsapp_business_management API integration works."]})})]})]})})},V={TRIGGER:"trigger",MESSAGE:"message",BUTTONS:"buttons",LIST:"list",ACTION:"action"},re={VIEW_ORDERS:"view_orders",CREATE_ORDER:"create_order",BROWSE_CATALOG:"browse_catalog",TRACK_ORDER:"track_order",CONTACT_SUPPORT:"contact_support",VIEW_PRODUCTS:"view_products",CUSTOM:"custom"},yt=[{id:"welcome",name:"Welcome Flow",description:"Greet customers and show main menu",icon:"ðŸ‘‹",nodes:[{type:V.TRIGGER,keywords:["hi","hello","hey","start"]},{type:V.MESSAGE,text:"Welcome to {business_name}! How can I help you today?"},{type:V.BUTTONS,buttons:[{label:"ðŸ›’ Browse Products",action:re.BROWSE_CATALOG},{label:"ðŸ“¦ My Orders",action:re.VIEW_ORDERS},{label:"ðŸ’¬ Get Help",action:re.CONTACT_SUPPORT}]}]},{id:"order_flow",name:"Order Assistant",description:"Help customers create and track orders",icon:"ðŸ›’",nodes:[{type:V.TRIGGER,keywords:["order","buy","purchase"]},{type:V.MESSAGE,text:"I can help you with orders! What would you like to do?"},{type:V.BUTTONS,buttons:[{label:"âž• New Order",action:re.CREATE_ORDER},{label:"ðŸ“‹ View Orders",action:re.VIEW_ORDERS},{label:"ðŸšš Track Delivery",action:re.TRACK_ORDER}]}]},{id:"catalog_flow",name:"Product Catalog",description:"Show products from your inventory",icon:"ðŸ“¦",nodes:[{type:V.TRIGGER,keywords:["products","catalog","menu","items"]},{type:V.MESSAGE,text:"Here are our product categories:"},{type:V.LIST,action:re.VIEW_PRODUCTS}]},{id:"support_flow",name:"Customer Support",description:"Handle support queries",icon:"ðŸŽ§",nodes:[{type:V.TRIGGER,keywords:["help","support","issue","problem"]},{type:V.MESSAGE,text:"I'm here to help! What do you need assistance with?"},{type:V.BUTTONS,buttons:[{label:"ðŸ“¦ Order Issue",action:"order_support"},{label:"ðŸ’° Payment Help",action:"payment_support"},{label:"ðŸ‘¤ Talk to Human",action:re.CONTACT_SUPPORT}]}]},{id:"order_status_flow",name:"Order Status",description:"Check order status and tracking",icon:"ðŸšš",nodes:[{type:V.TRIGGER,keywords:["status","track","tracking","where"]},{type:V.MESSAGE,text:`I can help you check your order status! ðŸ“¦

Please provide your order ID, or I can show your recent orders.`},{type:V.BUTTONS,buttons:[{label:"ðŸ“‹ Recent Orders",action:re.VIEW_ORDERS},{label:"ðŸ” Track by ID",action:re.TRACK_ORDER},{label:"ðŸ  Main Menu",action:"main_menu"}]}]},{id:"payment_reminder_flow",name:"Payment Reminder",description:"Send payment reminders to customers",icon:"ðŸ’³",nodes:[{type:V.TRIGGER,keywords:["payment","pay","pending","due","credit"]},{type:V.MESSAGE,text:`ðŸ’° *Payment Information*

I can help you with payment-related queries. What would you like to know?`},{type:V.BUTTONS,buttons:[{label:"ðŸ“‹ Pending Payments",action:"view_pending_payments"},{label:"ðŸ’° Pay Now",action:"make_payment"},{label:"ðŸ’³ Payment History",action:"payment_history"}]}]}],Nt=()=>{const[E,B]=r.useState([]),[u,I]=r.useState(null),[d,_]=r.useState(!1),[D,$]=r.useState(!1),[i,F]=r.useState(!0),[O,Q]=r.useState(!1),[L,y]=r.useState(!1),[p,l]=r.useState(null),[b,H]=r.useState(!1),P=ge.currentUser?.uid,n=E.filter(s=>s.isActive),g={totalFlows:E.length,activeFlows:n.length,hasWelcome:E.some(s=>s.triggerKeywords?.some(c=>["hi","hello","start"].includes(c?.toLowerCase()))),hasOrder:E.some(s=>s.triggerKeywords?.some(c=>["order","buy","products","browse"].includes(c?.toLowerCase())))},K=async()=>{if(P){H(!0);try{const s=Y(T,"businesses",P,"whatsappFlows"),k=(await oe(s)).docs.flatMap(j=>j.data().triggerKeywords||[]).map(j=>j?.toLowerCase());let a=0;k.some(j=>["hi","hello","start"].includes(j))||(await we(s,{name:"Welcome Flow",description:"Greets customers and shows main menu",isActive:!0,triggerKeywords:["hi","hello","hey","start","menu","hii"],nodes:[{id:"msg1",type:"message",text:`Welcome to {business_name}! ðŸ‘‹

How can I help you today?`},{id:"btn1",type:"buttons",text:"Please select an option:",buttons:[{label:"ðŸ›’ Browse Products",action:"browse_products"},{label:"ðŸ“¦ My Orders",action:"view_orders"},{label:"ðŸ’¬ Get Help",action:"contact_support"}]}],createdAt:te(),updatedAt:te()}),a++),k.some(j=>["order","buy","products","browse"].includes(j))||(await we(s,{name:"Order Flow",description:"Helps customers browse and order products",isActive:!0,triggerKeywords:["order","buy","purchase","products","catalog","browse"],nodes:[{id:"msg1",type:"message",text:"Let me help you place an order! ðŸ›’"},{id:"list1",type:"list",action:"view_products",title:"Our Products"}],createdAt:te(),updatedAt:te()}),a++),k.some(j=>["help","support"].includes(j))||(await we(s,{name:"Support Flow",description:"Handles customer support requests",isActive:!0,triggerKeywords:["help","support","issue","problem"],nodes:[{id:"msg1",type:"message",text:"I'm here to help! What do you need assistance with?"},{id:"btn1",type:"buttons",text:"Select an option:",buttons:[{label:"ðŸ“¦ Order Issue",action:"order_support"},{label:"ðŸ’° Payment Help",action:"payment_support"},{label:"ðŸ‘¤ Talk to Human",action:"contact_support"}]}],createdAt:te(),updatedAt:te()}),a++),a>0?f.success(`Created ${a} essential flow${a>1?"s":""}! Your bot is ready.`):f.info("All essential flows already exist!")}catch(s){console.error("Quick setup error:",s),f.error("Failed to create flows")}finally{H(!1)}}},[v,N]=r.useState({name:"",description:"",isActive:!0,triggerKeywords:[],nodes:[]}),[m,R]=r.useState("");r.useEffect(()=>{if(!P)return;const s=Y(T,"businesses",P,"whatsappFlows"),c=ue(s,ke("createdAt","desc")),k=ye(c,a=>{const j=a.docs.map(U=>({id:U.id,...U.data()}));B(j),F(!1)});return()=>k()},[P]);const X=async()=>{if(!v.name){f.error("Please enter a flow name");return}if(v.triggerKeywords.length===0){f.error("Please add at least one trigger keyword");return}if(v.nodes.length===0){f.error("Please add at least one node to the flow");return}Q(!0);try{const s={...v,updatedAt:te()};u?(await Fe(ae(T,"businesses",P,"whatsappFlows",u.id),s),f.success("Flow updated successfully!")):(s.createdAt=te(),await we(Y(T,"businesses",P,"whatsappFlows"),s),f.success("Flow created successfully!")),_(!1),I(null),G()}catch(s){console.error("Error saving flow:",s),f.error("Failed to save flow")}finally{Q(!1)}},M=async s=>{if(confirm("Are you sure you want to delete this flow?"))try{await Is(ae(T,"businesses",P,"whatsappFlows",s)),f.success("Flow deleted successfully!")}catch(c){console.error("Error deleting flow:",c),f.error("Failed to delete flow")}},Z=async s=>{try{await Fe(ae(T,"businesses",P,"whatsappFlows",s.id),{isActive:!s.isActive,updatedAt:te()}),f.success(s.isActive?"Flow paused":"Flow activated")}catch(c){console.error("Error toggling flow:",c),f.error("Failed to update flow")}},G=()=>{N({name:"",description:"",isActive:!0,triggerKeywords:[],nodes:[]}),R("")},A=()=>{if(m.trim()){if(v.triggerKeywords.includes(m.toLowerCase().trim())){f.warning("Keyword already added");return}N(s=>({...s,triggerKeywords:[...s.triggerKeywords,m.toLowerCase().trim()]})),R("")}},o=s=>{N(c=>({...c,triggerKeywords:c.triggerKeywords.filter(k=>k!==s)}))},w=(s,c={})=>{const k={id:Date.now().toString(),type:s,...c};switch(s){case V.MESSAGE:k.text=c.text||"";break;case V.BUTTONS:k.buttons=c.buttons||[{label:"",action:""}];break;case V.LIST:k.title=c.title||"Select an option",k.items=c.items||[],k.action=c.action||"";break;case V.ACTION:k.actionType=c.actionType||re.CUSTOM,k.customAction=c.customAction||"";break}N(a=>({...a,nodes:[...a.nodes,k]}))},z=(s,c)=>{N(k=>({...k,nodes:k.nodes.map(a=>a.id===s?{...a,...c}:a)}))},t=s=>{N(c=>({...c,nodes:c.nodes.filter(k=>k.id!==s)}))},x=(s,c)=>{const k=v.nodes.findIndex(U=>U.id===s);if(c==="up"&&k===0||c==="down"&&k===v.nodes.length-1)return;const a=[...v.nodes],j=c==="up"?k-1:k+1;[a[k],a[j]]=[a[j],a[k]],N(U=>({...U,nodes:a}))},h=s=>{N({name:s.name,description:s.description,isActive:!0,triggerKeywords:s.nodes[0]?.keywords||[],nodes:s.nodes.slice(1).map((c,k)=>({id:Date.now().toString()+k,...c}))}),$(!1),_(!0)},S=s=>{I(s),N({name:s.name||"",description:s.description||"",isActive:s.isActive!==!1,triggerKeywords:s.triggerKeywords||[],nodes:s.nodes||[]}),_(!0)},C=(s,c)=>{const k=p===s.id;return e.jsxs(ne.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-[#202c33] rounded-xl border border-[#2a3942] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-[#2a3942] transition-colors",onClick:()=>l(k?null:s.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-lg bg-[#00a884]/20 flex items-center justify-center",children:[s.type===V.MESSAGE&&e.jsx(Pe,{className:"text-[#00a884]"}),s.type===V.BUTTONS&&e.jsx($e,{className:"text-[#00a884]"}),s.type===V.LIST&&e.jsx(Re,{className:"text-[#00a884]"}),s.type===V.ACTION&&e.jsx(De,{className:"text-[#00a884]"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-white text-sm font-medium",children:[s.type===V.MESSAGE&&"Message",s.type===V.BUTTONS&&"Quick Reply Buttons",s.type===V.LIST&&"List Menu",s.type===V.ACTION&&"Action"]}),e.jsxs("p",{className:"text-[#8696a0] text-xs",children:["Step ",c+1]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),x(s.id,"up")},className:"p-1.5 rounded hover:bg-[#374248] text-[#8696a0] hover:text-white transition-colors",disabled:c===0,children:e.jsx(Ts,{size:12})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),x(s.id,"down")},className:"p-1.5 rounded hover:bg-[#374248] text-[#8696a0] hover:text-white transition-colors",disabled:c===v.nodes.length-1,children:e.jsx(Ps,{size:12})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),t(s.id)},className:"p-1.5 rounded hover:bg-red-500/20 text-[#8696a0] hover:text-red-400 transition-colors",children:e.jsx(cs,{size:12})}),k?e.jsx(Ts,{className:"text-[#8696a0]"}):e.jsx(Ps,{className:"text-[#8696a0]"})]})]}),e.jsx(ve,{children:k&&e.jsx(ne.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-[#2a3942]",children:e.jsxs("div",{className:"p-4 space-y-4",children:[s.type===V.MESSAGE&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#8696a0] text-xs mb-2",children:"Message Text"}),e.jsx("textarea",{value:s.text||"",onChange:a=>z(s.id,{text:a.target.value}),placeholder:"Enter your message... Use {customer_name}, {business_name} for variables",className:"w-full bg-[#2a3942] text-white text-sm rounded-lg px-3 py-2 focus:outline-none focus:ring-1 focus:ring-[#00a884] min-h-[80px] resize-none placeholder-[#8696a0]"}),e.jsxs("p",{className:"text-[#8696a0] text-xs mt-1",children:["Variables: ","{customer_name}",", ","{business_name}",", ","{order_id}"]})]}),s.type===V.BUTTONS&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-[#8696a0] text-xs",children:"Quick Reply Buttons (max 3)"}),(s.buttons||[]).map((a,j)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:a.label,onChange:U=>{const W=[...s.buttons||[]];W[j]={...W[j],label:U.target.value},z(s.id,{buttons:W})},placeholder:"Button label",maxLength:20,className:"flex-1 bg-[#2a3942] text-white text-sm rounded-lg px-3 py-2 focus:outline-none focus:ring-1 focus:ring-[#00a884] placeholder-[#8696a0]"}),e.jsxs("select",{value:a.action,onChange:U=>{const W=[...s.buttons||[]];W[j]={...W[j],action:U.target.value},z(s.id,{buttons:W})},className:"bg-[#2a3942] text-white text-sm rounded-lg px-3 py-2 focus:outline-none focus:ring-1 focus:ring-[#00a884]",children:[e.jsx("option",{value:"",children:"Select action"}),e.jsx("option",{value:re.BROWSE_CATALOG,children:"Browse Products"}),e.jsx("option",{value:re.VIEW_ORDERS,children:"View Orders"}),e.jsx("option",{value:re.CREATE_ORDER,children:"Create Order"}),e.jsx("option",{value:re.TRACK_ORDER,children:"Track Order"}),e.jsx("option",{value:re.CONTACT_SUPPORT,children:"Contact Support"}),e.jsx("option",{value:re.CUSTOM,children:"Custom Response"})]}),e.jsx("button",{onClick:()=>{const U=(s.buttons||[]).filter((W,ee)=>ee!==j);z(s.id,{buttons:U})},className:"p-2 rounded-lg hover:bg-red-500/20 text-[#8696a0] hover:text-red-400 transition-colors",children:e.jsx(Ie,{size:14})})]},j)),(s.buttons||[]).length<3&&e.jsxs("button",{onClick:()=>{const a=[...s.buttons||[],{label:"",action:""}];z(s.id,{buttons:a})},className:"flex items-center gap-2 text-[#00a884] text-sm hover:text-[#06cf9c] transition-colors",children:[e.jsx(Le,{size:12})," Add Button"]})]}),s.type===V.LIST&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#8696a0] text-xs mb-2",children:"List Action"}),e.jsxs("select",{value:s.action||"",onChange:a=>z(s.id,{action:a.target.value}),className:"w-full bg-[#2a3942] text-white text-sm rounded-lg px-3 py-2 focus:outline-none focus:ring-1 focus:ring-[#00a884]",children:[e.jsx("option",{value:"",children:"Select what to show"}),e.jsx("option",{value:re.VIEW_PRODUCTS,children:"Product Categories (from Inventory)"}),e.jsx("option",{value:re.VIEW_ORDERS,children:"Recent Orders"}),e.jsx("option",{value:"custom_list",children:"Custom List"})]})]}),e.jsx("p",{className:"text-[#8696a0] text-xs",children:"This will automatically show items from your inventory or orders"})]}),s.type===V.ACTION&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#8696a0] text-xs mb-2",children:"Action Type"}),e.jsxs("select",{value:s.actionType||"",onChange:a=>z(s.id,{actionType:a.target.value}),className:"w-full bg-[#2a3942] text-white text-sm rounded-lg px-3 py-2 focus:outline-none focus:ring-1 focus:ring-[#00a884]",children:[e.jsx("option",{value:re.CREATE_ORDER,children:"Create Order"}),e.jsx("option",{value:re.VIEW_ORDERS,children:"Show Orders"}),e.jsx("option",{value:re.BROWSE_CATALOG,children:"Show Catalog"}),e.jsx("option",{value:re.TRACK_ORDER,children:"Track Order"}),e.jsx("option",{value:re.CONTACT_SUPPORT,children:"Transfer to Human"}),e.jsx("option",{value:re.CUSTOM,children:"Custom Action"})]})]}),s.actionType===re.CUSTOM&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#8696a0] text-xs mb-2",children:"Custom Response"}),e.jsx("textarea",{value:s.customAction||"",onChange:a=>z(s.id,{customAction:a.target.value}),placeholder:"Enter custom response message...",className:"w-full bg-[#2a3942] text-white text-sm rounded-lg px-3 py-2 focus:outline-none focus:ring-1 focus:ring-[#00a884] min-h-[60px] resize-none placeholder-[#8696a0]"})]})]})]})})})]},s.id)};return i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 border-2 border-[#00a884] border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-[#00a884] to-[#075e54] flex items-center justify-center",children:e.jsx(Se,{className:"text-white text-lg"})}),"Flow Builder"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Create automated conversation flows for WhatsApp"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:K,disabled:b,className:"px-4 py-2 bg-gradient-to-r from-[#f59e0b] to-[#d97706] text-white rounded-lg hover:shadow-lg transition-all flex items-center gap-2 disabled:opacity-50",title:"Creates Welcome, Order, and Support flows automatically",children:[e.jsx(De,{size:16,className:b?"animate-spin":""}),b?"Creating...":"Quick Setup"]}),e.jsxs("button",{onClick:()=>$(!0),className:"px-4 py-2 bg-[#2a3942] text-white rounded-lg hover:bg-[#374248] transition-colors flex items-center gap-2",children:[e.jsx(ze,{size:14}),"Templates"]}),e.jsxs("button",{onClick:()=>{G(),I(null),_(!0)},className:"px-4 py-2 bg-[#00a884] text-white rounded-lg hover:bg-[#06cf9c] transition-colors flex items-center gap-2",children:[e.jsx(Le,{size:14}),"Create Flow"]})]})]}),e.jsx("div",{className:`rounded-xl border p-4 ${g.activeFlows>0?"bg-[#00a884]/10 border-[#00a884]/30":"bg-[#f59e0b]/10 border-[#f59e0b]/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${g.activeFlows>0?"bg-[#00a884]/20":"bg-[#f59e0b]/20"}`,children:g.activeFlows>0?e.jsx(Se,{className:"text-[#00a884] text-xl"}):e.jsx(Se,{className:"text-[#f59e0b] text-xl"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-white font-semibold",children:"Bot Status"}),g.activeFlows>0?e.jsxs("span",{className:"px-2 py-0.5 bg-[#00a884]/20 text-[#00a884] text-xs rounded-full flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-[#00a884] rounded-full animate-pulse"}),"Active"]}):e.jsx("span",{className:"px-2 py-0.5 bg-[#f59e0b]/20 text-[#f59e0b] text-xs rounded-full",children:"Inactive"})]}),e.jsxs("div",{className:"flex gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-[#8696a0]",children:[e.jsx("span",{className:"text-white font-medium",children:g.activeFlows})," active flow",g.activeFlows!==1?"s":""]}),e.jsxs("span",{className:g.hasWelcome?"text-[#00a884]":"text-[#8696a0]",children:[g.hasWelcome?"âœ“":"â—‹"," Welcome"]}),e.jsxs("span",{className:g.hasOrder?"text-[#00a884]":"text-[#8696a0]",children:[g.hasOrder?"âœ“":"â—‹"," Orders"]})]})]})]}),g.activeFlows===0&&e.jsxs("button",{onClick:K,disabled:b,className:"px-4 py-2 bg-[#00a884] text-white rounded-lg hover:bg-[#06cf9c] transition-colors flex items-center gap-2 text-sm",children:[e.jsx(Ns,{}),"Enable Bot"]})]})}),E.length===0?e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-2xl bg-[#202c33] flex items-center justify-center",children:e.jsx(Se,{className:"text-[#00a884] text-3xl"})}),e.jsx("h3",{className:"text-white text-xl font-semibold mb-2",children:"No flows created yet"}),e.jsx("p",{className:"text-gray-400 mb-6 max-w-md mx-auto",children:"Create automated conversation flows to respond to customer messages instantly"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>$(!0),className:"px-6 py-3 bg-[#2a3942] text-white rounded-lg hover:bg-[#374248] transition-colors flex items-center gap-2",children:[e.jsx(ze,{})," Use Template"]}),e.jsxs("button",{onClick:()=>{G(),_(!0)},className:"px-6 py-3 bg-[#00a884] text-white rounded-lg hover:bg-[#06cf9c] transition-colors flex items-center gap-2",children:[e.jsx(Le,{})," Create from Scratch"]})]})]}):e.jsx("div",{className:"grid gap-4",children:E.map(s=>e.jsxs(ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-5 hover:border-[#00a884]/30 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${s.isActive?"bg-[#00a884]/20":"bg-[#2a3942]"}`,children:e.jsx(Se,{className:s.isActive?"text-[#00a884] text-xl":"text-gray-500 text-xl"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-semibold text-lg flex items-center gap-2",children:[s.name,s.isActive&&e.jsx("span",{className:"px-2 py-0.5 bg-[#00a884]/20 text-[#00a884] text-xs rounded-full",children:"Active"})]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:s.description||"No description"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[(s.triggerKeywords||[]).slice(0,5).map((c,k)=>e.jsxs("span",{className:"px-2 py-1 bg-[#2a3942] text-[#8696a0] text-xs rounded-lg",children:['"',c,'"']},k)),(s.triggerKeywords||[]).length>5&&e.jsxs("span",{className:"text-[#8696a0] text-xs",children:["+",s.triggerKeywords.length-5," more"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Z(s),className:`p-2 rounded-lg transition-colors ${s.isActive?"bg-[#00a884]/20 text-[#00a884] hover:bg-[#00a884]/30":"bg-[#2a3942] text-gray-400 hover:bg-[#374248]"}`,title:s.isActive?"Pause flow":"Activate flow",children:s.isActive?e.jsx(Us,{size:14}):e.jsx(Xs,{size:14})}),e.jsx("button",{onClick:()=>S(s),className:"p-2 rounded-lg bg-[#2a3942] text-gray-400 hover:bg-[#374248] hover:text-white transition-colors",children:e.jsx(Ds,{size:14})}),e.jsx("button",{onClick:()=>M(s.id),className:"p-2 rounded-lg bg-[#2a3942] text-gray-400 hover:bg-red-500/20 hover:text-red-400 transition-colors",children:e.jsx(cs,{size:14})})]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2 overflow-x-auto pb-2",children:[e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1.5 bg-[#2a3942] rounded-lg text-xs text-[#00a884] whitespace-nowrap",children:[e.jsx(De,{})," Trigger"]}),(s.nodes||[]).slice(0,4).map((c,k)=>e.jsxs(Es.Fragment,{children:[e.jsx(ss,{className:"text-[#8696a0] text-xs flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1.5 bg-[#2a3942] rounded-lg text-xs text-[#8696a0] whitespace-nowrap",children:[c.type===V.MESSAGE&&e.jsxs(e.Fragment,{children:[e.jsx(Pe,{size:10})," Message"]}),c.type===V.BUTTONS&&e.jsxs(e.Fragment,{children:[e.jsx($e,{size:10})," Buttons"]}),c.type===V.LIST&&e.jsxs(e.Fragment,{children:[e.jsx(Re,{size:10})," List"]}),c.type===V.ACTION&&e.jsxs(e.Fragment,{children:[e.jsx(De,{size:10})," Action"]})]})]},k)),(s.nodes||[]).length>4&&e.jsxs("span",{className:"text-[#8696a0] text-xs",children:["+",s.nodes.length-4," more"]})]})]},s.id))}),e.jsx(ve,{children:D&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>$(!1),children:e.jsxs(ne.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:s=>s.stopPropagation(),className:"bg-[#111b21] rounded-2xl border border-[#2a3942] w-full max-w-2xl max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-[#2a3942]",children:[e.jsxs("h3",{className:"text-xl font-semibold text-white flex items-center gap-2",children:[e.jsx(ze,{className:"text-[#00a884]"}),"Flow Templates"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Start with a pre-built template"})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:yt.map(s=>e.jsxs(ne.div,{onClick:()=>h(s),whileHover:{scale:1.02},className:"p-5 bg-gradient-to-br from-[#202c33] to-[#111b21] rounded-xl border-2 border-[#2a3942] hover:border-[#00a884]/70 cursor-pointer transition-all hover:shadow-lg hover:shadow-[#00a884]/10 group",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-[#00a884]/10 flex items-center justify-center group-hover:bg-[#00a884]/20 transition-colors flex-shrink-0",children:e.jsx("span",{className:"text-2xl",children:s.icon})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-white font-semibold text-base mb-1",children:s.name}),e.jsx("p",{className:"text-[#8696a0] text-sm leading-relaxed",children:s.description})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3 pt-3 border-t border-[#2a3942]",children:[e.jsx("span",{className:"text-[#8696a0] text-xs font-medium mr-1",children:"Triggers:"}),s.nodes[0]?.keywords?.slice(0,4).map((c,k)=>e.jsxs("span",{className:"px-2.5 py-1 bg-[#2a3942] text-[#00a884] text-xs rounded-full font-medium border border-[#00a884]/20",children:['"',c,'"']},k)),s.nodes[0]?.keywords?.length>4&&e.jsxs("span",{className:"px-2.5 py-1 text-[#8696a0] text-xs",children:["+",s.nodes[0].keywords.length-4," more"]})]})]},s.id))})})]})})}),e.jsx(ve,{children:d&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>{_(!1),I(null),G()},children:e.jsxs(ne.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:s=>s.stopPropagation(),className:"bg-[#111b21] rounded-2xl border border-[#2a3942] w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-[#2a3942] flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:u?"Edit Flow":"Create New Flow"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Design your automated conversation"})]}),e.jsx("button",{onClick:()=>{_(!1),I(null),G()},className:"p-2 rounded-lg hover:bg-[#2a3942] text-gray-400 hover:text-white transition-colors",children:e.jsx(Ie,{size:20})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#8696a0] text-sm mb-2",children:"Flow Name *"}),e.jsx("input",{type:"text",value:v.name,onChange:s=>N(c=>({...c,name:s.target.value})),placeholder:"e.g., Welcome Flow",className:"w-full bg-[#202c33] text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-1 focus:ring-[#00a884] placeholder-[#8696a0]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#8696a0] text-sm mb-2",children:"Description"}),e.jsx("input",{type:"text",value:v.description,onChange:s=>N(c=>({...c,description:s.target.value})),placeholder:"Brief description...",className:"w-full bg-[#202c33] text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-1 focus:ring-[#00a884] placeholder-[#8696a0]"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[#8696a0] text-sm mb-2",children:["Trigger Keywords *",e.jsx("span",{className:"text-[#8696a0] text-xs ml-2",children:"(When customer sends these words, flow starts)"})]}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{type:"text",value:m,onChange:s=>R(s.target.value),onKeyDown:s=>s.key==="Enter"&&(s.preventDefault(),A()),placeholder:"Type keyword and press Enter...",className:"flex-1 bg-[#202c33] text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-1 focus:ring-[#00a884] placeholder-[#8696a0]"}),e.jsx("button",{onClick:A,className:"px-4 py-2 bg-[#00a884] text-white rounded-lg hover:bg-[#06cf9c] transition-colors",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.triggerKeywords.map((s,c)=>e.jsxs("span",{className:"px-3 py-1.5 bg-[#202c33] text-white text-sm rounded-lg flex items-center gap-2",children:['"',s,'"',e.jsx("button",{onClick:()=>o(s),className:"text-[#8696a0] hover:text-red-400 transition-colors",children:e.jsx(Ie,{size:10})})]},c))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"text-[#8696a0] text-sm",children:"Flow Steps"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>w(V.MESSAGE),className:"px-3 py-1.5 bg-[#202c33] text-[#8696a0] text-sm rounded-lg hover:bg-[#2a3942] hover:text-white transition-colors flex items-center gap-1",children:[e.jsx(Pe,{size:12})," Message"]}),e.jsxs("button",{onClick:()=>w(V.BUTTONS,{buttons:[{label:"",action:""}]}),className:"px-3 py-1.5 bg-[#202c33] text-[#8696a0] text-sm rounded-lg hover:bg-[#2a3942] hover:text-white transition-colors flex items-center gap-1",children:[e.jsx($e,{size:12})," Buttons"]}),e.jsxs("button",{onClick:()=>w(V.LIST),className:"px-3 py-1.5 bg-[#202c33] text-[#8696a0] text-sm rounded-lg hover:bg-[#2a3942] hover:text-white transition-colors flex items-center gap-1",children:[e.jsx(Re,{size:12})," List"]}),e.jsxs("button",{onClick:()=>w(V.ACTION),className:"px-3 py-1.5 bg-[#202c33] text-[#8696a0] text-sm rounded-lg hover:bg-[#2a3942] hover:text-white transition-colors flex items-center gap-1",children:[e.jsx(De,{size:12})," Action"]})]})]}),v.nodes.length===0?e.jsxs("div",{className:"bg-[#202c33] rounded-xl border border-dashed border-[#2a3942] p-8 text-center",children:[e.jsx(qe,{className:"text-[#8696a0] text-2xl mx-auto mb-3"}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:"Add steps to your flow using the buttons above"})]}):e.jsx("div",{className:"space-y-3",children:v.nodes.map((s,c)=>C(s,c))})]})]}),e.jsxs("div",{className:"p-6 border-t border-[#2a3942] flex justify-end gap-3 flex-shrink-0",children:[e.jsx("button",{onClick:()=>{_(!1),I(null),G()},className:"px-6 py-2.5 bg-[#2a3942] text-white rounded-lg hover:bg-[#374248] transition-colors",children:"Cancel"}),e.jsx("button",{onClick:X,disabled:O,className:"px-6 py-2.5 bg-[#00a884] text-white rounded-lg hover:bg-[#06cf9c] transition-colors flex items-center gap-2 disabled:opacity-50",children:O?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gs,{size:14}),u?"Update Flow":"Create Flow"]})})]})]})})})]})},wt=()=>{const[E,B]=r.useState([]),[u,I]=r.useState({}),[d,_]=r.useState(!0),[D,$]=r.useState(!1),[i,F]=r.useState(""),[O,Q]=r.useState("all"),[L,y]=r.useState([]),[p,l]=r.useState(new Set),[b,H]=r.useState({autoSync:!1,syncInterval:"daily",includeOutOfStock:!1,defaultCurrency:"INR"}),[P,n]=r.useState(!1),[g,K]=r.useState({total:0,synced:0,pending:0,outOfStock:0}),v=ge.currentUser?.uid;r.useEffect(()=>{if(!v)return;const o=Y(T,"businesses",v,"products"),w=ye(o,z=>{const t=z.docs.map(h=>({id:h.id,...h.data(),name:h.data().productName||h.data().name||"Unnamed Product",price:h.data().sellingPrice||h.data().mrp||h.data().price||0,stock:h.data().stock||h.data().quantity||0,image:h.data().productImage||h.data().image||null,category:h.data().category||"Uncategorized"}));B(t);const x=[...new Set(t.map(h=>h.category))].filter(Boolean);y(x),K({total:t.length,synced:t.filter(h=>u[h.id]).length,pending:t.filter(h=>!u[h.id]).length,outOfStock:t.filter(h=>(h.stock||0)<=0).length}),_(!1)});return()=>w()},[v,u]),r.useEffect(()=>{if(!v)return;(async()=>{try{const w=ae(T,"businesses",v,"whatsappCatalog","syncStatus"),z=await fe(w);z.exists()&&(I(z.data().products||{}),H(t=>({...t,...z.data().settings||{}})))}catch(w){console.error("Error loading sync status:",w)}})()},[v]);const N=E.filter(o=>{const w=o.name.toLowerCase().includes(i.toLowerCase())||(o.sku||"").toLowerCase().includes(i.toLowerCase()),z=O==="all"||o.category===O;return w&&z}),m=o=>{l(w=>{const z=new Set(w);return z.has(o)?z.delete(o):z.add(o),z})},R=()=>{const o=new Set(N.map(w=>w.id));l(o)},X=()=>{l(new Set)},M=async()=>{if(p.size===0){f.error("Please select products to sync");return}$(!0);try{const o=E.filter(h=>p.has(h.id)),w=o.map(h=>({retailer_id:h.id,name:h.name,description:h.description||h.name,price:Math.round(h.price*100),currency:b.defaultCurrency,image_url:h.image||"",availability:h.stock>0?"in stock":"out of stock",category:h.category||"General",brand:h.brand||"",sku:h.sku||h.id})),z=Os(T),t={...u};o.forEach(h=>{t[h.id]={syncedAt:new Date().toISOString(),catalogItemId:`wa_${h.id}`,status:"synced"}});const x=ae(T,"businesses",v,"whatsappCatalog","syncStatus");await Me(x,{products:t,settings:b,lastSync:te(),totalSynced:Object.keys(t).length},{merge:!0}),I(t),l(new Set),f.success(`Successfully synced ${o.length} products to WhatsApp catalog!`)}catch(o){console.error("Error syncing products:",o),f.error("Failed to sync products. Please try again.")}finally{$(!1)}},Z=async o=>{try{const w={...u};delete w[o];const z=ae(T,"businesses",v,"whatsappCatalog","syncStatus");await Me(z,{products:w,lastSync:te(),totalSynced:Object.keys(w).length},{merge:!0}),I(w),f.success("Product removed from WhatsApp catalog")}catch(w){console.error("Error unsyncing product:",w),f.error("Failed to unsync product")}},G=async()=>{l(new Set(E.map(o=>o.id))),setTimeout(()=>{M()},100)},A=async()=>{try{const o=ae(T,"businesses",v,"whatsappCatalog","syncStatus");await Me(o,{settings:b},{merge:!0}),f.success("Settings saved successfully!"),n(!1)}catch(o){console.error("Error saving settings:",o),f.error("Failed to save settings")}};return d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 border-2 border-[#00a884] border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-[#00a884] to-[#075e54] flex items-center justify-center",children:e.jsx(Re,{className:"text-white text-lg"})}),"Catalog Sync"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Sync your inventory products to WhatsApp Business catalog"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-[#2a3942] text-white rounded-lg hover:bg-[#374248] transition-colors flex items-center gap-2",children:[e.jsx(ms,{size:14}),"Settings"]}),e.jsxs("button",{onClick:G,disabled:D||E.length===0,className:"px-4 py-2 bg-[#00a884] text-white rounded-lg hover:bg-[#06cf9c] transition-colors flex items-center gap-2 disabled:opacity-50",children:[e.jsx(Fs,{size:14,className:D?"animate-spin":""}),"Sync All"]})]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[{label:"Total Products",value:g.total,icon:Re,color:"blue"},{label:"Synced",value:Object.keys(u).length,icon:Ne,color:"green"},{label:"Pending Sync",value:g.total-Object.keys(u).length,icon:rs,color:"yellow"},{label:"Out of Stock",value:g.outOfStock,icon:Ms,color:"red"}].map((o,w)=>e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(o.icon,{className:`text-${o.color==="blue"?"[#3b82f6]":o.color==="green"?"[#00a884]":o.color==="yellow"?"[#f59e0b]":"[#ef4444]"}`}),e.jsx("span",{className:"text-2xl font-bold text-white",children:o.value})]}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:o.label})]},w))}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ge,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-[#8696a0]"}),e.jsx("input",{type:"text",value:i,onChange:o=>F(o.target.value),placeholder:"Search products by name or SKU...",className:"w-full bg-[#202c33] text-white rounded-lg pl-11 pr-4 py-3 focus:outline-none focus:ring-1 focus:ring-[#00a884] placeholder-[#8696a0]"})]}),e.jsxs("select",{value:O,onChange:o=>Q(o.target.value),className:"bg-[#202c33] text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-1 focus:ring-[#00a884] min-w-[180px]",children:[e.jsx("option",{value:"all",children:"All Categories"}),L.map((o,w)=>e.jsx("option",{value:o,children:o},w))]})]}),p.size>0&&e.jsxs(ne.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-[#00a884]/10 border border-[#00a884]/30 rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("span",{className:"text-[#00a884] font-medium",children:[p.size," product",p.size>1?"s":""," selected"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:X,className:"px-4 py-2 text-[#8696a0] hover:text-white transition-colors",children:"Clear Selection"}),e.jsxs("button",{onClick:M,disabled:D,className:"px-4 py-2 bg-[#00a884] text-white rounded-lg hover:bg-[#06cf9c] transition-colors flex items-center gap-2",children:[e.jsx(rs,{size:14}),"Sync Selected"]})]})]}),E.length===0?e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-12 text-center",children:[e.jsx(Re,{className:"text-[#8696a0] text-5xl mx-auto mb-4"}),e.jsx("h3",{className:"text-white text-xl font-semibold mb-2",children:"No products in inventory"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Add products to your inventory first to sync them to WhatsApp catalog"})]}):N.length===0?e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-12 text-center",children:[e.jsx(Ge,{className:"text-[#8696a0] text-4xl mx-auto mb-4"}),e.jsx("h3",{className:"text-white text-lg font-medium mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-400",children:"Try adjusting your search or filter"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2",children:[e.jsx("input",{type:"checkbox",checked:p.size===N.length&&N.length>0,onChange:()=>{p.size===N.length?X():R()},className:"w-5 h-5 rounded border-[#2a3942] bg-[#202c33] text-[#00a884] focus:ring-[#00a884]"}),e.jsxs("span",{className:"text-[#8696a0] text-sm",children:[p.size===N.length?"Deselect all":"Select all"," (",N.length," products)"]})]}),e.jsx("div",{className:"grid gap-3",children:N.map(o=>{const w=u[o.id],z=p.has(o.id);return e.jsx(ne.div,{layout:!0,initial:{opacity:0},animate:{opacity:1},className:`bg-[#111b21] rounded-xl border transition-colors ${z?"border-[#00a884]":"border-[#2a3942] hover:border-[#2a3942]/80"}`,children:e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("input",{type:"checkbox",checked:z,onChange:()=>m(o.id),className:"w-5 h-5 rounded border-[#2a3942] bg-[#202c33] text-[#00a884] focus:ring-[#00a884]"}),e.jsx("div",{className:"w-16 h-16 rounded-lg bg-[#202c33] overflow-hidden flex-shrink-0",children:o.image?e.jsx("img",{src:o.image,alt:o.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(Je,{className:"text-[#8696a0] text-xl"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-white font-medium truncate",children:o.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[e.jsxs("span",{className:"text-[#8696a0] text-sm flex items-center gap-1",children:[e.jsx(Js,{size:10}),o.category]}),e.jsxs("span",{className:"text-[#00a884] text-sm flex items-center gap-1",children:[e.jsx(js,{size:10}),o.price?.toLocaleString("en-IN")]}),e.jsxs("span",{className:`text-sm flex items-center gap-1 ${o.stock>0?"text-[#8696a0]":"text-[#f59e0b]"}`,children:[e.jsx(Zs,{size:10}),o.stock>0?`${o.stock} in stock`:"Out of stock"]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:w?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-[#00a884]/20 rounded-lg",children:[e.jsx(Ne,{className:"text-[#00a884]",size:14}),e.jsx("span",{className:"text-[#00a884] text-sm",children:"Synced"})]}),e.jsx("button",{onClick:()=>Z(o.id),className:"p-2 rounded-lg hover:bg-red-500/20 text-[#8696a0] hover:text-red-400 transition-colors",title:"Remove from catalog",children:e.jsx(et,{size:14})})]}):e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-[#2a3942] rounded-lg",children:[e.jsx(rs,{className:"text-[#8696a0]",size:14}),e.jsx("span",{className:"text-[#8696a0] text-sm",children:"Not synced"})]})})]})},o.id)})})]}),e.jsx(ve,{children:P&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>n(!1),children:e.jsxs(ne.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:o=>o.stopPropagation(),className:"bg-[#111b21] rounded-2xl border border-[#2a3942] w-full max-w-md overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-[#2a3942]",children:e.jsxs("h3",{className:"text-xl font-semibold text-white flex items-center gap-2",children:[e.jsx(ms,{className:"text-[#00a884]"}),"Catalog Settings"]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:"Auto Sync"}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:"Automatically sync new products"})]}),e.jsx("button",{onClick:()=>H(o=>({...o,autoSync:!o.autoSync})),className:`p-2 rounded-full transition-colors ${b.autoSync?"bg-[#00a884]":"bg-[#2a3942]"}`,children:b.autoSync?e.jsx(xe,{className:"text-white text-xl"}):e.jsx(me,{className:"text-[#8696a0] text-xl"})})]}),b.autoSync&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-medium mb-2",children:"Sync Interval"}),e.jsxs("select",{value:b.syncInterval,onChange:o=>H(w=>({...w,syncInterval:o.target.value})),className:"w-full bg-[#202c33] text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-1 focus:ring-[#00a884]",children:[e.jsx("option",{value:"hourly",children:"Every hour"}),e.jsx("option",{value:"daily",children:"Once daily"}),e.jsx("option",{value:"weekly",children:"Once weekly"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:"Include Out of Stock"}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:"Sync products with 0 inventory"})]}),e.jsx("button",{onClick:()=>H(o=>({...o,includeOutOfStock:!o.includeOutOfStock})),className:`p-2 rounded-full transition-colors ${b.includeOutOfStock?"bg-[#00a884]":"bg-[#2a3942]"}`,children:b.includeOutOfStock?e.jsx(xe,{className:"text-white text-xl"}):e.jsx(me,{className:"text-[#8696a0] text-xl"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-medium mb-2",children:"Default Currency"}),e.jsxs("select",{value:b.defaultCurrency,onChange:o=>H(w=>({...w,defaultCurrency:o.target.value})),className:"w-full bg-[#202c33] text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-1 focus:ring-[#00a884]",children:[e.jsx("option",{value:"INR",children:"INR (Indian Rupee)"}),e.jsx("option",{value:"USD",children:"USD (US Dollar)"}),e.jsx("option",{value:"EUR",children:"EUR (Euro)"})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-[#2a3942] flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>n(!1),className:"px-6 py-2.5 bg-[#2a3942] text-white rounded-lg hover:bg-[#374248] transition-colors",children:"Cancel"}),e.jsx("button",{onClick:A,className:"px-6 py-2.5 bg-[#00a884] text-white rounded-lg hover:bg-[#06cf9c] transition-colors",children:"Save Settings"})]})]})})})]})},vt=()=>{const[E,B]=r.useState(!0),[u,I]=r.useState(!1),[d,_]=r.useState([]),[D,$]=r.useState({totalOrders:0,todayOrders:0,pendingOrders:0,revenue:0}),[i,F]=r.useState({enabled:!1,welcomeMessage:"Welcome! ðŸ‘‹ I'm your order assistant. What would you like to do?",menuOptions:{browseProducts:{enabled:!0,label:"ðŸ›’ Browse Products"},viewOrders:{enabled:!0,label:"ðŸ“¦ My Orders"},trackOrder:{enabled:!0,label:"ðŸšš Track Order"},support:{enabled:!0,label:"ðŸ’¬ Contact Support"}},productDisplay:{showPrice:!0,showStock:!0,showImage:!0,showDescription:!0,maxProductsPerMessage:5,groupByCategory:!0},orderSettings:{minOrderValue:0,maxItemsPerOrder:50,requireConfirmation:!0,autoAssignOrderId:!0,sendOrderConfirmation:!0,sendStatusUpdates:!0},paymentSettings:{acceptCOD:!0,acceptOnline:!1,acceptCredit:!1,creditLimit:0,creditDays:7},messages:{orderConfirmed:`âœ… Order #{order_id} confirmed!

Total: â‚¹{total}
Items: {items_count}

We'll notify you when it's ready for delivery.`,orderShipped:`ðŸšš Great news! Your order #{order_id} has been shipped.

Track your order anytime by sending 'track {order_id}'`,orderDelivered:`ðŸŽ‰ Your order #{order_id} has been delivered!

Thank you for shopping with us. Send 'Hi' to place a new order.`,outOfStock:"Sorry, {product_name} is currently out of stock. Would you like to see similar products?",cartEmpty:"Your cart is empty. Send 'Browse' to see our products.",paymentReminder:"ðŸ’° Reminder: Payment of â‚¹{amount} is pending for order #{order_id}."},businessHours:{enabled:!1,start:"09:00",end:"21:00",timezone:"Asia/Kolkata",offHoursMessage:"We're currently closed. Our business hours are 9 AM - 9 PM. We'll respond when we open!"}}),O=ge.currentUser?.uid;r.useEffect(()=>{if(!O)return;(async()=>{try{const b=ae(T,"businesses",O,"whatsappBot","orderConfig"),H=await fe(b);if(H.exists()){const P=H.data()||{};F(n=>({...n,...P,menuOptions:{...n.menuOptions,...P.menuOptions||{}},productDisplay:{...n.productDisplay,...P.productDisplay||{}},orderSettings:{...n.orderSettings,...P.orderSettings||{}},paymentSettings:{...n.paymentSettings,...P.paymentSettings||{}},messages:{...n.messages,...P.messages||{}},businessHours:{...n.businessHours,...P.businessHours||{}}}))}}catch(b){console.error("Error loading config:",b)}finally{B(!1)}})()},[O]),r.useEffect(()=>{if(!O)return;const l=Y(T,"businesses",O,"whatsappOrders"),b=ue(l,ke("createdAt","desc")),H=ye(b,P=>{const n=P.docs.slice(0,10).map(N=>({id:N.id,...N.data()}));_(n);const g=new Date;g.setHours(0,0,0,0);const K=P.docs.map(N=>N.data()),v=K.filter(N=>(N.createdAt?.toDate?.()||new Date(0))>=g);$({totalOrders:K.length,todayOrders:v.length,pendingOrders:K.filter(N=>N.status==="pending").length,revenue:K.reduce((N,m)=>N+(m.total||0),0)})});return()=>H()},[O]);const Q=async()=>{I(!0);try{const l=ae(T,"businesses",O,"whatsappBot","orderConfig");await Me(l,{...i,updatedAt:te()}),f.success("Order bot configuration saved!")}catch(l){console.error("Error saving config:",l),f.error("Failed to save configuration")}finally{I(!1)}},L=(l,b,H)=>{const P=b.split(".").filter(Boolean);if(P.length===0)return l;const n={...l||{}};let g=n;for(let N=0;N<P.length-1;N++){const m=P[N],R=g[m];g[m]=R&&typeof R=="object"&&!Array.isArray(R)?{...R}:{},g=g[m]}const K=P[P.length-1],v=g[K];return g[K]=typeof H=="function"?H(v):H,n},y=l=>{F(b=>L(b,l,H=>!H))},p=(l,b)=>{F(H=>L(H,l,b))};return E?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 border-2 border-[#00a884] border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-[#00a884] to-[#075e54] flex items-center justify-center",children:e.jsx(Ze,{className:"text-white text-lg"})}),"Order Bot"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Configure WhatsApp ordering automation"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:Q,disabled:u,className:"px-4 py-2 bg-[#00a884] text-white rounded-lg hover:bg-[#06cf9c] transition-colors flex items-center gap-2 disabled:opacity-50",children:[e.jsx(gs,{size:14,className:u?"animate-spin":""}),u?"Saving...":"Save Changes"]})})]}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[{label:"Total Orders",value:D.totalOrders,icon:ns,color:"blue"},{label:"Today",value:D.todayOrders,icon:us,color:"green"},{label:"Pending",value:D.pendingOrders,icon:Rs,color:"yellow"},{label:"Revenue",value:`â‚¹${D.revenue.toLocaleString("en-IN")}`,icon:js,color:"purple"}].map((l,b)=>e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(l.icon,{className:`text-[${l.color==="blue"?"#3b82f6":l.color==="green"?"#00a884":l.color==="yellow"?"#f59e0b":"#a855f7"}]`}),e.jsx("span",{className:"text-2xl font-bold text-white",children:l.value})]}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:l.label})]},b))}),e.jsx("div",{className:`rounded-2xl border-2 p-6 transition-all ${i.enabled?"bg-gradient-to-br from-[#00a884]/20 to-[#075e54]/10 border-[#00a884]/50":"bg-[#111b21] border-[#2a3942]"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center ${i.enabled?"bg-[#00a884]/30":"bg-[#2a3942]"}`,children:e.jsx(Ze,{className:`text-3xl ${i.enabled?"text-[#00a884]":"text-[#8696a0]"}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-white text-xl font-bold",children:"Order Bot"}),i.enabled&&e.jsxs("span",{className:"px-3 py-1 bg-[#00a884]/20 text-[#00a884] text-sm font-medium rounded-full flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 bg-[#00a884] rounded-full animate-pulse"}),"Active"]})]}),e.jsx("p",{className:"text-[#8696a0] text-sm mt-1",children:i.enabled?"Customers can now browse products and place orders via WhatsApp":"Enable to let customers order products via WhatsApp automatically"}),i.enabled&&e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-[#8696a0]",children:[e.jsx("span",{children:"â€¢ Auto-responds to messages"}),e.jsx("span",{children:"â€¢ Shows product catalog"}),e.jsx("span",{children:"â€¢ Creates orders automatically"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("button",{onClick:async()=>{y("enabled"),setTimeout(()=>Q(),100)},className:`px-6 py-3 rounded-xl font-semibold transition-all flex items-center gap-2 ${i.enabled?"bg-[#2a3942] text-white hover:bg-[#374248]":"bg-gradient-to-r from-[#00a884] to-[#06cf9c] text-white hover:shadow-lg hover:shadow-[#00a884]/30"}`,children:i.enabled?e.jsxs(e.Fragment,{children:[e.jsx(xe,{size:18}),"Enabled"]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{size:18}),"Enable Now"]})}),e.jsx("span",{className:"text-[#8696a0] text-xs",children:i.enabled?"Click to pause":"One-click activation"})]})]})}),i.enabled&&d.length>0&&e.jsx("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#00a884]/20 flex items-center justify-center",children:e.jsx(De,{className:"text-[#00a884] text-lg"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium",children:"Recent Activity"}),e.jsxs("p",{className:"text-[#8696a0] text-xs",children:[d.length," order",d.length!==1?"s":""," received via WhatsApp"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.slice(0,3).map((l,b)=>e.jsxs("span",{className:"px-2 py-1 bg-[#2a3942] text-[#8696a0] rounded text-xs",children:["#",l.orderId||l.id?.slice(-6)]},b)),d.length>3&&e.jsxs("span",{className:"text-[#8696a0] text-xs",children:["+",d.length-3," more"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{role:"button",tabIndex:0,onClick:()=>y("paymentSettings.acceptCOD"),onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&y("paymentSettings.acceptCOD")},className:`p-4 rounded-xl border-2 transition-all cursor-pointer select-none ${i.paymentSettings.acceptCOD?"bg-gradient-to-br from-green-500/10 to-green-600/5 border-green-500/50":"bg-[#111b21] border-[#2a3942]"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(We,{className:i.paymentSettings.acceptCOD?"text-green-400":"text-[#8696a0]"}),e.jsx("button",{onClick:l=>{l.stopPropagation(),y("paymentSettings.acceptCOD")},className:i.paymentSettings.acceptCOD?"text-green-400":"text-[#8696a0]",children:i.paymentSettings.acceptCOD?e.jsx(xe,{size:20}):e.jsx(me,{size:20})})]}),e.jsx("h4",{className:"text-white font-medium text-sm",children:"Cash on Delivery"}),e.jsx("p",{className:"text-[#8696a0] text-xs mt-1",children:"Enable COD payments"})]}),e.jsxs("div",{role:"button",tabIndex:0,onClick:()=>y("paymentSettings.acceptOnline"),onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&y("paymentSettings.acceptOnline")},className:`p-4 rounded-xl border-2 transition-all cursor-pointer select-none ${i.paymentSettings.acceptOnline?"bg-gradient-to-br from-blue-500/10 to-blue-600/5 border-blue-500/50":"bg-[#111b21] border-[#2a3942]"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(We,{className:i.paymentSettings.acceptOnline?"text-blue-400":"text-[#8696a0]"}),e.jsx("button",{onClick:l=>{l.stopPropagation(),y("paymentSettings.acceptOnline")},className:i.paymentSettings.acceptOnline?"text-blue-400":"text-[#8696a0]",children:i.paymentSettings.acceptOnline?e.jsx(xe,{size:20}):e.jsx(me,{size:20})})]}),e.jsx("h4",{className:"text-white font-medium text-sm",children:"Online Payment"}),e.jsx("p",{className:"text-[#8696a0] text-xs mt-1",children:"Enable UPI/Card payments"})]}),e.jsxs("div",{role:"button",tabIndex:0,onClick:()=>y("paymentSettings.acceptCredit"),onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&y("paymentSettings.acceptCredit")},className:`p-4 rounded-xl border-2 transition-all cursor-pointer select-none ${i.paymentSettings.acceptCredit?"bg-gradient-to-br from-purple-500/10 to-purple-600/5 border-purple-500/50":"bg-[#111b21] border-[#2a3942]"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(We,{className:i.paymentSettings.acceptCredit?"text-purple-400":"text-[#8696a0]"}),e.jsx("button",{onClick:l=>{l.stopPropagation(),y("paymentSettings.acceptCredit")},className:i.paymentSettings.acceptCredit?"text-purple-400":"text-[#8696a0]",children:i.paymentSettings.acceptCredit?e.jsx(xe,{size:20}):e.jsx(me,{size:20})})]}),e.jsx("h4",{className:"text-white font-medium text-sm",children:"Credit (Khata)"}),e.jsx("p",{className:"text-[#8696a0] text-xs mt-1",children:"Enable credit sales"}),i.paymentSettings.acceptCredit&&e.jsxs("p",{className:"text-purple-300 text-[11px] mt-2",children:["Credit days: ",e.jsx("span",{className:"font-semibold",children:i.paymentSettings.creditDays||0})]})]}),e.jsxs("div",{className:`p-4 rounded-xl border-2 transition-all ${i.orderSettings.requireConfirmation?"bg-gradient-to-br from-yellow-500/10 to-yellow-600/5 border-yellow-500/50":"bg-[#111b21] border-[#2a3942]"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ne,{className:i.orderSettings.requireConfirmation?"text-yellow-400":"text-[#8696a0]"}),e.jsx("button",{onClick:()=>y("orderSettings.requireConfirmation"),className:i.orderSettings.requireConfirmation?"text-yellow-400":"text-[#8696a0]",children:i.orderSettings.requireConfirmation?e.jsx(xe,{size:20}):e.jsx(me,{size:20})})]}),e.jsx("h4",{className:"text-white font-medium text-sm",children:"Order Confirmation"}),e.jsx("p",{className:"text-[#8696a0] text-xs mt-1",children:"Require customer confirmation"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-6 space-y-4",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-2",children:[e.jsx(ns,{className:"text-[#00a884]"}),"Menu Options"]}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:"Configure what options customers see"}),e.jsx("div",{className:"space-y-3 mt-4",children:Object.entries(i.menuOptions).map(([l,b])=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("input",{type:"text",value:b.label,onChange:H=>p(`menuOptions.${l}.label`,H.target.value),className:"bg-[#202c33] text-white text-sm rounded-lg px-3 py-2 w-48 focus:outline-none focus:ring-1 focus:ring-[#00a884]"})}),e.jsx("button",{onClick:()=>y(`menuOptions.${l}.enabled`),className:`p-1 rounded-full ${b.enabled?"text-[#00a884]":"text-[#8696a0]"}`,children:b.enabled?e.jsx(xe,{size:24}):e.jsx(me,{size:24})})]},l))})]}),e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-6 space-y-4",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-2",children:[e.jsx(ms,{className:"text-[#00a884]"}),"Order Settings"]}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:"Configure order processing rules"}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white text-sm",children:"Minimum Order Value"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[#8696a0]",children:"â‚¹"}),e.jsx("input",{type:"number",value:i.orderSettings.minOrderValue,onChange:l=>p("orderSettings.minOrderValue",parseInt(l.target.value)||0),className:"bg-[#202c33] text-white text-sm rounded-lg px-3 py-2 w-24 focus:outline-none focus:ring-1 focus:ring-[#00a884]"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white text-sm",children:"Max Items Per Order"}),e.jsx("input",{type:"number",value:i.orderSettings.maxItemsPerOrder,onChange:l=>p("orderSettings.maxItemsPerOrder",parseInt(l.target.value)||50),className:"bg-[#202c33] text-white text-sm rounded-lg px-3 py-2 w-24 focus:outline-none focus:ring-1 focus:ring-[#00a884]"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white text-sm",children:"Require Order Confirmation"}),e.jsx("button",{onClick:()=>y("orderSettings.requireConfirmation"),className:i.orderSettings.requireConfirmation?"text-[#00a884]":"text-[#8696a0]",children:i.orderSettings.requireConfirmation?e.jsx(xe,{size:24}):e.jsx(me,{size:24})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white text-sm",children:"Send Order Confirmation"}),e.jsx("button",{onClick:()=>y("orderSettings.sendOrderConfirmation"),className:i.orderSettings.sendOrderConfirmation?"text-[#00a884]":"text-[#8696a0]",children:i.orderSettings.sendOrderConfirmation?e.jsx(xe,{size:24}):e.jsx(me,{size:24})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white text-sm",children:"Send Status Updates"}),e.jsx("button",{onClick:()=>y("orderSettings.sendStatusUpdates"),className:i.orderSettings.sendStatusUpdates?"text-[#00a884]":"text-[#8696a0]",children:i.orderSettings.sendStatusUpdates?e.jsx(xe,{size:24}):e.jsx(me,{size:24})})]})]})]}),e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-6 space-y-4",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-2",children:[e.jsx(We,{className:"text-[#00a884]"}),"Payment Settings (Detailed)"]}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:"Advanced payment configuration"}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx("div",{role:"button",tabIndex:0,onClick:()=>y("paymentSettings.acceptCOD"),onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&y("paymentSettings.acceptCOD")},className:"p-4 bg-[#202c33] rounded-lg border border-[#2a3942] cursor-pointer select-none",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white text-sm font-medium",children:"Cash on Delivery (COD)"}),e.jsx("p",{className:"text-[#8696a0] text-xs mt-1",children:"Customers pay when order is delivered"})]}),e.jsx("button",{onClick:l=>{l.stopPropagation(),y("paymentSettings.acceptCOD")},className:i.paymentSettings.acceptCOD?"text-[#00a884]":"text-[#8696a0]",children:i.paymentSettings.acceptCOD?e.jsx(xe,{size:24}):e.jsx(me,{size:24})})]})}),e.jsx("div",{role:"button",tabIndex:0,onClick:()=>y("paymentSettings.acceptOnline"),onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&y("paymentSettings.acceptOnline")},className:"p-4 bg-[#202c33] rounded-lg border border-[#2a3942] cursor-pointer select-none",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white text-sm font-medium",children:"Online Payment"}),e.jsx("p",{className:"text-[#8696a0] text-xs mt-1",children:"UPI, Cards, Net Banking"})]}),e.jsx("button",{onClick:l=>{l.stopPropagation(),y("paymentSettings.acceptOnline")},className:i.paymentSettings.acceptOnline?"text-[#00a884]":"text-[#8696a0]",children:i.paymentSettings.acceptOnline?e.jsx(xe,{size:24}):e.jsx(me,{size:24})})]})}),e.jsxs("div",{role:"button",tabIndex:0,onClick:()=>y("paymentSettings.acceptCredit"),onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&y("paymentSettings.acceptCredit")},className:"p-4 bg-[#202c33] rounded-lg border border-[#2a3942] cursor-pointer select-none",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-white text-sm font-medium",children:"Credit (Khata)"}),e.jsx("p",{className:"text-[#8696a0] text-xs mt-1",children:"Allow customers to purchase on credit"})]}),e.jsx("button",{onClick:l=>{l.stopPropagation(),y("paymentSettings.acceptCredit")},className:i.paymentSettings.acceptCredit?"text-[#00a884]":"text-[#8696a0]",children:i.paymentSettings.acceptCredit?e.jsx(xe,{size:24}):e.jsx(me,{size:24})})]}),i.paymentSettings.acceptCredit&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-[#2a3942] grid gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-white text-sm",children:"Credit Days"}),e.jsx("input",{type:"number",min:0,max:365,value:i.paymentSettings.creditDays??0,onClick:l=>l.stopPropagation(),onChange:l=>p("paymentSettings.creditDays",parseInt(l.target.value)||0),className:"bg-[#111b21] text-white text-sm rounded-lg px-3 py-2 w-32 focus:outline-none focus:ring-1 focus:ring-[#00a884] border border-[#2a3942]",placeholder:"e.g. 7"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-white text-sm",children:"Credit Limit per Customer"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[#8696a0]",children:"â‚¹"}),e.jsx("input",{type:"number",min:0,value:i.paymentSettings.creditLimit??0,onClick:l=>l.stopPropagation(),onChange:l=>p("paymentSettings.creditLimit",parseInt(l.target.value)||0),className:"bg-[#111b21] text-white text-sm rounded-lg px-3 py-2 w-32 focus:outline-none focus:ring-1 focus:ring-[#00a884] border border-[#2a3942]",placeholder:"0 (unlimited)"})]})]}),e.jsx("p",{className:"text-[#8696a0] text-xs",children:"Customers can pay within the selected credit days."})]})]})]})]}),e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-6 space-y-4",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-2",children:[e.jsx(Re,{className:"text-[#00a884]"}),"Product Display"]}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:"How products appear to customers"}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white text-sm",children:"Show Price"}),e.jsx("button",{onClick:()=>y("productDisplay.showPrice"),className:i.productDisplay.showPrice?"text-[#00a884]":"text-[#8696a0]",children:i.productDisplay.showPrice?e.jsx(xe,{size:24}):e.jsx(me,{size:24})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white text-sm",children:"Show Stock Status"}),e.jsx("button",{onClick:()=>y("productDisplay.showStock"),className:i.productDisplay.showStock?"text-[#00a884]":"text-[#8696a0]",children:i.productDisplay.showStock?e.jsx(xe,{size:24}):e.jsx(me,{size:24})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white text-sm",children:"Show Images"}),e.jsx("button",{onClick:()=>y("productDisplay.showImage"),className:i.productDisplay.showImage?"text-[#00a884]":"text-[#8696a0]",children:i.productDisplay.showImage?e.jsx(xe,{size:24}):e.jsx(me,{size:24})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white text-sm",children:"Group by Category"}),e.jsx("button",{onClick:()=>y("productDisplay.groupByCategory"),className:i.productDisplay.groupByCategory?"text-[#00a884]":"text-[#8696a0]",children:i.productDisplay.groupByCategory?e.jsx(xe,{size:24}):e.jsx(me,{size:24})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white text-sm",children:"Products per message"}),e.jsx("input",{type:"number",value:i.productDisplay.maxProductsPerMessage,onChange:l=>p("productDisplay.maxProductsPerMessage",parseInt(l.target.value)||5),min:1,max:10,className:"bg-[#202c33] text-white text-sm rounded-lg px-3 py-2 w-20 focus:outline-none focus:ring-1 focus:ring-[#00a884]"})]})]})]})]}),e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-2 mb-4",children:[e.jsx(Pe,{className:"text-[#00a884]"}),"Welcome Message"]}),e.jsx("textarea",{value:i.welcomeMessage,onChange:l=>p("welcomeMessage",l.target.value),placeholder:"Enter welcome message shown when customer says 'Hi'...",className:"w-full bg-[#202c33] text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-1 focus:ring-[#00a884] min-h-[100px] resize-none placeholder-[#8696a0]"}),e.jsx("p",{className:"text-[#8696a0] text-xs mt-2",children:"This message is sent when a customer initiates a conversation"})]}),e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-2 mb-4",children:[e.jsx(Rs,{className:"text-[#00a884]"}),"Automated Messages"]}),e.jsx("div",{className:"grid gap-4",children:[{key:"orderConfirmed",label:"Order Confirmed",placeholder:"Message sent when order is confirmed"},{key:"orderShipped",label:"Order Shipped",placeholder:"Message sent when order is shipped"},{key:"orderDelivered",label:"Order Delivered",placeholder:"Message sent when order is delivered"}].map(l=>e.jsxs("div",{children:[e.jsx("label",{className:"text-white text-sm mb-2 block",children:l.label}),e.jsx("textarea",{value:i.messages[l.key],onChange:b=>p(`messages.${l.key}`,b.target.value),placeholder:l.placeholder,className:"w-full bg-[#202c33] text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-1 focus:ring-[#00a884] min-h-[80px] resize-none placeholder-[#8696a0] text-sm"})]},l.key))}),e.jsxs("p",{className:"text-[#8696a0] text-xs mt-4",children:["Variables: ","{order_id}",", ","{total}",", ","{items_count}",", ","{customer_name}",", ","{product_name}"]})]}),e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-2 mb-4",children:[e.jsx(st,{className:"text-[#00a884]"}),"Recent WhatsApp Orders"]}),d.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ns,{className:"text-[#8696a0] text-4xl mx-auto mb-3"}),e.jsx("p",{className:"text-[#8696a0]",children:"No WhatsApp orders yet"}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:"Orders placed via WhatsApp will appear here"})]}):e.jsx("div",{className:"space-y-3",children:d.map(l=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-[#202c33] rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[#00a884]/20 flex items-center justify-center",children:e.jsx(Ce,{className:"text-[#00a884]"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-white font-medium",children:["#",l.orderId||l.id.slice(-6)]}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:l.customerPhone||"Unknown"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-white font-medium",children:["â‚¹",(l.total||0).toLocaleString("en-IN")]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${l.status==="delivered"?"bg-[#00a884]/20 text-[#00a884]":l.status==="shipped"?"bg-blue-500/20 text-blue-400":l.status==="pending"?"bg-yellow-500/20 text-yellow-400":"bg-[#2a3942] text-[#8696a0]"}`,children:l.status||"Pending"})]})]},l.id))})]})]})},St={name:"Welcome Flow",description:"Greets customers and shows main menu options",isActive:!0,triggerKeywords:["hi","hello","hey","start","menu","hii","hiii"],nodes:[{id:"welcome_msg",type:"message",text:`Welcome to {business_name}! ðŸ‘‹

How can I help you today?`},{id:"welcome_buttons",type:"buttons",text:"Please select an option:",buttons:[{label:"ðŸ›’ Browse Products",action:"browse_products"},{label:"ðŸ“¦ My Orders",action:"view_orders"},{label:"ðŸ’¬ Get Help",action:"contact_support"}]}]},Ct={name:"Order Flow",description:"Helps customers browse and order products",isActive:!0,triggerKeywords:["order","buy","purchase","products","catalog","browse"],nodes:[{id:"order_msg",type:"message",text:"Let me help you place an order! ðŸ›’"},{id:"order_list",type:"list",action:"view_products",title:"Our Products"}]},kt={enabled:!0,welcomeMessage:"Welcome! ðŸ‘‹ I'm your order assistant. What would you like to do?",menuOptions:{browseProducts:{enabled:!0,label:"ðŸ›’ Browse Products"},viewOrders:{enabled:!0,label:"ðŸ“¦ My Orders"},trackOrder:{enabled:!0,label:"ðŸšš Track Order"},support:{enabled:!0,label:"ðŸ’¬ Contact Support"}},productDisplay:{showPrice:!0,showStock:!0,showImage:!0,showDescription:!0,maxProductsPerMessage:5,groupByCategory:!0},orderSettings:{minOrderValue:0,maxItemsPerOrder:50,requireConfirmation:!0,autoAssignOrderId:!0,sendOrderConfirmation:!0,sendStatusUpdates:!0},paymentSettings:{acceptCOD:!0,acceptOnline:!1,acceptCredit:!1,creditLimit:0,creditDays:7},messages:{orderConfirmed:`âœ… Order #{order_id} confirmed!

Total: â‚¹{total}
Items: {items_count}

We'll notify you when it's ready for delivery.`,orderShipped:"ðŸšš Great news! Your order #{order_id} has been shipped.",orderDelivered:`ðŸŽ‰ Your order #{order_id} has been delivered!

Thank you for shopping with us.`,outOfStock:"Sorry, {product_name} is currently out of stock.",cartEmpty:"Your cart is empty. Send 'Browse' to see our products."}},At=()=>{const[E,B]=r.useState(!0),[u,I]=r.useState(!1),[d,_]=r.useState({isEnabled:!1,hasWelcomeFlow:!1,hasOrderFlow:!1,orderBotEnabled:!1,totalFlows:0,activeFlows:0}),[D,$]=r.useState({messagesHandled:0,ordersReceived:0,activeConversations:0}),[i,F]=r.useState(!1),O=ge.currentUser?.uid;r.useEffect(()=>{if(!O)return;(async()=>{try{const p=ae(T,"businesses",O,"whatsappBot","orderConfig"),l=await fe(p),b=l.exists()&&l.data()?.enabled===!0,H=Y(T,"businesses",O,"whatsappFlows"),n=(await oe(H)).docs.map(A=>({id:A.id,...A.data()})),g=n.filter(A=>A.isActive),K=n.some(A=>A.triggerKeywords?.some(o=>["hi","hello","start"].includes(o.toLowerCase()))),v=n.some(A=>A.triggerKeywords?.some(o=>["order","buy","products"].includes(o.toLowerCase())));_({isEnabled:b||g.length>0,hasWelcomeFlow:K,hasOrderFlow:v,orderBotEnabled:b,totalFlows:n.length,activeFlows:g.length});const N=Y(T,"businesses",O,"whatsappOrders"),m=await oe(N),R=Y(T,"businesses",O,"whatsappMessages"),X=ue(R,is("automated","==",!0)),M=await oe(X),Z=Y(T,"businesses",O,"whatsappSessions"),G=await oe(Z);$({messagesHandled:M.size,ordersReceived:m.size,activeConversations:G.size}),B(!1)}catch(p){console.error("Error loading bot status:",p),B(!1)}})()},[O]);const Q=async()=>{if(O){I(!0);try{const y=ae(T,"businesses",O,"whatsappBot","orderConfig");await Me(y,{...kt,enabled:!0,createdAt:te(),updatedAt:te()}),console.log("âœ… Order Bot config created");const p=Y(T,"businesses",O,"whatsappFlows"),l=await oe(p),b=l.docs.some(P=>P.data().triggerKeywords?.some(g=>["hi","hello","start"].includes(g.toLowerCase())));b||(await we(p,{...St,createdAt:te(),updatedAt:te()}),console.log("âœ… Welcome Flow created"));const H=l.docs.some(P=>P.data().triggerKeywords?.some(g=>["order","buy","products"].includes(g.toLowerCase())));H||(await we(p,{...Ct,createdAt:te(),updatedAt:te()}),console.log("âœ… Order Flow created")),_(P=>({...P,isEnabled:!0,hasWelcomeFlow:!0,hasOrderFlow:!0,orderBotEnabled:!0,activeFlows:P.activeFlows+(b?0:1)+(H?0:1),totalFlows:P.totalFlows+(b?0:1)+(H?0:1)})),f.success("ðŸ¤– Bot enabled successfully! Your customers can now order via WhatsApp.")}catch(y){console.error("Error enabling bot:",y),f.error("Failed to enable bot. Please try again.")}finally{I(!1)}}},L=async()=>{if(O)try{const y=ae(T,"businesses",O,"whatsappBot","orderConfig");await Me(y,{enabled:!1,updatedAt:te()},{merge:!0}),_(p=>({...p,isEnabled:!1,orderBotEnabled:!1})),f.info("Bot paused. Customers will not receive automated responses.")}catch(y){console.error("Error disabling bot:",y),f.error("Failed to disable bot.")}};return E?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 border-2 border-[#00a884] border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-[#00a884] to-[#075e54] flex items-center justify-center",children:e.jsx(Se,{className:"text-white text-lg"})}),"Bot Quick Setup"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Enable automated WhatsApp ordering in one click"})]})}),e.jsx("div",{className:`rounded-2xl border-2 p-8 transition-all ${d.isEnabled?"bg-gradient-to-br from-[#00a884]/20 to-[#075e54]/10 border-[#00a884]/50":"bg-[#111b21] border-[#2a3942]"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:`w-20 h-20 rounded-2xl flex items-center justify-center ${d.isEnabled?"bg-[#00a884]/30":"bg-[#2a3942]"}`,children:e.jsx(Se,{className:`text-4xl ${d.isEnabled?"text-[#00a884]":"text-[#8696a0]"}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"WhatsApp Order Bot"}),d.isEnabled&&e.jsxs("span",{className:"px-3 py-1 bg-[#00a884]/20 text-[#00a884] text-sm font-medium rounded-full flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-[#00a884] rounded-full animate-pulse"}),"Active"]})]}),e.jsx("p",{className:"text-[#8696a0] mt-1",children:d.isEnabled?"Your bot is active and responding to customer messages":"Enable the bot to let customers order products via WhatsApp automatically"}),e.jsxs("div",{className:"flex flex-wrap gap-4 mt-4",children:[e.jsxs("div",{className:`flex items-center gap-2 text-sm ${d.hasWelcomeFlow?"text-[#00a884]":"text-[#8696a0]"}`,children:[d.hasWelcomeFlow?e.jsx(Ne,{}):e.jsx("div",{className:"w-4 h-4 rounded-full border border-[#8696a0]"}),"Welcome Flow"]}),e.jsxs("div",{className:`flex items-center gap-2 text-sm ${d.hasOrderFlow?"text-[#00a884]":"text-[#8696a0]"}`,children:[d.hasOrderFlow?e.jsx(Ne,{}):e.jsx("div",{className:"w-4 h-4 rounded-full border border-[#8696a0]"}),"Order Flow"]}),e.jsxs("div",{className:`flex items-center gap-2 text-sm ${d.orderBotEnabled?"text-[#00a884]":"text-[#8696a0]"}`,children:[d.orderBotEnabled?e.jsx(Ne,{}):e.jsx("div",{className:"w-4 h-4 rounded-full border border-[#8696a0]"}),"Order Bot"]})]})]})]}),e.jsx("div",{children:d.isEnabled?e.jsxs("button",{onClick:L,className:"px-6 py-3 bg-[#2a3942] text-white rounded-xl hover:bg-[#374248] transition-all flex items-center gap-2",children:[e.jsx(Us,{}),"Pause Bot"]}):e.jsx("button",{onClick:Q,disabled:u,className:"px-8 py-4 bg-gradient-to-r from-[#00a884] to-[#06cf9c] text-white text-lg font-semibold rounded-xl hover:shadow-lg hover:shadow-[#00a884]/30 transition-all flex items-center gap-3 disabled:opacity-50",children:u?e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"animate-spin"}),"Enabling..."]}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{}),"Enable Bot Now"]})})})]})}),d.isEnabled&&e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Pe,{className:"text-[#00a884] text-xl"}),e.jsx("span",{className:"text-3xl font-bold text-white",children:D.messagesHandled})]}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:"Messages Handled"})]}),e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ze,{className:"text-[#3b82f6] text-xl"}),e.jsx("span",{className:"text-3xl font-bold text-white",children:D.ordersReceived})]}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:"Orders Received"})]}),e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ce,{className:"text-[#00a884] text-xl"}),e.jsx("span",{className:"text-3xl font-bold text-white",children:D.activeConversations})]}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:"Active Conversations"})]})]}),e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(at,{className:"text-[#f59e0b]"}),"How It Works"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{step:1,icon:Ce,title:'Customer Sends "Hi"',desc:"Your customer starts a conversation"},{step:2,icon:Se,title:"Bot Responds",desc:"Shows welcome message with options"},{step:3,icon:Re,title:"Browse & Select",desc:"Customer browses and adds to cart"},{step:4,icon:Ne,title:"Order Confirmed",desc:"Order is created automatically"}].map((y,p)=>e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-[#00a884]/20 flex items-center justify-center mb-3",children:e.jsx(y.icon,{className:"text-[#00a884] text-xl"})}),e.jsxs("span",{className:"text-xs text-[#00a884] font-medium mb-1",children:["Step ",y.step]}),e.jsx("h4",{className:"text-white font-medium text-sm",children:y.title}),e.jsx("p",{className:"text-[#8696a0] text-xs mt-1",children:y.desc})]}),p<3&&e.jsx(ss,{className:"hidden md:block absolute top-6 -right-2 text-[#2a3942]"})]},p))})]}),e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-2 flex items-center gap-2",children:[e.jsx(Ns,{className:"text-[#00a884]"}),"Available Flow Templates (6 Ready-to-Use)"]}),e.jsx("p",{className:"text-[#8696a0] text-sm mb-4",children:"Choose any template from Flow Builder to customize your bot"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[{icon:"ðŸ‘‹",name:"Welcome Flow",triggers:"hi, hello, start",desc:"Greets customers & shows main menu",color:"from-green-500/20 to-green-600/10"},{icon:"ðŸ›’",name:"Order Assistant",triggers:"order, buy, purchase",desc:"Create & track orders",color:"from-blue-500/20 to-blue-600/10"},{icon:"ðŸ“¦",name:"Product Catalog",triggers:"products, catalog, menu",desc:"Show inventory products",color:"from-purple-500/20 to-purple-600/10"},{icon:"ðŸŽ§",name:"Customer Support",triggers:"help, support, issue",desc:"Handle support queries",color:"from-yellow-500/20 to-yellow-600/10"},{icon:"ðŸšš",name:"Order Status",triggers:"status, track, tracking",desc:"Check order status & tracking",color:"from-orange-500/20 to-orange-600/10"},{icon:"ðŸ’³",name:"Payment Reminder",triggers:"payment, pay, pending",desc:"Send payment reminders",color:"from-pink-500/20 to-pink-600/10"}].map((y,p)=>e.jsxs("div",{className:`p-4 bg-gradient-to-br ${y.color} rounded-xl border border-[#2a3942] hover:border-[#00a884]/50 transition-all`,children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#00a884]/20 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xl",children:y.icon})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-white font-medium text-sm",children:y.name}),e.jsx("p",{className:"text-[#8696a0] text-xs mt-0.5",children:y.desc})]})]}),e.jsx("div",{className:"mt-2 pt-2 border-t border-[#2a3942]",children:e.jsxs("p",{className:"text-[#8696a0] text-xs",children:[e.jsx("span",{className:"font-medium text-[#00a884]",children:"Triggers:"})," ",y.triggers]})})]},p))}),e.jsx("div",{className:"mt-4 p-3 bg-[#00a884]/10 border border-[#00a884]/30 rounded-lg",children:e.jsxs("p",{className:"text-[#00a884] text-xs flex items-center gap-2",children:[e.jsx(ze,{className:"text-[#00a884]"}),e.jsxs("span",{children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"}),' Go to "Flow Builder" tab to customize these templates or create your own flows!']})]})})]}),d.isEnabled&&e.jsx("div",{className:"bg-gradient-to-r from-[#00a884]/10 to-[#075e54]/10 rounded-xl border border-[#00a884]/30 p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-[#00a884]/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Ce,{className:"text-[#00a884] text-2xl"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-lg mb-1",children:"Test Your Bot"}),e.jsx("p",{className:"text-[#8696a0] mb-3",children:"Send a message from a customer's phone to your WhatsApp Business number. Try sending:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["Hi","Hello","Browse","Products","Orders"].map(y=>e.jsxs("span",{className:"px-3 py-1 bg-[#2a3942] text-[#00a884] text-sm rounded-full",children:['"',y,'"']},y))})]})]})})]})},je={pending:{bg:"bg-yellow-500/20",text:"text-yellow-400",border:"border-yellow-500/30"},confirmed:{bg:"bg-blue-500/20",text:"text-blue-400",border:"border-blue-500/30"},processing:{bg:"bg-purple-500/20",text:"text-purple-400",border:"border-purple-500/30"},shipped:{bg:"bg-indigo-500/20",text:"text-indigo-400",border:"border-indigo-500/30"},delivered:{bg:"bg-green-500/20",text:"text-green-400",border:"border-green-500/30"},cancelled:{bg:"bg-red-500/20",text:"text-red-400",border:"border-red-500/30"}},Tt=()=>{const[E,B]=r.useState([]),[u,I]=r.useState(!0),[d,_]=r.useState(null),[D,$]=r.useState(!1),[i,F]=r.useState(""),[O,Q]=r.useState("all"),[L,y]=r.useState({total:0,pending:0,confirmed:0,shipped:0,delivered:0,totalRevenue:0,todayRevenue:0}),p=ge.currentUser?.uid;r.useEffect(()=>{if(!p)return;const n=Y(T,"businesses",p,"whatsappOrders"),g=ue(n,ke("createdAt","desc")),K=ye(g,v=>{const N=v.docs.map(M=>({id:M.id,...M.data(),createdAt:M.data().createdAt,updatedAt:M.data().updatedAt}));B(N);const m=new Date;m.setHours(0,0,0,0);const R=N.reduce((M,Z)=>M+(Z.total||0),0),X=N.filter(M=>(M.createdAt?.toDate?.()||new Date(0))>=m).reduce((M,Z)=>M+(Z.total||0),0);y({total:N.length,pending:N.filter(M=>M.status==="pending").length,confirmed:N.filter(M=>M.status==="confirmed").length,shipped:N.filter(M=>M.status==="shipped").length,delivered:N.filter(M=>M.status==="delivered").length,totalRevenue:R,todayRevenue:X}),I(!1)},v=>{console.error("Error loading orders:",v),I(!1)});return()=>K()},[p]);const l=E.filter(n=>{const g=!i||n.orderId?.toLowerCase().includes(i.toLowerCase())||n.customerPhone?.includes(i)||n.id?.toLowerCase().includes(i.toLowerCase()),K=O==="all"||n.status===O;return g&&K}),b=async(n,g)=>{try{const K=ae(T,"businesses",p,"whatsappOrders",n);await Fe(K,{status:g,updatedAt:te()}),f.success(`Order status updated to ${g}`),d?.id===n&&_({...d,status:g})}catch(K){console.error("Error updating order status:",K),f.error("Failed to update order status")}},H=async n=>{try{if(!n?.id)return;await ys(hs,"sendOrderUpdateNotification")({orderId:n.id,status:n.status}),f.success("âœ… Customer notified on WhatsApp")}catch(g){console.error("Notify customer failed:",g),f.error(`Failed to notify: ${g.message||"Unknown error"}`)}},P=n=>{if(!n)return"N/A";try{return(n.toDate?n.toDate():new Date(n)).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"N/A"}};return u?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 border-2 border-[#00a884] border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between pb-4 border-b border-white/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“‹"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"WhatsApp Orders"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Track and manage all orders received via WhatsApp"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ls,{className:"text-[#00a884] text-xl"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:L.total})]}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:"Total Orders"})]}),e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(rt,{className:"text-yellow-400 text-xl"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:L.pending})]}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:"Pending"})]}),e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(nt,{className:"text-indigo-400 text-xl"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:L.shipped})]}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:"Shipped"})]}),e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(js,{className:"text-green-400 text-xl"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:["â‚¹",L.totalRevenue.toLocaleString("en-IN")]})]}),e.jsx("p",{className:"text-[#8696a0] text-sm",children:"Total Revenue"})]})]}),e.jsx("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-[#8696a0]"}),e.jsx("input",{type:"text",value:i,onChange:n=>F(n.target.value),placeholder:"Search by Order ID or Phone Number...",className:"w-full bg-[#202c33] text-white rounded-lg pl-10 pr-4 py-2.5 focus:outline-none focus:ring-1 focus:ring-[#00a884] placeholder-[#8696a0]"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:O,onChange:n=>Q(n.target.value),className:"bg-[#202c33] text-white rounded-lg px-4 py-2.5 focus:outline-none focus:ring-1 focus:ring-[#00a884] border border-[#2a3942]",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]})}),e.jsx("div",{className:"space-y-3",children:l.length===0?e.jsxs("div",{className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-12 text-center",children:[e.jsx(Ce,{className:"text-[#8696a0] text-5xl mx-auto mb-4"}),e.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"No Orders Found"}),e.jsx("p",{className:"text-[#8696a0]",children:i||O!=="all"?"No orders match your filters. Try adjusting your search.":"WhatsApp orders will appear here once customers place orders via your bot."})]}):l.map(n=>e.jsx(ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-[#111b21] rounded-xl border border-[#2a3942] p-5 hover:border-[#00a884]/50 transition-all cursor-pointer",onClick:()=>{_(n),$(!0)},children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-[#00a884]/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Ce,{className:"text-[#00a884] text-xl"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h3",{className:"text-white font-semibold text-lg",children:["#",n.orderId||n.id]}),e.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-medium ${je[n.status]?.bg||je.pending.bg} ${je[n.status]?.text||je.pending.text} ${je[n.status]?.border||je.pending.border} border`,children:n.status?.toUpperCase()||"PENDING"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[#8696a0]",children:[e.jsx(ds,{className:"text-[#00a884]"}),e.jsx("span",{children:n.customerPhone||"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[#8696a0]",children:[e.jsx(ls,{className:"text-[#00a884]"}),e.jsxs("span",{children:[n.itemCount||0," items"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[#8696a0]",children:[e.jsx(us,{className:"text-[#00a884]"}),e.jsx("span",{children:P(n.createdAt)})]})]}),n.items&&n.items.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-[#2a3942]",children:[e.jsx("p",{className:"text-[#8696a0] text-xs mb-1",children:"Items:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.items.slice(0,3).map((g,K)=>e.jsxs("span",{className:"text-xs bg-[#202c33] text-[#8696a0] px-2 py-1 rounded",children:[g.name||"Item"," (Ã—",g.quantity,")"]},K)),n.items.length>3&&e.jsxs("span",{className:"text-xs text-[#8696a0] px-2 py-1",children:["+",n.items.length-3," more"]})]})]})]})]}),e.jsxs("div",{className:"text-right ml-4 flex-shrink-0",children:[e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:["â‚¹",(n.total||0).toLocaleString("en-IN")]}),e.jsxs("div",{className:"flex items-center gap-2 text-[#8696a0] text-xs",children:[e.jsx(lt,{className:"text-[#00a884]"}),e.jsx("span",{children:"View Details"})]})]})]})},n.id))}),e.jsx(ve,{children:D&&d&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>$(!1),children:e.jsxs(ne.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:n=>n.stopPropagation(),className:"bg-[#111b21] rounded-2xl border border-[#2a3942] w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-[#2a3942] flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-white flex items-center gap-3",children:[e.jsx(Ce,{className:"text-[#00a884]"}),"Order Details"]}),e.jsxs("p",{className:"text-[#8696a0] text-sm mt-1",children:["#",d.orderId||d.id]})]}),e.jsx("button",{onClick:()=>$(!1),className:"p-2 rounded-lg hover:bg-[#2a3942] text-gray-400 hover:text-white transition-colors",children:e.jsx(Ie,{size:20})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1 space-y-6",children:[e.jsxs("div",{className:"bg-[#202c33] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 gap-3",children:[e.jsx("h4",{className:"text-white font-semibold",children:"Order Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>H(d),className:"px-3 py-2 rounded-lg bg-[#00a884]/15 border border-[#00a884]/30 text-[#00a884] text-sm hover:bg-[#00a884]/25 transition-colors",title:"Send an update message to customer on WhatsApp",children:"Notify Customer"}),e.jsxs("select",{value:d.status||"pending",onChange:n=>b(d.id,n.target.value),className:"bg-[#111b21] text-white rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-[#00a884] border border-[#2a3942]",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`px-3 py-1.5 rounded-full text-sm font-medium ${je[d.status]?.bg||je.pending.bg} ${je[d.status]?.text||je.pending.text} ${je[d.status]?.border||je.pending.border} border`,children:d.status?.toUpperCase()||"PENDING"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-[#202c33] rounded-xl p-4",children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(ds,{className:"text-[#00a884]"}),"Customer Details"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[#8696a0]",children:"Phone:"}),e.jsx("span",{className:"text-white ml-2",children:d.customerPhone||"N/A"})]}),d.customerName&&e.jsxs("div",{children:[e.jsx("span",{className:"text-[#8696a0]",children:"Name:"}),e.jsx("span",{className:"text-white ml-2",children:d.customerName})]})]})]}),e.jsxs("div",{className:"bg-[#202c33] rounded-xl p-4",children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(We,{className:"text-[#00a884]"}),"Payment Info"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[#8696a0]",children:"Method:"}),e.jsx("span",{className:"text-white ml-2",children:d.paymentMethod||"COD"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[#8696a0]",children:"Status:"}),e.jsx("span",{className:"text-white ml-2 capitalize",children:d.paymentStatus||"pending"})]})]})]})]}),e.jsxs("div",{className:"bg-[#202c33] rounded-xl p-4",children:[e.jsxs("h4",{className:"text-white font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ls,{className:"text-[#00a884]"}),"Order Items (",d.itemCount||d.items?.length||0,")"]}),e.jsx("div",{className:"space-y-3",children:d.items&&d.items.length>0?d.items.map((n,g)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-[#111b21] rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-medium",children:n.name||"Product"}),e.jsxs("p",{className:"text-[#8696a0] text-sm",children:[n.quantity," Ã— â‚¹",n.price?.toLocaleString("en-IN")||0]})]}),e.jsxs("div",{className:"text-white font-semibold",children:["â‚¹",(n.total||0).toLocaleString("en-IN")]})]},g)):e.jsx("p",{className:"text-[#8696a0] text-sm",children:"No items found"})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-[#2a3942] flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold text-lg",children:"Total Amount:"}),e.jsxs("span",{className:"text-white font-bold text-xl",children:["â‚¹",(d.total||0).toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"bg-[#202c33] rounded-xl p-4",children:[e.jsxs("h4",{className:"text-white font-semibold mb-4 flex items-center gap-2",children:[e.jsx(us,{className:"text-[#00a884]"}),"Order Timeline"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[#8696a0]",children:"Order Created:"}),e.jsx("span",{className:"text-white ml-2",children:P(d.createdAt)})]}),d.updatedAt&&e.jsxs("div",{children:[e.jsx("span",{className:"text-[#8696a0]",children:"Last Updated:"}),e.jsx("span",{className:"text-white ml-2",children:P(d.updatedAt)})]}),d.source&&e.jsxs("div",{children:[e.jsx("span",{className:"text-[#8696a0]",children:"Source:"}),e.jsx("span",{className:"text-white ml-2 capitalize",children:d.source.replace("_"," ")})]})]})]})]})]})})})]})},Pt=`
  .scrollbar-thin::-webkit-scrollbar {
    width: 6px;
  }
  .scrollbar-thin::-webkit-scrollbar-track {
    background: transparent;
  }
  .scrollbar-thin::-webkit-scrollbar-thumb {
    background: rgba(134, 150, 160, 0.2);
    border-radius: 10px;
  }
  .scrollbar-thin::-webkit-scrollbar-thumb:hover {
    background: rgba(134, 150, 160, 0.35);
  }
  .scrollbar-thumb-slate-600::-webkit-scrollbar-thumb {
    background: rgba(42, 57, 66, 0.6);
  }
  .scrollbar-track-transparent::-webkit-scrollbar-track {
    background: transparent;
  }
  
  /* WhatsApp-like card styles */
  .wa-card {
    background: #111b21;
    border: 1px solid #222d34;
    border-radius: 12px;
  }
  
  .wa-card-hover:hover {
    border-color: #00a884;
    box-shadow: 0 0 0 1px rgba(0, 168, 132, 0.2);
  }
  
  /* Button styles */
  .wa-btn-primary {
    background: linear-gradient(135deg, #00a884 0%, #075e54 100%);
    transition: all 0.2s ease;
  }
  
  .wa-btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 168, 132, 0.3);
  }
  
  /* Stats card animation */
  @keyframes statFadeIn {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .stat-card {
    animation: statFadeIn 0.3s ease forwards;
  }
  
  .stat-card:nth-child(1) { animation-delay: 0ms; }
  .stat-card:nth-child(2) { animation-delay: 50ms; }
  .stat-card:nth-child(3) { animation-delay: 100ms; }
  .stat-card:nth-child(4) { animation-delay: 150ms; }
`,$t=()=>{zs();const B=new URLSearchParams(window.location.search).get("review")==="true",[u,I]=r.useState({selectedProducts:[],selectedRetailers:new Set,customPhoneNumbers:[],currentMessage:"",messageImage:null,messageImageUrl:"",templateData:{}}),[d,_]=r.useState(""),[D,$]=r.useState(""),[i,F]=r.useState(B?"review":"overview"),[O,Q]=r.useState(0),L=[{id:"overview",label:"Overview",icon:"ðŸ“Š",description:"Dashboard & stats"},{id:"inbox",label:"Inbox",icon:"ðŸ’¬",description:"WhatsApp-style chat",showBadge:!0},{id:"catalog",label:"Catalog Sync",icon:"ðŸ“¦",description:"Sync products"},{id:"quicksetup",label:"Bot Setup",icon:"ðŸš€",description:"Bot configuration & automation"},{id:"flowbuilder",label:"Flow Builder",icon:"ðŸ”€",description:"Automated flows"},{id:"orders",label:"Orders",icon:"ðŸ“‹",description:"All WhatsApp orders"},{id:"stock",label:"Stock Reminders",icon:"ðŸ””",description:"Stock alerts"},{id:"templates",label:"Templates",icon:"ðŸŽ¨",description:"Manage message templates"},{id:"campaigns",label:"Campaigns",icon:"ðŸ“ˆ",description:"Campaigns"},{id:"schedule",label:"Schedule",icon:"â°",description:"Scheduling"},{id:"history",label:"History",icon:"ðŸ“œ",description:"History"}],[y,p]=r.useState("setup"),[l,b]=r.useState(null),[H,P]=r.useState(!0),[n,g]=r.useState([]),[K,v]=r.useState([]),[N,m]=r.useState([]),[R,X]=r.useState({sent:0,today:0,thisWeek:0,byType:{stock:0,promotional:0,order:0,payment:0,catalog:0},successRate:0}),[M,Z]=r.useState(!1),[G,A]=r.useState(!1),o=ge.currentUser?.uid;r.useEffect(()=>{if(!o)return;const t=Y(T,"businesses",o,"whatsappInbox"),x=ye(ue(t,Ae(500)),h=>{let S=0;h.docs.forEach(C=>{const s=C.data();!s.read&&s.read!==!0&&S++}),Q(S)});return()=>x()},[o]),r.useEffect(()=>{if(!o)return;const t=Y(T,"businesses",o,"products"),x=ye(t,h=>{const S=h.docs.map(C=>({id:C.id,...C.data(),name:C.data().productName||C.data().name||"Unnamed Product",price:C.data().sellingPrice||C.data().mrp||C.data().price||0,originalPrice:C.data().sellingPrice||C.data().mrp||C.data().price||0,imageUrl:C.data().imageUrl||C.data().image||null}));g(S),I(C=>({...C,selectedProducts:C.selectedProducts.map(s=>{const c=S.find(k=>k.id===s.id);return c?{...s,...c,price:s.customPrice!==void 0?s.customPrice:c.price,originalPrice:c.originalPrice}:s})}))});return()=>x()},[o]),r.useEffect(()=>{if(!o)return;const t=ae(T,"businesses",o),x=ye(t,async h=>{if(h.exists()&&h.data().whatsappBusinessAccountId){const C=await Te(o);b(C)}});return()=>x()},[o]),r.useEffect(()=>{(async()=>{if(o)try{const x=await Te(o),h=await fe(ae(T,"businesses",o));if(h.exists()){const c=h.data();if(c.whatsappBusinessAccountId){const k={enabled:c.whatsappEnabled||!0,provider:c.whatsappProvider||Ke.META_TECH_PROVIDER,phoneNumberId:c.whatsappPhoneNumberId||"",businessAccountId:c.whatsappBusinessAccountId,apiKey:x?.apiKey||"",apiSecret:x?.apiSecret||"",accessToken:x?.accessToken||"",twilioAccountSid:x?.twilioAccountSid||"",twilioAuthToken:x?.twilioAuthToken||"",twilioWhatsAppFrom:x?.twilioWhatsAppFrom||"",verified:c.whatsappVerified||!1,createdVia:c.whatsappCreatedVia||null,webhookConfigured:c.whatsappWebhookConfigured||!1};b(k)}else b(x)}else b(x);const S=Y(T,"businesses",o,"connectedRetailers"),s=(await oe(S)).docs.map(c=>{const k=c.data();return{id:c.id,...k,phone:k.phone||k.retailerPhone||"",businessName:k.businessName||k.retailerName||""}});if(v(s),x?.enabled)try{const c=Y(T,"businesses",o,"whatsappMessages"),k=ue(c,ke("createdAt","desc"),Ae(500)),j=(await oe(k)).docs.map(J=>({id:J.id,...J.data()}));m(j);const U=new Date,W=new Date(U.getFullYear(),U.getMonth(),U.getDate()),ee=new Date(W.getTime()-10080*60*1e3),ie=j.filter(J=>J.status==="sent").length,ce=j.filter(J=>J.status==="failed").length,le=ie+ce,q=j.filter(J=>(J.createdAt?.toDate?.()||new Date(J.createdAt||0))>=W&&J.status==="sent").length,be=j.filter(J=>(J.createdAt?.toDate?.()||new Date(J.createdAt||0))>=ee&&J.status==="sent").length,pe={stock:j.filter(J=>J.messageType==="stock_reminder"||J.messageType==="bulk_stock_reminder").length,promotional:j.filter(J=>J.messageType==="promotional").length,order:j.filter(J=>J.messageType==="order_status_update").length,payment:j.filter(J=>J.messageType==="payment_reminder").length,catalog:j.filter(J=>J.messageType==="catalog"||J.messageType==="product_share").length};X({sent:ie,today:q,thisWeek:be,byType:pe,successRate:le>0?Math.round(ie/le*100):0})}catch(c){console.warn("Could not fetch message history:",c)}}catch(x){console.error("Error fetching data:",x)}finally{P(!1)}})()},[o]),r.useCallback(async()=>{if(u.selectedProducts.length===0)return"";const t=ae(T,"businesses",o),S=(await fe(t)).data()?.businessName||"Our Store";let C=`ðŸ“¦ *Product Catalog*

`;return C+=`Hello!

`,C+=`Here are our featured products:

`,u.selectedProducts.forEach((s,c)=>{C+=`${c+1}. *${s.name}*
`,s.brand&&(C+=`   Brand: ${s.brand}
`),s.price&&(s.discountPercent&&s.originalPrice?(C+=`   Price: â‚¹${s.price} (${s.discountPercent}% OFF)
`,C+=`   ~~Was: â‚¹${s.originalPrice}~~
`):C+=`   Price: â‚¹${s.price}
`),s.quantity!==void 0&&(C+=`   Stock: ${s.quantity} ${s.unit||"units"}
`),C+=`
`}),u.messageImageUrl&&(C+=`
ðŸ“· [View Image: ${u.messageImageUrl}]

`),C+=`ðŸ’¡ Interested in any product? Reply to this message to place your order!

`,C+=`â€“ ${S}
`,C+="_Powered by FLYP_",I(s=>({...s,currentMessage:C})),C},[u.selectedProducts,u.messageImageUrl,o]),r.useCallback(async t=>{const x=ae(T,"businesses",o),C=(await fe(x)).data()?.businessName||"Our Store";let s=`ðŸŽ‰ *Special Offer!*

`;return t.title&&(s+=`*${t.title}*

`),t.description&&(s+=`${t.description}

`),u.selectedProducts.length>0&&(s+=`ðŸ“¦ *Featured Products:*
`,u.selectedProducts.forEach((c,k)=>{s+=`${k+1}. *${c.name}*`,c.price&&(c.discountPercent&&c.originalPrice?(s+=` - â‚¹${c.price} (${c.discountPercent}% OFF)`,s+=` ~~Was â‚¹${c.originalPrice}~~`):s+=` - â‚¹${c.price}`),s+=`
`}),s+=`
`),t.discount&&(s+=`ðŸ’° *Discount:* ${t.discount}
`),t.validUntil&&(s+=`ðŸ“… *Valid Until:* ${t.validUntil}
`),t.terms&&(s+=`
${t.terms}
`),u.messageImageUrl&&(s+=`
ðŸ“· [View Image: ${u.messageImageUrl}]

`),s+=`
Don't miss out on this amazing deal!

`,s+=`â€“ ${C}
`,s+="_Powered by FLYP_",I(c=>({...c,currentMessage:s})),s},[u.selectedProducts,u.messageImageUrl,o]);const w=l?.enabled||!!l?.businessAccountId,z=l?.provider===Ke.META_TECH_PROVIDER;return H?e.jsx("div",{className:"p-6 text-white",children:e.jsx("div",{className:"animate-pulse",children:"Loading WhatsApp Hub..."})}):e.jsxs("div",{className:"flex w-full h-full text-white bg-[#0b141a] overflow-hidden relative",children:[e.jsx("style",{children:Pt}),e.jsxs("div",{className:"w-56 bg-[#111b21] border-r border-[#222d34] flex flex-col flex-shrink-0 h-full overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-[#222d34] flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-[#00a884] to-[#075e54] flex items-center justify-center shadow-lg shadow-[#00a884]/20",children:e.jsx("span",{className:"text-xl",children:"ðŸ’¬"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-base font-semibold text-white",children:"WhatsApp Hub"}),w&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-[#00a884] rounded-full animate-pulse"}),e.jsx("span",{className:"text-[11px] text-[#00a884] font-medium",children:"Connected"})]})]})]})}),e.jsx("nav",{className:"flex-1 overflow-y-auto py-2 px-2 scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-transparent",children:L.map(t=>{const x=i===t.id,h=t.showBadge&&O>0;return e.jsxs("button",{onClick:()=>{F(t.id),t.id==="quicksetup"&&p("setup")},className:`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg mb-0.5 transition-all duration-200 group relative ${x?"bg-[#00a884] text-white shadow-lg shadow-[#00a884]/25":"text-[#aebac1] hover:bg-[#202c33] hover:text-white"}`,title:t.description,children:[e.jsx("span",{className:`text-base ${x?"scale-110":"group-hover:scale-105"} transition-transform`,children:t.icon}),e.jsx("span",{className:"font-medium text-sm flex-1 text-left",children:t.label}),h&&e.jsx("span",{className:`min-w-[20px] h-5 px-1.5 text-[11px] font-bold rounded-full flex items-center justify-center ${x?"bg-white text-[#00a884]":"bg-[#00a884] text-white"}`,children:O>99?"99+":O})]},t.id)})}),e.jsx("div",{className:"p-3 border-t border-[#222d34]",children:e.jsxs("div",{className:"flex items-center gap-2 px-2 py-2 rounded-lg bg-[#202c33]/50",children:[e.jsx("div",{className:"w-2 h-2 bg-[#00a884] rounded-full"}),e.jsx("span",{className:"text-[11px] text-[#8696a0]",children:R.today>0?`${R.today} messages today`:"Ready to send"})]})})]}),e.jsx("div",{className:`flex-1 h-full bg-[#0b141a] ${i==="inbox"?"overflow-hidden":"overflow-y-auto scroll-smooth scrollbar-thin"}`,children:e.jsxs("div",{className:`${i==="inbox"?"h-full overflow-hidden":"p-5"}`,children:[i!=="inbox"&&w&&e.jsxs("div",{className:"mb-5 flex items-center justify-between gap-3 pb-4 border-b border-[#222d34]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-[#00a884]/10 border border-[#00a884]/30 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-[#00a884] rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium text-[#00a884]",children:"Connected"})]}),z&&e.jsx("div",{className:"px-3 py-1.5 bg-[#3b82f6]/10 border border-[#3b82f6]/30 rounded-lg",children:e.jsx("span",{className:"text-xs font-medium text-[#3b82f6]",children:"ðŸš€ Tech Provider"})})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-[#8696a0]",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-[#00a884]"}),R.sent," sent"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-[#3b82f6]"}),R.successRate,"% success"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-[#a855f7]"}),R.today," today"]})]})]}),e.jsx(ve,{mode:"wait",children:e.jsxs(ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:[i==="overview"&&e.jsx("div",{className:"space-y-5",children:w?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"stat-card bg-[#111b21] border border-[#222d34] rounded-xl p-5 hover:border-[#00a884]/30 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#00a884]/20 flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:"ðŸ“¤"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:R.sent})]}),e.jsx("p",{className:"text-sm text-[#8696a0]",children:"Messages Sent"})]}),e.jsxs("div",{className:"stat-card bg-[#111b21] border border-[#222d34] rounded-xl p-5 hover:border-[#00a884]/30 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#00a884]/20 flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:"âœ…"})}),e.jsxs("span",{className:"text-2xl font-bold text-[#00a884]",children:[R.successRate,"%"]})]}),e.jsx("p",{className:"text-sm text-[#8696a0]",children:"Success Rate"})]}),e.jsxs("div",{className:"stat-card bg-[#111b21] border border-[#222d34] rounded-xl p-5 hover:border-[#00a884]/30 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#3b82f6]/20 flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:"ðŸ“…"})}),e.jsx("span",{className:"text-2xl font-bold text-[#3b82f6]",children:R.today})]}),e.jsx("p",{className:"text-sm text-[#8696a0]",children:"Sent Today"})]}),e.jsxs("div",{className:"stat-card bg-[#111b21] border border-[#222d34] rounded-xl p-5 hover:border-[#00a884]/30 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#a855f7]/20 flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:"ðŸ“Š"})}),e.jsx("span",{className:"text-2xl font-bold text-[#a855f7]",children:R.thisWeek})]}),e.jsx("p",{className:"text-sm text-[#8696a0]",children:"This Week"})]})]}),e.jsxs("div",{className:"bg-[#111b21] border border-[#222d34] rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-white flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-8 rounded-lg bg-[#00a884]/20 flex items-center justify-center text-sm",children:"ðŸ“Š"}),"Message Types"]}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:[{label:"Catalogs",value:R.byType.catalog,color:"#00a884"},{label:"Promotional",value:R.byType.promotional,color:"#3b82f6"},{label:"Order Updates",value:R.byType.order,color:"#a855f7"},{label:"Stock Reminders",value:R.byType.stock,color:"#f59e0b"},{label:"Payment",value:R.byType.payment,color:"#06b6d4"}].map((t,x)=>e.jsxs("div",{className:"text-center p-3 rounded-lg bg-[#202c33]/50 hover:bg-[#202c33] transition-colors",children:[e.jsx("p",{className:"text-xl font-bold",style:{color:t.color},children:t.value}),e.jsx("p",{className:"text-xs text-[#8696a0] mt-1",children:t.label})]},x))})]}),e.jsxs("div",{className:"bg-[#111b21] border border-[#222d34] rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-white flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-8 rounded-lg bg-[#00a884]/20 flex items-center justify-center text-sm",children:"âš¡"}),"Quick Actions"]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-3",children:[e.jsxs("button",{onClick:()=>F("inbox"),className:"group p-4 bg-[#202c33]/50 border border-[#222d34] rounded-xl hover:border-[#00a884]/50 hover:bg-[#00a884]/10 transition-all text-left",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#00a884]/20 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",children:e.jsx("span",{className:"text-xl",children:"ðŸ’¬"})}),e.jsx("p",{className:"font-medium text-white text-sm",children:"Chat Inbox"}),e.jsx("p",{className:"text-xs text-[#8696a0] mt-0.5",children:"WhatsApp-style messaging"})]}),e.jsxs("button",{onClick:()=>F("catalog"),className:"group p-4 bg-[#202c33]/50 border border-[#222d34] rounded-xl hover:border-[#3b82f6]/50 hover:bg-[#3b82f6]/10 transition-all text-left",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#3b82f6]/20 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",children:e.jsx("span",{className:"text-xl",children:"ðŸ“¦"})}),e.jsx("p",{className:"font-medium text-white text-sm",children:"Catalog Sync"}),e.jsx("p",{className:"text-xs text-[#8696a0] mt-0.5",children:"Sync products"})]}),e.jsxs("button",{onClick:()=>F("stock"),className:"group p-4 bg-[#202c33]/50 border border-[#222d34] rounded-xl hover:border-[#f59e0b]/50 hover:bg-[#f59e0b]/10 transition-all text-left",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#f59e0b]/20 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",children:e.jsx("span",{className:"text-xl",children:"ðŸ””"})}),e.jsx("p",{className:"font-medium text-white text-sm",children:"Stock Reminders"}),e.jsx("p",{className:"text-xs text-[#8696a0] mt-0.5",children:"Bulk stock alerts"})]}),e.jsxs("button",{onClick:()=>F("orders"),className:"group p-4 bg-[#202c33]/50 border border-[#222d34] rounded-xl hover:border-[#a855f7]/50 hover:bg-[#a855f7]/10 transition-all text-left",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#a855f7]/20 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",children:e.jsx("span",{className:"text-xl",children:"ðŸ“‹"})}),e.jsx("p",{className:"font-medium text-white text-sm",children:"Orders"}),e.jsx("p",{className:"text-xs text-[#8696a0] mt-0.5",children:"View all orders"})]})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"bg-gradient-to-br from-[#00a884]/10 to-[#075e54]/5 border border-[#00a884]/20 rounded-2xl p-8 mb-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-2xl bg-[#00a884]/20 flex items-center justify-center",children:e.jsx("span",{className:"text-4xl",children:"ðŸ“±"})}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Create Your WhatsApp Business Account"}),e.jsx("p",{className:"text-[#8696a0] mb-4 max-w-2xl mx-auto",children:"Set up your own WhatsApp Business Account with your phone number to start sending messages, managing conversations, and automating customer interactions."})]}),e.jsx(Bs,{onSetupComplete:async t=>{if(t?.success){const x=await Te(o);b(x),f.success("WhatsApp setup complete! You can now use all features.");try{const h=Y(T,"businesses",o,"whatsappMessages"),S=ue(h,ke("createdAt","desc"),Ae(500)),s=(await oe(S)).docs.map(c=>({id:c.id,...c.data()}));m(s)}catch(h){console.warn("Could not refresh message history:",h)}}}})]})}),!1,i==="inbox"&&w&&e.jsx("div",{className:"h-full w-full overflow-hidden",style:{height:"100%"},children:e.jsx(xt,{})}),i==="catalog"&&w&&e.jsx(wt,{}),i==="quicksetup"&&w&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 border-b border-white/10 pb-2",children:[e.jsx("button",{onClick:()=>p("setup"),className:`px-4 py-2 font-semibold text-sm transition-all duration-200 border-b-2 ${y==="setup"?"text-emerald-400 border-emerald-400":"text-gray-400 border-transparent hover:text-white"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"ðŸš€"}),e.jsx("span",{children:"Quick Setup"})]})}),e.jsx("button",{onClick:()=>p("orderbot"),className:`px-4 py-2 font-semibold text-sm transition-all duration-200 border-b-2 ${y==="orderbot"?"text-emerald-400 border-emerald-400":"text-gray-400 border-transparent hover:text-white"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ›’"}),e.jsx("span",{children:"Order Bot"})]})})]}),e.jsx(ve,{mode:"wait",children:e.jsxs(ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:[y==="setup"&&e.jsx(At,{}),y==="orderbot"&&e.jsx(vt,{})]},y)})]}),i==="flowbuilder"&&w&&e.jsx(Nt,{}),i==="orders"&&w&&e.jsx(Tt,{}),i==="stock"&&w&&e.jsx(ct,{}),i==="templates"&&w&&e.jsx(ot,{}),i==="campaigns"&&w&&e.jsx(mt,{}),i==="schedule"&&w&&e.jsx(ut,{}),i==="history"&&e.jsxs("div",{className:"space-y-4",children:[z&&e.jsx("div",{className:"bg-blue-900/30 border border-blue-500/50 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-2xl",children:"â„¹ï¸"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-blue-300 mb-2",children:"How Tech Provider Mode Works"}),e.jsxs("p",{className:"text-sm text-blue-200/80 mb-2",children:["Messages are sent from ",e.jsx("strong",{children:"your WhatsApp Business Account"}),", not your personal WhatsApp. You won't see these messages in your personal WhatsApp app."]}),e.jsxs("p",{className:"text-sm text-blue-200/80",children:[e.jsx("strong",{children:"To verify delivery:"})," Check status below (sent â†’ delivered â†’ read) or ask the recipient. They'll receive messages from your business phone number."]})]})]})}),N.length===0?e.jsxs("div",{className:"bg-slate-900/80 border border-white/10 rounded-xl p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸ“­"}),e.jsx("p",{className:"text-gray-400",children:"No messages sent yet"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:N.slice(0,20).map(t=>{({sent:"text-yellow-400",delivered:"text-blue-400",read:"text-green-400",failed:"text-red-400"})[t.status];const x={sent:"âœ“",delivered:"âœ“âœ“",read:"âœ“âœ“ (read)",failed:"âœ—"}[t.status]||"?";return e.jsx("div",{className:"bg-slate-900/80 border border-white/10 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm text-gray-300 mb-1",children:[t.message?.substring(0,100),"..."]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-400",children:[e.jsxs("span",{children:["To: ",t.to]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:t.createdAt?.toDate?.()?.toLocaleString()||new Date(t.createdAt||0).toLocaleString()}),t.statusUpdatedAt&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{className:"text-gray-500",children:["Updated: ",t.statusUpdatedAt?.toDate?.()?.toLocaleString()||new Date(t.statusUpdatedAt||0).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${t.status==="sent"?"bg-yellow-500/20 text-yellow-300":t.status==="delivered"?"bg-blue-500/20 text-blue-300":t.status==="read"?"bg-green-500/20 text-green-300":t.status==="failed"?"bg-red-500/20 text-red-300":"bg-gray-500/20 text-gray-300"}`,children:[x," ",t.status?.toUpperCase()||"UNKNOWN"]}),t.statusDetails?.error&&e.jsx("span",{className:"text-xs text-red-400 max-w-xs text-right",children:t.statusDetails.error.message||"Error"})]})]})},t.id)})})]}),i==="review"&&e.jsx(gt,{embedded:!0,onSetupComplete:async()=>{const t=await Te(o);b(t),f.success("WhatsApp setup complete! Refreshing...")}}),i==="features"&&e.jsx(pt,{})]},i)})]})})]})};export{$t as default};
