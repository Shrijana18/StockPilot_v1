import{j as e}from"./index-DRC3F7i0.js";import{r as o}from"./router-BPBaD_i0.js";import{i as y,c as I,n as D,g as S}from"./firebase-DWi1MSv1.js";import"./vendor-Ckhrjn13.js";import"./index.esm-Bux_mLJ0.js";const C=({invoice:n})=>{const{customerInfo:r,items:a,total:d,subtotal:i,gst:m,createdAt:c,settings:u}=n;return e.jsx("div",{className:"w-full max-w-md mx-auto mb-4",children:e.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 shadow-md bg-white hover:shadow-lg transition-all overflow-hidden",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between items-center mb-2",children:[e.jsxs("h3",{className:"font-semibold text-base md:text-lg",children:["ðŸ§¾ ",u?.invoiceType||"Invoice"]}),e.jsx("span",{className:"text-xs md:text-sm text-gray-500",children:new Date(c).toLocaleDateString()})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"font-medium text-base md:text-sm",children:r?.name}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:r?.email}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:r?.phone})]}),e.jsxs("div",{className:"border-t pt-2 text-xs md:text-sm",children:[a?.slice(0,3).map((s,x)=>e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between",children:[e.jsxs("span",{children:[s.name," Ã— ",s.quantity]}),e.jsxs("span",{children:["â‚¹",s.subtotal]})]},x)),a?.length>3&&e.jsxs("p",{className:"text-xs text-blue-500 mt-1",children:["+ ",a.length-3," more items"]})]}),e.jsxs("div",{className:"border-t pt-2 mt-2 text-xs md:text-sm",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["â‚¹",i]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between",children:[e.jsx("span",{children:"GST"}),e.jsxs("span",{children:["â‚¹",m]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["â‚¹",d]})]})]}),e.jsx("div",{className:"mt-3 text-right",children:e.jsx("button",{className:"text-blue-600 hover:underline text-xs md:text-sm",children:"View / Download"})})]})})},A=({invoice:n,onClose:r})=>{if(!n)return null;const{customer:a,cartItems:d,totalAmount:i,issuedAt:m,settings:c,paymentMode:u}=n;return e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex justify-end",children:e.jsxs("div",{className:"w-full sm:max-w-xl bg-white shadow-xl p-4 md:p-6 rounded-xl overflow-y-auto max-h-[90vh] space-y-4 pt-[env(safe-area-inset-top)] pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold",children:"Invoice Preview"}),e.jsx("button",{onClick:r,className:"text-red-500 font-bold text-lg",children:"âœ•"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mb-2",children:["Date: ",new Date(m).toLocaleString()]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Customer Info"}),e.jsxs("p",{children:["Name: ",a?.name]}),e.jsxs("p",{children:["Email: ",a?.email]}),e.jsxs("p",{children:["Phone: ",a?.phone]}),e.jsxs("p",{children:["Address: ",a?.address]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Items"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"text-left p-2 border",children:"Product"}),e.jsx("th",{className:"text-left p-2 border",children:"Qty"}),e.jsx("th",{className:"text-left p-2 border",children:"Price"}),e.jsx("th",{className:"text-left p-2 border",children:"Total"})]})}),e.jsx("tbody",{children:d?.map((s,x)=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 border",children:s.name}),e.jsx("td",{className:"p-2 border",children:s.quantity}),e.jsxs("td",{className:"p-2 border",children:["â‚¹",s.price]}),e.jsxs("td",{className:"p-2 border",children:["â‚¹",(s.quantity*s.price*(1-(s.discount||0)/100)).toFixed(2)]})]},x))})]})})]}),e.jsxs("div",{className:"text-sm border-t pt-4",children:[e.jsxs("p",{className:"font-bold",children:["Total: â‚¹",i]}),e.jsxs("p",{children:["Payment Mode: ",c?.paymentMode]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Download PDF"})})]})})},R=()=>{const[n,r]=o.useState([]),[a,d]=o.useState([]),[i,m]=o.useState(null),[c,u]=o.useState(""),[s,x]=o.useState({from:"",to:""});o.useEffect(()=>{(async()=>{const l=y().currentUser;if(!l)return;const h=I(D(),`businesses/${l.uid}/finalizedInvoices`),j=(await S(h)).docs.map(p=>({id:p.id,...p.data()}));r(j),d(j)})()},[]),o.useEffect(()=>{const t=c.toLowerCase(),l=n.filter(h=>{const f=h.customerInfo?.name?.toLowerCase().includes(t),j=h.customerInfo?.email?.toLowerCase().includes(t),p=new Date(h.createdAt),b=s.from?new Date(s.from):null,v=s.to?new Date(s.to):null,w=(!b||p>=b)&&(!v||p<=v);return(f||j)&&w});d(l)},[c,s,n]);const g=t=>m(t),N=()=>m(null);return e.jsxs("div",{className:"px-4 py-6 md:px-6 pt-[env(safe-area-inset-top)] pb-[env(safe-area-inset-bottom)] space-y-6",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold mb-4",children:"All Invoices"}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search by customer name/email",value:c,onChange:t=>u(t.target.value),className:"border border-gray-300 p-2 rounded w-full sm:max-w-xs text-sm"}),e.jsx("input",{type:"date",value:s.from,onChange:t=>x(l=>({...l,from:t.target.value})),className:"border border-gray-300 p-2 rounded w-full sm:max-w-xs text-sm"}),e.jsx("input",{type:"date",value:s.to,onChange:t=>x(l=>({...l,to:t.target.value})),className:"border border-gray-300 p-2 rounded w-full sm:max-w-xs text-sm"})]}),a.length===0?e.jsx("p",{children:"No invoices found."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(t=>e.jsx(C,{invoice:t,onView:()=>g(t)},t.id))}),i&&e.jsx(A,{invoice:i,onClose:N})]})};export{R as default};
