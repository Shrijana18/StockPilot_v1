const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CjDO0J1E.js","assets/index-DRC3F7i0.js","assets/vendor-Ckhrjn13.js","assets/router-BPBaD_i0.js","assets/firebase-DWi1MSv1.js","assets/index.esm-Bux_mLJ0.js","assets/index-BwRLlX-x.css"])))=>i.map(i=>d[i]);
import{j as e,d as Q,M as os,o as cs,_ as ds}from"./index-DRC3F7i0.js";import{r,R as Yt,c as xs}from"./router-BPBaD_i0.js";import{e as Ie,d as xe,a as ms,u as He,s as le,l as bt,c as be,g as We,q as Nt,w as Gt,v as Vt,p as Wt,b as ct,W as hs,o as us}from"./firebase-DWi1MSv1.js";import{b as ps,c as fs,d as bs,e as gs,f as js,a as gt,g as jt,h as ws}from"./index-CNZ3HuWf.js";import{ae as ys,am as Xe,M as qe,m as ze,aI as ge,F as vt,s as ee,ah as wt,X as ke,g as Qt,r as te,aN as re,bd as yt,be as Ce,K as ie,aM as Ye,C as De,ar as Ee,o as Le,bf as Ns,P as dt,Q as ot,bg as xt,R as Me,I as Fe,A as Ge,N as vs,p as Te,ac as Ss,aW as Ft,S as St,J as ks,bh as Cs,Z as je,O as Rt,d as fe,aE as Ot,as as Ds,at as Ps,bi as $e,bj as kt,T as Ve,au as As,a3 as et,bk as Es,D as Fs,_ as Kt,l as Rs,i as Lt,bl as Os,bm as Ls,E as Tt,a5 as It,ai as Ts,bn as Is,bo as Ms}from"./index-CprmGC-M.js";import{m as E}from"./proxy-BgUy8BPw.js";import{A as me}from"./index-DSciU07p.js";import{a as Jt,g as Zt,c as $s}from"./marketplaceOffers-DYmwRj2h.js";import{Haptics as _s,ImpactStyle as Us}from"./index-CjDO0J1E.js";import{u as Bs,A as Hs,G as qs,M as zs}from"./esm-LCaBFwtY.js";import"./vendor-Ckhrjn13.js";import"./index.esm-Bux_mLJ0.js";const Ys=(t,l="tiered")=>{if(!t||t<=0)return 0;switch(l){case"fixed":return 10;case"tiered":return t<200?5:t<500?10:t<1e3?15:t<2e3?20:25;case"percentage":const s=t*.01;return Math.max(5,Math.min(50,Math.round(s)));case"hybrid":const a=5,n=t*.005;return Math.round(a+n);default:return 10}},Xt=r.createContext(),st=()=>{const t=r.useContext(Xt);if(!t)throw new Error("useCart must be used within CartProvider");return t},Gs=({children:t})=>{const[l,s]=r.useState([]),[a,n]=r.useState(null);r.useEffect(()=>{const f=localStorage.getItem("flyp_customer_cart"),b=localStorage.getItem("flyp_customer_cart_store");if(f)try{s(JSON.parse(f))}catch(N){console.error("Failed to load cart:",N)}if(b)try{n(JSON.parse(b))}catch(N){console.error("Failed to load cart store:",N)}},[]),r.useEffect(()=>{localStorage.setItem("flyp_customer_cart",JSON.stringify(l)),a&&localStorage.setItem("flyp_customer_cart_store",JSON.stringify(a))},[l,a]);const o=(f,b,N=1)=>{if(a&&a.id!==b.id&&l.length>0)return{success:!1,error:"DIFFERENT_STORE",message:`Your cart has items from ${a.name}. Clear cart to add from ${b.name}?`};(!a||a.id===b.id)&&n({id:b.id,name:b.businessName||b.name,deliveryFee:b.deliveryFee||0,minOrder:parseFloat(b.minOrderValue)||0,freeDeliveryAbove:parseFloat(b.freeDeliveryAbove)||0,deliveryRadius:b.deliveryRadius||10,pickupEnabled:b.pickupEnabled||!1});const g=f.sellingPrice||f.price||0,w=f.mrp||g,v=f.imageUrl||f.image||"",u=f.unit||f.packSize||"",m=f.offerLabel||null,S=f.returnPolicy||"inherit";return s(k=>{const A=k.findIndex(C=>C.productId===f.id);if(A>=0){const C=[...k];return C[A].quantity+=N,C}else return[...k,{productId:f.id,name:f.name,price:g,mrp:w,image:v,unit:u,quantity:N,offerLabel:m,returnPolicy:S}]}),{success:!0}},i=(f,b)=>{if(b<=0){c(f);return}s(N=>N.map(g=>g.productId===f?{...g,quantity:b}:g))},c=f=>{s(b=>{const N=b.filter(g=>g.productId!==f);return N.length===0&&(n(null),localStorage.removeItem("flyp_customer_cart_store")),N})},h=()=>{s([]),n(null),localStorage.removeItem("flyp_customer_cart"),localStorage.removeItem("flyp_customer_cart_store")},x=()=>{const f=l.reduce((A,C)=>A+C.price*C.quantity,0),b=parseFloat(a?.deliveryFee)||0,N=parseFloat(a?.freeDeliveryAbove)||0,g=N>0&&f>=N,w=g?0:b,v=N>0?Math.max(0,N-f):0,u=Ys(f+w,"tiered"),m=f+w+u,S=l.reduce((A,C)=>A+C.quantity,0),k=l.reduce((A,C)=>{const R=(C.mrp||C.price)*C.quantity,y=C.price*C.quantity;return A+(R-y)},0);return{subtotal:f,deliveryFee:w,baseDeliveryFee:b,platformFee:u,total:m,itemCount:S,savings:k,meetsMinOrder:f>=(a?.minOrder||0),freeDeliveryAbove:N,qualifiesForFreeDelivery:g,amountForFreeDelivery:v}},d=f=>l.find(N=>N.productId===f)?.quantity||0;return e.jsx(Xt.Provider,{value:{cartItems:l,cartStore:a,addToCart:o,updateQuantity:i,removeFromCart:c,clearCart:h,getCartTotals:x,getItemQuantity:d},children:t})},Mt=os?.isNativePlatform?.()===!0,es=r.createContext(),_e=()=>{const t=r.useContext(es);if(!t)throw new Error("useCustomerAuth must be used within CustomerAuthProvider");return t},Vs=({children:t})=>{const[l,s]=r.useState(null),[a,n]=r.useState(null),[o,i]=r.useState(!0),[c,h]=r.useState(!1),[x,d]=r.useState(null);r.useEffect(()=>{(async()=>{try{const m=localStorage.getItem("flyp_customer_id");if(m){const S=await Ie(xe(Q,"customers",m));if(S.exists()){const k=S.data();s({uid:m,phoneNumber:k.phone||""}),n(k)}else localStorage.removeItem("flyp_customer_id")}}catch(m){console.error("Error checking session:",m),localStorage.removeItem("flyp_customer_id")}finally{i(!1)}})()},[]);const f=async(u,m)=>{h(!0),d(null);const S=u.replace(/\D/g,""),k=`customer_${S}`;console.log("[CustomerAuth] Starting login:",{customerId:k,isNative:Mt});const A=async()=>{try{console.log("[CustomerAuth] Fetching customer document...");const y=xe(Q,"customers",k),F=await Ie(y);let L;return F.exists()?(console.log("[CustomerAuth] Existing customer found"),L=F.data(),m&&m!==L.name&&(console.log("[CustomerAuth] Updating customer name..."),await He(y,{name:m,updatedAt:le()}),L.name=m)):(console.log("[CustomerAuth] Creating new customer..."),L={name:m||"Customer",phone:`+91${S}`,email:"",addresses:[],paymentMethods:[],settings:{pushNotifications:!0,emailNotifications:!1,smsNotifications:!1,orderUpdates:!0,offers:!0},totalOrders:0,totalSavings:0,loyaltyPoints:0,referralCode:`FLYP${k.slice(-6).toUpperCase()}`,createdAt:le(),isActive:!0},await bt(y,L),console.log("[CustomerAuth] New customer created successfully")),{data:L,isNewUser:!F.exists()}}catch(y){throw console.error("[CustomerAuth] Firestore operation failed:",y),y}},C=Mt?2e4:3e4,R=new Promise((y,F)=>{setTimeout(()=>{console.error("[CustomerAuth] Login timeout after",C,"ms"),F(new Error("Connection timed out. Please check your network and try again."))},C)});try{const y=await Promise.race([A(),R]);return console.log("[CustomerAuth] Login successful, saving to localStorage"),localStorage.setItem("flyp_customer_id",k),s({uid:k,phoneNumber:`+91${S}`}),n(y.data),{success:!0,isNewUser:y.isNewUser}}catch(y){console.error("[CustomerAuth] Login error:",y);const F=y?.message||"Login failed. Please try again.";return d(F),{success:!1,error:F}}finally{h(!1)}},b=async u=>{try{if(!l)throw new Error("Not logged in");const m=xe(Q,"customers",l.uid);return await He(m,{...u,updatedAt:le()}),n(S=>({...S,...u})),{success:!0}}catch(m){return console.error("Error updating profile:",m),{success:!1,error:m.message}}},N=async u=>{try{if(!l)throw new Error("Not logged in");const m={id:Date.now().toString(),...u,createdAt:new Date().toISOString()},S=[...a?.addresses||[]];return(S.length===0||u.isDefault)&&(S.forEach(k=>k.isDefault=!1),m.isDefault=!0),S.push(m),await b({addresses:S}),{success:!0,address:m}}catch(m){return console.error("Error adding address:",m),{success:!1,error:m.message}}},g=async u=>{try{const m=(a?.addresses||[]).map(S=>({...S,isDefault:S.id===u}));return await b({addresses:m}),{success:!0}}catch(m){return{success:!1,error:m.message}}},w=async()=>{try{return localStorage.removeItem("flyp_customer_id"),s(null),n(null),{success:!0}}catch(u){return{success:!1,error:u.message}}},v=async()=>{try{if(!l?.uid)return{success:!1,error:"Not logged in"};const u=xe(Q,"customers",l.uid);return await ms(u),localStorage.removeItem("flyp_customer_id"),s(null),n(null),{success:!0}}catch(u){return console.error("Error deleting account:",u),{success:!1,error:u.message}}};return e.jsx(es.Provider,{value:{customer:l,customerData:a,loading:o,loginLoading:c,error:x,setError:d,simpleLogin:f,updateProfile:b,addAddress:N,setDefaultAddress:g,logout:w,deleteAccount:v,isLoggedIn:!!l},children:t})},Ws=({activeTab:t,onTabChange:l})=>{const{cartItems:s}=st(),a=s?.reduce((o,i)=>o+i.quantity,0)||0,n=[{id:"home",icon:ps,label:"Home"},{id:"search",icon:fs,label:"Search"},{id:"cart",icon:bs,label:"Cart"},{id:"orders",icon:gs,label:"Orders"},{id:"profile",icon:js,label:"Profile"}];return e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50",style:{paddingBottom:"max(env(safe-area-inset-bottom), 8px)",paddingLeft:"max(env(safe-area-inset-left), 16px)",paddingRight:"max(env(safe-area-inset-right), 16px)",paddingTop:8,background:"rgba(11, 15, 20, 0.94)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderTop:"1px solid rgba(255,255,255,0.06)"},children:e.jsx("div",{className:"flex items-center justify-around",children:n.map(o=>{const i=o.icon,c=t===o.id,h=o.id==="cart";return e.jsxs("button",{onClick:()=>l(o.id),className:`relative flex flex-col items-center justify-center py-2 px-4 rounded-xl transition-all duration-200 min-w-[56px] ${c?"text-emerald-400":"text-white/45 hover:text-white/70 active:scale-95"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(i,{className:`text-[22px] ${c?"opacity-100":"opacity-80"}`}),h&&a>0&&e.jsx("span",{className:"absolute -top-1 -right-2 min-w-[18px] h-[18px] px-1 bg-emerald-500 text-white rounded-full flex items-center justify-center text-[10px] font-semibold",children:a>99?"99+":a})]}),e.jsx("span",{className:`text-[11px] font-medium mt-1.5 ${c?"text-emerald-400":"text-white/50"}`,children:o.label})]},o.id)})})})};class Qs extends Yt.Component{constructor(l){super(l),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(l){return{hasError:!0,error:l}}componentDidCatch(l,s){console.error("ErrorBoundary caught an error:",l,s),this.setState({errorInfo:s}),console.error("[Production Error]",{message:l.message,stack:l.stack,componentStack:s.componentStack})}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0B0F14] via-[#0D1117] to-[#0B0F14] flex items-center justify-center px-6",children:e.jsxs("div",{className:"text-center max-w-md w-full",children:[e.jsx("div",{className:"w-20 h-20 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("span",{className:"text-4xl",children:"âš ï¸"})}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-white/60 mb-6",children:this.state.error?.message||"An unexpected error occurred. Please try again."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()},className:"w-full px-6 py-3 bg-emerald-500 hover:bg-emerald-600 text-slate-900 font-semibold rounded-xl transition-colors",children:"Reload App"}),e.jsx("button",{onClick:()=>{this.setState({hasError:!1,error:null,errorInfo:null})},className:"w-full px-6 py-3 bg-white/10 hover:bg-white/15 text-white font-semibold rounded-xl border border-white/10 transition-colors",children:"Try Again"})]}),!1]})}):this.props.children}}const Ks=()=>e.jsx(E.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:200,damping:15},className:"flex flex-col items-center",children:e.jsx("img",{src:"/assets/flyp_logo.png",alt:"FLYP",className:"w-24 h-24 object-contain"})}),Js=({onLoginSuccess:t,onContinueAsGuest:l,isCheckoutFlow:s})=>{const{simpleLogin:a,loginLoading:n,error:o,setError:i}=_e(),[c,h]=r.useState(""),[x,d]=r.useState(""),[f,b]=r.useState(1),N=w=>{w.preventDefault(),c.length>=10&&(i?.(null),b(2))},g=async w=>{if(w.preventDefault(),!x.trim()||c.length<10)return;(await a(c,x.trim()))?.success&&typeof t=="function"&&requestAnimationFrame(()=>{t()})};return e.jsxs("div",{className:"h-full w-full flex flex-col bg-gradient-to-br from-[#0B0F14] via-[#0D1117] to-[#0B0F14] relative overflow-hidden",style:{minHeight:"100%",overflow:"hidden",overscrollBehavior:"none",touchAction:"pan-y"},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 rounded-full bg-emerald-500/10 blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 rounded-full bg-teal-500/10 blur-3xl"}),e.jsx("div",{className:"absolute top-1/3 left-1/2 -translate-x-1/2 w-64 h-64 rounded-full bg-emerald-500/5 blur-3xl"}),e.jsx("div",{className:"absolute inset-0 opacity-30",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='40' height='40' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='grid' width='40' height='40' patternUnits='userSpaceOnUse'%3E%3Cpath d='M 0 10 L 40 10 M 10 0 L 10 40 M 0 20 L 40 20 M 20 0 L 20 40 M 0 30 L 40 30 M 30 0 L 30 40' fill='none' stroke='%231f2937' stroke-width='1'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23grid)'/%3E%3C/svg%3E")`}})]}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center px-6 relative z-10 min-h-0 overflow-y-auto",style:{paddingTop:"max(env(safe-area-inset-top), 24px)",paddingBottom:"max(env(safe-area-inset-bottom), 16px)",overscrollBehavior:"contain",WebkitOverflowScrolling:"touch"},children:[e.jsxs(E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[e.jsx("div",{className:"flex justify-center mb-5",children:e.jsx(Ks,{})}),e.jsxs(E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:[e.jsx("h1",{className:"text-3xl font-black text-white mb-2 tracking-tight",children:"FLYP Shop"}),e.jsx("p",{className:"text-white/60 text-lg",children:"Groceries in minutes"}),e.jsx("p",{className:"text-white/40 text-sm mt-2 max-w-xs mx-auto",children:"Browse stores and add to cart without an account. Sign in when youâ€™re ready to checkout."})]})]}),e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsx(me,{mode:"wait",children:f===1?e.jsxs(E.form,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-white/70 mb-3",children:"Enter your phone number"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"absolute left-5 top-1/2 -translate-y-1/2 flex items-center gap-3 border-r border-white/10 pr-3",children:[e.jsx("span",{className:"text-xl",children:"ðŸ‡®ðŸ‡³"}),e.jsx("span",{className:"text-white font-semibold",children:"+91"})]}),e.jsx("input",{type:"tel",value:c,onChange:w=>h(w.target.value.replace(/\D/g,"").slice(0,10)),placeholder:"Enter 10 digit number",className:"w-full pl-28 pr-5 py-5 bg-white rounded-2xl text-slate-900 font-semibold text-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all border border-emerald-500/30 placeholder-slate-500",autoFocus:!0})]})]}),e.jsxs(E.button,{whileTap:{scale:.98},type:"submit",disabled:c.length<10,className:`w-full py-5 rounded-2xl font-bold text-lg flex items-center justify-center gap-3 transition-all duration-300 ${c.length>=10?"bg-emerald-500 text-slate-900 hover:bg-emerald-400 transition":"bg-white/5 text-white/40 border border-white/10"}`,children:["Continue",e.jsx(ys,{className:c.length>=10?"":"opacity-50"})]}),typeof l=="function"&&e.jsx("button",{type:"button",onClick:l,className:"w-full py-4 mt-2 rounded-2xl font-semibold text-base text-white/70 hover:text-white hover:bg-white/10 border border-white/20 transition-all flex items-center justify-center gap-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"text-lg"}),"Back to cart"]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"text-lg"}),"Continue as guest"]})})]},"phone"):e.jsxs(E.form,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between bg-white/5 backdrop-blur-xl rounded-2xl px-5 py-4 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-emerald-500/10 border border-emerald-500/20 flex items-center justify-center",children:e.jsx(ze,{className:"text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/40 font-medium",children:"Phone Number"}),e.jsxs("p",{className:"font-bold text-white",children:["+91 ",c]})]})]}),e.jsx("button",{type:"button",onClick:()=>{i?.(null),b(1)},className:"w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center border border-white/10 hover:bg-white/10 transition-colors",children:e.jsx(ge,{className:"text-white/60 text-sm"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-white/70 mb-3",children:"What should we call you?"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-5 top-1/2 -translate-y-1/2",children:e.jsx(vt,{className:"text-white/40"})}),e.jsx("input",{type:"text",value:x,onChange:w=>d(w.target.value),placeholder:"Enter your name",className:"w-full pl-14 pr-5 py-5 bg-white rounded-2xl text-slate-900 font-semibold text-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all border border-emerald-500/30 placeholder-slate-500",autoFocus:!0})]})]}),o&&e.jsx(E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-4 bg-red-500/10 border border-red-500/20 rounded-2xl",children:e.jsx("p",{className:"text-red-400 text-sm font-medium",children:o})}),e.jsx(E.button,{whileTap:{scale:.98},type:"submit",disabled:!x.trim()||n,className:`w-full py-5 rounded-2xl font-bold text-lg flex items-center justify-center gap-3 transition-all duration-300 ${x.trim()&&!n?"bg-emerald-500 text-white hover:bg-emerald-400 transition":"bg-white/5 text-white/40 border border-white/10"}`,children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Getting started..."})]}):e.jsxs(e.Fragment,{children:["Get Started",e.jsx(gt,{className:"text-xl"})]})}),typeof l=="function"&&e.jsx("button",{type:"button",onClick:l,className:"w-full py-4 mt-2 rounded-2xl font-semibold text-base text-white/70 hover:text-white hover:bg-white/10 border border-white/20 transition-all flex items-center justify-center gap-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"text-lg"}),"Back to cart"]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"text-lg"}),"Continue as guest"]})})]},"name")})}),e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},className:"mt-6 grid grid-cols-3 gap-4",children:[{icon:"âš¡",label:"Express Delivery"},{icon:"ðŸª",label:"Local Stores"},{icon:"ðŸ’°",label:"Best Prices"}].map((w,v)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center mx-auto mb-2 text-2xl",children:w.icon}),e.jsx("p",{className:"text-xs font-medium text-white/40",children:w.label})]},v))}),e.jsxs(E.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},className:"text-xs text-white/40 text-center mt-6 px-4",children:["By continuing, you agree to our"," ",e.jsx("a",{href:"/terms",className:"text-emerald-400 font-medium hover:underline",children:"Terms of Service"})," ","and"," ",e.jsx("a",{href:"/privacy",className:"text-emerald-400 font-medium hover:underline",children:"Privacy Policy"})]})]})]})},Zs=(t,l,s,a)=>{const o=(s-t)*Math.PI/180,i=(a-l)*Math.PI/180,c=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))},tt=async(t,l,s=50,a=20)=>{try{if(console.log("[StoreService] Fetching nearby stores...",{userLat:t,userLng:l,radiusKm:s}),!Q)throw console.error("[StoreService] Database not initialized!"),new Error("Database not initialized. Please check your connection.");console.log("[StoreService] Database initialized, querying stores collection...");const n=be(Q,"stores"),o=await We(n);console.log("[StoreService] Fetched stores:",o.size);const i=[];return o.docs.forEach(c=>{const h=c.data();if(h.isActive===!1)return;let x,d;h.location&&(x=h.location.latitude||h.location._lat,d=h.location.longitude||h.location._long);let f=null;x&&d&&t&&l&&(f=Zs(t,l,x,d));const b=h.deliveryRadius||10,N=f!==null?f<=b:!0;i.push({id:c.id,...h,distance:f!==null?Math.round(f*10)/10:null,deliveryRadius:b,isWithinDeliveryRange:N,deliveryAvailable:h.deliveryEnabled!==!1&&N})}),i.sort((c,h)=>c.distance===null?1:h.distance===null?-1:c.distance-h.distance),i.slice(0,a)}catch(n){if(console.error("Error fetching nearby stores:",n),n.code==="permission-denied"||n.code==="unavailable")return console.warn("Firebase permission or availability issue. Returning empty stores list."),[];throw n}},ts=async t=>{try{const l=await Ie(xe(Q,"stores",t));return l.exists()?{id:l.id,...l.data()}:null}catch(l){throw console.error("Error fetching store:",l),l}},Xs=async(t,l=null,s=100)=>{try{const a=be(Q,"stores",t,"products");let o=(await We(a)).docs.map(i=>({id:i.id,storeId:t,...i.data()}));return o=o.filter(i=>{const c=i.onMarketplace===!0||i.isAvailable===!0||i.syncedToMarketplace===!0||i.marketplaceEnabled===!0||i.onMarketplace===void 0&&i.isAvailable===void 0,h=!l||i.category===l;return c&&h}),o.sort((i,c)=>{const h=i.stock!==void 0&&i.stock<=0,x=c.stock!==void 0&&c.stock<=0;return h!==x?h?1:-1:i.category!==c.category?(i.category||"").localeCompare(c.category||""):(i.name||"").localeCompare(c.name||"")}),o.slice(0,s)}catch(a){throw console.error("Error fetching store products:",a),a}},ea=async t=>{try{const l=await Ie(xe(Q,"stores",t));if(l.exists()&&l.data().categories?.length>0)return l.data().categories;const s=be(Q,"stores",t,"products"),a=await We(s),n=new Set;return a.docs.forEach(i=>{const c=i.data();c.category&&n.add(c.category)}),Array.from(n).sort()}catch(l){throw console.error("Error fetching categories:",l),l}},ce=t=>(t||"").toLowerCase().trim(),ta=(t,l,s)=>{const a=ce(t.name),n=ce(t.brand),o=ce(t.category),i=ce(t.sku),c=ce(t.description),h=(t.searchKeywords||[]).map(b=>ce(b)),x=[a,n,o,i,c,...h].filter(Boolean),d=x.some(b=>b.includes(l)),f=s.length>0&&s.some(b=>x.some(N=>N.includes(b)));return d||f},sa=(t,l,s)=>{const a=ce(t.businessName||t.name),n=ce(t.category),o=ce(t.description),i=[a,n,o].filter(Boolean),c=i.some(x=>x.includes(l)),h=s.length>0&&s.some(x=>i.some(d=>d.includes(x)));return c||h},aa=async(t,l,s,a={})=>{const{radiusKm:n=50,maxStores:o=30,maxProductsPerStore:i=150,maxProducts:c=80,maxStoresInResult:h=15}=a;try{const x=await tt(l,s,n,o),d=t.toLowerCase().trim(),f=d.split(/\s+/).filter(Boolean),b=[],N=new Map;for(const w of x){const v=be(Q,"stores",w.id,"products"),u=await We(v),m=[];u.docs.forEach(A=>{const C=A.data();(C.onMarketplace===!0||C.isAvailable===!0||C.syncedToMarketplace===!0||C.marketplaceEnabled===!0||C.onMarketplace===void 0&&C.isAvailable===void 0)&&m.push({id:A.id,...C})});const S=m.filter(A=>ta(A,d,f)),k=sa(w,d,f);if(S.length>0||k){const A=S.slice(0,3).map(C=>({id:C.id,name:C.name,price:C.sellingPrice||C.price}));N.set(w.id,{...w,matchedProductCount:S.length,matchedByName:k,sampleProducts:A})}S.slice(0,i).forEach(A=>{b.push({id:A.id,storeId:w.id,storeName:w.businessName||w.name,storeDistance:w.distance,...A})})}const g=Array.from(N.values()).sort((w,v)=>w.matchedByName&&!v.matchedByName?-1:!w.matchedByName&&v.matchedByName?1:(v.matchedProductCount||0)-(w.matchedProductCount||0)).slice(0,h);return b.sort((w,v)=>{const u=ce(w.name),m=ce(v.name),S=ce(w.brand),k=ce(v.brand),A=u===d||S===d||u.startsWith(d)||S.startsWith(d),C=m===d||k===d||m.startsWith(d)||k.startsWith(d);if(A&&!C)return-1;if(!A&&C)return 1;const R=w.storeDistance??9999,y=v.storeDistance??9999;return R-y}),{products:b.slice(0,c),stores:g}}catch(x){throw console.error("Advanced search error:",x),x}},$t=async(t,l,s=3,a=20)=>{try{const n=await tt(t,l,s,10),o=[];for(const i of n.slice(0,5)){const c=be(Q,"stores",i.id,"products"),h=Nt(c,Gt("isAvailable","==",!0),Vt(10));(await We(h)).docs.forEach(d=>{o.push({id:d.id,storeId:i.id,storeName:i.businessName,storeDistance:i.distance,...d.data()})})}return o.sort(()=>Math.random()-.5).slice(0,a)}catch(n){if(console.error("Error fetching featured products:",n),n.code==="permission-denied"||n.code==="unavailable")return console.warn("Firebase permission or availability issue. Returning empty products list."),[];throw n}},la=async(t,l,s=5)=>{try{const a=await tt(t,l,s,20),n=new Set;a.forEach(c=>{(c.categories||[]).forEach(h=>n.add(h))});const o=Array.from(n),i={grocery:{icon:"ðŸ›’",color:"from-green-500 to-green-600"},dairy:{icon:"ðŸ¥›",color:"from-blue-400 to-blue-500"},fruits:{icon:"ðŸŽ",color:"from-red-400 to-red-500"},vegetables:{icon:"ðŸ¥¬",color:"from-green-400 to-green-500"},snacks:{icon:"ðŸ¿",color:"from-yellow-400 to-yellow-500"},beverages:{icon:"ðŸ¥¤",color:"from-purple-400 to-purple-500"},"personal care":{icon:"ðŸ§´",color:"from-pink-400 to-pink-500"},household:{icon:"ðŸ ",color:"from-indigo-400 to-indigo-500"},medicines:{icon:"ðŸ’Š",color:"from-teal-400 to-teal-500"},"baby care":{icon:"ðŸ‘¶",color:"from-rose-400 to-rose-500"},"pet supplies":{icon:"ðŸ•",color:"from-amber-400 to-amber-500"},stationery:{icon:"ðŸ“",color:"from-cyan-400 to-cyan-500"}};return o.map(c=>({name:c,...i[c.toLowerCase()]||{icon:"ðŸ“¦",color:"from-gray-400 to-gray-500"}}))}catch(a){throw console.error("Error fetching categories:",a),a}},ra=({store:t,onClick:l,isFavorite:s,onFavoriteToggle:a,index:n,isMobile:o=!1})=>{const i=t.businessName||t.name||"Store",[c,h]=r.useState(!1),x=t.isWithinDeliveryRange||t.pickupEnabled||t.distance===null,d=()=>{x&&l(t)},f=t.deliveryFee||0,b=t.freeDeliveryAbove||0,N=b>0;return e.jsxs(E.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.25,delay:n*.04},onTapStart:()=>x&&h(!0),onTap:()=>{h(!1),d()},onTapCancel:()=>h(!1),className:`rounded-2xl overflow-hidden border transition-all duration-200 relative ${x?c?"cursor-pointer border-emerald-500/50 bg-white/[0.04] scale-[0.99]":"cursor-pointer border-white/[0.06] bg-white/[0.02] hover:border-white/[0.12] hover:bg-white/[0.04] active:scale-[0.995]":"cursor-not-allowed opacity-60 border-white/[0.08] bg-white/[0.02]"}`,children:[e.jsxs("div",{className:"relative h-36 w-full overflow-hidden",children:[t.bannerUrl?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.bannerUrl,alt:`${i} banner`,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-slate-900/50"})]}):e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-emerald-500/20 via-blue-500/15 to-purple-500/20 relative",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.05) 10px, rgba(255,255,255,0.05) 20px)"}}),t.logoUrl&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("img",{src:t.logoUrl,alt:i,className:"w-20 h-20 rounded-xl object-cover border-2 border-white/20 shadow-lg"})})]}),e.jsxs("div",{className:"absolute top-3 left-3 right-3 flex items-start justify-between z-10",children:[e.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-[10px] font-semibold backdrop-blur-md flex items-center gap-1.5 ${t.isActive?"bg-emerald-500 text-slate-900 border border-emerald-400/50":"bg-black/60 text-white/70 border border-white/20"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${t.isActive?"bg-white animate-pulse":"bg-white/60"}`}),t.isActive?"Open Now":"Closed"]}),e.jsx(E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:g=>{g.stopPropagation(),a?.(t.id)},className:`w-8 h-8 rounded-lg backdrop-blur-md flex items-center justify-center border transition-all shadow-lg ${s?"bg-red-500/90 border-red-400/50":"bg-black/60 border-white/20 hover:border-white/40"}`,children:e.jsx(yt,{className:`text-xs ${s?"text-white":"text-white/70"}`})})]}),e.jsx("div",{className:"absolute bottom-3 left-3 right-3 z-10",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold text-white text-lg drop-shadow-lg",children:i}),t.isVerified&&e.jsx(jt,{className:"text-emerald-400 text-lg flex-shrink-0 drop-shadow-lg"})]})})]}),e.jsxs("div",{className:`relative z-10 ${t.bannerUrl,"p-4"}`,children:[!t.bannerUrl&&e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-emerald-500/20 to-emerald-600/10 border border-emerald-500/30 flex items-center justify-center flex-shrink-0 overflow-hidden",children:t.logoUrl?e.jsx("img",{src:t.logoUrl,alt:i,className:"w-full h-full object-cover"}):e.jsx(te,{className:"text-emerald-400 text-xl"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-white text-lg leading-tight truncate",children:i}),t.isVerified&&e.jsx(jt,{className:"text-emerald-400 text-lg flex-shrink-0"})]}),e.jsx("p",{className:"text-white/60 text-sm mb-2",children:t.category||"General Store"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-[10px] font-semibold flex items-center gap-1.5 ${t.isActive?"bg-emerald-500/20 text-emerald-400 border border-emerald-500/40":"bg-white/10 text-white/50 border border-white/10"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${t.isActive?"bg-emerald-400 animate-pulse":"bg-white/40"}`}),t.isActive?"Open Now":"Closed"]}),t.rating>0&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-amber-500/15 rounded-lg border border-amber-500/25",children:[e.jsx(Ce,{className:"text-amber-400 text-[10px]"}),e.jsx("span",{className:"text-xs font-semibold text-amber-400",children:t.rating?.toFixed(1)})]})]})]}),e.jsx(E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:g=>{g.stopPropagation(),a?.(t.id)},className:`w-9 h-9 rounded-lg flex items-center justify-center border transition-all flex-shrink-0 ${s?"bg-red-500/20 border-red-500/40":"bg-white/10 border-white/10 hover:border-white/30"}`,children:e.jsx(yt,{className:`text-sm ${s?"text-red-400":"text-white/40"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-3",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-white/60 text-sm",children:t.category||"General Store"})}),t.rating>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-amber-500/15 rounded-lg border border-amber-500/25",children:[e.jsx(Ce,{className:"text-amber-400 text-[10px]"}),e.jsx("span",{className:"text-xs font-semibold text-amber-400",children:t.rating?.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 pb-3 border-b border-white/20",children:[t.distance!==null&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ee,{className:"text-emerald-400 text-xs"}),e.jsxs("span",{className:"text-xs text-white/70 font-medium",children:[t.distance," km"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ie,{className:"text-blue-400 text-xs"}),e.jsxs("span",{className:"text-xs text-white/70 font-medium",children:[t.avgDeliveryTime||t.baseDeliveryTime||30," min"]})]}),t.deliveryEnabled!==!1&&!t.isWithinDeliveryRange&&t.distance!==null&&e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-medium ${t.pickupEnabled?"bg-amber-500/20 text-amber-400 border border-amber-500/30":"bg-red-500/20 text-red-400 border border-red-500/30"}`,children:t.pickupEnabled?"Pickup Only":"Out of Range"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[f>0?e.jsxs("span",{className:"text-xs text-white/60",children:["Delivery: â‚¹",f,N&&e.jsxs("span",{className:"text-emerald-400 ml-1",children:["â€¢ Free above â‚¹",b]})]}):e.jsxs("span",{className:"text-xs text-emerald-400 font-medium flex items-center gap-1",children:[e.jsx(Ye,{className:"text-[10px]"}),"Free Delivery"]}),t.minOrderValue>0&&e.jsxs("span",{className:"text-xs text-white/50",children:["Min: â‚¹",t.minOrderValue]})]}),x&&e.jsxs(E.div,{whileHover:{x:4,scale:1.05},className:"flex items-center gap-1.5 px-3 py-1.5 bg-emerald-500/20 border border-emerald-500/40 rounded-lg hover:bg-emerald-500/30 hover:border-emerald-500/60 transition-all",children:[e.jsx("span",{className:"text-xs font-semibold text-emerald-400",children:"View Store"}),e.jsx(re,{className:"text-[10px] text-emerald-400"})]})]}),!t.isWithinDeliveryRange&&!t.pickupEnabled&&t.distance!==null&&e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm rounded-2xl flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4",children:[e.jsx(ee,{className:"text-red-400 text-2xl mx-auto mb-2"}),e.jsx("p",{className:"text-white font-semibold text-sm",children:"Not Available"}),e.jsx("p",{className:"text-white/60 text-xs",children:"Outside delivery area"})]})})]})]})},ia=({product:t,onAdd:l,index:s})=>e.jsxs(E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:s*.03},className:"rounded-xl overflow-hidden w-40 flex-shrink-0 border border-white/[0.06] bg-white/[0.03] hover:border-white/[0.1] active:scale-[0.98] transition-all duration-200",children:[e.jsx("div",{className:"h-32 bg-gradient-to-br from-white/[0.04] to-transparent relative p-4",children:t.image||t.imageUrl?e.jsx("img",{src:t.image||t.imageUrl,alt:t.name,className:"w-full h-full object-contain"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-4xl",children:"ðŸ“¦"})}),e.jsxs("div",{className:"p-3.5",children:[e.jsx("p",{className:"text-[10px] text-emerald-400 font-medium truncate mb-0.5",children:t.storeName}),e.jsx("h4",{className:"text-sm font-medium text-white truncate",children:t.name}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("span",{className:"font-bold text-white text-lg",children:["â‚¹",t.sellingPrice||t.price]}),e.jsx(E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>l?.(t),className:"w-9 h-9 bg-emerald-500 rounded-xl flex items-center justify-center text-slate-900 text-lg font-bold hover:bg-emerald-400 transition-colors",children:"+"})]})]})]}),na=({name:t,emoji:l,isActive:s,onClick:a})=>e.jsxs("button",{onClick:a,className:`flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl whitespace-nowrap transition-all duration-200 flex-shrink-0 ${s?"bg-emerald-500 text-white font-semibold":"bg-white/[0.06] text-white/80 border border-white/[0.06] hover:bg-white/[0.08] active:scale-[0.98]"}`,children:[e.jsx("span",{className:"text-sm",children:l}),e.jsx("span",{className:"text-[13px] font-medium",children:t})]}),oa=({isOpen:t,onClose:l,location:s,onSelect:a})=>{const[n,o]=r.useState(!1),[i,c]=r.useState(""),h=()=>{o(!0),navigator.geolocation.getCurrentPosition(x=>{a({lat:x.coords.latitude,lng:x.coords.longitude,label:"Current Location"}),o(!1),l()},x=>{console.error("Location detection error:",x),o(!1),x.code===x.PERMISSION_DENIED?alert("Location permission denied. Please enable location access in Settings to use your current location."):x.code===x.POSITION_UNAVAILABLE?alert("Location unavailable. Please try again or select a location manually."):x.code===x.TIMEOUT?alert("Location request timed out. Please try again or select a location manually."):alert("Unable to detect location. Please select a location manually.")},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})};return e.jsx(me,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:l,className:"fixed inset-0 z-50 bg-black/70 backdrop-blur-sm"}),e.jsxs(E.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-[60] bg-gradient-to-r from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-xl rounded-t-[28px] border-t border-white/10 shadow-xl overflow-y-auto",style:{maxHeight:"calc(85vh - env(safe-area-inset-bottom))",paddingBottom:"calc(100px + env(safe-area-inset-bottom))"},children:[e.jsx("div",{className:"flex justify-center py-4 sticky top-0 bg-gradient-to-b from-slate-800 to-transparent z-10",children:e.jsx("div",{className:"w-12 h-1.5 bg-white/20 rounded-full"})}),e.jsxs("div",{className:"px-6 pb-[120px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Delivery Location"}),e.jsx("p",{className:"text-white/50 text-sm mt-1",children:"Choose where you want your order delivered"})]}),e.jsx(E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:l,className:"w-10 h-10 rounded-full bg-white/10 border border-white/10 flex items-center justify-center",children:e.jsx(De,{className:"text-white/60"})})]}),e.jsxs("div",{className:"relative mb-5",children:[e.jsx(ke,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/30"}),e.jsx("input",{type:"text",value:i,onChange:x=>c(x.target.value),placeholder:"Search for area, street name...",className:"w-full h-14 pl-12 pr-4 bg-white/10 rounded-2xl text-white placeholder-white/30 focus:outline-none focus:ring-2 focus:ring-emerald-500/40 border border-white/10 focus:border-emerald-500/40 transition-all text-sm"})]}),e.jsxs(E.button,{whileHover:{scale:1.01},whileTap:{scale:.99},onClick:h,disabled:n,className:"w-full flex items-center gap-4 p-4 bg-gradient-to-r from-emerald-500/20 to-emerald-600/10 border border-emerald-500/40 rounded-2xl mb-5 hover:from-emerald-500/30 hover:to-emerald-600/20 transition-all",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-xl flex items-center justify-center shadow-lg shadow-emerald-500/30",children:e.jsx(ws,{className:"text-white text-2xl"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"font-semibold text-white text-base",children:"Use Current Location"}),e.jsx("p",{className:"text-emerald-400 text-sm",children:n?"Detecting your location...":"GPS â€¢ Fast & Accurate"})]}),n?e.jsx("div",{className:"w-6 h-6 border-2 border-emerald-400 border-t-transparent rounded-full animate-spin"}):e.jsx(re,{className:"text-emerald-400"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-white/40 text-xs font-medium uppercase tracking-wider mb-3",children:"Recent Locations"}),s&&e.jsxs(E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex items-center gap-4 p-4 bg-white/5 rounded-2xl border border-white/10 hover:border-emerald-500/20 transition-all cursor-pointer",onClick:()=>{a(s),l()},children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center",children:e.jsx(ee,{className:"text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-medium",children:s.label||"Current Location"}),e.jsx("p",{className:"text-white/40 text-sm",children:"Currently selected"})]}),e.jsx("div",{className:"w-3 h-3 bg-emerald-500 rounded-full shadow-lg shadow-emerald-500/50"})]}),e.jsxs(E.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"w-full flex items-center gap-4 p-4 bg-white/5 rounded-2xl border border-dashed border-white/10 hover:border-emerald-500/30 transition-all",children:[e.jsx("div",{className:"w-12 h-12 bg-white/5 rounded-xl flex items-center justify-center",children:e.jsx(ee,{className:"text-white/30"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"text-white/50 font-medium",children:"Add New Address"}),e.jsx("p",{className:"text-white/30 text-sm",children:"Save for faster checkout"})]}),e.jsx(re,{className:"text-white/30"})]})]})]})]})]})})},ca=({location:t,onNavigate:l,onStoreSelect:s,onProductAdd:a})=>{const{isNativeApp:n,isMobileViewport:o}=cs(),i=n||o,[c,h]=r.useState(t||null),[x,d]=r.useState(!t),[f,b]=r.useState(!1),[N,g]=r.useState([]),[w,v]=r.useState([]),[u,m]=r.useState(!t),[S,k]=r.useState(null),[A,C]=r.useState([]),[R,y]=r.useState("All"),F=[{name:"All",emoji:"ðŸª"},{name:"Grocery",emoji:"ðŸ›’"},{name:"Fresh",emoji:"ðŸ¥¬"},{name:"Dairy",emoji:"ðŸ¥›"},{name:"Snacks",emoji:"ðŸ¿"},{name:"Drinks",emoji:"ðŸ¥¤"}],G=(()=>{const P=new Date().getHours();return P>=5&&P<12?{text:"Good Morning",emoji:"â˜€ï¸"}:P>=12&&P<17?{text:"Good Afternoon",emoji:"ðŸŒ¤ï¸"}:P>=17&&P<21?{text:"Good Evening",emoji:"ðŸŒ…"}:{text:"Good Night",emoji:"ðŸŒ™"}})(),B=P=>{C(I=>I.includes(P)?I.filter(z=>z!==P):[...I,P])};return r.useEffect(()=>{if(t){h(t),d(!1);return}if(d(!0),!navigator.geolocation){h({lat:19.076,lng:72.8777,label:"Select Location"}),d(!1);return}navigator.geolocation.getCurrentPosition(P=>{h({lat:P.coords.latitude,lng:P.coords.longitude,label:"Current Location"}),d(!1)},()=>{h({lat:19.076,lng:72.8777,label:"Select Location"}),d(!1)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:3e5})},[t]),r.useEffect(()=>{const P=c||t||{lat:19.076,lng:72.8777,label:"Mumbai"};if(!P||!P.lat||!P.lng){console.warn("Location not available, using default Mumbai location"),h({lat:19.076,lng:72.8777,label:"Mumbai"});return}(async()=>{m(!0),k(null);try{const[z,J]=await Promise.all([tt(P.lat,P.lng,50,10),$t(P.lat,P.lng,50,10)]);g(z||[]),v(J||[])}catch(z){console.error("Error fetching data:",z),k({message:z.message||"Failed to load stores. Please check your connection and try again.",type:"fetch_error"}),g([]),v([])}finally{m(!1)}})()},[c,t]),x?e.jsxs("div",{className:"bg-transparent flex flex-col items-center justify-center px-6 py-20",children:[e.jsx(E.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200},className:"w-20 h-20 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-3xl flex items-center justify-center mb-6 shadow-2xl shadow-emerald-500/30",children:e.jsx("span",{className:"text-white font-bold text-3xl",children:"F"})}),e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"w-10 h-10 border-2 border-emerald-400/30 border-t-emerald-400 rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-white/50",children:"Finding stores near you..."})]}):S&&!u?e.jsxs("div",{className:"bg-transparent w-full",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-gradient-to-r from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-xl border-b border-white/10",style:{paddingTop:"env(safe-area-inset-top)"},children:e.jsxs("div",{className:`px-5 ${i?"py-2.5":"py-4"} flex items-center ${i?"gap-2.5":"gap-4"}`,children:[e.jsx(E.div,{whileHover:{scale:1.05},whileTap:{scale:.95},className:`${i?"w-10 h-10":"w-12 h-12"} rounded-xl flex items-center justify-center overflow-hidden bg-white/10 border border-white/10 flex-shrink-0`,children:e.jsx("img",{src:"/assets/flyp_logo.png",alt:"FLYP",className:"w-full h-full object-contain p-1"})}),e.jsx("div",{className:"flex-1",children:e.jsx("h1",{className:`${i?"text-base":"text-lg"} font-bold text-white`,children:"FLYP"})})]})}),e.jsx("main",{className:"px-5 py-12",children:e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("span",{className:"text-4xl",children:"âš ï¸"})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Unable to Load Stores"}),e.jsx("p",{className:"text-white/60 mb-6 max-w-md mx-auto",children:S.message}),e.jsxs("div",{className:"space-y-3 max-w-sm mx-auto",children:[e.jsx(E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{k(null),m(!0),c&&(async()=>{try{const[I,z]=await Promise.all([tt(c.lat,c.lng,50,10),$t(c.lat,c.lng,50,10)]);g(I||[]),v(z||[]),k(null)}catch(I){k({message:I.message||"Failed to load stores. Please check your connection and try again.",type:"fetch_error"})}finally{m(!1)}})()},className:"w-full px-6 py-3 bg-emerald-500 hover:bg-emerald-600 text-slate-900 font-semibold rounded-xl transition-colors",children:"Try Again"}),e.jsx(E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>b(!0),className:"w-full px-6 py-3 bg-white/10 hover:bg-white/15 text-white font-semibold rounded-xl border border-white/10 transition-colors",children:"Change Location"})]})]})})]}):e.jsxs("div",{className:"bg-transparent w-full h-full flex flex-col min-h-0",children:[e.jsx("header",{className:"sticky top-0 z-40 flex-shrink-0 border-b border-white/[0.06]",style:{paddingTop:"max(env(safe-area-inset-top), 12px)",paddingBottom:12,paddingLeft:"max(env(safe-area-inset-left), 20px)",paddingRight:"max(env(safe-area-inset-right), 20px)",background:"rgba(11, 15, 20, 0.92)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center overflow-hidden bg-white/[0.06] flex-shrink-0",children:e.jsx("img",{src:"/assets/flyp_logo.png",alt:"FLYP",className:"w-full h-full object-contain p-1.5"})}),e.jsxs("button",{onClick:()=>b(!0),className:"flex-1 flex items-center gap-2.5 min-w-0 py-2 pl-3 pr-2.5 rounded-xl bg-white/[0.04] hover:bg-white/[0.08] active:scale-[0.99] transition-all duration-200",children:[e.jsx(ee,{className:"text-emerald-400 text-sm flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("p",{className:"text-[11px] text-white/40 font-medium uppercase tracking-widest",children:"Deliver to"}),e.jsx("p",{className:"text-sm font-semibold text-white truncate",children:c?.label||"Current Location"})]}),e.jsx(wt,{className:"text-white/30 text-[10px] flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>l("search"),className:"w-10 h-10 rounded-xl bg-white/[0.04] flex items-center justify-center hover:bg-white/[0.08] active:scale-95 transition-all duration-200",children:e.jsx(ke,{className:"text-white/50 text-sm"})}),e.jsxs("button",{className:"w-10 h-10 rounded-xl bg-white/[0.04] flex items-center justify-center relative hover:bg-white/[0.08] active:scale-95 transition-all duration-200",children:[e.jsx(Qt,{className:"text-white/50 text-sm"}),e.jsx("span",{className:"absolute top-2 right-2 w-1.5 h-1.5 bg-emerald-400 rounded-full"})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden overscroll-behavior-y-contain",children:e.jsxs("div",{className:"w-full",style:{paddingLeft:"max(env(safe-area-inset-left), 20px)",paddingRight:"max(env(safe-area-inset-right), 20px)",paddingTop:20,paddingBottom:24},children:[e.jsxs("div",{className:"mb-5",children:[e.jsxs("h1",{className:"text-xl font-semibold text-white tracking-tight flex items-center gap-2",children:[G.text,e.jsx("span",{className:"text-lg opacity-80",children:G.emoji})]}),e.jsx("p",{className:"text-white/45 text-sm mt-0.5",children:"What would you like to order today?"})]}),e.jsxs("button",{onClick:()=>l("search"),className:"w-full flex items-center gap-3 px-4 py-3.5 rounded-xl bg-white/[0.04] border border-white/[0.06] hover:border-white/[0.1] active:scale-[0.995] transition-all duration-200 mb-5",children:[e.jsx(ke,{className:"text-white/35 text-base flex-shrink-0"}),e.jsx("span",{className:"flex-1 text-left text-white/40 text-[15px]",children:"Search products, stores..."}),e.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-500 flex items-center justify-center flex-shrink-0",children:e.jsx(ke,{className:"text-white text-xs"})})]}),e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-hide pb-1 mb-6",style:{marginLeft:-20,marginRight:-20,paddingLeft:"max(env(safe-area-inset-left), 20px)",paddingRight:20,scrollBehavior:"smooth",WebkitOverflowScrolling:"touch",scrollbarWidth:"none",msOverflowStyle:"none"},children:F.map(P=>e.jsx(na,{name:P.name,emoji:P.emoji,isActive:R===P.name,onClick:()=>y(P.name)},P.name))}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-[17px] font-semibold text-white tracking-tight",children:"Stores Near You"}),e.jsx("p",{className:"text-xs text-white/40 mt-0.5",children:"Browse and order from nearby stores"})]}),e.jsx("span",{className:"text-xs font-medium px-2.5 py-1.5 rounded-lg bg-emerald-500/15 text-emerald-300 border border-emerald-500/25",children:N.length})]}),u?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(P=>e.jsxs("div",{className:"h-48 rounded-2xl overflow-hidden border border-white/[0.06] bg-white/[0.02]",children:[e.jsx("div",{className:"h-36 bg-white/[0.04] animate-pulse"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-4 bg-white/[0.06] rounded w-3/4 animate-pulse"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-3 bg-white/[0.04] rounded w-14 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/[0.04] rounded w-16 animate-pulse"})]})]})]},P))}):N.length>0?e.jsx("div",{className:"space-y-4",children:N.map((P,I)=>e.jsx(ra,{store:P,index:I,isMobile:i,onClick:()=>s?.(P),isFavorite:A.includes(P.id),onFavoriteToggle:B},P.id))}):e.jsx("div",{className:"py-14 px-6 rounded-2xl border border-white/[0.06] bg-white/[0.02]",children:e.jsxs("div",{className:"flex flex-col items-center text-center max-w-sm mx-auto",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-white/[0.06] flex items-center justify-center mx-auto mb-4",children:e.jsx(te,{className:"text-white/25 text-xl"})}),e.jsx("h3",{className:"font-semibold text-white text-base mb-1",children:"No stores nearby"}),e.jsx("p",{className:"text-white/45 text-sm mb-6 leading-relaxed",children:"Stores are being added in your area. Try a different location or explore products."}),e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center",children:[e.jsx("button",{onClick:()=>l?.("search"),className:"px-5 py-2.5 bg-emerald-500 text-white font-medium rounded-xl text-sm hover:bg-emerald-400 active:scale-[0.98] transition-all duration-200",children:"Explore Products"}),e.jsx("button",{onClick:()=>b(!0),className:"px-5 py-2.5 bg-white/[0.06] text-white font-medium rounded-xl text-sm border border-white/[0.08] hover:bg-white/[0.08] active:scale-[0.98] transition-all duration-200",children:"Change Location"})]})]})})]}),e.jsxs("section",{className:"mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-[17px] font-semibold text-white tracking-tight",children:"Trending Now"}),e.jsxs("button",{onClick:()=>l?.("search"),className:"text-sm text-emerald-400 font-medium flex items-center gap-1 hover:text-emerald-300 active:opacity-80 transition-opacity",children:["See all ",e.jsx(re,{className:"text-[10px]"})]})]}),w.length>0?e.jsx("div",{className:"flex gap-4 overflow-x-auto scrollbar-hide pb-2",style:{marginLeft:-20,marginRight:-20,paddingLeft:"max(env(safe-area-inset-left), 20px)",paddingRight:20,WebkitOverflowScrolling:"touch"},children:w.map((P,I)=>e.jsx(ia,{product:P,onAdd:a,index:I},I))}):e.jsxs("div",{className:"flex gap-4 overflow-x-auto scrollbar-hide pb-2",style:{marginLeft:-20,marginRight:-20,paddingLeft:"max(env(safe-area-inset-left), 20px)",paddingRight:20,WebkitOverflowScrolling:"touch"},children:[[1,2,3].map(P=>e.jsxs("div",{className:"flex-shrink-0 w-40 h-44 rounded-xl bg-white/[0.03] border border-white/[0.06] overflow-hidden",children:[e.jsx("div",{className:"h-28 bg-white/[0.04] animate-pulse"}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx("div",{className:"h-3 bg-white/[0.06] rounded w-2/3 animate-pulse"}),e.jsx("div",{className:"h-4 bg-white/[0.06] rounded w-1/2 animate-pulse"})]})]},P)),e.jsxs("button",{onClick:()=>l?.("search"),className:"flex-shrink-0 w-40 h-44 rounded-xl border border-dashed border-white/[0.12] flex flex-col items-center justify-center gap-2 hover:border-emerald-500/30 hover:bg-emerald-500/[0.03] active:scale-[0.98] transition-all duration-200",children:[e.jsx(ke,{className:"text-white/25 text-xl"}),e.jsx("span",{className:"text-white/40 text-sm font-medium",children:"Explore"})]})]})]})]})}),e.jsx(oa,{isOpen:f,onClose:()=>b(!1),location:c,onSelect:P=>{h(P),b(!1)}})]})},_t=t=>{const l={All:"ðŸª",Offers:"ðŸ·ï¸",Food:"ðŸ•",Grocery:"ðŸ›’",Vegetables:"ðŸ¥¬",Fruits:"ðŸŽ",Dairy:"ðŸ¥›",Beverages:"ðŸ¥¤",Beverage:"ðŸ¥¤",Drink:"ðŸ¹",Snacks:"ðŸ¿","Personal Care":"ðŸ§´","Hair Care":"ðŸ’‡",Health:"ðŸ’Š",Household:"ðŸ ",Electronics:"ðŸ“±",Clothing:"ðŸ‘•",Liquor:"ðŸº",General:"ðŸ“¦"};return l[t]||l[t?.split(" ")[0]]||"ðŸ“¦"},pt=t=>{const l=t.sellingPrice??t.price??0;return(t.mrp??l)>l||!!t.offerLabel},da=({product:t,cartQuantity:l,onAdd:s,onUpdate:a,onClick:n,storeReturnPolicy:o})=>{const i=t.sellingPrice||t.price||0,c=t.mrp||i,h=c>i,x=h?Math.round((1-i/c)*100):0,d=t.offerLabel||(x>0?`${x}% OFF`:null),f=t.stock!==void 0&&t.stock<=0||t.quantity!==void 0&&t.quantity<=0||!t.inStock,b=Jt(t,o),N=Zt(b);return e.jsxs("div",{onClick:()=>n&&n(t),className:`group bg-white/5 hover:bg-white/10 rounded-xl overflow-hidden border border-white/10 hover:border-emerald-500/30 transition-all duration-200 cursor-pointer ${f?"opacity-60":""}`,children:[e.jsxs("div",{className:"relative h-24 sm:h-28 bg-white rounded-t-xl overflow-hidden",children:[t.imageUrl||t.image?e.jsx("img",{src:t.imageUrl||t.image,alt:t.name,className:"w-full h-full object-contain p-2 group-hover:scale-105 transition-transform duration-300"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-50 text-2xl",children:"ðŸ“¦"}),d&&!f&&e.jsxs("span",{className:"absolute top-1 left-1 bg-gradient-to-r from-amber-500 to-amber-600 text-white text-[8px] font-bold px-1.5 py-0.5 rounded shadow-sm flex items-center gap-0.5",children:[e.jsx(dt,{className:"text-[7px]"}),d]}),b==="non_returnable"&&e.jsxs("span",{className:"absolute top-1 right-1 bg-red-500/80 text-white text-[8px] font-semibold px-1.5 py-0.5 rounded shadow-sm flex items-center gap-0.5",children:[e.jsx(ot,{className:"text-[7px]"}),"No Return"]}),f&&e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-[1px] flex items-center justify-center",children:e.jsx("span",{className:"text-white text-[9px] font-semibold bg-red-500/80 px-2 py-0.5 rounded",children:"Out of Stock"})})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("p",{className:"text-[10px] sm:text-[11px] text-white/90 font-medium line-clamp-2 leading-tight min-h-[28px]",children:t.name}),e.jsxs("div",{className:"flex items-center justify-between mt-0.5",children:[e.jsx("p",{className:"text-[9px] text-white/40 truncate",children:t.unit||"1 unit"}),b!=="non_returnable"&&b!=="replacement_available"&&e.jsxs("span",{className:"text-[8px] text-emerald-400/70 flex items-center gap-0.5",children:[e.jsx(ot,{className:"text-[7px]"}),N]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1.5 gap-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-white font-bold text-xs sm:text-sm",children:["â‚¹",i]}),h&&e.jsxs("span",{className:"text-white/40 text-[9px] line-through",children:["â‚¹",c]})]}),l>0&&!f?e.jsxs("div",{className:"flex items-center bg-emerald-500 rounded-md h-6",children:[e.jsx("button",{onClick:g=>{g.stopPropagation(),a(t.id,l-1)},className:"w-6 h-6 flex items-center justify-center text-white hover:bg-emerald-600 rounded-l-md transition-colors",children:e.jsx(xt,{size:7})}),e.jsx("span",{className:"text-white font-bold text-[10px] min-w-[16px] text-center",children:l}),e.jsx("button",{onClick:g=>{g.stopPropagation(),a(t.id,l+1)},className:"w-6 h-6 flex items-center justify-center text-white hover:bg-emerald-600 rounded-r-md transition-colors",children:e.jsx(Me,{size:7})})]}):e.jsx("button",{onClick:g=>{g.stopPropagation(),!f&&s(t)},disabled:f,className:`h-6 px-2.5 rounded-md text-[9px] font-bold transition-all ${f?"bg-white/10 text-white/30":"bg-emerald-500 hover:bg-emerald-400 text-slate-900 active:scale-95"}`,children:"ADD"})]})]})]})},xa=({product:t,store:l,isOpen:s,onClose:a,cartQuantity:n,onAdd:o,onUpdate:i,storeReturnPolicy:c})=>{const h=t?.sellingPrice||t?.price||0,x=t?.mrp||h,d=x>h,f=t?.offerLabel||(d?`${Math.round((1-h/x)*100)}% OFF`:null),b=t?.stock!==void 0&&t?.stock<=0||t?.quantity!==void 0&&t?.quantity<=0||!t?.inStock,N=Jt(t,c),g=Zt(N),w=x>h?x-h:0;r.useEffect(()=>{if(s){const u=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=u}}},[s]);const v=u=>{u.target===u.currentTarget&&u.preventDefault()};return!s||!t?null:xs.createPortal(e.jsx(me,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},onClick:a,onTouchMove:v,className:"fixed inset-0 z-[100] bg-black/70 backdrop-blur-md touch-none",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"}}),e.jsxs(E.div,{initial:{scale:.95,opacity:0,x:"-50%",y:"calc(-50% + 20px)"},animate:{scale:1,opacity:1,x:"-50%",y:"-50%"},exit:{scale:.95,opacity:0,x:"-50%",y:"calc(-50% + 20px)"},transition:{type:"spring",damping:25,stiffness:300,mass:.8},onClick:u=>u.stopPropagation(),className:"fixed top-1/2 left-1/2 z-[101] bg-slate-900 rounded-2xl border border-white/10 shadow-2xl w-[calc(100%-2rem)] sm:w-[90%] max-w-2xl max-h-[90vh] overflow-y-auto",style:{WebkitOverflowScrolling:"touch"},children:[e.jsx("button",{onClick:a,className:"absolute top-4 right-4 w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 active:bg-white/30 flex items-center justify-center transition-all z-10 touch-manipulation","aria-label":"Close",children:e.jsx(De,{className:"text-white/70 text-sm"})}),e.jsxs("div",{className:"relative h-56 sm:h-64 md:h-80 bg-gradient-to-br from-white to-gray-50 rounded-t-2xl overflow-hidden",children:[t.imageUrl||t.image?e.jsx("img",{src:t.imageUrl||t.image,alt:t.name,className:"w-full h-full object-contain p-8"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-50 text-6xl",children:"ðŸ“¦"}),f&&!b&&e.jsxs("div",{className:"absolute top-4 left-4 bg-gradient-to-r from-amber-500 to-amber-600 text-white px-3 py-1.5 rounded-full shadow-lg flex items-center gap-1.5",children:[e.jsx(dt,{className:"text-xs"}),e.jsx("span",{className:"font-bold text-sm",children:f})]}),b&&e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ge,{className:"text-red-400 text-4xl mx-auto mb-2"}),e.jsx("span",{className:"text-white font-bold text-lg",children:"Out of Stock"})]})})]}),e.jsxs("div",{className:"p-5 md:p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-white flex-1 leading-tight pr-2",children:t.name}),t.category&&e.jsx("span",{className:"px-2.5 py-1 bg-emerald-500/20 text-emerald-300 rounded-full text-[10px] md:text-xs font-medium flex-shrink-0",children:t.category})]}),e.jsxs("div",{className:"space-y-1",children:[t.brand&&e.jsxs("p",{className:"text-white/60 text-sm",children:["Brand: ",e.jsx("span",{className:"text-white/80 font-medium",children:t.brand})]}),t.sku&&e.jsxs("p",{className:"text-white/40 text-xs",children:["SKU: ",t.sku]})]})]}),t.description&&e.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[e.jsxs("h3",{className:"text-white/70 text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(Le,{className:"text-emerald-400"}),"Description"]}),e.jsx("p",{className:"text-white/60 text-sm leading-relaxed",children:t.description})]}),e.jsxs("div",{className:"bg-gradient-to-r from-emerald-500/10 via-emerald-500/5 to-cyan-500/10 rounded-xl p-4 md:p-5 border border-emerald-500/20 shadow-lg shadow-emerald-500/5",children:[e.jsxs("div",{className:"flex flex-wrap items-baseline gap-2 md:gap-3 mb-3",children:[e.jsxs("span",{className:"text-2xl md:text-3xl font-bold text-white",children:["â‚¹",h]}),d&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-lg md:text-xl text-white/40 line-through",children:["â‚¹",x]}),w>0&&e.jsxs("span",{className:"text-xs md:text-sm text-emerald-400 font-semibold bg-emerald-500/10 px-2 py-0.5 rounded-full",children:["Save â‚¹",w]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 md:gap-4 text-xs md:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-white/70",children:[e.jsx(vs,{className:"text-[10px]"}),e.jsx("span",{children:t.unit||"1 unit"})]}),t.quantity!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 text-white/70",children:[e.jsx(Te,{className:"text-[10px] text-emerald-400"}),e.jsx("span",{className:t.quantity>0?"text-emerald-400":"text-red-400",children:t.quantity>0?"In Stock":"Out of Stock"})]})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[e.jsxs("h3",{className:"text-white/80 text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(ot,{className:"text-emerald-400 text-sm"}),"Return & Replacement Policy"]}),e.jsx("div",{className:"space-y-2",children:N==="non_returnable"?e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-red-500/10 rounded-lg border border-red-500/20",children:[e.jsx(Ge,{className:"text-red-400 text-base flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-red-300 font-semibold text-sm mb-1",children:"Non-returnable"}),e.jsx("p",{className:"text-red-300/70 text-xs leading-relaxed",children:"This item cannot be returned or replaced once purchased."})]})]}):N==="replacement_available"?e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-amber-500/10 rounded-lg border border-amber-500/20",children:[e.jsx(Te,{className:"text-amber-400 text-base flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-amber-300 font-semibold text-sm mb-1",children:"Replacement Available"}),e.jsx("p",{className:"text-amber-300/70 text-xs leading-relaxed",children:"Replace if defective, damaged, or wrong item received."})]})]}):e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-emerald-500/10 rounded-lg border border-emerald-500/20",children:[e.jsx(Te,{className:"text-emerald-400 text-base flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-emerald-300 font-semibold text-sm mb-1",children:g}),e.jsx("p",{className:"text-emerald-300/70 text-xs leading-relaxed",children:N.includes("1h")?"Return or replace within 1 hour of delivery.":N.includes("24h")?"Return or replace within 24 hours of delivery.":N.includes("3d")?"Return or replace within 3 days of delivery.":"Return or replace as per store policy."})]})]})})]}),(t.barcode||t.packSize)&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.barcode&&e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[e.jsx("p",{className:"text-white/40 text-xs mb-1",children:"Barcode"}),e.jsx("p",{className:"text-white text-sm font-medium",children:t.barcode})]}),t.packSize&&e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[e.jsx("p",{className:"text-white/40 text-xs mb-1",children:"Pack Size"}),e.jsx("p",{className:"text-white text-sm font-medium",children:t.packSize})]})]}),e.jsx("div",{className:"pt-4 border-t border-white/10",children:b?e.jsx("button",{disabled:!0,className:"w-full py-4 bg-white/10 text-white/40 rounded-xl font-semibold cursor-not-allowed touch-manipulation",children:"Out of Stock"}):n>0?e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsxs("div",{className:"flex-1 flex items-center justify-between bg-emerald-500/20 rounded-xl p-2 border border-emerald-500/30",children:[e.jsx("button",{onClick:u=>{u.stopPropagation(),i(t.id,n-1)},className:"w-10 h-10 rounded-lg bg-emerald-500 text-slate-900 flex items-center justify-center active:bg-emerald-400 active:scale-95 transition-all touch-manipulation","aria-label":"Decrease quantity",children:e.jsx(xt,{className:"text-sm"})}),e.jsx("span",{className:"text-white font-bold text-lg min-w-[2rem] text-center",children:n}),e.jsx("button",{onClick:u=>{u.stopPropagation(),i(t.id,n+1)},className:"w-10 h-10 rounded-lg bg-emerald-500 text-slate-900 flex items-center justify-center active:bg-emerald-400 active:scale-95 transition-all touch-manipulation","aria-label":"Increase quantity",children:e.jsx(Me,{className:"text-sm"})})]}),e.jsxs("button",{onClick:u=>{u.stopPropagation(),a()},className:"px-5 md:px-6 py-4 bg-emerald-500 text-slate-900 rounded-xl font-semibold active:bg-emerald-400 active:scale-95 transition-all flex items-center gap-2 touch-manipulation",children:[e.jsx(Xe,{}),e.jsx("span",{className:"hidden sm:inline",children:"View Cart"}),e.jsx("span",{className:"sm:hidden",children:"Cart"})]})]}):e.jsxs("button",{onClick:u=>{u.stopPropagation(),o(t)},className:"w-full py-4 bg-emerald-500 text-slate-900 rounded-xl font-semibold active:opacity-90 active:scale-[0.98] transition-all flex items-center justify-center gap-2 touch-manipulation",children:[e.jsx(Xe,{}),e.jsx("span",{children:"Add to Cart"}),e.jsxs("span",{className:"font-bold",children:["â€¢ â‚¹",h]})]})})]})]})]})}),document.body)},ma=({store:t,isOpen:l,onClose:s,customerDistance:a,isWithinDeliveryRange:n})=>{const o=t?.businessName||t?.name||"Store";return!l||!t?null:e.jsxs(e.Fragment,{children:[e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:s,className:"fixed inset-0 z-50 bg-black/60"}),e.jsx(E.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-[60] bg-slate-800 rounded-t-2xl overflow-y-auto",style:{maxHeight:"calc(70vh - env(safe-area-inset-bottom))",paddingBottom:"calc(100px + env(safe-area-inset-bottom))"},children:e.jsxs("div",{className:"p-5",style:{paddingBottom:"calc(env(safe-area-inset-bottom) + 20px)"},children:[e.jsx("div",{className:"w-10 h-1 bg-white/20 rounded-full mx-auto mb-4"}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center overflow-hidden",children:t.logoUrl?e.jsx("img",{src:t.logoUrl,alt:"",className:"w-full h-full object-cover"}):e.jsx(te,{className:"text-emerald-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:o}),e.jsx("p",{className:"text-white/50 text-sm",children:t.category||"General Store"})]}),e.jsx("button",{onClick:s,className:"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center",children:e.jsx(De,{className:"text-white/60 text-sm"})})]}),t.description&&e.jsx("p",{className:"text-white/60 text-sm mb-4",children:t.description}),e.jsxs("div",{className:"space-y-2",children:[t.deliveryEnabled!==!1&&!n&&a!==null&&e.jsxs("div",{className:"p-3 bg-red-500/10 rounded-xl border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ee,{className:"text-red-400 text-sm"}),e.jsx("span",{className:"text-red-400 text-xs font-bold",children:"Out of Delivery Range"})]}),e.jsxs("p",{className:"text-red-400/80 text-xs",children:["You are ",e.jsxs("span",{className:"font-bold",children:[a," km"]})," away from this store. They only deliver within ",e.jsxs("span",{className:"font-bold",children:[t.deliveryRadius||10," km"]}),"."]}),t.pickupEnabled&&e.jsxs("p",{className:"text-amber-400 text-xs mt-2 flex items-center gap-1",children:[e.jsx(te,{className:"text-xs"}),"Store pickup is still available!"]})]}),t.deliveryEnabled!==!1&&e.jsxs("div",{className:`p-3 rounded-xl border ${n?"bg-gradient-to-r from-emerald-500/10 to-cyan-500/10 border-emerald-500/20":"bg-white/5 border-white/10"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:n?"text-emerald-400 text-sm":"text-white/40 text-sm"}),e.jsx("span",{className:n?"text-emerald-400 text-xs font-medium":"text-white/50 text-xs font-medium",children:"Delivery Info"})]}),!n&&e.jsx("span",{className:"text-[9px] text-red-400 bg-red-500/10 px-2 py-0.5 rounded-full",children:"Not Available"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[parseFloat(t.minOrderValue)>0&&e.jsxs("div",{className:"p-2 bg-white/5 rounded-lg",children:[e.jsx("p",{className:"text-white/40 text-[9px]",children:"Min. Order"}),e.jsxs("p",{className:"text-white text-sm font-bold",children:["â‚¹",t.minOrderValue]})]}),parseFloat(t.freeDeliveryAbove)>0&&e.jsxs("div",{className:"p-2 bg-emerald-500/10 rounded-lg border border-emerald-500/20",children:[e.jsx("p",{className:"text-emerald-400 text-[9px]",children:"Free Delivery"}),e.jsxs("p",{className:"text-emerald-400 text-sm font-bold",children:["Above â‚¹",t.freeDeliveryAbove]})]}),e.jsxs("div",{className:"p-2 bg-white/5 rounded-lg",children:[e.jsx("p",{className:"text-white/40 text-[9px]",children:"Delivery Fee"}),e.jsx("p",{className:"text-white text-sm font-bold",children:t.distanceBasedFee?`â‚¹${t.baseFee||20}+`:`â‚¹${t.deliveryFee||20}`})]}),e.jsxs("div",{className:"p-2 bg-white/5 rounded-lg",children:[e.jsx("p",{className:"text-white/40 text-[9px]",children:"Delivers within"}),e.jsxs("p",{className:"text-white text-sm font-bold",children:[t.deliveryRadius||5," km"]})]})]}),t.distanceBasedFee&&e.jsxs("p",{className:"text-white/40 text-[10px] mt-2",children:["* Delivery fee: â‚¹",t.baseFee||20," base + â‚¹",t.perKmFee||5,"/km after ",t.baseDistance||2,"km"]})]}),t.pickupEnabled&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-purple-500/10 rounded-xl border border-purple-500/20",children:[e.jsx(te,{className:"text-purple-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-purple-400 text-[10px]",children:"Store Pickup Available"}),e.jsx("p",{className:"text-white text-sm",children:"Skip delivery fee - pick up at store"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-xl",children:[e.jsx(ee,{className:"text-emerald-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white/40 text-[10px]",children:"Address"}),e.jsx("p",{className:"text-white text-sm",children:t.address||"Not available"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-xl",children:[e.jsx(ie,{className:"text-blue-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white/40 text-[10px]",children:"Hours"}),e.jsxs("p",{className:"text-white text-sm",children:[t.openTime||"9 AM"," - ",t.closeTime||"9 PM"]})]})]}),t.phone&&e.jsxs("a",{href:`tel:${t.phone}`,className:"flex items-center gap-3 p-3 bg-emerald-500/10 rounded-xl border border-emerald-500/30",children:[e.jsx(ze,{className:"text-emerald-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-emerald-400 text-[10px]",children:"Call Store"}),e.jsx("p",{className:"text-white text-sm font-medium",children:t.phone})]}),e.jsx(re,{className:"text-emerald-400 text-sm"})]})]})]})})]})},ha=(t,l,s,a)=>{const o=(s-t)*Math.PI/180,i=(a-l)*Math.PI/180,c=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))},ua=({storeId:t,onBack:l,onCartClick:s})=>{const[a,n]=r.useState(null),[o,i]=r.useState([]),[c,h]=r.useState(["All"]),[x,d]=r.useState("All"),[f,b]=r.useState(""),[N,g]=r.useState(!0),[w,v]=r.useState(!1),[u,m]=r.useState(!1),[S,k]=r.useState(null),[A,C]=r.useState(null),[R,y]=r.useState(null),[F,L]=r.useState(!0),{addToCart:G,updateQuantity:B,getItemQuantity:P,getCartTotals:I,cartStore:z}=st(),{itemCount:J,total:$}=I(),_=a?.businessName||a?.name||"Store";r.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(O=>{C({lat:O.coords.latitude,lng:O.coords.longitude})},O=>{console.log("Location not available:",O.message)},{enableHighAccuracy:!0,timeout:1e4})},[]),r.useEffect(()=>{if(a&&A){let O,j;if(a.location&&(O=a.location.latitude||a.location._lat,j=a.location.longitude||a.location._long),O&&j){const U=ha(A.lat,A.lng,O,j),q=Math.round(U*10)/10;y(q);const X=a.deliveryRadius||10;L(q<=X)}}},[a,A]),r.useEffect(()=>{(async()=>{if(t){g(!0);try{const[j,U,q]=await Promise.all([ts(t),Xs(t),ea(t)]);n(j),i(U||[]);const X=(U||[]).filter(pt).length;h(["All",...X>0?["Offers"]:[],...q||[]])}catch(j){console.error("Error:",j)}finally{g(!1)}}})()},[t]);const se=r.useMemo(()=>o.filter(O=>{const j=x==="All"?!0:x==="Offers"?pt(O):O.category===x,U=!f||O.name?.toLowerCase().includes(f.toLowerCase());return j&&U}),[o,x,f]),he=O=>O==="All"?o.length:O==="Offers"?o.filter(pt).length:o.filter(j=>j.category===O).length,Pe=O=>{G(O,a)};if(N)return e.jsx("div",{className:"min-h-screen bg-transparent flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-10 h-10 border-2 border-emerald-500/30 border-t-emerald-500 rounded-full animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-white/50 text-sm",children:"Loading..."})]})});if(!a)return e.jsxs("div",{className:"min-h-screen bg-slate-900 flex flex-col items-center justify-center p-6",children:[e.jsx(te,{className:"text-white/20 text-4xl mb-3"}),e.jsx("p",{className:"text-white/50 mb-4",children:"Store not found"}),e.jsx("button",{onClick:l,className:"px-6 py-2 bg-emerald-500 text-slate-900 rounded-lg text-sm font-medium hover:bg-emerald-400 transition",children:"Go Back"})]});const ne=a.deliveryEnabled!==!1,we=a.pickupEnabled===!0;return!F&&R!==null&&!we&&ne?e.jsx("div",{className:"min-h-screen bg-slate-900 flex flex-col items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl overflow-hidden bg-white/10 mx-auto mb-4",children:a.logoUrl?e.jsx("img",{src:a.logoUrl,alt:_,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-red-500/20 to-red-600/10 flex items-center justify-center",children:e.jsx(te,{className:"text-red-400 text-2xl"})})}),e.jsx("h2",{className:"text-white font-bold text-xl mb-2",children:_}),e.jsx("p",{className:"text-white/50 text-sm mb-6",children:a.category||"General Store"}),e.jsx("div",{className:"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ee,{className:"text-red-400 text-2xl"})}),e.jsx("h3",{className:"text-red-400 font-semibold text-lg mb-2",children:"Store Not Available"}),e.jsxs("p",{className:"text-white/60 text-sm mb-2",children:["You are ",e.jsxs("span",{className:"text-red-400 font-semibold",children:[R," km"]})," away from this store."]}),e.jsxs("p",{className:"text-white/50 text-sm mb-6",children:["This store only delivers within ",e.jsxs("span",{className:"text-white font-medium",children:[a.deliveryRadius||10," km"]})," and does not offer store pickup."]}),e.jsx("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-6 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-white/40 text-xs",children:"Delivery Range"}),e.jsxs("p",{className:"text-white font-semibold",children:[a.deliveryRadius||10," km"]})]}),e.jsx("div",{className:"w-px h-8 bg-white/10"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-white/40 text-xs",children:"Your Distance"}),e.jsxs("p",{className:"text-red-400 font-semibold",children:[R," km"]})]}),e.jsx("div",{className:"w-px h-8 bg-white/10"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-white/40 text-xs",children:"Store Pickup"}),e.jsx("p",{className:"text-red-400 font-semibold",children:"Not Available"})]})]})}),e.jsx("button",{onClick:l,className:"w-full py-3 bg-emerald-500 text-slate-900 rounded-xl font-semibold hover:bg-emerald-400 transition-colors",children:"Browse Other Stores"}),e.jsx("p",{className:"text-white/30 text-xs mt-4",children:"Try stores closer to your location"})]})}):e.jsxs("div",{className:"bg-transparent w-full h-full flex flex-col",children:[e.jsxs("header",{className:"sticky top-0 z-50 bg-gradient-to-r from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-xl border-b border-white/10 flex-shrink-0",style:{paddingTop:"env(safe-area-inset-top)"},children:[e.jsxs("div",{className:"flex items-center gap-3 px-3 lg:px-4 py-3",children:[e.jsx("button",{onClick:l,className:"w-9 h-9 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/15 transition-colors",children:e.jsx(ge,{className:"text-white text-sm"})}),e.jsx("div",{className:"w-10 h-10 rounded-xl overflow-hidden bg-white/10 flex-shrink-0",children:a.logoUrl?e.jsx("img",{src:a.logoUrl,alt:_,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-emerald-500/20 to-emerald-600/10 flex items-center justify-center",children:e.jsx(te,{className:"text-emerald-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("h1",{className:"text-white font-bold text-sm sm:text-base truncate",children:_}),a.isVerified&&e.jsx(jt,{className:"text-emerald-400 flex-shrink-0 text-sm"})]}),e.jsx("p",{className:"text-white/50 text-xs truncate",children:a.category||"General Store"})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ce,{className:"text-amber-400 text-xs"}),e.jsx("span",{className:"text-white text-sm font-medium",children:a.rating?.toFixed(1)||"0.0"})]}),e.jsx("div",{className:"w-px h-4 bg-white/10"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ie,{className:"text-emerald-400 text-xs"}),e.jsxs("span",{className:"text-white text-sm",children:[a.baseDeliveryTime||a.avgDeliveryTime||30," min"]})]}),e.jsx("div",{className:"w-px h-4 bg-white/10"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ee,{className:"text-blue-400 text-xs"}),e.jsxs("span",{className:"text-white text-sm",children:["â‚¹",a.deliveryFee||20]})]}),parseFloat(a.freeDeliveryAbove)>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-4 bg-white/10"}),e.jsxs("span",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-emerald-500/10 rounded-full text-emerald-400 text-xs font-medium",children:[e.jsx(Ye,{className:"text-xs"}),"Free delivery above â‚¹",a.freeDeliveryAbove]})]}),a.isActive&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-4 bg-white/10"}),e.jsxs("span",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-emerald-500/15 rounded-full text-emerald-400 text-xs font-medium border border-emerald-500/30",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-emerald-400 rounded-full animate-pulse"}),"Open Now"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>v(!0),className:"w-9 h-9 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/15 transition-colors",children:e.jsx(Le,{className:"text-white/60 text-sm"})}),e.jsx("button",{onClick:()=>m(!u),className:"w-9 h-9 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/15 transition-colors",children:e.jsx(yt,{className:u?"text-red-500 text-sm":"text-white/40 text-sm"})}),e.jsx("button",{className:"hidden sm:flex w-9 h-9 rounded-full bg-white/10 items-center justify-center hover:bg-white/15 transition-colors",children:e.jsx(Ns,{className:"text-white/60 text-sm"})})]})]}),e.jsxs("div",{className:"md:hidden flex items-center gap-3 px-3 pb-3 overflow-x-auto scrollbar-hide",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx(Ce,{className:"text-amber-400 text-[10px]"}),e.jsx("span",{className:"text-white text-xs font-medium",children:a.rating?.toFixed(1)||"0.0"})]}),e.jsx("div",{className:"w-px h-3 bg-white/10"}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx(ie,{className:"text-emerald-400 text-[10px]"}),e.jsxs("span",{className:"text-white text-xs",children:[a.baseDeliveryTime||a.avgDeliveryTime||30," min"]})]}),e.jsx("div",{className:"w-px h-3 bg-white/10"}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx(Ee,{className:"text-blue-400 text-[10px]"}),e.jsxs("span",{className:"text-white text-xs",children:["â‚¹",a.deliveryFee||20]})]}),parseFloat(a.freeDeliveryAbove)>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-3 bg-white/10"}),e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-emerald-500/10 rounded-full text-emerald-400 text-[10px] font-medium flex-shrink-0",children:[e.jsx(Ye,{className:"text-[8px]"}),"Free >â‚¹",a.freeDeliveryAbove]})]}),a.isActive&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-3 bg-white/10"}),e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-emerald-500/15 rounded-full text-emerald-400 text-[10px] font-medium border border-emerald-500/30 flex-shrink-0",children:[e.jsx("span",{className:"w-1 h-1 bg-emerald-400 rounded-full animate-pulse"}),"Open Now"]})]}),R!==null&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-3 bg-white/10"}),e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-blue-500/15 rounded-full text-blue-400 text-[10px] font-medium flex-shrink-0",children:[e.jsx(ee,{className:"text-[8px]"}),R," km away"]})]})]}),a.deliveryEnabled!==!1&&!F&&R!==null&&e.jsxs("div",{className:"mx-3 mb-2 p-2.5 bg-red-500/10 border border-red-500/30 rounded-xl flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-red-500/20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ee,{className:"text-red-400 text-sm"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-red-400 text-xs font-semibold",children:"Out of Delivery Range"}),e.jsxs("p",{className:"text-red-400/70 text-[10px]",children:["You are ",R," km away. Store delivers within ",a.deliveryRadius||10," km.",a.pickupEnabled&&" Store pickup is still available."]})]})]}),e.jsx("div",{className:"px-3 lg:px-4 pb-3 lg:ml-52 xl:ml-56",children:e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-white/40 text-sm"}),e.jsx("input",{type:"text",placeholder:`Search in ${_}`,value:f,onChange:O=>b(O.target.value),className:"w-full h-9 pl-9 pr-9 bg-white/10 rounded-lg text-white text-sm placeholder-white/40 focus:outline-none focus:ring-1 focus:ring-emerald-500/50 focus:bg-white/10 transition-colors"}),f&&e.jsx("button",{onClick:()=>b(""),className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx(De,{className:"text-white/40 text-sm hover:text-white/60"})})]})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx("div",{className:"lg:hidden sticky top-0 z-20 bg-gradient-to-r from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-md border-b border-white/10",children:e.jsx("div",{className:"flex gap-2 px-3 py-2.5 overflow-x-auto scrollbar-hide",style:{scrollBehavior:"smooth",WebkitOverflowScrolling:"touch"},children:c.map(O=>e.jsxs("button",{onClick:()=>d(O),className:`flex-shrink-0 px-3 py-2 rounded-xl text-[11px] font-medium transition-all flex items-center gap-1.5 ${x===O?"bg-emerald-500 text-slate-900 shadow-lg shadow-emerald-500/30":"bg-white/10 text-white hover:bg-white/15 active:bg-white/20 border border-white/10"}`,style:{minHeight:"36px"},children:[e.jsx("span",{children:_t(O)}),O,e.jsxs("span",{className:"opacity-60",children:["(",he(O),")"]})]},O))})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsxs("aside",{className:"hidden lg:flex flex-col fixed left-0 top-[110px] bottom-0 w-52 xl:w-56 border-r border-white/10 bg-gradient-to-br from-slate-900/98 via-slate-800/95 to-slate-900/98 backdrop-blur-2xl z-30 overflow-y-auto",children:[e.jsxs("div",{className:"p-3 flex-1",children:[e.jsx("h3",{className:"text-white/50 text-[10px] font-semibold uppercase tracking-wider mb-3 px-2",children:"Categories"}),e.jsx("div",{className:"space-y-1",children:c.map(O=>e.jsxs("button",{onClick:()=>d(O),className:`w-full flex items-center gap-2.5 px-3 py-2.5 rounded-lg text-left transition-all ${x===O?"bg-emerald-500 text-slate-900":"bg-white/10 text-white hover:bg-white/15 active:bg-white/20"}`,children:[e.jsx("span",{className:"text-base",children:_t(O)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium truncate ${x===O?"text-emerald-400":""}`,children:O}),e.jsxs("p",{className:"text-[10px] text-white/40",children:[he(O)," items"]})]}),x===O&&e.jsx("div",{className:"w-1.5 h-1.5 bg-emerald-400 rounded-full"})]},O))})]}),e.jsx("div",{className:"h-20 flex-shrink-0"})]}),e.jsxs("div",{className:"lg:ml-52 xl:ml-56",children:[e.jsx("div",{className:"sticky top-0 z-20 bg-gradient-to-r from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-md px-3 lg:px-4 py-3 flex items-center justify-between border-b border-white/10",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-semibold text-sm",children:x==="All"?"All Products":x}),e.jsxs("p",{className:"text-white/40 text-xs",children:[se.length," products"]})]})}),e.jsxs("div",{className:"p-3 lg:p-4",children:[se.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-2 sm:gap-3",children:se.map(O=>e.jsx(da,{product:O,cartQuantity:P(O.id),onAdd:Pe,onUpdate:B,onClick:j=>k(j),storeReturnPolicy:a?.returnPolicyDefault},O.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(ke,{className:"text-white/20 text-2xl mb-3"}),e.jsx("p",{className:"text-white/50 text-sm",children:"No products found"})]}),e.jsx("div",{className:"h-24"})]})]})]})]}),e.jsx(me,{children:J>0&&z?.id===t&&e.jsx(E.div,{initial:{y:100},animate:{y:0},exit:{y:100},className:"fixed bottom-0 left-0 right-0 z-40 bg-gradient-to-r from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-md border-t border-white/10",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:e.jsx("div",{className:"p-3 lg:pl-56 xl:pl-60",children:e.jsxs("button",{onClick:s,className:"w-full bg-emerald-500 text-slate-900 rounded-xl p-3 flex items-center justify-between hover:bg-emerald-400 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 bg-slate-900/20 rounded-lg flex items-center justify-center",children:e.jsx(Xe,{className:"text-slate-900"})}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"text-slate-900 font-semibold",children:[J," item",J>1?"s":""]}),e.jsx("p",{className:"text-slate-900/70 text-xs",children:_})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-slate-900 font-bold text-lg",children:["â‚¹",$]}),e.jsx("div",{className:"w-8 h-8 bg-slate-900/20 rounded-lg flex items-center justify-center",children:e.jsx(re,{className:"text-slate-900"})})]})]})})})}),e.jsx(me,{children:w&&e.jsx(ma,{store:a,isOpen:w,onClose:()=>v(!1),customerDistance:R,isWithinDeliveryRange:F})}),e.jsx(xa,{product:S,store:a,isOpen:!!S,onClose:()=>k(null),cartQuantity:S?P(S.id):0,onAdd:Pe,onUpdate:B,storeReturnPolicy:a?.returnPolicyDefault})]})},ft=async()=>{try{await _s.impact({style:Us.Light})}catch{}},pa=({product:t,cartQuantity:l,onAdd:s,onUpdate:a,onStoreClick:n})=>{const o=t.sellingPrice||t.price||0,i=t.mrp||o;return e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 p-3 flex gap-3",children:[e.jsx("div",{className:"w-20 h-20 bg-white/10 rounded-lg flex-shrink-0 overflow-hidden border border-white/10",children:t.imageUrl||t.image?e.jsx("img",{src:t.imageUrl||t.image,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-2xl",children:"ðŸ“¦"})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white text-sm line-clamp-2",children:t.name}),e.jsxs("button",{onClick:()=>n(t.storeId),className:"flex items-center gap-1 text-xs text-emerald-400 mt-1",children:[e.jsx(te,{className:"text-[10px]"}),t.storeName,t.storeDistance!=null&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"text-[10px] ml-1"}),t.storeDistance," km"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-bold text-white",children:["â‚¹",o]}),i>o&&e.jsxs("span",{className:"text-xs text-slate-500 line-through ml-1",children:["â‚¹",i]})]}),l>0?e.jsxs("div",{className:"flex items-center gap-2 bg-emerald-500 rounded-lg overflow-hidden",children:[e.jsx("button",{onClick:()=>{ft(),a(t.id,l-1)},className:"w-7 h-7 flex items-center justify-center text-white",children:e.jsx(xt,{className:"text-xs"})}),e.jsx("span",{className:"text-white font-semibold min-w-[16px] text-center text-sm",children:l}),e.jsx("button",{onClick:()=>{ft(),a(t.id,l+1)},className:"w-7 h-7 flex items-center justify-center text-white",children:e.jsx(Me,{className:"text-xs"})})]}):e.jsx("button",{onClick:()=>{ft(),s(t)},className:"px-3 py-1.5 bg-emerald-500 text-slate-900 rounded-lg text-sm font-semibold hover:bg-emerald-400 transition",children:"ADD"})]})]})]})},fa=({category:t,onClick:l})=>e.jsxs("button",{onClick:()=>l(t.name),className:`flex items-center gap-2 px-3 py-2 rounded-xl bg-gradient-to-br ${t.color} text-white text-sm font-medium whitespace-nowrap border border-white/10 shadow-lg`,children:[e.jsx("span",{children:t.icon}),t.name]}),ba=({location:t,onBack:l,onStoreSelect:s})=>{const[a,n]=r.useState(""),[o,i]=r.useState([]),[c,h]=r.useState([]),[x,d]=r.useState([]),[f,b]=r.useState([]),[N,g]=r.useState(!1),[w,v]=r.useState(!1),{addToCart:u,updateQuantity:m,getItemQuantity:S,cartStore:k}=st();r.useEffect(()=>{(async()=>{if(t?.lat&&t?.lng){const L=await la(t.lat,t.lng,5);d(L)}const F=localStorage.getItem("flyp_recent_searches");if(F)try{b(JSON.parse(F).slice(0,5))}catch{}})()},[t]);const A=r.useCallback(async y=>{if(!y.trim())return;const F=t?.lat??19.076,L=t?.lng??72.8777;g(!0),v(!0);try{const{products:G,stores:B}=await aa(y,F,L,{radiusKm:50,maxStores:30,maxProducts:80,maxStoresInResult:15});i(G||[]),h(B||[]);const P=[y,...f.filter(I=>I!==y)].slice(0,5);b(P),localStorage.setItem("flyp_recent_searches",JSON.stringify(P))}catch(G){console.error("Search error:",G),i([]),h([])}finally{g(!1)}},[t,f]),C=()=>{a.trim()&&A(a)},R=y=>{const F={id:y.storeId,businessName:y.storeName,deliveryFee:20,minOrderValue:100},L=u(y,F);!L.success&&L.error==="DIFFERENT_STORE"&&alert(L.message)};return e.jsxs("div",{className:"bg-transparent w-full h-full flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-xl sticky top-0 z-10 border-b border-white/10 flex-shrink-0",style:{paddingTop:"env(safe-area-inset-top)"},children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[e.jsx("button",{onClick:l,className:"w-10 h-10 rounded-full bg-white/10 border border-white/10 flex items-center justify-center",children:e.jsx(ge,{className:"text-white/60"})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"}),e.jsx("input",{type:"text",placeholder:"Products, brands, stores (e.g. Samsung, Sprite)",value:a,onChange:y=>n(y.target.value),onKeyDown:y=>y.key==="Enter"&&C(),autoFocus:!0,className:"w-full pl-10 pr-10 py-2.5 bg-white/5 border border-white/10 rounded-xl text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"}),a&&e.jsx("button",{onClick:()=>{n(""),i([]),h([]),v(!1)},className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx(De,{className:"text-slate-500"})})]}),e.jsx("button",{onClick:C,className:"px-4 py-2.5 bg-emerald-500 text-slate-900 rounded-lg text-sm font-semibold hover:bg-emerald-400 transition",children:"Search"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"px-4 py-4",children:[!w&&e.jsxs(e.Fragment,{children:[f.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Recent Searches"}),e.jsx("div",{className:"space-y-2",children:f.map((y,F)=>e.jsxs("button",{onClick:()=>{n(y),A(y)},className:"flex items-center gap-3 w-full text-left py-2",children:[e.jsx(Ss,{className:"text-slate-500"}),e.jsx("span",{className:"text-white/70",children:y})]},F))})]}),x.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Browse by Category"}),e.jsx("div",{className:"flex flex-wrap gap-2",style:{scrollBehavior:"smooth"},children:x.map((y,F)=>e.jsx(fa,{category:y,onClick:L=>{n(L),A(L)}},F))})]})]}),N&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-10 h-10 rounded-full border-4 border-emerald-500 border-t-transparent animate-spin"})}),w&&!N&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-white/60 mb-4",children:[o.length+c.length,' results for "',a,'"']}),o.length>0||c.length>0?e.jsxs("div",{className:"space-y-6",children:[c.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(te,{className:"text-emerald-400"}),"Stores (",c.length,")"]}),e.jsx("div",{className:"space-y-2",children:c.map(y=>e.jsxs("button",{type:"button",onClick:()=>s&&s(y.id),className:"w-full flex items-center gap-4 p-4 rounded-xl bg-white/5 border border-white/10 hover:border-emerald-500/30 hover:bg-white/10 transition-all text-left",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/10 flex items-center justify-center overflow-hidden flex-shrink-0",children:y.logoUrl?e.jsx("img",{src:y.logoUrl,alt:"",className:"w-full h-full object-cover"}):e.jsx(te,{className:"text-emerald-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-white truncate",children:y.businessName||y.name}),e.jsx("p",{className:"text-xs text-white/50 truncate",children:y.category||"Store"}),e.jsx("p",{className:"text-xs text-emerald-400 mt-1",children:y.matchedProductCount>0?`${y.matchedProductCount} product${y.matchedProductCount!==1?"s":""} match`:"Store matches your search"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 flex-shrink-0",children:[y.distance!=null&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-white/50",children:[e.jsx(ee,{className:"text-[10px]"}),y.distance," km"]}),e.jsx("span",{className:"text-emerald-400 text-xs font-medium",children:"View â†’"})]})]},y.id))})]}),o.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-white mb-3 flex items-center gap-2",children:["ðŸ“¦ Products (",o.length,")"]}),e.jsx("div",{className:"space-y-3",children:o.map(y=>e.jsx(pa,{product:y,cartQuantity:S(y.id),onAdd:R,onUpdate:m,onStoreClick:s},`${y.storeId}-${y.id}`))})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-white/10 border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(ke,{className:"text-white/30 text-2xl"})}),e.jsx("p",{className:"text-white/60 mb-2",children:"No products or stores found"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Try a different search (e.g. brand, product name, category, store)"}),e.jsx("p",{className:"text-xs text-white/40",children:"Searches name, brand, category, SKU & store names"})]})]})]})})]})},ga=({item:t,onUpdate:l,onRemove:s})=>e.jsxs("div",{className:"flex items-center gap-3 py-3 border-b border-white/[0.06] last:border-0",children:[e.jsx("div",{className:"w-14 h-14 bg-white rounded-lg flex-shrink-0 overflow-hidden",children:t.image?e.jsx("img",{src:t.image,alt:t.name,className:"w-full h-full object-contain p-1"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xl bg-gray-100",children:"ðŸ“¦"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx("h3",{className:"font-medium text-white text-sm leading-tight line-clamp-1",children:t.name}),t.offerLabel&&e.jsx("span",{className:"px-1.5 py-0.5 bg-amber-500/20 text-amber-300 text-[10px] rounded flex-shrink-0",children:t.offerLabel})]}),e.jsx("p",{className:"text-xs text-white/40 mt-0.5",children:t.unit||"1 unit"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-white font-bold text-sm",children:["â‚¹",t.price*t.quantity]}),t.mrp!=null&&t.mrp>t.price&&e.jsxs("span",{className:"text-[10px] text-white/40 line-through",children:["â‚¹",(t.mrp||t.price)*t.quantity]}),t.quantity>1&&e.jsxs("span",{className:"text-[10px] text-white/40",children:["â‚¹",t.price," Ã— ",t.quantity]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>t.quantity===1?s(t.productId):l(t.productId,t.quantity-1),className:`w-7 h-7 rounded-md flex items-center justify-center transition-colors ${t.quantity===1?"bg-red-500/20 text-red-400":"bg-white/[0.06] text-white/60 hover:bg-white/[0.1]"}`,children:t.quantity===1?e.jsx(St,{className:"text-[10px]"}):e.jsx(xt,{className:"text-[10px]"})}),e.jsx("span",{className:"font-bold text-white text-sm w-6 text-center",children:t.quantity}),e.jsx("button",{onClick:()=>l(t.productId,t.quantity+1),className:"w-7 h-7 rounded-md bg-emerald-500/20 text-emerald-400 flex items-center justify-center hover:bg-emerald-500/30 transition-colors",children:e.jsx(Me,{className:"text-[10px]"})})]})]}),ja=({onBack:t,onCheckout:l})=>{const{cartItems:s,cartStore:a,updateQuantity:n,removeFromCart:o,clearCart:i,getCartTotals:c}=st(),{subtotal:h,deliveryFee:x,baseDeliveryFee:d,platformFee:f,total:b,itemCount:N,savings:g,meetsMinOrder:w,freeDeliveryAbove:v,qualifiesForFreeDelivery:u,amountForFreeDelivery:m}=c(),[S,k]=r.useState(!1),[A,C]=r.useState(!0),R=a?.minOrder||0,y=R>0?Math.max(0,R-h):0,F=R===0||h>=R,L=r.useMemo(()=>S||s.length<=5?s:s.slice(0,5),[s,S]),G=s.length-5;return s.length===0?e.jsxs("div",{className:"bg-transparent w-full h-full flex flex-col",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-gradient-to-r from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-xl border-b border-white/10 flex-shrink-0",style:{paddingTop:"env(safe-area-inset-top)"},children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[e.jsx("button",{onClick:t,className:"w-9 h-9 rounded-full bg-white/[0.06] flex items-center justify-center",children:e.jsx(ge,{className:"text-white text-sm"})}),e.jsx("h1",{className:"font-bold text-white text-lg",children:"My Cart"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-6 pt-20",children:[e.jsx("div",{className:"w-24 h-24 rounded-2xl bg-white/5 border border-white/[0.08] flex items-center justify-center mb-4",children:e.jsx(qe,{className:"text-emerald-400 text-4xl"})}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Your cart is empty"}),e.jsx("p",{className:"text-white/50 text-center mb-6 text-sm",children:"Explore nearby stores and add items to your cart"}),e.jsx("button",{onClick:t,className:"px-6 py-3 bg-emerald-500 text-slate-900 font-semibold rounded-xl hover:bg-emerald-400 transition",children:"Start Shopping"})]})]}):e.jsxs("div",{className:"bg-transparent w-full h-full flex flex-col",children:[e.jsxs("header",{className:"sticky top-0 z-50 bg-gradient-to-r from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-xl border-b border-white/10 flex-shrink-0",style:{paddingTop:"env(safe-area-inset-top)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:t,className:"w-9 h-9 rounded-full bg-white/[0.06] flex items-center justify-center",children:e.jsx(ge,{className:"text-white text-sm"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-white text-base",children:"My Cart"}),e.jsxs("p",{className:"text-xs text-white/50",children:[N," items â€¢ â‚¹",h]})]})]}),e.jsx("button",{onClick:()=>{window.confirm("Clear all items from cart?")&&i()},className:"text-red-400 text-xs font-semibold px-3 py-1.5 rounded-lg hover:bg-red-500/10 transition-colors",children:"Clear All"})]}),a&&e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-6 h-6 rounded-md bg-emerald-500/20 flex items-center justify-center",children:e.jsx(te,{className:"text-emerald-400 text-xs"})}),e.jsx("span",{className:"text-white font-medium truncate",children:a.name||a.businessName}),e.jsx("span",{className:"text-white/40",children:"â€¢"}),e.jsxs("span",{className:"text-white/50 text-xs",children:[a.avgDeliveryTime||30," min"]})]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"pb-[180px]",children:[e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"bg-white/5 rounded-xl border border-white/[0.06] overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-white/[0.06] flex items-center justify-between bg-white/[0.02]",children:[e.jsxs("span",{className:"text-white font-medium text-sm",children:[s.length," Items"]}),s.length>5&&e.jsxs("button",{onClick:()=>k(!S),className:"text-emerald-400 text-xs font-medium flex items-center gap-1",children:[S?"Show Less":`+${G} more`,S?e.jsx(Ft,{className:"text-[10px]"}):e.jsx(wt,{className:"text-[10px]"})]})]}),e.jsx("div",{className:"px-4 divide-y divide-white/[0.04]",children:L.map(B=>e.jsx(ga,{item:B,onUpdate:n,onRemove:o},B.productId))}),!S&&s.length>5&&e.jsxs("button",{onClick:()=>k(!0),className:"w-full py-3 text-center text-emerald-400 text-sm font-medium border-t border-white/[0.06] bg-white/[0.02] hover:bg-white/[0.04] transition-colors",children:["View all ",s.length," items"]})]})}),e.jsx("div",{className:"px-4 mt-4",children:e.jsxs("button",{className:"w-full bg-white/5 rounded-xl p-3 flex items-center gap-3 border border-dashed border-emerald-500/30 hover:border-emerald-500/50 transition-colors",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-emerald-500/10 flex items-center justify-center",children:e.jsx(dt,{className:"text-emerald-400 text-sm"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"font-medium text-white text-sm",children:"Apply Coupon"}),e.jsx("p",{className:"text-xs text-white/40",children:"Save more on your order"})]}),e.jsx(re,{className:"text-white/30 text-sm"})]})}),e.jsx("div",{className:"px-4 mt-4",children:e.jsxs("div",{className:"bg-white/5 rounded-xl border border-white/[0.06] overflow-hidden",children:[e.jsxs("button",{onClick:()=>C(!A),className:"w-full px-4 py-3 flex items-center justify-between bg-white/[0.02]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-md bg-amber-500/20 flex items-center justify-center",children:e.jsx(gt,{className:"text-amber-400 text-sm"})}),e.jsx("span",{className:"font-medium text-white text-sm",children:"Bill Details"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-white font-bold",children:["â‚¹",b]}),A?e.jsx(Ft,{className:"text-white/40 text-xs"}):e.jsx(wt,{className:"text-white/40 text-xs"})]})]}),e.jsx(me,{children:A&&e.jsx(E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"px-4 pb-4 pt-2 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-white/60",children:[e.jsx("span",{children:"Item Total"}),e.jsxs("span",{className:"text-white",children:["â‚¹",h]})]}),e.jsxs("div",{className:"flex justify-between text-white/60",children:[e.jsx("span",{children:"Delivery Fee"}),u?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-white/40 line-through text-xs",children:["â‚¹",d]}),e.jsx("span",{className:"text-emerald-400 font-medium",children:"FREE"})]}):e.jsxs("span",{className:"text-white",children:["â‚¹",x]})]}),e.jsxs("div",{className:"flex justify-between text-white/60",children:[e.jsx("span",{children:"Platform Fee"}),e.jsxs("span",{className:"text-white",children:["â‚¹",f]})]}),u&&d>0&&e.jsxs("div",{className:"flex justify-between text-emerald-400",children:[e.jsx("span",{children:"Free Delivery Savings"}),e.jsxs("span",{children:["-â‚¹",d]})]}),g>0&&e.jsxs("div",{className:"flex justify-between text-emerald-400",children:[e.jsx("span",{children:"Product Savings"}),e.jsxs("span",{children:["-â‚¹",g]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-white/[0.06] font-bold",children:[e.jsx("span",{className:"text-white",children:"To Pay"}),e.jsxs("span",{className:"text-white text-base",children:["â‚¹",b]})]})]})})})]})}),!F&&R>0&&e.jsx("div",{className:"px-4 mt-4",children:e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center",children:e.jsx(qe,{className:"text-amber-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-amber-400 text-sm",children:["Add â‚¹",y," more"]}),e.jsxs("p",{className:"text-xs text-amber-400/70",children:["Minimum order is â‚¹",R]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-white/40",children:"Current"}),e.jsxs("p",{className:"text-sm font-bold text-white",children:["â‚¹",h]})]})]})}),v>0&&e.jsx("div",{className:"px-4 mt-4",children:u?e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-500 flex items-center justify-center",children:e.jsx(Ye,{className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-emerald-400 text-sm",children:"Free Delivery Unlocked!"}),e.jsxs("p",{className:"text-xs text-emerald-400/70",children:["You saved â‚¹",d," on delivery"]})]}),e.jsx("div",{className:"px-2 py-1 bg-emerald-500/20 rounded-lg",children:e.jsx("span",{className:"text-emerald-400 text-xs font-bold",children:"FREE"})})]}):e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center",children:e.jsx(Fe,{className:"text-blue-400 text-sm"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("p",{className:"text-blue-400 text-sm font-medium",children:["Add â‚¹",m," more for free delivery"]})}),e.jsxs("span",{className:"text-white/40 text-xs",children:["â‚¹",v]})]}),e.jsx("div",{className:"h-1.5 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-blue-400 rounded-full transition-all duration-300",style:{width:`${Math.min(h/v*100,100)}%`}})})]})}),g>0&&e.jsx("div",{className:"px-4 mt-4",children:e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/20 rounded-xl p-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-500 flex items-center justify-center",children:e.jsx(gt,{className:"text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-emerald-400 text-sm",children:["You're saving â‚¹",g]}),e.jsx("p",{className:"text-xs text-emerald-400/70",children:"on this order"})]})]})})]})}),e.jsxs("div",{className:"sticky bottom-0 z-40 px-4 pb-3 bg-gradient-to-r from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-xl border-t border-white/10 flex-shrink-0",style:{paddingBottom:"calc(env(safe-area-inset-bottom) + 12px)"},children:[!F&&R>0&&e.jsxs("div",{className:"mb-2 bg-white/5 rounded-xl p-2 border border-amber-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsxs("span",{className:"text-amber-400",children:["â‚¹",h," / â‚¹",R]}),e.jsxs("span",{className:"text-white/50",children:["Add â‚¹",y," more"]})]}),e.jsx("div",{className:"h-1.5 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-amber-500 to-amber-400 rounded-full transition-all duration-300",style:{width:`${Math.min(h/R*100,100)}%`}})})]}),e.jsxs("button",{onClick:F?l:void 0,disabled:!F,className:`w-full py-4 rounded-xl font-bold flex items-center justify-center gap-3 transition-colors ${F?"bg-emerald-500 hover:bg-emerald-400 text-slate-900":"bg-slate-700 text-white/40 cursor-not-allowed"}`,children:[e.jsx("span",{children:F?"Proceed to Checkout":`Add â‚¹${y} more`}),e.jsxs("span",{className:`px-3 py-1 rounded-lg text-sm font-semibold ${F?"bg-white/20":"bg-white/10"}`,children:["â‚¹",h]})]})]})]})},wa=async t=>{try{const{customerId:l,customerName:s,customerPhone:a,storeId:n,storeName:o,storePhone:i,items:c,subtotal:h,discountAmount:x=0,appliedOffer:d=null,deliveryFee:f,platformFee:b,total:N,orderType:g="delivery",deliveryAddress:w,deliverySlot:v,customerDistance:u,isScheduledDelivery:m,deliveryDate:S,deliveryDateLabel:k,pickupSlot:A,pickupDate:C,pickupDateLabel:R,pickupInstructions:y,scheduledTime:F,paymentMethod:L,payNow:G=N,payLater:B=0,paymentDueDate:P,specialInstructions:I}=t,z=`ORD${Date.now().toString(36).toUpperCase()}`;let J="pending";L==="UPI"?J="paid":L==="PAY_LATER"?J="pay_later":L==="PARTIAL"&&(J="partial_paid");const $={orderNumber:z,customerId:l,customerName:s,customerPhone:a,storeId:n,storeName:o,storePhone:i,items:c,subtotal:h,discountAmount:x,appliedOffer:d?{type:d.type,value:d.value,minOrderValue:d.minOrderValue}:null,deliveryFee:f,platformFee:b,total:N,orderType:g,deliveryAddress:g==="delivery"?w:null,deliverySlot:g==="delivery"?v:null,customerDistance:g==="delivery"?u:null,isScheduledDelivery:g==="delivery"?!!m:!1,deliveryDate:g==="delivery"&&m?S:null,deliveryDateLabel:g==="delivery"&&m?k:null,pickupSlot:g==="pickup"?A:null,pickupDate:g==="pickup"?C:null,pickupDateLabel:g==="pickup"?R:null,pickupInstructions:g==="pickup"?y:null,scheduledTime:F||null,paymentMethod:L,paymentStatus:J,payNow:G,payLater:B,paymentDueDate:P||null,amountPaid:L==="PAY_LATER"?0:G,amountDue:B,status:"pending",statusHistory:{pending:le()},specialInstructions:I||"",deliveryPartner:null,deliveryPartnerPhone:null,estimatedDeliveryMinutes:null,createdAt:le(),updatedAt:le()},_=await ct(be(Q,"customerOrders"),$);await bt(xe(Q,"stores",n,"customerOrders",_.id),{...$,orderId:_.id});try{const se=xe(Q,"customers",l);(await Ie(se)).exists()?await He(se,{totalOrders:hs(1),updatedAt:le()}):await bt(se,{totalOrders:1,updatedAt:le()},{merge:!0})}catch(se){console.error("Error updating customer order count:",se)}return{success:!0,orderId:_.id,orderNumber:z}}catch(l){return console.error("Error placing order:",l),{success:!1,error:l.message}}},Ct=async(t,l=20)=>{try{const s=be(Q,"customerOrders"),a=Nt(s,Gt("customerId","==",t),Vt(l*2)),o=(await We(a)).docs.map(i=>({id:i.id,...i.data(),createdAt:i.data().createdAt?.toDate?.()||new Date}));return o.sort((i,c)=>c.createdAt-i.createdAt),o.slice(0,l)}catch(s){throw console.error("Error fetching orders:",s),s}},ya=(t,l)=>{const s=xe(Q,"customerOrders",t);return Wt(s,a=>{a.exists()&&l({id:a.id,...a.data(),createdAt:a.data().createdAt?.toDate?.()||new Date})},a=>{console.error("Error in order subscription:",a)})},Na=async(t,l)=>{try{const{storeRating:s,storeReview:a,deliveryPersonRating:n,deliveryPersonReview:o,deliveryPersonName:i,deliveryPersonId:c}=l,h=xe(Q,"customerOrders",t),x=await Ie(h);if(!x.exists())return{success:!1,error:"Order not found"};const d=x.data(),f={ratedAt:le()};if(s!==void 0&&(f.storeRating=s,a&&(f.storeReview=a)),d.orderType==="delivery"&&n!==void 0&&(f.deliveryPersonRating=n,o&&(f.deliveryPersonReview=o),i&&(f.deliveryPersonName=i),c&&(f.deliveryPersonId=c)),await He(h,f),s!==void 0&&d.storeId){const b=be(Q,"stores",d.storeId,"reviews");await ct(b,{orderId:t,customerId:d.customerId,customerName:d.customerName,rating:s,review:a||"",createdAt:le(),orderDate:d.createdAt});const N=xe(Q,"stores",d.storeId),g=await Ie(N);if(g.exists()){const u=[...g.data().reviews||[],s],m=u.reduce((S,k)=>S+k,0)/u.length;await He(N,{rating:Math.round(m*10)/10,totalReviews:u.length,reviews:u.slice(-100)})}}return{success:!0}}catch(s){return console.error("Error rating order:",s),{success:!1,error:s.message}}},ss=(t,l="delivery")=>{const s=l==="pickup",a={pending:{label:"Order Placed",description:"Waiting for store to accept",color:"text-yellow-500",bgColor:"bg-yellow-500/20",icon:"ðŸ“",step:1},confirmed:{label:"Confirmed",description:"Store has accepted your order",color:"text-blue-500",bgColor:"bg-blue-500/20",icon:"âœ…",step:2},preparing:{label:"Preparing",description:"Your order is being packed",color:"text-orange-500",bgColor:"bg-orange-500/20",icon:"ðŸ“¦",step:3},ready:{label:s?"Ready for Pickup":"Ready",description:s?"Your order is ready to collect":"Your order is ready for delivery",color:"text-purple-500",bgColor:"bg-purple-500/20",icon:s?"ðŸª":"âœ¨",step:4},out_for_delivery:{label:"Out for Delivery",description:"Your order is on the way",color:"text-cyan-500",bgColor:"bg-cyan-500/20",icon:"ðŸšš",step:5},delivered:{label:s?"Picked Up":"Delivered",description:s?"Order picked up successfully":"Order delivered successfully",color:"text-green-500",bgColor:"bg-green-500/20",icon:"ðŸŽ‰",step:s?5:6},cancelled:{label:"Cancelled",description:"Order was cancelled",color:"text-red-500",bgColor:"bg-red-500/20",icon:"âŒ",step:0}};return a[t]||a.pending},va="AIzaSyBPkkXZWll0VifG5kb0DDSsoV5UB-n5pFE",Sa=["places"],ka={width:"100%",height:"200px",borderRadius:"12px"},Ca={disableDefaultUI:!0,zoomControl:!0,streetViewControl:!1,mapTypeControl:!1,fullscreenControl:!1},Ut=async(t="light")=>{try{const{Haptics:l,ImpactStyle:s,NotificationType:a}=await ds(async()=>{const{Haptics:n,ImpactStyle:o,NotificationType:i}=await import("./index-CjDO0J1E.js");return{Haptics:n,ImpactStyle:o,NotificationType:i}},__vite__mapDeps([0,1,2,3,4,5,6]));t==="success"?await l.notification({type:a.Success}):await l.impact({style:s.Light})}catch{}},Da=t=>{if(!t)return 0;const l=t.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);if(!l)return 0;let s=parseInt(l[1]);const a=parseInt(l[2]),n=l[3].toUpperCase();return n==="PM"&&s!==12&&(s+=12),n==="AM"&&s===12&&(s=0),s*60+a},Pa=(t,l=30)=>{if(!t?.time)return!1;const s=t.time.split(" - ");if(s.length!==2)return!0;const a=s[0].trim(),n=Da(a),o=new Date,i=o.getHours()*60+o.getMinutes();return n>i+l},Ze=(t,l,s=30)=>{if(!t||!Array.isArray(t))return[];const a=t.filter(i=>i.enabled),n=new Date;return l.toDateString()===n.toDateString()?a.filter(i=>Pa(i,s)):a},Be=t=>{const l=new Date,s=new Date(l);return s.setDate(s.getDate()+1),t.toDateString()===l.toDateString()?"Today":t.toDateString()===s.toDateString()?"Tomorrow":t.toLocaleDateString("en-IN",{weekday:"short",day:"numeric",month:"short"})},Bt=(t=7)=>{const l=[],s=new Date;for(let a=0;a<t;a++){const n=new Date(s);n.setDate(s.getDate()+a),l.push({date:n,label:Be(n),dayName:n.toLocaleDateString("en-IN",{weekday:"short"}),dayNum:n.getDate(),isToday:a===0,isTomorrow:a===1})}return l},Ht=({type:t,icon:l,label:s,description:a,isSelected:n,onSelect:o,disabled:i})=>e.jsx("button",{onClick:()=>!i&&o(t),disabled:i,className:`flex-1 p-4 rounded-xl border-2 transition-all ${i?"border-white/10 bg-white/5/50 opacity-50 cursor-not-allowed":n?"border-[#05E06C]500 bg-[#05E06C]/10":"border-white/10 bg-white/5/50 hover:border-white/10"}`,children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${n?"bg-[#05E06C]":"bg-slate-700"}`,children:e.jsx(l,{className:`text-xl ${n?"text-white":"text-white/60"}`})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:`font-semibold ${n?"text-[#05E06C]400":"text-white"}`,children:s}),e.jsx("p",{className:"text-xs text-white/40",children:a})]})]})}),Aa=({slot:t,isSelected:l,onSelect:s})=>e.jsxs("button",{onClick:()=>s(t),className:`flex-1 p-3 rounded-xl border-2 transition-all ${l?"border-[#05E06C]500 bg-[#05E06C]/10":"border-white/10 bg-white/5/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ie,{className:l?"text-[#05E06C]400":"text-white/40"}),e.jsx("span",{className:`font-medium ${l?"text-[#05E06C]400":"text-white"}`,children:t.label})]}),e.jsx("p",{className:"text-xs text-white/40",children:t.description})]}),Ea=({slot:t,isSelected:l,onSelect:s})=>e.jsxs("button",{onClick:()=>s(t),className:`w-full p-3 rounded-xl border-2 flex items-center justify-between transition-all ${l?"border-emerald-500 bg-emerald-500/10":"border-white/10 bg-white/5/50 hover:border-white/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${l?"bg-emerald-500":"bg-white/[0.06]"}`,children:e.jsx(ie,{className:l?"text-white text-sm":"text-white/40 text-sm"})}),e.jsx("span",{className:`font-medium ${l?"text-emerald-400":"text-white"}`,children:t.time})]}),l&&e.jsx(je,{className:"text-emerald-400"})]}),qt=({days:t,selectedDate:l,onSelect:s})=>e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 -mx-1 px-1 scrollbar-hide",children:t.map((a,n)=>e.jsx("button",{onClick:()=>s(a.date),className:`flex-shrink-0 w-16 py-2 px-1 rounded-xl border-2 transition-all ${l?.toDateString()===a.date.toDateString()?"border-emerald-500 bg-emerald-500/10":"border-white/10 bg-white/5/50 hover:border-white/20"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:`text-[10px] font-medium ${l?.toDateString()===a.date.toDateString()?"text-emerald-400":a.isToday?"text-amber-400":"text-white/50"}`,children:a.isToday?"Today":a.isTomorrow?"Tmrw":a.dayName}),e.jsx("p",{className:`text-lg font-bold ${l?.toDateString()===a.date.toDateString()?"text-emerald-400":"text-white"}`,children:a.dayNum})]})},n))}),Fa=({method:t,isSelected:l,onSelect:s,badge:a})=>{const o={COD:Ot,UPI:Rt,CARD:fe,PAY_LATER:ie,PARTIAL:Rt}[t.id]||Ot,c={emerald:{border:"border-[#05E06C]500",bg:"bg-[#05E06C]/10",icon:"bg-[#05E06C]",text:"text-[#05E06C]400",check:"text-[#05E06C]400"},amber:{border:"border-amber-500",bg:"bg-amber-500/10",icon:"bg-amber-500",text:"text-amber-400",check:"text-amber-400"},purple:{border:"border-purple-500",bg:"bg-purple-500/10",icon:"bg-purple-500",text:"text-purple-400",check:"text-purple-400"}}[t.color||"emerald"];return e.jsxs("button",{onClick:()=>s(t),className:`w-full p-4 rounded-xl border-2 flex items-center gap-3 transition-all ${l?`${c.border} ${c.bg}`:"border-white/10 bg-white/5/50"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${l?c.icon:"bg-slate-700"}`,children:e.jsx(o,{className:l?"text-white":"text-white/60"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:`font-medium ${l?c.text:"text-white"}`,children:t.label}),a&&e.jsx("span",{className:`px-2 py-0.5 text-[10px] font-bold rounded-full ${a.color}`,children:a.text})]}),e.jsx("p",{className:"text-xs text-white/40",children:t.description})]}),l&&e.jsx(je,{className:c.check})]})},Ra=({address:t,isSelected:l,onSelect:s})=>e.jsx("button",{onClick:()=>s(t),className:`w-full p-4 rounded-xl border-2 text-left transition-all ${l?"border-emerald-500 bg-emerald-500/10":"border-white/10 bg-white/5/50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${l?"bg-emerald-500":"bg-slate-700"}`,children:e.jsx(ee,{className:l?"text-white":"text-white/60"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-white",children:t.label}),t.latitude&&t.longitude&&e.jsx("span",{className:"px-1.5 py-0.5 bg-emerald-500/20 text-emerald-400 text-[9px] rounded font-medium",children:"ðŸ“ Pinned"})]}),e.jsx("p",{className:"text-sm text-white/60 mt-1 line-clamp-2",children:t.address})]}),l&&e.jsx(je,{className:"text-emerald-400 flex-shrink-0"})]})}),Oa=({onBack:t,onOrderPlaced:l})=>{const{cartItems:s,cartStore:a,getCartTotals:n,clearCart:o}=st(),{customer:i,customerData:c,addAddress:h}=_e(),x=n(),[d,f]=r.useState(null),[b,N]=r.useState(!0),[g,w]=r.useState("delivery"),[v,u]=r.useState(c?.addresses?.find(p=>p.isDefault)||c?.addresses?.[0]||null),[m,S]=r.useState("asap"),[k,A]=r.useState(!1),[C,R]=r.useState(new Date),[y,F]=r.useState(null),[L,G]=r.useState(null),[B,P]=r.useState(new Date),[I,z]=r.useState("COD"),J=Bt(7),$=Bt(7),[_,se]=r.useState(0),[he,Pe]=r.useState(""),[ne,we]=r.useState(!1),[ue,O]=r.useState(!c?.addresses?.length),[j,U]=r.useState({label:"Home",address:"",landmark:"",city:"",pincode:"",latitude:null,longitude:null}),q=r.useRef(null),X=r.useRef(null),[Pt,at]=r.useState({lat:20.5937,lng:78.9629}),[Ae,ye]=r.useState(null),[lt,Qe]=r.useState(!1),[mt,rt]=r.useState(!0),[Re,Ke]=r.useState(null),[Ne,ht]=r.useState(!0),it=(p,D,M,W)=>{const V=(M-p)*Math.PI/180,oe=(W-D)*Math.PI/180,pe=Math.sin(V/2)*Math.sin(V/2)+Math.cos(p*Math.PI/180)*Math.cos(M*Math.PI/180)*Math.sin(oe/2)*Math.sin(oe/2);return 6371*(2*Math.atan2(Math.sqrt(pe),Math.sqrt(1-pe)))},{isLoaded:ve,loadError:Ue}=Bs({id:"google-map-script",googleMapsApiKey:va,libraries:Sa}),nt=r.useCallback(p=>{q.current=p},[]),T=r.useCallback(p=>{X.current=p},[]),K=r.useCallback((p,D)=>{window.google&&window.google.maps&&new window.google.maps.Geocoder().geocode({location:{lat:p,lng:D}},(W,Z)=>{if(Z==="OK"&&W[0]){const V=W[0];let oe="",pe="";V.address_components.forEach(de=>{de.types.includes("locality")&&(oe=de.long_name),de.types.includes("postal_code")&&(pe=de.long_name),(de.types.includes("sublocality_level_1")||de.types.includes("sublocality"))&&de.long_name}),U(de=>({...de,address:V.formatted_address,city:oe||de.city,pincode:pe||de.pincode,latitude:p,longitude:D}))}})},[]),Se=r.useCallback(()=>{if(X.current){const p=X.current.getPlace();if(p.geometry){const D=p.geometry.location.lat(),M=p.geometry.location.lng();ye({lat:D,lng:M}),at({lat:D,lng:M}),q.current&&(q.current.panTo({lat:D,lng:M}),q.current.setZoom(16));let W="",Z="";p.address_components&&p.address_components.forEach(V=>{V.types.includes("locality")&&(W=V.long_name),V.types.includes("postal_code")&&(Z=V.long_name)}),U(V=>({...V,address:p.formatted_address||"",city:W||V.city,pincode:Z||V.pincode,latitude:D,longitude:M}))}}},[]),Je=r.useCallback(p=>{const D=p.latLng.lat(),M=p.latLng.lng();ye({lat:D,lng:M}),K(D,M)},[K]),At=r.useCallback(p=>{const D=p.latLng.lat(),M=p.latLng.lng();ye({lat:D,lng:M}),K(D,M)},[K]),Et=r.useCallback(()=>{if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}Qe(!0),navigator.geolocation.getCurrentPosition(p=>{const D=p.coords.latitude,M=p.coords.longitude;ye({lat:D,lng:M}),at({lat:D,lng:M}),q.current&&(q.current.panTo({lat:D,lng:M}),q.current.setZoom(16)),K(D,M),Qe(!1),Ut("success")},p=>{console.error("Error getting location:",p),alert("Could not get your location. Please search or tap on the map."),Qe(!1)},{enableHighAccuracy:!0,timeout:1e4})},[K]);r.useEffect(()=>{ue&&ve&&!Ae&&Et()},[ue,ve]),r.useEffect(()=>{if(v&&d){let p,D;d.location&&(p=d.location.latitude||d.location._lat,D=d.location.longitude||d.location._long);const M=v.latitude,W=v.longitude;if(p&&D&&M&&W){const Z=it(M,W,p,D),V=Math.round(Z*10)/10;Ke(V);const oe=d.deliveryRadius||10,pe=V<=oe;rt(pe),!pe&&d.pickupEnabled&&g==="delivery"&&w("pickup")}else rt(!0),Ke(null)}},[v,d,g]),r.useEffect(()=>{d&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(p=>{const D=p.coords.latitude,M=p.coords.longitude;let W,Z;if(d.location&&(W=d.location.latitude||d.location._lat,Z=d.location.longitude||d.location._long),W&&Z){const V=it(D,M,W,Z),oe=d.deliveryRadius||10,pe=V<=oe;ht(pe),Ke(Math.round(V*10)/10),!pe&&d.pickupEnabled&&w("pickup")}},p=>{console.log("Could not get location for range check:",p)},{enableHighAccuracy:!0,timeout:5e3})},[d]),r.useEffect(()=>{(async()=>{if(a?.id)try{const D=await ts(a.id);if(f(D),D?.pickupTimeSlots?.length>0){const M=new Date,W=Ze(D.pickupTimeSlots,M,30);if(W.length>0)G(W[0]);else{const Z=new Date(M);Z.setDate(Z.getDate()+1),P(Z);const V=Ze(D.pickupTimeSlots,Z,30);V.length>0&&G(V[0])}}}catch(D){console.error("Error fetching store settings:",D)}finally{N(!1)}})()},[a?.id]),r.useEffect(()=>{if(d?.pickupTimeSlots&&B){const p=Ze(d.pickupTimeSlots,B,30);p.length>0&&!p.find(D=>D.id===L?.id)?G(p[0]):p.length===0&&G(null)}},[B,d?.pickupTimeSlots]),r.useEffect(()=>{if(I==="PARTIAL"&&d?.minAdvancePercent){const p=Math.ceil(x.total*d.minAdvancePercent/100);se(p)}},[I,x.total,d?.minAdvancePercent]);const as=[{id:"asap",label:"ASAP",description:"Within 45-60 min"},{id:"2hr",label:"2 Hours",description:"Flexible delivery"}],ls=d?.deliveryTimeSlots||[{time:"9:00 AM - 12:00 PM",enabled:!0},{time:"12:00 PM - 3:00 PM",enabled:!0},{time:"3:00 PM - 6:00 PM",enabled:!0},{time:"6:00 PM - 9:00 PM",enabled:!0}],rs=(()=>{const p=[],D=d?.paymentOptions||{cod:!0,upi:!0};return D.cod!==!1&&p.push({id:"COD",label:"Cash on Delivery",description:"Pay when you receive",color:"emerald"}),D.upi!==!1&&p.push({id:"UPI",label:"UPI Payment",description:"GPay, PhonePe, Paytm",color:"emerald"}),D.payLater&&p.push({id:"PAY_LATER",label:"Pay Later",description:`Pay within ${d?.payLaterDays||7} days`,color:"amber",badge:{text:"CREDIT",color:"bg-amber-500/20 text-amber-400"}}),D.partialPayment&&p.push({id:"PARTIAL",label:"Pay Advance + Later",description:`Min ${d?.minAdvancePercent||50}% now, rest on delivery`,color:"purple",badge:{text:"SPLIT",color:"bg-purple-500/20 text-purple-400"}}),p})(),is=async()=>{if(!j.address||!j.city||!j.pincode){alert("Please fill all required fields");return}const p=`${j.address}${j.landmark?", "+j.landmark:""}, ${j.city} - ${j.pincode}`,D=await h({label:j.label||"Home",address:p,city:j.city,pincode:j.pincode,landmark:j.landmark,latitude:j.latitude,longitude:j.longitude,isDefault:!c?.addresses?.length});D.success&&(u(D.address),O(!1),ye(null),U({label:"Home",address:"",landmark:"",city:"",pincode:"",latitude:null,longitude:null}))},Y=(()=>{let p=g==="pickup"?0:x.deliveryFee;const{discountAmount:D,appliedOffer:M}=$s(x.subtotal,d?.storeOffers||[]);let Z=Math.max(0,x.subtotal-D)+p+x.platformFee,V=Z,oe=0;return I==="PAY_LATER"?(V=0,oe=Z):I==="PARTIAL"&&(V=_,oe=Z-_),{deliveryFee:p,finalTotal:Z,payNow:V,payLater:oe,discountAmount:D,appliedOffer:M}})(),ns=async()=>{if(g==="delivery"&&!v){alert("Please add a delivery address");return}if(g==="delivery"&&!mt&&Re!==null){alert(`Delivery is not available to your address. You are ${Re} km away, but the store only delivers within ${d?.deliveryRadius||10} km. Please choose Store Pickup instead.`);return}if(g==="pickup"&&!L){alert("Please select a pickup time slot");return}if(g==="delivery"&&k&&!y){alert("Please select a delivery time slot");return}we(!0);try{let p={isScheduledDelivery:!1,deliverySlot:null,deliveryDate:null,deliveryDateLabel:null};g==="delivery"&&(k&&y&&y.time?(p={isScheduledDelivery:!0,deliverySlot:y.time,deliveryDate:C.toISOString(),deliveryDateLabel:Be(C)},console.log("Scheduled delivery info:",p)):p={isScheduledDelivery:!1,deliverySlot:m,deliveryDate:null,deliveryDateLabel:null});const D={customerId:i.uid,customerName:c?.name||"Customer",customerPhone:i.phoneNumber||c?.phone||"",storeId:a.id,storeName:a.name||a.businessName||"Store",storePhone:d?.phone||"",items:s.map(W=>({productId:W.productId,name:W.name,price:W.price,quantity:W.quantity,total:W.price*W.quantity})),subtotal:x.subtotal,discountAmount:Y.discountAmount||0,appliedOffer:Y.appliedOffer||null,deliveryFee:Y.deliveryFee,platformFee:x.platformFee,total:Y.finalTotal,orderType:g,deliveryAddress:g==="delivery"?v:null,customerDistance:g==="delivery"&&Re?Re:null,isScheduledDelivery:p.isScheduledDelivery,deliverySlot:p.deliverySlot,deliveryDate:p.deliveryDate,deliveryDateLabel:p.deliveryDateLabel,pickupSlot:g==="pickup"?L:null,pickupDate:g==="pickup"?B.toISOString():null,pickupDateLabel:g==="pickup"?Be(B):null,pickupInstructions:g==="pickup"?d?.pickupInstructions:null,paymentMethod:I,payNow:Y.payNow,payLater:Y.payLater,paymentDueDate:I==="PAY_LATER"?new Date(Date.now()+(d?.payLaterDays||7)*24*60*60*1e3).toISOString():null,specialInstructions:he},M=await wa(D);M.success?(await Ut("success"),o(),l?.(M.orderId,M.orderNumber)):alert(M.error||"Failed to place order")}catch(p){console.error("Order error:",p),alert("Something went wrong. Please try again.")}finally{we(!1)}};if(b)return e.jsx("div",{className:"min-h-screen bg-transparent flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-[#05E06C]500 border-t-transparent rounded-full animate-spin"})});const ut=d?.pickupEnabled&&d?.pickupTimeSlots?.some(p=>p.enabled);return e.jsxs("div",{className:"bg-transparent",children:[e.jsx("div",{className:"bg-gradient-to-r from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-xl sticky top-0 z-10 border-b border-white/10",children:e.jsxs("div",{className:"px-4 py-3 flex items-center gap-3",style:{paddingTop:"calc(env(safe-area-inset-top) + 12px)"},children:[e.jsx("button",{onClick:t,className:"w-10 h-10 rounded-full bg-white/5 border border-white/10 flex items-center justify-center",children:e.jsx(ge,{className:"text-white/60"})}),e.jsx("h1",{className:"font-bold text-white text-lg",children:"Checkout"})]})}),e.jsxs("div",{className:"px-4 py-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"How would you like to receive?"}),!Ne&&ut&&e.jsxs("div",{className:"mb-4 p-3 bg-amber-500/10 border border-amber-500/30 rounded-xl flex items-start gap-2",children:[e.jsx(ee,{className:"text-amber-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-400 text-xs font-semibold",children:"Store Pickup Only"}),e.jsxs("p",{className:"text-amber-400/70 text-[11px] mt-0.5",children:["You are ",Re," km away from this store. Delivery is only available within ",d?.deliveryRadius||10," km. Please pick up your order from the store."]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[Ne&&e.jsx(Ht,{type:"delivery",icon:Fe,label:"Delivery",description:"To your address",isSelected:g==="delivery",onSelect:w}),e.jsx(Ht,{type:"pickup",icon:qe,label:Ne?"Pickup":"Store Pickup",description:Ne?"From store":"Only option available",isSelected:g==="pickup",onSelect:w,disabled:!ut}),!Ne&&e.jsx("div",{className:"flex-1 p-4 rounded-xl border-2 border-white/5 bg-white/5/30 opacity-50 cursor-not-allowed",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-slate-700/50",children:e.jsx(Fe,{className:"text-xl text-white/30"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-white/40",children:"Delivery"}),e.jsx("p",{className:"text-xs text-red-400/60",children:"Out of range"})]})]})})]}),!ut&&Ne&&e.jsxs("p",{className:"text-xs text-white/40 mt-2 flex items-center gap-1",children:[e.jsx(Le,{}),"Pickup not available for this store"]})]}),e.jsx(me,{children:g==="delivery"&&Ne&&e.jsxs(E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Delivery Address"}),ue?e.jsxs("div",{className:"bg-white/5/50 backdrop-blur-xl rounded-2xl p-5 border border-white/10",children:[e.jsxs("h4",{className:"font-medium text-white mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"text-emerald-400"}),"Add Delivery Address"]}),e.jsxs("div",{className:"mb-4",children:[ve&&e.jsx("div",{className:"mb-3",children:e.jsx(Hs,{onLoad:T,onPlaceChanged:Se,restrictions:{country:"in"},children:e.jsxs("div",{className:"relative",children:[e.jsx(ks,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-emerald-400"}),e.jsx("input",{type:"text",placeholder:"Search your location...",className:"w-full pl-10 pr-4 py-3 bg-slate-700 border border-white/10 rounded-xl text-sm text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]})})}),e.jsxs("div",{className:"relative rounded-xl overflow-hidden border border-white/10",children:[Ue&&e.jsx("div",{className:"h-[200px] flex items-center justify-center bg-red-500/10 text-red-400 text-sm",children:e.jsx("p",{children:"Error loading map"})}),!ve&&!Ue&&e.jsx("div",{className:"h-[200px] flex items-center justify-center bg-slate-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-white/60 text-xs",children:"Loading map..."})]})}),ve&&!Ue&&e.jsx(qs,{mapContainerStyle:ka,center:Pt,zoom:Ae?16:5,options:Ca,onLoad:nt,onClick:Je,children:Ae&&e.jsx(zs,{position:Ae,draggable:!0,onDragEnd:At,icon:{url:"https://maps.google.com/mapfiles/ms/icons/red-dot.png",scaledSize:new window.google.maps.Size(40,40)}})}),ve&&e.jsx("div",{className:"absolute bottom-2 left-2 right-2 flex justify-between items-center",children:e.jsx("span",{className:"px-2 py-1 bg-black/70 text-white text-[10px] rounded",children:Ae?"Drag pin to adjust":"Tap to place pin"})})]}),e.jsx("button",{onClick:Et,disabled:lt||!ve,className:"w-full mt-3 py-2.5 bg-emerald-500/20 border border-emerald-500/30 rounded-xl text-emerald-400 text-sm font-medium flex items-center justify-center gap-2 disabled:opacity-50",children:lt?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-emerald-400 border-t-transparent rounded-full animate-spin"}),"Getting location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Cs,{}),"Use Current Location"]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-2",children:"Save as"}),e.jsx("div",{className:"flex gap-2",children:["Home","Office","Other"].map(p=>e.jsx("button",{onClick:()=>U({...j,label:p}),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${j.label===p?"bg-emerald-500 text-slate-900":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:p},p))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Full Address *"}),e.jsx("textarea",{rows:2,placeholder:"House/Flat No., Building, Street",value:j.address,onChange:p=>U({...j,address:p.target.value}),className:"w-full px-4 py-3 bg-slate-700 border border-white/10 rounded-xl text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Landmark (Optional)"}),e.jsx("input",{type:"text",placeholder:"Near temple, opposite park, etc.",value:j.landmark,onChange:p=>U({...j,landmark:p.target.value}),className:"w-full px-4 py-3 bg-slate-700 border border-white/10 rounded-xl text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"City *"}),e.jsx("input",{type:"text",placeholder:"City",value:j.city,onChange:p=>U({...j,city:p.target.value}),className:"w-full px-4 py-3 bg-slate-700 border border-white/10 rounded-xl text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Pincode *"}),e.jsx("input",{type:"text",placeholder:"Pincode",value:j.pincode,onChange:p=>U({...j,pincode:p.target.value.replace(/\D/g,"").slice(0,6)}),className:"w-full px-4 py-3 bg-slate-700 border border-white/10 rounded-xl text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]})]})]}),j.latitude&&j.longitude&&e.jsxs("div",{className:"mt-3 px-3 py-2 bg-emerald-500/10 border border-emerald-500/20 rounded-lg flex items-center gap-2",children:[e.jsx(ee,{className:"text-emerald-400 text-xs"}),e.jsxs("span",{className:"text-xs text-emerald-400",children:["Location pinned â€¢ Lat: ",j.latitude.toFixed(4),", Lng: ",j.longitude.toFixed(4)]})]}),e.jsxs("div",{className:"flex gap-3 mt-5",children:[c?.addresses?.length>0&&e.jsx("button",{onClick:()=>{O(!1),ye(null),U({label:"Home",address:"",landmark:"",city:"",pincode:"",latitude:null,longitude:null})},className:"flex-1 py-3 border border-white/10 rounded-xl text-white/60 font-medium",children:"Cancel"}),e.jsx("button",{onClick:is,disabled:!j.address||!j.city||!j.pincode,className:"flex-1 py-3 bg-emerald-500 text-slate-900 rounded-xl font-medium hover:bg-emerald-400 transition disabled:bg-slate-700 disabled:text-white/40",children:"Save Address"})]})]}):e.jsxs("div",{className:"space-y-3",children:[c?.addresses?.map(p=>e.jsx(Ra,{address:p,isSelected:v?.id===p.id,onSelect:u},p.id)),e.jsxs("button",{onClick:()=>O(!0),className:"w-full p-4 rounded-xl border-2 border-dashed border-[#05E06C]500/30 bg-[#05E06C]/5 flex items-center justify-center gap-2 text-[#05E06C]400 font-medium",children:[e.jsx(Me,{className:"text-sm"}),"Add New Address"]})]})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:g==="delivery"?"Delivery Time":"Pickup Time"}),g==="delivery"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{A(!1),S("asap")},className:`flex-1 p-3 rounded-xl border-2 transition-all ${k?"border-white/10 bg-white/5/50":"border-emerald-500 bg-emerald-500/10"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Fe,{className:k?"text-white/40":"text-emerald-400"}),e.jsx("span",{className:`font-medium ${k?"text-white":"text-emerald-400"}`,children:"Quick Delivery"})]})}),e.jsx("button",{onClick:()=>{A(!0),S("scheduled")},className:`flex-1 p-3 rounded-xl border-2 transition-all ${k?"border-emerald-500 bg-emerald-500/10":"border-white/10 bg-white/5/50"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(ie,{className:k?"text-emerald-400":"text-white/40"}),e.jsx("span",{className:`font-medium ${k?"text-emerald-400":"text-white"}`,children:"Schedule"})]})})]}),!k&&e.jsx("div",{className:"flex gap-2",children:as.map(p=>e.jsx(Aa,{slot:p,isSelected:m===p.id,onSelect:()=>S(p.id)},p.id))}),k&&e.jsxs("div",{className:"space-y-4 p-4 bg-white/5/50 rounded-xl border border-white/10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/50 mb-2",children:"Select Delivery Date"}),e.jsx(qt,{days:J,selectedDate:C,onSelect:R})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-white/50 mb-2",children:["Delivery Slots for ",Be(C)]}),e.jsx("div",{className:"space-y-2",children:(()=>{const p=Ze(ls,C,60);return p.length===0?e.jsxs("div",{className:"p-4 bg-amber-500/10 border border-amber-500/20 rounded-xl text-sm text-amber-400 flex items-center gap-2",children:[e.jsx(Le,{}),e.jsx("span",{children:C.toDateString()===new Date().toDateString()?"No more slots available today. Please select another date.":"No delivery slots available for this date."})]}):p.map((D,M)=>e.jsxs("button",{onClick:()=>F(D),className:`w-full p-3 rounded-xl border-2 flex items-center justify-between transition-all ${y?.time===D.time?"border-emerald-500 bg-emerald-500/10":"border-white/10 bg-white/5/50 hover:border-white/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${y?.time===D.time?"bg-emerald-500":"bg-white/[0.06]"}`,children:e.jsx(ie,{className:y?.time===D.time?"text-white text-sm":"text-white/40 text-sm"})}),e.jsx("span",{className:`font-medium ${y?.time===D.time?"text-emerald-400":"text-white"}`,children:D.time})]}),y?.time===D.time&&e.jsx(je,{className:"text-emerald-400"})]},M))})()})]}),y&&e.jsx("div",{className:"p-3 bg-emerald-500/10 border border-emerald-500/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-emerald-400 text-sm",children:[e.jsx(je,{className:"text-xs"}),e.jsxs("span",{children:["Scheduled for ",e.jsx("strong",{children:Be(C)})," at ",e.jsx("strong",{children:y.time})]})]})})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/50 mb-2",children:"Select Date"}),e.jsx(qt,{days:$,selectedDate:B,onSelect:P})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-white/50 mb-2",children:["Available Slots for ",Be(B)]}),e.jsx("div",{className:"space-y-2",children:(()=>{const p=Ze(d?.pickupTimeSlots,B,30);return p.length===0?e.jsxs("div",{className:"p-4 bg-amber-500/10 border border-amber-500/20 rounded-xl text-sm text-amber-400 flex items-center gap-2",children:[e.jsx(Le,{}),e.jsx("span",{children:B.toDateString()===new Date().toDateString()?"No more slots available today. Please select tomorrow or another date.":"No pickup slots available for this date."})]}):p.map(D=>e.jsx(Ea,{slot:D,isSelected:L?.id===D.id,onSelect:()=>G(D)},D.id))})()})]}),d?.pickupInstructions&&e.jsxs("div",{className:"p-3 bg-blue-500/10 border border-blue-500/20 rounded-xl text-sm text-blue-400 flex items-start gap-2",children:[e.jsx(Le,{className:"mt-0.5 flex-shrink-0"}),e.jsx("span",{children:d.pickupInstructions})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Payment Method"}),e.jsx("div",{className:"space-y-2",children:rs.map(p=>e.jsx(Fa,{method:p,isSelected:I===p.id,onSelect:()=>z(p.id),badge:p.badge},p.id))}),I==="PARTIAL"&&e.jsxs(E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mt-3 p-4 bg-purple-500/10 border border-purple-500/20 rounded-xl",children:[e.jsxs("label",{className:"block text-sm font-medium text-purple-400 mb-2",children:["Advance Amount (Min: â‚¹",Math.ceil(Y.finalTotal*(d?.minAdvancePercent||50)/100),")"]}),e.jsx("input",{type:"number",value:_,onChange:p=>{const D=Math.ceil(Y.finalTotal*(d?.minAdvancePercent||50)/100),M=Math.max(D,Math.min(Y.finalTotal,parseInt(p.target.value)||0));se(M)},className:"w-full px-4 py-3 bg-white/5 border border-purple-500/30 rounded-xl text-lg font-bold text-white focus:outline-none focus:ring-2 focus:ring-purple-500"}),e.jsxs("p",{className:"text-xs text-purple-400 mt-2",children:["Remaining â‚¹",Y.finalTotal-_," to be paid on ",g==="delivery"?"delivery":"pickup"]})]}),I==="PAY_LATER"&&e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-3 p-4 bg-amber-500/10 border border-amber-500/20 rounded-xl",children:e.jsxs("p",{className:"text-sm text-amber-400",children:[e.jsx("strong",{children:"Pay Later:"})," Full payment of â‚¹",Y.finalTotal.toFixed(2)," due within ",d?.payLaterDays||7," days"]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Special Instructions (Optional)"}),e.jsx("textarea",{placeholder:"Any special requests...",value:he,onChange:p=>Pe(p.target.value),rows:2,className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-sm text-white placeholder-slate-500 resize-none focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),d?.storeOffers?.length>0&&d.storeOffers.some(p=>p.enabled)&&e.jsxs("div",{className:"rounded-xl border border-amber-500/30 bg-amber-500/10 p-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-amber-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(dt,{className:"text-amber-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-300 text-sm",children:"Store offers applied at checkout"}),e.jsx("p",{className:"text-white/50 text-xs mt-0.5",children:d.storeOffers.filter(p=>p.enabled).map(p=>p.type==="percent_all"?`${p.value}% off on all orders`:p.type==="percent_above"?`${p.value}% off on orders above â‚¹${p.minOrderValue||0}`:null).filter(Boolean).join(" â€¢ ")})]})]}),e.jsxs("div",{className:"bg-white/5/50 backdrop-blur-xl rounded-2xl border border-white/10 p-5",children:[e.jsx("h3",{className:"font-semibold text-white mb-4",children:"Order Summary"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-white/60",children:["Items (",x.itemCount,")"]}),e.jsxs("span",{className:"font-medium text-white",children:["â‚¹",x.subtotal.toFixed(2)]})]}),Y.discountAmount>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-amber-400",children:Y.appliedOffer?.type==="percent_all"?`${Y.appliedOffer?.value}% off on all orders`:Y.appliedOffer?.type==="percent_above"?`${Y.appliedOffer?.value}% off (orders above â‚¹${Y.appliedOffer?.minOrderValue||0})`:"Store offer"}),e.jsxs("span",{className:"font-medium text-amber-400",children:["-â‚¹",Y.discountAmount.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:g==="delivery"?"Delivery Fee":"Pickup"}),e.jsx("span",{className:`font-medium ${Y.deliveryFee===0?"text-emerald-400":"text-white"}`,children:Y.deliveryFee===0?"FREE":`â‚¹${Y.deliveryFee}`})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"Platform Fee"}),e.jsxs("span",{className:"font-medium text-white",children:["â‚¹",x.platformFee]})]}),e.jsxs("div",{className:"border-t border-white/10 pt-3 mt-3",children:[e.jsxs("div",{className:"flex justify-between font-bold text-base",children:[e.jsx("span",{className:"text-white",children:"Total"}),e.jsxs("span",{className:"text-emerald-400",children:["â‚¹",Y.finalTotal.toFixed(2)]})]}),(I==="PARTIAL"||I==="PAY_LATER")&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-white/60",children:"Pay Now"}),e.jsxs("span",{className:"font-semibold text-emerald-400",children:["â‚¹",Y.payNow.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-white/60",children:"Pay Later"}),e.jsxs("span",{className:"font-semibold text-amber-400",children:["â‚¹",Y.payLater.toFixed(2)]})]})]})]})]})]}),e.jsx("button",{onClick:ns,disabled:ne||g==="delivery"&&!v||g==="delivery"&&k&&!y||g==="pickup"&&!L,className:`w-full py-4 rounded-xl font-semibold text-lg flex items-center justify-center gap-2 transition-all ${ne||g==="delivery"&&!v||g==="delivery"&&k&&!y||g==="pickup"&&!L?"bg-white/5 text-white/40 cursor-not-allowed":"bg-emerald-500 text-slate-900 hover:bg-emerald-400 transition"}`,children:ne?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Placing Order..."]}):e.jsxs(e.Fragment,{children:["Place Order â€¢ â‚¹",Y.payNow>0?Y.payNow.toFixed(2):Y.finalTotal.toFixed(2),Y.payLater>0&&e.jsxs("span",{className:"text-white/70 text-sm ml-1",children:["(+â‚¹",Y.payLater.toFixed(2)," later)"]})]})})]}),e.jsx("div",{className:"h-24"})]})},La=({order:t,onClose:l})=>{const{customer:s,customerData:a}=_e(),[n,o]=r.useState([]),[i,c]=r.useState(""),[h,x]=r.useState(!1),d=r.useRef(null),f=r.useRef(null),b=()=>{d.current?.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{b()},[n]),r.useEffect(()=>{if(!t?.id)return;const u=be(Q,"orderChats",t.id,"messages"),m=Nt(u,us("createdAt","asc")),S=Wt(m,k=>{const A=k.docs.map(C=>({id:C.id,...C.data(),createdAt:C.data().createdAt?.toDate()||new Date}));o(A)},k=>{console.error("Error fetching chat:",k)});return()=>S()},[t?.id]);const N=async()=>{if(!i.trim()||h)return;const u=i.trim();c(""),x(!0);try{const m=be(Q,"orderChats",t.id,"messages");await ct(m,{text:u,senderId:s?.uid||"customer",senderName:a?.name||"Customer",senderType:"customer",createdAt:le(),read:!1});const S=xe(Q,"orderChats",t.id);await He(S,{lastMessage:u,lastMessageAt:le(),lastMessageBy:"customer"}).catch(()=>{})}catch(m){console.error("Error sending message:",m),c(u)}finally{x(!1),f.current?.focus()}},g=u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),N())},w=u=>u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),v=["Where are you?","How long?","I'm outside","Call me","Wait please"];return e.jsxs(E.div,{initial:{opacity:0,y:"100%"},animate:{opacity:1,y:0},exit:{opacity:0,y:"100%"},transition:{type:"spring",damping:25,stiffness:300},className:"fixed inset-0 bg-slate-900 z-50 flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#05E06C] to-[#04B857] text-white px-4 py-4",style:{paddingTop:"calc(env(safe-area-inset-top) + 16px)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:l,className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 transition-all",children:e.jsx(ge,{})}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-full bg-white/20 flex items-center justify-center text-lg",children:e.jsx(Ee,{})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-base",children:t.deliveryAgent?.name||t.deliveryPartner||"Delivery Partner"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-300 animate-pulse"}),e.jsx("p",{className:"text-xs text-white/80",children:t.status==="out_for_delivery"?"On the way":"Delivery Agent"})]})]})]}),(t.deliveryAgent?.phone||t.deliveryPartnerPhone)&&e.jsx("a",{href:`tel:${t.deliveryAgent?.phone||t.deliveryPartnerPhone}`,className:"w-11 h-11 rounded-full bg-white flex items-center justify-center text-emerald-600 shadow-lg hover:scale-105 transition-all",children:e.jsx(ze,{})})]}),t.deliveryAgent?.vehicleNumber&&e.jsxs("div",{className:"mt-3 inline-flex items-center gap-2 bg-white/20 rounded-full px-3 py-1.5 text-xs",children:[e.jsx(Ee,{className:"text-white/70"}),e.jsx("span",{children:t.deliveryAgent.vehicleNumber}),e.jsx("span",{className:"text-white/50",children:"â€¢"}),e.jsxs("span",{className:"text-white/70",children:["Order #",t.orderNumber?.slice(-6)||t.id?.slice(-6)]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 bg-[#0A1340]",children:n.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center px-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-emerald-500/10 border border-[#05E06C]/20 flex items-center justify-center mb-4",children:e.jsx(Ee,{className:"text-3xl text-emerald-400"})}),e.jsx("h3",{className:"font-semibold text-white text-lg mb-2",children:"Chat with your delivery agent"}),e.jsx("p",{className:"text-sm text-white/40 max-w-xs leading-relaxed",children:"Coordinate delivery or share your location details"})]}):e.jsxs("div",{className:"space-y-4",children:[n.map(u=>{const m=u.senderType==="customer";return e.jsx(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${m?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-2xl px-4 py-3 ${m?"bg-gradient-to-br from-[#05E06C] to-[#04B857] text-white rounded-tr-sm shadow-lg shadow-[#05E06C]/20":"bg-[#101B4A] border border-white/10 text-white rounded-tl-sm"}`,children:[!m&&e.jsx("p",{className:"text-xs font-medium text-emerald-400 mb-1",children:u.senderName}),e.jsx("p",{className:"text-sm leading-relaxed",children:u.text}),e.jsxs("div",{className:`flex items-center justify-end gap-1.5 mt-2 ${m?"text-white/70":"text-white/40"}`,children:[e.jsx("span",{className:"text-[10px]",children:w(u.createdAt)}),m&&(u.read?e.jsx(Ds,{className:"text-[10px]"}):e.jsx(je,{className:"text-[10px]"}))]})]})},u.id)}),e.jsx("div",{ref:d})]})}),e.jsx("div",{className:"px-4 py-2 bg-slate-900 border-t border-white/5",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 scrollbar-hide",children:v.map((u,m)=>e.jsx("button",{onClick:()=>c(u),className:"px-4 py-2 bg-[#101B4A] hover:bg-emerald-500/10 border border-white/10 hover:border-[#05E06C]/30 rounded-full text-sm text-white/70 hover:text-emerald-400 whitespace-nowrap transition-all",children:u},m))})}),e.jsx("div",{className:"bg-slate-900 border-t border-white/5 px-4 py-3",style:{paddingBottom:"calc(env(safe-area-inset-bottom) + 12px)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{ref:f,type:"text",value:i,onChange:u=>c(u.target.value),onKeyPress:g,placeholder:"Type a message...",className:"flex-1 px-5 py-3.5 bg-[#101B4A] rounded-full text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-emerald-500 border border-white/10 focus:border-[#05E06C]/50 transition-all text-sm"}),e.jsx("button",{onClick:N,disabled:!i.trim()||h,className:`w-12 h-12 rounded-full flex items-center justify-center transition-all ${i.trim()?"bg-gradient-to-br from-[#05E06C] to-[#04B857] text-white shadow-lg shadow-[#05E06C]/30 hover:shadow-[#05E06C]/50 hover:scale-105":"bg-[#101B4A] text-white/30 border border-white/10"}`,children:e.jsx(Ps,{className:`text-sm ${h?"animate-pulse":""}`})})]})})]})},Ta=()=>`TKT${Date.now().toString(36).toUpperCase().slice(-8)}`,Ia=async t=>{try{const l=Ta(),s={ticketNumber:l,customerId:t.customerId,customerName:t.customerName,customerPhone:t.customerPhone,orderId:t.orderId||null,orderNumber:t.orderNumber||null,storeId:t.storeId||null,storeName:t.storeName||null,category:t.category,issueType:t.issueType,subject:t.subject||null,description:t.description,selectedItems:t.selectedItems&&t.selectedItems.length>0?t.selectedItems:null,status:"open",statusHistory:{open:le()},createdAt:le(),updatedAt:le()};return{success:!0,ticketId:(await ct(be(Q,"customerSupport"),s)).id,ticketNumber:l}}catch(l){return console.error("Error submitting support ticket:",l),{success:!1,error:l.message}}},Ma=[{id:"order",label:"Order related",icon:Ve,desc:"Query, return, refund, delivery"},{id:"payment",label:"Payment",icon:fe,desc:"Billing, Pay Later, refunds"},{id:"account",label:"Account",icon:vt,desc:"Profile, addresses, settings"},{id:"other",label:"Other",icon:$e,desc:"General help"}],$a=[{id:"query",label:"Query / Question",icon:$e},{id:"return_request",label:"Return request",icon:ot},{id:"refund",label:"Refund request",icon:fe},{id:"wrong_missing_item",label:"Wrong or missing item",icon:Ge},{id:"delivery_issue",label:"Delivery issue",icon:Fe},{id:"other",label:"Other",icon:kt}],_a=[{id:"query",label:"Query / Question",icon:$e},{id:"cancel_request",label:"Cancel order request",icon:De},{id:"delivery_issue",label:"Delivery issue",icon:Fe},{id:"other",label:"Other",icon:kt}],Ua=[{id:"query",label:"Query / Question",icon:$e},{id:"other",label:"Other",icon:kt}],H={CATEGORY:0,ORDER:1,ISSUE:2,PRODUCTS:3,FORM:4,SUCCESS:5},zt=["return_request","wrong_missing_item","refund"],Dt=({isOpen:t,onClose:l,preSelectedOrder:s=null})=>{const{customer:a,customerData:n}=_e(),[o,i]=r.useState(H.CATEGORY),[c,h]=r.useState(null),[x,d]=r.useState(s),[f,b]=r.useState([]),[N,g]=r.useState(!1),[w,v]=r.useState(null),[u,m]=r.useState([]),[S,k]=r.useState(""),[A,C]=r.useState(""),[R,y]=r.useState(!1),[F,L]=r.useState(null),[G,B]=r.useState(""),P=c==="order",I=x?.status==="delivered",z=x?.status==="pending",J=P?I?$a:_a:Ua,$=P&&!I?J.filter(j=>j.id!=="cancel_request"||z):J,_=P&&I&&x?.items?.length>0&&zt.includes(w);r.useEffect(()=>{!t||!a?.uid||c!=="order"||s||(g(!0),Ct(a.uid,30).then(j=>b(j)).catch(j=>{console.error(j),b([])}).finally(()=>g(!1)))},[t,a?.uid,c,s]),r.useEffect(()=>{t?d(s||null):(i(H.CATEGORY),h(null),d(s||null),v(null),m([]),k(""),C(""),L(null),B(""))},[t,s]);const se=()=>{B(""),o===H.ORDER?i(H.CATEGORY):o===H.ISSUE?i(P?H.ORDER:H.CATEGORY):o===H.PRODUCTS?i(H.ISSUE):o===H.FORM?i(_?H.PRODUCTS:H.ISSUE):i(Math.max(0,o-1))},he=j=>{h(j),j==="order"&&!s?i(H.ORDER):(j==="order"&&s&&d(s),i(H.ISSUE))},Pe=j=>{d(j),i(H.ISSUE)},ne=j=>{v(j);const U=P&&x?.items?.length>0&&zt.includes(j);i(U?H.PRODUCTS:H.FORM)},we=j=>{m(U=>U.includes(j)?U.filter(q=>q!==j):[...U,j].sort((q,X)=>q-X))},ue=()=>{i(H.FORM)},O=async()=>{const j=A.trim();if(!j){B("Please describe your issue.");return}y(!0),B("");const U=u.length>0&&x?.items?u.map(q=>{const X=x.items[q];return{index:q,productId:X.productId||X.id||`item-${q}`,name:X.name||"Item",quantity:X.quantity??1,price:X.price}}):null;try{const q=await Ia({customerId:a?.uid||"guest",customerName:n?.name||"Customer",customerPhone:n?.phone||"",orderId:x?.id||null,orderNumber:x?.orderNumber||null,storeId:x?.storeId||null,storeName:x?.storeName||null,category:c||"other",issueType:w||"other",subject:S.trim()||null,description:j,selectedItems:U});q.success?(L({ticketId:q.ticketId,ticketNumber:q.ticketNumber}),i(H.SUCCESS)):B(q.error||"Something went wrong. Please try again.")}catch(q){B(q?.message||"Failed to submit. Please try again.")}finally{y(!1)}};return t?e.jsxs(me,{children:[e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:l,className:"fixed inset-0 z-[200] bg-black/70 backdrop-blur-sm",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"}}),e.jsxs(E.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-[201] bg-[#0f172a] rounded-t-3xl border-t border-white/10 shadow-2xl max-h-[90vh] overflow-hidden flex flex-col",onClick:j=>j.stopPropagation(),children:[e.jsx("div",{className:"flex justify-center py-3",children:e.jsx("div",{className:"w-12 h-1.5 bg-white/20 rounded-full"})}),e.jsxs("div",{className:"px-5 pb-3 flex items-center justify-between border-b border-white/10",children:[e.jsx("button",{type:"button",onClick:o===H.CATEGORY?l:se,className:"w-10 h-10 rounded-full bg-white/10 flex items-center justify-center",children:o===H.CATEGORY?e.jsx(De,{className:"text-white/70"}):e.jsx(ge,{className:"text-white/70"})}),e.jsxs("h2",{className:"font-bold text-white text-lg",children:[o===H.CATEGORY&&"Get Help",o===H.ORDER&&"Select Order",o===H.ISSUE&&"Whatâ€™s the issue?",o===H.PRODUCTS&&"Select products",o===H.FORM&&"Describe your issue",o===H.SUCCESS&&"Submitted"]}),e.jsx("div",{className:"w-10"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-5 py-4",children:e.jsxs(me,{mode:"wait",children:[o===H.CATEGORY&&e.jsxs(E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-3",children:[e.jsx("p",{className:"text-white/60 text-sm mb-4",children:"What do you need help with?"}),Ma.map(j=>e.jsxs("button",{type:"button",onClick:()=>he(j.id),className:"w-full flex items-center gap-4 p-4 rounded-2xl bg-white/5 border border-white/10 hover:border-emerald-500/40 hover:bg-emerald-500/5 transition-all text-left",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center",children:e.jsx(j.icon,{className:"text-emerald-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-white",children:j.label}),e.jsx("p",{className:"text-xs text-white/50",children:j.desc})]}),e.jsx(re,{className:"text-white/40 flex-shrink-0"})]},j.id))]},"category"),o===H.ORDER&&e.jsxs(E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-3",children:[e.jsx("p",{className:"text-white/60 text-sm mb-4",children:"Which order is this about?"}),N?e.jsxs("div",{className:"py-12 flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 border-2 border-emerald-500/30 border-t-emerald-500 rounded-full animate-spin"}),e.jsx("p",{className:"text-white/50 text-sm",children:"Loading ordersâ€¦"})]}):f.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(Ve,{className:"text-white/20 text-4xl mx-auto mb-3"}),e.jsx("p",{className:"text-white/60",children:"No orders found."}),e.jsx("p",{className:"text-white/40 text-sm mt-1",children:"You can still submit a general query."}),e.jsx("button",{type:"button",onClick:()=>{d(null),i(H.ISSUE)},className:"mt-4 px-6 py-2.5 rounded-xl bg-emerald-500/20 text-emerald-400 border border-emerald-500/40 font-medium",children:"Continue without order"})]}):f.map(j=>e.jsxs("button",{type:"button",onClick:()=>Pe(j),className:"w-full flex items-center gap-4 p-4 rounded-2xl bg-white/5 border border-white/10 hover:border-emerald-500/40 transition-all text-left",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/10 flex items-center justify-center",children:e.jsx(te,{className:"text-white/40"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-white truncate",children:j.storeName}),e.jsxs("p",{className:"text-xs text-white/50",children:["#",j.orderNumber?.slice(-8)," â€¢ â‚¹",j.total]})]}),e.jsx(re,{className:"text-white/40 flex-shrink-0"})]},j.id))]},"order"),o===H.ISSUE&&e.jsxs(E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-3",children:[x&&e.jsxs("div",{className:"mb-4 p-3 rounded-xl bg-emerald-500/10 border border-emerald-500/20 flex items-center gap-3",children:[e.jsx(te,{className:"text-emerald-400"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-white truncate",children:x.storeName}),e.jsxs("p",{className:"text-xs text-white/50",children:["#",x.orderNumber?.slice(-8)]})]})]}),e.jsx("p",{className:"text-white/60 text-sm mb-4",children:"Whatâ€™s the issue?"}),$.map(j=>e.jsxs("button",{type:"button",onClick:()=>ne(j.id),className:"w-full flex items-center gap-4 p-4 rounded-2xl bg-white/5 border border-white/10 hover:border-emerald-500/40 transition-all text-left",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center",children:e.jsx(j.icon,{className:"text-emerald-400 text-sm"})}),e.jsx("p",{className:"font-medium text-white flex-1",children:j.label}),e.jsx(re,{className:"text-white/40 flex-shrink-0"})]},j.id))]},"issue"),o===H.PRODUCTS&&x?.items?.length>0&&e.jsxs(E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-3",children:[e.jsx("p",{className:"text-white/60 text-sm mb-4",children:"Select the product(s) this is about. You can also continue without selecting."}),e.jsx("div",{className:"space-y-2",children:x.items.map((j,U)=>{const q=u.includes(U);return e.jsxs("button",{type:"button",onClick:()=>we(U),className:`w-full flex items-center gap-4 p-4 rounded-2xl border transition-all text-left ${q?"bg-emerald-500/15 border-emerald-500/40":"bg-white/5 border-white/10 hover:border-emerald-500/30"}`,children:[e.jsx("div",{className:`w-6 h-6 rounded-lg flex items-center justify-center flex-shrink-0 border-2 ${q?"bg-emerald-500 border-emerald-500":"border-white/30"}`,children:q&&e.jsx(je,{className:"text-white text-xs"})}),e.jsx("div",{className:"w-11 h-11 rounded-xl bg-white/10 flex items-center justify-center overflow-hidden flex-shrink-0",children:j.image?e.jsx("img",{src:j.image,alt:j.name,className:"w-full h-full object-contain"}):e.jsx(Ve,{className:"text-white/40"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-white truncate",children:j.name}),e.jsxs("p",{className:"text-xs text-white/50",children:["Qty: ",j.quantity," Ã— â‚¹",j.price??0]})]}),q&&e.jsx("span",{className:"text-emerald-400 text-xs font-medium flex-shrink-0",children:"Selected"})]},U)})}),e.jsxs("button",{type:"button",onClick:ue,className:"w-full py-4 rounded-xl bg-emerald-500 text-slate-900 font-semibold flex items-center justify-center gap-2 hover:bg-emerald-400 transition-colors mt-4",children:["Continue",e.jsx(re,{className:"text-sm"})]})]},"products"),o===H.FORM&&e.jsxs(E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4",children:[_&&u.length>0&&x?.items&&e.jsxs("div",{className:"p-3 rounded-xl bg-emerald-500/10 border border-emerald-500/20 space-y-2",children:[e.jsx("p",{className:"text-xs font-medium text-emerald-400",children:"Selected product(s)"}),u.map(j=>{const U=x.items[j];return e.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/80",children:[e.jsx(je,{className:"text-emerald-400 text-xs flex-shrink-0"}),e.jsx("span",{className:"truncate",children:U?.name}),e.jsxs("span",{className:"text-white/50 flex-shrink-0",children:["Ã—",U?.quantity??1]})]},j)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:"Subject (optional)"}),e.jsx("input",{type:"text",value:S,onChange:j=>k(j.target.value),placeholder:"e.g. Missing item in order",className:"w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-white/30 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-white/80 mb-2",children:["Description ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("textarea",{value:A,onChange:j=>C(j.target.value),placeholder:"Describe your issue in detail. We'll get back to you soon.",rows:5,className:"w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-white/30 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 resize-none"})]}),G&&e.jsxs("p",{className:"text-red-400 text-sm flex items-center gap-2",children:[e.jsx(Ge,{})," ",G]}),e.jsx("button",{type:"button",disabled:R,onClick:O,className:"w-full py-4 rounded-xl bg-emerald-500 text-slate-900 font-semibold flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-emerald-400 transition-colors",children:R?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Submittingâ€¦"]}):e.jsxs(e.Fragment,{children:["Submit",e.jsx(re,{className:"text-sm"})]})})]},"form"),o===H.SUCCESS&&F&&e.jsxs(E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0},className:"py-8 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-emerald-500/20 flex items-center justify-center mx-auto mb-6",children:e.jsx(Te,{className:"text-emerald-400 text-4xl"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Query submitted"}),e.jsx("p",{className:"text-white/60 text-sm mb-6",children:"Weâ€™ve received your request and will get back to you soon."}),e.jsxs("div",{className:"px-4 py-3 rounded-xl bg-white/5 border border-white/10 mb-6",children:[e.jsx("p",{className:"text-xs text-white/50 mb-1",children:"Ticket number"}),e.jsx("p",{className:"font-mono font-bold text-emerald-400",children:F.ticketNumber})]}),e.jsx("button",{type:"button",onClick:l,className:"w-full py-4 rounded-xl bg-emerald-500 text-slate-900 font-semibold hover:bg-emerald-400 transition-colors",children:"Done"})]},"success")]})})]})]}):null},Ba=t=>{if(!t)return null;try{const l=new Date(t),s=new Date,a=new Date(s);return a.setDate(a.getDate()+1),l.toDateString()===s.toDateString()?"Today":l.toDateString()===a.toDateString()?"Tomorrow":l.toLocaleDateString("en-IN",{weekday:"short",day:"numeric",month:"short"})}catch{return null}},Ha=({step:t,currentStep:l,label:s,time:a,isLast:n,icon:o})=>{const i=l>t,c=l===t;return e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-9 h-9 rounded-full flex items-center justify-center transition-all ${i?"bg-emerald-500 shadow-lg shadow-emerald-500/30":c?"bg-emerald-500/20 border-2 border-emerald-500 shadow-lg shadow-emerald-500/20":"bg-white/[0.06] border border-white/[0.1]"}`,children:i?e.jsx(je,{className:"text-white text-sm"}):e.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${c?"bg-emerald-500 animate-pulse":"bg-white/20"}`})}),!n&&e.jsx("div",{className:`w-0.5 h-10 ${i?"bg-emerald-500":"bg-white/[0.08]"}`})]}),e.jsxs("div",{className:"flex-1 pb-6",children:[e.jsx("p",{className:`font-medium ${c?"text-emerald-400":i?"text-white":"text-white/30"}`,children:s}),a&&e.jsx("p",{className:"text-xs text-white/40 mt-0.5",children:a})]})]})},qa=({orderId:t,onBack:l})=>{const[s,a]=r.useState(null),[n,o]=r.useState(!0),[i,c]=r.useState(!1),[h,x]=r.useState(!1),[d,f]=r.useState(!1);if(r.useEffect(()=>{if(!t)return;const m=ya(t,S=>{a(S),o(!1),S?.status==="delivered"&&!S?.storeRating&&!h&&setTimeout(()=>{x(!0)},1e3)});return()=>m()},[t,h]),n)return e.jsxs("div",{className:"min-h-screen bg-[#0a0f1a] flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-emerald-500 border-t-transparent animate-spin mb-4"}),e.jsx("p",{className:"text-white/40",children:"Loading order..."})]});if(!s)return e.jsxs("div",{className:"min-h-screen bg-[#0a0f1a] flex flex-col items-center justify-center px-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-white/[0.04] flex items-center justify-center mb-4",children:e.jsx(Ve,{className:"text-white/20 text-3xl"})}),e.jsx("p",{className:"text-white/60 mb-4",children:"Order not found"}),e.jsx("button",{onClick:l,className:"text-emerald-400 font-medium",children:"Go Back"})]});const b=s.orderType==="pickup",N=ss(s.status,s.orderType)||{label:"Processing",description:"Order is being processed",color:"text-white/60",icon:"â³",step:1},v=b?[{step:1,label:"Order Placed",status:"pending"},{step:2,label:"Confirmed",status:"confirmed"},{step:3,label:"Preparing",status:"preparing"},{step:4,label:"Ready for Pickup",status:"ready"},{step:5,label:"Picked Up",status:"delivered"}]:[{step:1,label:"Order Placed",status:"pending"},{step:2,label:"Confirmed",status:"confirmed"},{step:3,label:"Preparing",status:"preparing"},{step:4,label:"Ready",status:"ready"},{step:5,label:"Out for Delivery",status:"out_for_delivery"},{step:6,label:"Delivered",status:"delivered"}],u=m=>{if(!Array.isArray(s.statusHistory))return m==="pending"&&s.createdAt?new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):null;const S=s.statusHistory.find(k=>k.status===m);return S?new Date(S.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):null};return e.jsxs("div",{className:"min-h-screen bg-[#0a0f1a]",children:[e.jsx("div",{className:"bg-[#0a0f1a]/90 backdrop-blur-xl sticky top-0 z-10 border-b border-white/[0.06]",children:e.jsxs("div",{className:"px-4 py-3 flex items-center gap-3",style:{paddingTop:"calc(env(safe-area-inset-top) + 12px)"},children:[e.jsx("button",{onClick:()=>{if(l)try{l()}catch(m){console.error("Navigation error:",m),window.history.length>1?window.history.back():window.location.href="/shop"}else window.history.length>1?window.history.back():window.location.href="/shop"},className:"w-10 h-10 rounded-full bg-white/[0.06] border border-white/[0.08] flex items-center justify-center hover:bg-white/[0.1] transition",children:e.jsx(ge,{className:"text-white/60"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-white",children:"Track Order"}),e.jsxs("p",{className:"text-xs text-white/40",children:["#",s.orderNumber]})]})]})}),e.jsxs("div",{className:`mx-4 mt-4 p-4 rounded-2xl border ${b?"bg-purple-500/10 border-purple-500/20":"bg-cyan-500/10 border-cyan-500/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center text-2xl ${b?"bg-purple-500/20":"bg-cyan-500/20"}`,children:N.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-semibold text-lg ${N.color||"text-emerald-400"}`,children:N.label}),e.jsx("p",{className:"text-sm text-white/60",children:N.description})]})]}),s.status!=="delivered"&&s.status!=="cancelled"&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-white/[0.08] flex items-center gap-2",children:[e.jsx(ie,{className:"text-white/40"}),b?e.jsxs("span",{className:"text-sm text-white/60",children:["Pickup: ",e.jsx("span",{className:"text-white font-medium",children:s.pickupDateLabel||"Today"})," at ",e.jsx("span",{className:"text-white font-medium",children:s.pickupSlot?.time||"Store hours"})]}):s.estimatedDelivery?e.jsxs("span",{className:"text-sm text-white/60",children:["Estimated delivery by ",e.jsx("span",{className:"text-white font-medium",children:new Date(s.estimatedDelivery).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}):e.jsx("span",{className:"text-sm text-white/60",children:"Estimated time will be updated soon"})]})]}),s.status!=="cancelled"&&e.jsxs("div",{className:"mx-4 mt-4 bg-slate-800 rounded-2xl border border-white/[0.06] p-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-4",children:"Order Progress"}),e.jsx("div",{children:v.map((m,S)=>e.jsx(Ha,{step:m.step,currentStep:N.step,label:m.label,time:u(m.status),isLast:S===v.length-1},m.step))})]}),!b&&(s.deliveryAgent||s.deliveryPartner)&&s.status==="out_for_delivery"&&e.jsxs(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mx-4 mt-4 bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:"Delivery Partner"}),e.jsxs("span",{className:"text-xs bg-white/20 px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),"On the way"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(Ee,{className:"text-2xl"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:s.deliveryAgent?.name||s.deliveryPartner}),e.jsx("p",{className:"text-sm text-white/80",children:s.deliveryAgent?.vehicleNumber||"Delivery Agent"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[(s.deliveryAgent?.phone||s.deliveryPartnerPhone)&&e.jsx("a",{href:`tel:${s.deliveryAgent?.phone||s.deliveryPartnerPhone}`,className:"w-11 h-11 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 transition",children:e.jsx(ze,{})}),e.jsx("button",{onClick:()=>c(!0),className:"w-11 h-11 rounded-full bg-white flex items-center justify-center text-emerald-600",children:e.jsx(As,{})})]})]})]}),b&&s.status==="ready"&&e.jsxs(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mx-4 mt-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl p-4 text-white shadow-xl shadow-purple-500/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:"Ready for Pickup!"}),e.jsxs("span",{className:"text-xs bg-white/20 px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(Te,{className:"text-xs"}),"Waiting for you"]})]}),e.jsx("p",{className:"text-white/90 text-sm mb-4",children:"Your order is packed and ready. Visit the store to collect it."}),e.jsxs("div",{className:"bg-white/10 rounded-xl p-3 mb-3",children:[e.jsx("p",{className:"text-white/70 text-xs mb-1",children:"Pickup Time"}),e.jsxs("p",{className:"font-semibold",children:[s.pickupDateLabel||"Today"," â€¢ ",s.pickupSlot?.time||"During store hours"]})]}),s.pickupInstructions&&e.jsxs("div",{className:"bg-white/10 rounded-xl p-3",children:[e.jsx("p",{className:"text-white/70 text-xs mb-1",children:"Pickup Instructions"}),e.jsx("p",{className:"text-sm",children:s.pickupInstructions})]})]}),e.jsxs("div",{className:"mx-4 mt-4 bg-slate-800 rounded-2xl border border-white/[0.06] p-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Store Details"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${b?"bg-purple-500/10 border border-purple-500/20":"bg-blue-500/10 border border-blue-500/20"}`,children:e.jsx(te,{className:b?"text-purple-400":"text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.storeName}),e.jsx("p",{className:"text-sm text-white/40",children:b?"Pickup location":"Store"})]})]}),e.jsx("div",{className:"flex gap-2",children:s.storePhone&&e.jsx("a",{href:`tel:${s.storePhone}`,className:"w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center",children:e.jsx(ze,{className:"text-emerald-400 text-sm"})})})]})]}),e.jsx("div",{className:"mx-4 mt-4",children:e.jsxs("button",{type:"button",onClick:()=>f(!0),className:"w-full flex items-center justify-between gap-3 p-4 rounded-2xl bg-amber-500/10 border border-amber-500/20 hover:bg-amber-500/15 hover:border-amber-500/30 transition-all text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-amber-500/20 flex items-center justify-center",children:e.jsx($e,{className:"text-amber-400 text-lg"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:"Need help with this order?"}),e.jsx("p",{className:"text-xs text-white/50",children:s.status==="delivered"?"Query, return, refund, or other support":"Query, cancel, delivery issue, or other support"})]})]}),e.jsx(re,{className:"text-white/40 flex-shrink-0"})]})}),b?e.jsxs("div",{className:"mx-4 mt-4 bg-slate-800 rounded-2xl border border-white/[0.06] p-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Pickup Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-purple-500/5 rounded-xl",children:[e.jsx(et,{className:"text-purple-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/40",children:"Date"}),e.jsx("p",{className:"text-white font-medium",children:s.pickupDateLabel||"Today"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-purple-500/5 rounded-xl",children:[e.jsx(ie,{className:"text-purple-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/40",children:"Time Slot"}),e.jsx("p",{className:"text-white font-medium",children:s.pickupSlot?.time||"During store hours"})]})]}),s.pickupInstructions&&e.jsxs("div",{className:"p-3 bg-white/[0.03] rounded-xl",children:[e.jsx("p",{className:"text-xs text-white/40 mb-1",children:"Store Instructions"}),e.jsx("p",{className:"text-white/80 text-sm",children:s.pickupInstructions})]})]})]}):s.deliveryAddress&&e.jsxs("div",{className:"mx-4 mt-4 bg-slate-800 rounded-2xl border border-white/[0.06] p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("h3",{className:"font-semibold text-white",children:s.isScheduledDelivery?"Scheduled Delivery":"Delivery Address"}),s.isScheduledDelivery&&e.jsx("span",{className:"px-2 py-0.5 bg-amber-500/20 text-amber-400 text-xs font-medium rounded-full",children:"Scheduled"})]}),(s.deliveryDateLabel||s.deliveryDate||s.deliverySlot&&s.deliverySlot.includes(" - "))&&e.jsx("div",{className:"mb-3 p-3 bg-amber-500/5 rounded-xl border border-amber-500/10",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(et,{className:"text-amber-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/40",children:"Delivery Date"}),e.jsx("p",{className:"text-white font-medium",children:s.deliveryDateLabel||Ba(s.deliveryDate)||"Scheduled"})]})]}),s.deliverySlot&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"text-amber-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/40",children:"Time Slot"}),e.jsx("p",{className:"text-white font-medium",children:s.deliverySlot})]})]})]})}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-500/10 flex items-center justify-center",children:e.jsx(ee,{className:"text-cyan-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-white",children:s.deliveryAddress?.label}),e.jsx("p",{className:"text-sm text-white/60 mt-0.5",children:s.deliveryAddress?.address}),s.deliveryAddress?.city&&e.jsxs("p",{className:"text-sm text-white/40",children:[s.deliveryAddress?.city," - ",s.deliveryAddress?.pincode]})]})]}),s.deliverySlot&&!s.deliverySlot.includes(" - ")&&!s.deliveryDateLabel&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-white/[0.06] flex items-center gap-2",children:[e.jsx(ie,{className:"text-white/40 text-sm"}),e.jsxs("span",{className:"text-sm text-white/60",children:["Delivery: ",s.deliverySlot==="asap"?"ASAP (45-60 min)":s.deliverySlot==="2hr"?"Within 2 Hours":s.deliverySlot]})]})]}),e.jsxs("div",{className:"mx-4 mt-4 bg-slate-800 rounded-2xl border border-white/[0.06] p-4",children:[e.jsxs("h3",{className:"font-semibold text-white mb-3",children:["Order Items (",s.items?.length||0,")"]}),e.jsx("div",{className:"space-y-3",children:s.items?.map((m,S)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/[0.04] flex items-center justify-center",children:m.image?e.jsx("img",{src:m.image,alt:m.name,className:"w-10 h-10 object-contain"}):e.jsx(Ve,{className:"text-white/20"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:m.name}),e.jsxs("p",{className:"text-xs text-white/40",children:["Qty: ",m.quantity," Ã— â‚¹",m.price]})]}),e.jsxs("p",{className:"font-medium text-white",children:["â‚¹",m.total||m.price*m.quantity]})]},S))}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/[0.06] space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-white/50",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["â‚¹",s.subtotal||s.total]})]}),!b&&s.deliveryFee>0&&e.jsxs("div",{className:"flex justify-between text-white/50",children:[e.jsx("span",{children:"Delivery Fee"}),e.jsxs("span",{children:["â‚¹",s.deliveryFee]})]}),s.platformFee>0&&e.jsxs("div",{className:"flex justify-between text-white/50",children:[e.jsx("span",{children:"Platform Fee"}),e.jsxs("span",{children:["â‚¹",s.platformFee]})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-white pt-2 border-t border-white/[0.06]",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-emerald-400",children:["â‚¹",s.total]})]})]})]}),(()=>{const m=s.paymentMethod==="PAY_LATER"||s.paymentStatus==="pay_later",S=A=>{if(!A)return null;const C=A?.toDate?A.toDate():new Date(A),y=C-new Date,F=Math.ceil(y/(1e3*60*60*24));return F<0?{text:`Overdue by ${Math.abs(F)} days`,isOverdue:!0}:F===0?{text:"Due today",isOverdue:!1,isToday:!0}:F===1?{text:"Due tomorrow",isOverdue:!1}:{text:`Due ${C.toLocaleDateString("en-IN",{day:"numeric",month:"short"})}`,isOverdue:!1}},k=m&&s.paymentDueDate?S(s.paymentDueDate):null;return e.jsxs("div",{className:`mx-4 mt-4 rounded-2xl border p-4 ${m?k?.isOverdue?"bg-red-500/10 border-red-500/20":"bg-amber-500/10 border-amber-500/20":"bg-slate-800 border-white/[0.06]"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-semibold text-white flex items-center gap-2",children:[m&&e.jsx(fe,{className:"text-amber-400"}),"Payment"]}),e.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs font-medium flex items-center gap-1.5 ${s.paymentStatus==="paid"?"bg-green-500/20 text-green-400":m?k?.isOverdue?"bg-red-500/20 text-red-400":"bg-amber-500/20 text-amber-400":"bg-yellow-500/20 text-yellow-400"}`,children:[m&&e.jsx(fe,{className:"text-xs"}),s.paymentStatus==="paid"?"Paid":m?"Pay Later":"Pay on "+(b?"Pickup":"Delivery")]})]}),e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsx("span",{className:"text-white/60",children:s.paymentMethod==="COD"?"Cash on Delivery":s.paymentMethod==="PAY_LATER"?"Credit / Pay Later":s.paymentMethod||"Cash"})}),m&&e.jsxs("div",{className:`mt-3 pt-3 border-t ${k?.isOverdue?"border-red-500/20":"border-amber-500/20"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/60 text-sm",children:"Amount Due"}),e.jsxs("span",{className:"text-white font-bold text-lg",children:["â‚¹",s.amountDue||s.total]})]}),k&&e.jsxs("div",{className:`flex items-center gap-2 p-2.5 rounded-lg ${k.isOverdue?"bg-red-500/20":k.isToday?"bg-amber-500/20":"bg-white/5"}`,children:[k.isOverdue?e.jsx(Ge,{className:"text-red-400"}):e.jsx(ie,{className:"text-amber-400"}),e.jsx("span",{className:`text-sm font-medium ${k.isOverdue?"text-red-400":"text-amber-400"}`,children:k.text})]})]})]})})(),s.status==="delivered"&&!s.storeRating&&!h&&e.jsxs("div",{className:"mx-4 mt-4 p-4 bg-gradient-to-r from-yellow-500/10 to-amber-500/10 rounded-2xl border border-yellow-500/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-yellow-500/20 flex items-center justify-center",children:e.jsx(Ce,{className:"text-yellow-400 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-white",children:"Rate Your Experience"}),e.jsx("p",{className:"text-sm text-white/60",children:"Help us improve by rating your order"})]})]}),e.jsxs("button",{onClick:()=>x(!0),className:"w-full py-3 bg-yellow-500 text-white rounded-xl font-medium hover:bg-yellow-600 transition flex items-center justify-center gap-2",children:[e.jsx(Ce,{}),"Rate Order"]})]}),(s.storeRating||s.deliveryPersonRating)&&e.jsxs("div",{className:"mx-4 mt-4 space-y-3",children:[s.storeRating&&e.jsxs("div",{className:"p-4 bg-slate-800 rounded-2xl border border-white/[0.06]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(te,{className:"text-blue-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-white",children:s.storeName}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[[1,2,3,4,5].map(m=>e.jsx(Ce,{className:`text-sm ${m<=s.storeRating?"text-yellow-400 fill-yellow-400":"text-white/20"}`},m)),e.jsxs("span",{className:"text-xs text-white/50 ml-2",children:[s.storeRating,"/5"]})]})]})]}),s.storeReview&&e.jsx("p",{className:"text-sm text-white/70 mt-2",children:s.storeReview})]}),s.deliveryPersonRating&&e.jsxs("div",{className:"p-4 bg-slate-800 rounded-2xl border border-white/[0.06]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Ee,{className:"text-emerald-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-white",children:s.deliveryPersonName||s.deliveryAgent?.name||"Delivery Person"}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[[1,2,3,4,5].map(m=>e.jsx(Ce,{className:`text-sm ${m<=s.deliveryPersonRating?"text-yellow-400 fill-yellow-400":"text-white/20"}`},m)),e.jsxs("span",{className:"text-xs text-white/50 ml-2",children:[s.deliveryPersonRating,"/5"]})]})]})]}),s.deliveryPersonReview&&e.jsx("p",{className:"text-sm text-white/70 mt-2",children:s.deliveryPersonReview})]})]}),e.jsx("div",{className:"h-28"}),e.jsx(me,{children:i&&s&&e.jsx(La,{order:s,onClose:()=>c(!1)})}),e.jsx(me,{children:h&&s&&s.status==="delivered"&&e.jsx(za,{order:s,onClose:()=>x(!1),onSubmit:async m=>{(await Na(s.id,m)).success?(x(!1),a(k=>({...k,...m}))):alert("Failed to submit rating. Please try again.")}})}),e.jsx(Dt,{isOpen:d,onClose:()=>f(!1),preSelectedOrder:s})]})},za=({order:t,onClose:l,onSubmit:s})=>{const[a,n]=r.useState(0),[o,i]=r.useState(""),[c,h]=r.useState(0),[x,d]=r.useState(""),[f,b]=r.useState(!1),N=t.orderType==="delivery",g=async()=>{if(a===0){alert("Please rate the store");return}if(N&&c===0){alert("Please rate the delivery person");return}b(!0);try{await s({storeRating:a,storeReview:o.trim()||"",deliveryPersonRating:N?c:void 0,deliveryPersonReview:N&&x.trim()||"",deliveryPersonName:t.deliveryAgent?.name||t.deliveryPartner,deliveryPersonId:t.deliveryAgent?.id})}catch(v){console.error("Error submitting rating:",v),alert("Failed to submit rating. Please try again.")}finally{b(!1)}},w=({rating:v,onRatingChange:u,label:m})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-white/80",children:m}),e.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(S=>e.jsx("button",{type:"button",onClick:()=>u(S),className:"transition-transform hover:scale-110 active:scale-95",children:e.jsx(Ce,{className:`text-2xl ${S<=v?"text-yellow-400 fill-yellow-400":"text-white/20"}`})},S)),v>0&&e.jsxs("span",{className:"text-sm text-white/60 ml-2",children:[v,"/5"]})]})]});return e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 px-4",onClick:l,children:e.jsxs(E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-slate-800 rounded-2xl p-6 w-full max-w-md border border-white/10",onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Rate Your Experience"}),e.jsx("button",{onClick:l,className:"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition",children:e.jsx(ge,{className:"text-white/60 text-sm"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-white/5 rounded-xl border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center",children:e.jsx(te,{className:"text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:t.storeName}),e.jsx("p",{className:"text-xs text-white/50",children:"Store"})]})]}),e.jsx(w,{rating:a,onRatingChange:n,label:"How was your experience with the store?"}),e.jsx("textarea",{value:o,onChange:v=>i(v.target.value),placeholder:"Write a review (optional)...",className:"mt-3 w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/40 text-sm resize-none",rows:"3"})]}),N&&(t.deliveryAgent||t.deliveryPartner)&&e.jsxs("div",{className:"p-4 bg-white/5 rounded-xl border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center",children:e.jsx(Ee,{className:"text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:t.deliveryAgent?.name||t.deliveryPartner||"Delivery Person"}),e.jsx("p",{className:"text-xs text-white/50",children:"Delivery Partner"})]})]}),e.jsx(w,{rating:c,onRatingChange:h,label:"How was the delivery experience?"}),e.jsx("textarea",{value:x,onChange:v=>d(v.target.value),placeholder:"Write a review (optional)...",className:"mt-3 w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/40 text-sm resize-none",rows:"3"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:l,disabled:f,className:"flex-1 px-4 py-3 bg-white/10 text-white/70 rounded-xl font-medium hover:bg-white/20 transition disabled:opacity-50",children:"Skip"}),e.jsx("button",{onClick:g,disabled:f||a===0||N&&c===0,className:"flex-1 px-4 py-3 bg-emerald-500 text-slate-900 rounded-xl font-medium hover:bg-emerald-400 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{}),"Submit Rating"]})})]})]})]})})},Ya=t=>{if(!t)return null;try{const l=new Date(t),s=new Date,a=new Date(s);return a.setDate(a.getDate()+1),l.toDateString()===s.toDateString()?"Today":l.toDateString()===a.toDateString()?"Tomorrow":l.toLocaleDateString("en-IN",{weekday:"short",day:"numeric",month:"short"})}catch{return null}},Ga=t=>{if(!t)return null;const a=(t?.toDate?t.toDate():new Date(t))-new Date,n=Math.ceil(a/(1e3*60*60*24));return n<0?{text:`Overdue by ${Math.abs(n)} days`,isOverdue:!0}:n===0?{text:"Due today",isOverdue:!1,isToday:!0}:n===1?{text:"Due tomorrow",isOverdue:!1}:{text:`Due in ${n} days`,isOverdue:!1}},Va=({order:t,onClick:l})=>{const s=ss(t.status,t.orderType),a=t.items?.reduce((x,d)=>x+d.quantity,0)||0,n=new Date(t.createdAt).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"}),o=t.orderType==="pickup",i=!["delivered","cancelled"].includes(t.status),c=t.paymentMethod==="PAY_LATER"||t.paymentStatus==="pay_later",h=c&&t.paymentDueDate?Ga(t.paymentDueDate):null;return e.jsxs(E.button,{whileTap:{scale:.98},onClick:()=>l(t),className:`w-full bg-slate-800 rounded-2xl border overflow-hidden text-left transition-all ${c&&h?.isOverdue?"border-red-500/30 shadow-lg shadow-red-500/5":i?"border-emerald-500/30 shadow-lg shadow-emerald-500/5":"border-white/[0.06]"}`,children:[e.jsxs("div",{className:`px-4 py-2 flex items-center justify-between ${o?"bg-purple-500/10 border-b border-purple-500/20":"bg-cyan-500/10 border-b border-cyan-500/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[o?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"text-purple-400 text-xs"}),e.jsx("span",{className:"text-purple-300 text-xs font-medium",children:"Store Pickup"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"text-cyan-400 text-xs"}),e.jsx("span",{className:"text-cyan-300 text-xs font-medium",children:"Delivery"})]}),c&&e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-medium flex items-center gap-1 ml-1 ${t.paymentStatus==="paid"?"bg-green-500/20 text-green-300":"bg-amber-500/20 text-amber-300"}`,children:[t.paymentStatus==="paid"?e.jsx(Te,{className:"text-[8px]"}):e.jsx(fe,{className:"text-[8px]"}),t.paymentStatus==="paid"?"Paid":"Credit"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${t.status==="delivered"?"bg-green-500":t.status==="cancelled"?"bg-red-500":"bg-emerald-500 animate-pulse"}`}),e.jsx("span",{className:`text-xs font-medium ${s.color}`,children:s.label})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/[0.06] flex items-center justify-center",children:e.jsx(te,{className:"text-white/40"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white",children:t.storeName}),e.jsxs("p",{className:"text-xs text-white/40",children:[n," â€¢ #",t.orderNumber?.slice(-8)]})]})]}),e.jsx(re,{className:"text-white/30 mt-1"})]}),o?e.jsxs("div",{className:"flex items-center gap-3 mb-3 p-2 bg-purple-500/5 rounded-lg",children:[e.jsx(et,{className:"text-purple-400 text-sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-white/60",children:"Pickup scheduled"}),e.jsxs("p",{className:"text-sm text-white font-medium",children:[t.pickupDateLabel||"Today"," â€¢ ",t.pickupSlot?.time||"Anytime"]})]})]}):t.deliveryAddress?e.jsxs("div",{className:"space-y-2 mb-3",children:[(t.deliveryDateLabel||t.deliveryDate||t.deliverySlot&&t.deliverySlot.includes(" - "))&&e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-amber-500/5 rounded-lg border border-amber-500/10",children:[e.jsx(et,{className:"text-amber-400 text-sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-white/60",children:"Scheduled Delivery"}),e.jsxs("p",{className:"text-sm text-white font-medium",children:[t.deliveryDateLabel||Ya(t.deliveryDate)||"Scheduled"," â€¢ ",t.deliverySlot||"Anytime"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-cyan-500/5 rounded-lg",children:[e.jsx(ee,{className:"text-cyan-400 text-sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-white/60",children:"Delivering to"}),e.jsx("p",{className:"text-sm text-white font-medium truncate",children:t.deliveryAddress?.label||t.deliveryAddress?.address})]})]})]}):null,c&&(t.paymentStatus==="paid"?e.jsxs("div",{className:"flex items-center gap-3 mb-3 p-2.5 rounded-lg bg-green-500/10 border border-green-500/20",children:[e.jsx(Te,{className:"text-green-400 text-sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-green-400 font-medium",children:"Payment Received"}),e.jsxs("p",{className:"text-sm text-white font-medium",children:["â‚¹",t.amountPaid||t.total," paid"]})]})]}):h?e.jsxs("div",{className:`flex items-center gap-3 mb-3 p-2.5 rounded-lg ${h.isOverdue?"bg-red-500/10 border border-red-500/20":h.isToday?"bg-amber-500/10 border border-amber-500/20":"bg-amber-500/5"}`,children:[h.isOverdue?e.jsx(Ge,{className:"text-red-400 text-sm"}):e.jsx(fe,{className:"text-amber-400 text-sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-xs ${h.isOverdue?"text-red-400":"text-amber-400"} font-medium`,children:h.text}),e.jsxs("p",{className:"text-sm text-white font-medium",children:["â‚¹",t.amountDue||t.total," payment pending"]})]})]}):e.jsxs("div",{className:"flex items-center gap-3 mb-3 p-2.5 rounded-lg bg-amber-500/5",children:[e.jsx(fe,{className:"text-amber-400 text-sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-amber-400 font-medium",children:"Payment Pending"}),e.jsxs("p",{className:"text-sm text-white font-medium",children:["â‚¹",t.amountDue||t.total," due"]})]})]})),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("div",{className:"flex -space-x-2",children:[(t.items||[]).slice(0,3).map((x,d)=>e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white/[0.08] border-2 border-slate-800 flex items-center justify-center",children:e.jsx(Ve,{className:"text-white/30 text-xs"})},d)),(t.items||[]).length>3&&e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white/[0.08] border-2 border-slate-800 flex items-center justify-center",children:e.jsxs("span",{className:"text-white/50 text-xs",children:["+",t.items.length-3]})})]}),e.jsxs("span",{className:"text-sm text-white/50",children:[a," items"]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-white/[0.06]",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs font-medium flex items-center gap-1.5 ${s.bgColor} ${s.color}`,children:[e.jsx("span",{children:s.icon}),s.label]})}),e.jsxs("p",{className:"font-bold text-white text-lg",children:["â‚¹",t.total]})]})]}),t.status==="delivered"&&e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("button",{onClick:x=>{x.stopPropagation()},className:"w-full py-3 bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 rounded-xl text-sm font-medium flex items-center justify-center gap-2 hover:bg-emerald-500/20 transition-colors",children:[e.jsx(Es,{className:"text-xs"}),"Reorder"]})})]})},Wa=({onBack:t,onOrderClick:l})=>{const{customer:s}=_e(),[a,n]=r.useState([]),[o,i]=r.useState(!0),[c,h]=r.useState("all"),[x,d]=r.useState(!1);r.useEffect(()=>{(async()=>{if(s?.uid){i(!0);try{const v=await Ct(s.uid,50);n(v)}catch(v){console.error("Error fetching orders:",v)}finally{i(!1)}}})()},[s]);const f=a.filter(w=>c==="active"?!["delivered","cancelled"].includes(w.status):c==="completed"?w.status==="delivered":!0),b=f.reduce((w,v)=>{const u=new Date(v.createdAt).toLocaleDateString("en-IN",{day:"numeric",month:"long",year:"numeric"});return w[u]||(w[u]=[]),w[u].push(v),w},{}),N=a.filter(w=>!["delivered","cancelled"].includes(w.status)).length,g=a.filter(w=>w.status==="delivered").length;return e.jsxs("div",{className:"min-h-screen bg-[#0a0f1a]",children:[e.jsxs("div",{className:"bg-[#0a0f1a]/90 backdrop-blur-xl sticky top-0 z-10 border-b border-white/[0.06]",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center gap-3",style:{paddingTop:"calc(env(safe-area-inset-top) + 12px)"},children:[e.jsx("button",{onClick:t,className:"w-10 h-10 rounded-full bg-white/[0.06] border border-white/[0.08] flex items-center justify-center",children:e.jsx(ge,{className:"text-white/60"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"font-bold text-white text-lg",children:"My Orders"}),a.length>0&&e.jsxs("p",{className:"text-xs text-white/40",children:[N," active â€¢ ",g," completed"]})]}),e.jsx("button",{type:"button",onClick:()=>d(!0),className:"w-10 h-10 rounded-full bg-amber-500/20 border border-amber-500/30 flex items-center justify-center hover:bg-amber-500/30 transition-colors",title:"Help & Support",children:e.jsx($e,{className:"text-amber-400 text-lg"})})]}),e.jsx("div",{className:"px-4 pb-3 flex gap-2",children:[{id:"all",label:"All",count:a.length},{id:"active",label:"Active",count:N},{id:"completed",label:"Completed",count:g}].map(w=>e.jsxs("button",{onClick:()=>h(w.id),className:`px-4 py-2 rounded-xl text-sm font-medium transition-all flex items-center gap-2 ${c===w.id?"bg-emerald-500 text-slate-900":"bg-white/[0.06] text-white/50 border border-white/[0.08] hover:bg-white/[0.08]"}`,children:[w.label,w.count>0&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded-md ${c===w.id?"bg-white/20":"bg-white/[0.08]"}`,children:w.count})]},w.id))})]}),e.jsx("div",{className:"px-4 py-4 pb-28",children:o?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-emerald-500 border-t-transparent animate-spin mb-4"}),e.jsx("p",{className:"text-white/40 text-sm",children:"Loading orders..."})]}):f.length>0?e.jsx("div",{className:"space-y-6",children:Object.entries(b).map(([w,v])=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-white/40 mb-3 flex items-center gap-2",children:[e.jsx(et,{className:"text-xs"}),w]}),e.jsx("div",{className:"space-y-3",children:v.map(u=>e.jsx(Va,{order:u,onClick:()=>l(u.id)},u.id))})]},w))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-white/[0.04] border border-white/[0.08] flex items-center justify-center mb-4",children:e.jsx(qe,{className:"text-white/20 text-4xl"})}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"No orders yet"}),e.jsx("p",{className:"text-sm text-white/40 text-center max-w-[250px]",children:c==="active"?"You have no active orders right now":c==="completed"?"You have no completed orders yet":"Start ordering from nearby stores and your orders will appear here"}),e.jsx("button",{onClick:t,className:"mt-6 px-6 py-3 bg-emerald-500 text-slate-900 rounded-xl font-medium hover:bg-emerald-400 transition",children:"Browse Stores"})]})}),e.jsx(Dt,{isOpen:x,onClose:()=>d(!1),preSelectedOrder:null})]})},Qa=()=>e.jsx("img",{src:"/assets/flyp_logo.png",alt:"FLYP",className:"w-12 h-12 object-contain"}),ae=({icon:t,label:l,value:s,onClick:a,danger:n,badge:o})=>e.jsxs("button",{onClick:a,className:`w-full flex items-center gap-4 px-4 py-3 ${n?"text-red-400":"text-white"} hover:bg-white/5 transition-colors`,children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 ${n?"bg-red-500/10 border border-red-500/20":"bg-slate-700 border border-slate-600"}`,children:e.jsx(t,{className:n?"text-red-400":"text-slate-400"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:l}),o&&e.jsx("span",{className:"px-2 py-0.5 bg-emerald-500/20 text-emerald-400 text-xs rounded-full",children:o})]}),s&&e.jsx("p",{className:"text-sm text-white/40",children:s})]}),e.jsx(re,{className:"text-white/30"})]}),Ka=({address:t,onEdit:l,onDelete:s,onSetDefault:a})=>e.jsxs("div",{className:"bg-white/5/50 backdrop-blur-xl rounded-xl border border-white/10/50 p-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-500/10 border border-emerald-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(ee,{className:"text-emerald-400 text-sm"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-white",children:t.label}),t.isDefault&&e.jsx("span",{className:"px-2 py-0.5 bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 text-xs rounded-full",children:"Default"})]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:t.address})]})]})}),e.jsxs("div",{className:"flex gap-2 mt-3 pt-3 border-t border-white/10",children:[!t.isDefault&&e.jsx("button",{onClick:()=>a(t.id),className:"flex-1 py-2 text-sm text-emerald-400 font-medium hover:bg-emerald-500/10 rounded-lg transition",children:"Set as Default"}),e.jsx("button",{onClick:()=>l(t),className:"px-4 py-2 text-sm text-slate-400 hover:bg-white/5 rounded-lg transition",children:e.jsx(Kt,{})}),e.jsx("button",{onClick:()=>s(t.id),className:"px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 rounded-lg transition",children:e.jsx(St,{})})]})]}),Oe=({isOpen:t,onClose:l,title:s,children:a})=>e.jsx(me,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:l,className:"fixed inset-0 z-50 bg-black/70 backdrop-blur-sm"}),e.jsxs(E.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-[60] bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 rounded-t-[28px] border-t border-white/10 shadow-xl overflow-y-auto",style:{maxHeight:"calc(90vh - env(safe-area-inset-bottom))",paddingBottom:"calc(100px + env(safe-area-inset-bottom))"},children:[e.jsx("div",{className:"flex justify-center py-4 sticky top-0 bg-gradient-to-b from-slate-800 to-transparent z-10",children:e.jsx("div",{className:"w-12 h-1 bg-white/20 rounded-full"})}),e.jsxs("div",{className:"px-6 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:s}),e.jsx("button",{onClick:l,className:"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-white/60 hover:bg-white/20 transition",children:e.jsx(De,{})})]}),a]})]})]})}),Ja=({onBack:t})=>{const{customer:l,customerData:s,updateProfile:a,logout:n,deleteAccount:o,setDefaultAddress:i,addAddress:c}=_e(),h=r.useRef(null),[x,d]=r.useState(!1),[f,b]=r.useState(s?.name||""),[N,g]=r.useState(!1),[w,v]=r.useState(!1),[u,m]=r.useState({label:"",address:""}),[S,k]=r.useState(!1),[A,C]=r.useState(!1),[R,y]=r.useState(s?.email||""),[F,L]=r.useState(!1),[G,B]=r.useState(l?.phoneNumber||""),[P,I]=r.useState(!1),[z,J]=r.useState(!1),[$,_]=r.useState(!1),[se,he]=r.useState(!1),[Pe,ne]=r.useState(!1),[we,ue]=r.useState(""),[O,j]=r.useState(!1),[U,q]=r.useState({pushNotifications:s?.settings?.pushNotifications??!0,emailNotifications:s?.settings?.emailNotifications??!1,smsNotifications:s?.settings?.smsNotifications??!1,orderUpdates:s?.settings?.orderUpdates??!0,offers:s?.settings?.offers??!0}),[X,Pt]=r.useState(s?.paymentMethods||[]),[at,Ae]=r.useState(s?.totalOrders||0);r.useEffect(()=>{(async()=>{if(l?.uid)try{const Se=(await Ct(l.uid,1e3)).length;Ae(Se);const Je=s?.totalOrders||0;Math.abs(Se-Je)>0&&await a({totalOrders:Se})}catch(K){console.error("Error fetching order count:",K),Ae(s?.totalOrders||0)}})()},[l?.uid]);const ye=async()=>{f.trim()&&f!==s?.name?(await a({name:f.trim()})).success&&d(!1):d(!1)},lt=async()=>{const T=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!R.trim()){alert("Please enter a valid email address");return}if(!T.test(R.trim())){alert("Please enter a valid email format");return}(await a({email:R.trim()})).success?C(!1):alert("Failed to update email. Please try again.")},Qe=async()=>{if(!/^\+?[1-9]\d{1,14}$/.test(G.replace(/\s/g,""))){alert("Please enter a valid phone number");return}alert("Phone number update requires verification. This feature will be available soon."),L(!1)},mt=async T=>{const K=T.target.files[0];if(!K)return;if(K.size>5*1024*1024){alert("Image size should be less than 5MB");return}const Se=new FileReader;Se.onloadend=async()=>{const Je=Se.result;(await a({profilePicture:Je})).success&&alert("Profile picture updated successfully!")},Se.readAsDataURL(K)},rt=async T=>{const K={...U,[T]:!U[T]};q(K),await a({settings:{...s?.settings,...K}})},Re=()=>{alert("Payment method integration coming soon!")},Ke=()=>{const T=s?.referralCode||`FLYP${l?.uid?.slice(-6).toUpperCase()}`;navigator.clipboard.writeText(T),alert("Referral code copied to clipboard!")},Ne=async()=>{u.label&&u.address&&(await c(u),m({label:"",address:""}),v(!1))},ht=async()=>{window.confirm("Are you sure you want to logout?")&&await n()},it=async()=>{if(we==="DELETE"){j(!0);try{const T=await o();T.success?(ne(!1),ue("")):alert(T.error||"Could not delete account. Please try again.")}finally{j(!1)}}},ve=s?.totalSavings||0,Ue=s?.loyaltyPoints||0,nt=s?.referralCode||`FLYP${l?.uid?.slice(-6).toUpperCase()}`;return e.jsxs("div",{className:"bg-transparent w-full h-full flex flex-col overflow-y-auto",children:[e.jsxs("div",{className:"relative px-4 pt-6 pb-12 overflow-hidden",style:{paddingTop:"calc(env(safe-area-inset-top) + 24px)"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-slate-800 via-slate-900 to-slate-900"}),e.jsx("div",{className:"absolute -top-20 -right-20 w-60 h-60 rounded-full bg-emerald-500/10 blur-3xl"}),e.jsx("div",{className:"absolute -bottom-20 -left-20 w-60 h-60 rounded-full bg-teal-500/10 blur-3xl"}),e.jsxs("div",{className:"relative flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-white/5 border-2 border-emerald-500/30 flex items-center justify-center overflow-hidden cursor-pointer hover:border-emerald-500/50 transition",onClick:()=>h.current?.click(),children:s?.profilePicture?e.jsx("img",{src:s.profilePicture,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(vt,{className:"text-emerald-400 text-3xl"})}),e.jsx("button",{onClick:()=>h.current?.click(),className:"absolute bottom-0 right-0 w-6 h-6 bg-emerald-500 rounded-full flex items-center justify-center border-2 border-slate-900 hover:bg-emerald-400 transition",children:e.jsx(Fs,{className:"text-slate-900 text-xs"})}),e.jsx("input",{ref:h,type:"file",accept:"image/*",onChange:mt,className:"hidden"})]}),e.jsxs("div",{className:"flex-1",children:[x?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:f,onChange:T=>b(T.target.value),className:"flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-white placeholder-slate-500 outline-none focus:ring-2 focus:ring-emerald-500",autoFocus:!0,onKeyPress:T=>T.key==="Enter"&&ye()}),e.jsx("button",{onClick:ye,className:"px-3 py-2 bg-emerald-500 rounded-lg text-slate-900 font-medium hover:bg-emerald-400 transition",children:e.jsx(je,{})}),e.jsx("button",{onClick:()=>{b(s?.name||""),d(!1)},className:"px-3 py-2 bg-slate-700 rounded-lg text-white hover:bg-slate-600 transition",children:e.jsx(De,{})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:s?.name||"Customer"}),e.jsx("button",{onClick:()=>d(!0),className:"p-1 hover:bg-white/10 rounded transition",children:e.jsx(Kt,{className:"text-white/40 text-sm"})})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:l?.phoneNumber}),s?.email&&e.jsx("p",{className:"text-slate-500 text-xs",children:s.email})]})]})]}),e.jsx("div",{className:"px-4 -mt-6",children:e.jsx("div",{className:"bg-white/5/50 backdrop-blur-xl rounded-xl border border-white/10/50 p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:at}),e.jsx("p",{className:"text-xs text-white/40 mt-1",children:"Total Orders"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:s?.addresses?.length||0}),e.jsx("p",{className:"text-xs text-white/40 mt-1",children:"Saved Addresses"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-emerald-400",children:["â‚¹",ve.toLocaleString()]}),e.jsx("p",{className:"text-xs text-white/40 mt-1",children:"Total Savings"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-amber-400",children:Ue}),e.jsx("p",{className:"text-xs text-white/40 mt-1",children:"Loyalty Points"})]})]})})}),e.jsxs("div",{className:"mt-6 px-4 space-y-4 flex-1",style:{paddingBottom:"calc(120px + env(safe-area-inset-bottom))"},children:[e.jsxs("div",{className:"bg-white/5/50 backdrop-blur-xl rounded-xl border border-white/10/50 overflow-hidden",children:[e.jsx("p",{className:"px-4 py-3 text-sm font-medium text-white/40 border-b border-white/10",children:"Account"}),e.jsx(ae,{icon:ze,label:"Phone Number",value:l?.phoneNumber,onClick:()=>L(!0)}),e.jsx(ae,{icon:Rs,label:"Email",value:s?.email||"Not added",onClick:()=>C(!0),badge:s?.email?void 0:"Add"}),e.jsx(ae,{icon:ee,label:"Saved Addresses",value:`${s?.addresses?.length||0} addresses`,onClick:()=>g(!N)}),e.jsx(ae,{icon:fe,label:"Payment Methods",value:X.length>0?`${X.length} saved`:"No payment methods",onClick:()=>I(!0)}),e.jsx(ae,{icon:Lt,label:"Delete my account",value:"Permanently delete account and data",onClick:()=>ne(!0),danger:!0})]}),e.jsxs("div",{className:"bg-white/5/50 backdrop-blur-xl rounded-xl border border-white/10/50 overflow-hidden",children:[e.jsx("p",{className:"px-4 py-3 text-sm font-medium text-white/40 border-b border-white/10",children:"Preferences"}),e.jsx(ae,{icon:Qt,label:"Notifications",value:U.pushNotifications?"Enabled":"Disabled",onClick:()=>J(!0)}),e.jsx(ae,{icon:Os,label:"Language",value:"English",onClick:()=>alert("Language selection coming soon!")})]}),e.jsxs("div",{className:"bg-white/5/50 backdrop-blur-xl rounded-xl border border-white/10/50 overflow-hidden",children:[e.jsx("p",{className:"px-4 py-3 text-sm font-medium text-white/40 border-b border-white/10",children:"Rewards"}),e.jsx(ae,{icon:Ye,label:"Referral Code",value:nt,onClick:()=>_(!0),badge:"Earn"}),e.jsx(ae,{icon:Ls,label:"Loyalty Points",value:`${Ue} points available`,onClick:()=>alert("Loyalty points redemption coming soon!")})]}),e.jsxs("div",{className:"bg-white/5/50 backdrop-blur-xl rounded-xl border border-white/10/50 overflow-hidden",children:[e.jsx("p",{className:"px-4 py-3 text-sm font-medium text-white/40 border-b border-white/10",children:"Security"}),e.jsx(ae,{icon:Tt,label:"Account Security",value:"Manage your account security",onClick:()=>he(!0)}),e.jsx(ae,{icon:Lt,label:"Delete Account",value:"Permanently delete your account and data",onClick:()=>ne(!0),danger:!0})]}),N&&e.jsxs("div",{className:"space-y-3",children:[s?.addresses?.map(T=>e.jsx(Ka,{address:T,onSetDefault:i,onEdit:()=>{},onDelete:()=>{}},T.id)),w?e.jsxs("div",{className:"bg-white/5/50 backdrop-blur-xl rounded-xl border border-white/10/50 p-4 space-y-3",children:[e.jsx("input",{type:"text",placeholder:"Label (Home, Office, etc.)",value:u.label,onChange:T=>m({...u,label:T.target.value}),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"}),e.jsx("textarea",{placeholder:"Full address",value:u.address,onChange:T=>m({...u,address:T.target.value}),rows:2,className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-sm text-white placeholder-slate-500 resize-none focus:outline-none focus:ring-2 focus:ring-emerald-500"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>v(!1),className:"flex-1 py-2 border border-slate-600 rounded-lg text-slate-400 hover:bg-slate-700 transition",children:"Cancel"}),e.jsx("button",{onClick:Ne,className:"flex-1 py-2 bg-emerald-500 text-slate-900 rounded-lg hover:bg-emerald-400 transition font-medium",children:"Save"})]})]}):e.jsxs("button",{onClick:()=>v(!0),className:"w-full p-4 rounded-xl border-2 border-dashed border-emerald-500/30 bg-emerald-500/5 flex items-center justify-center gap-2 text-emerald-400 hover:bg-emerald-500/10 transition",children:[e.jsx(Me,{}),e.jsx("span",{children:"Add New Address"})]})]}),e.jsxs("div",{className:"bg-white/5/50 backdrop-blur-xl rounded-xl border border-white/10/50 overflow-hidden",children:[e.jsx("p",{className:"px-4 py-3 text-sm font-medium text-white/40 border-b border-white/10",children:"Support"}),e.jsx(ae,{icon:$e,label:"Help & Support",onClick:()=>k(!0)}),e.jsx(ae,{icon:It,label:"Privacy Policy",onClick:()=>window.open("/privacy.html","_blank")}),e.jsx(ae,{icon:Le,label:"About FLYP",onClick:()=>alert("FLYP - Your trusted delivery partner")})]}),e.jsx("div",{className:"bg-white/5/50 backdrop-blur-xl rounded-xl border border-white/10/50 overflow-hidden",children:e.jsx(ae,{icon:Ts,label:"Logout",onClick:ht,danger:!0})}),e.jsxs("div",{className:"flex flex-col items-center py-6",children:[e.jsx(Qa,{}),e.jsx("p",{className:"text-xs text-white/40 mt-3",children:"FLYP Customer App v1.0.9"})]})]}),e.jsx(Oe,{isOpen:A,onClose:()=>{y(s?.email||""),C(!1)},title:"Edit Email",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/60 mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:R,onChange:T=>y(T.target.value),placeholder:"Enter your email",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{y(s?.email||""),C(!1)},className:"flex-1 py-3 border border-slate-600 rounded-lg text-slate-400 hover:bg-slate-700 transition font-medium",children:"Cancel"}),e.jsx("button",{onClick:lt,className:"flex-1 py-3 bg-emerald-500 text-slate-900 rounded-lg hover:bg-emerald-400 transition font-medium",children:"Save"})]})]})}),e.jsx(Oe,{isOpen:F,onClose:()=>{B(l?.phoneNumber||""),L(!1)},title:"Edit Phone Number",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/60 mb-2",children:"Phone Number"}),e.jsx("input",{type:"tel",value:G,onChange:T=>B(T.target.value),placeholder:"Enter your phone number",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"}),e.jsx("p",{className:"text-xs text-white/40 mt-2",children:"Phone number update requires OTP verification"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{B(l?.phoneNumber||""),L(!1)},className:"flex-1 py-3 border border-slate-600 rounded-lg text-slate-400 hover:bg-slate-700 transition font-medium",children:"Cancel"}),e.jsx("button",{onClick:Qe,className:"flex-1 py-3 bg-emerald-500 text-slate-900 rounded-lg hover:bg-emerald-400 transition font-medium",children:"Update"})]})]})}),e.jsx(Oe,{isOpen:P,onClose:()=>I(!1),title:"Payment Methods",children:e.jsxs("div",{className:"space-y-4",children:[X.length>0?e.jsx("div",{className:"space-y-3",children:X.map((T,K)=>e.jsxs("div",{className:"bg-slate-700 rounded-lg p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"text-emerald-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:T.type}),e.jsx("p",{className:"text-white/40 text-sm",children:T.maskedNumber})]})]}),e.jsx("button",{className:"text-red-400 hover:text-red-300",children:e.jsx(St,{})})]},K))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{className:"text-white/20 text-4xl mx-auto mb-3"}),e.jsx("p",{className:"text-white/60",children:"No payment methods added"})]}),e.jsxs("button",{onClick:Re,className:"w-full py-3 bg-emerald-500 text-slate-900 rounded-lg hover:bg-emerald-400 transition font-medium flex items-center justify-center gap-2",children:[e.jsx(Me,{}),"Add Payment Method"]})]})}),e.jsx(Oe,{isOpen:z,onClose:()=>J(!1),title:"Notification Settings",children:e.jsx("div",{className:"space-y-4",children:Object.entries(U).map(([T,K])=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-700 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium capitalize",children:T.replace(/([A-Z])/g," $1").trim()}),e.jsxs("p",{className:"text-white/40 text-sm",children:[T==="pushNotifications"&&"Receive push notifications on your device",T==="emailNotifications"&&"Receive order updates via email",T==="smsNotifications"&&"Receive SMS updates for orders",T==="orderUpdates"&&"Get notified about order status changes",T==="offers"&&"Receive special offers and discounts"]})]}),e.jsx("button",{onClick:()=>rt(T),className:`w-12 h-6 rounded-full transition-colors ${K?"bg-emerald-500":"bg-slate-600"}`,children:e.jsx("div",{className:`w-5 h-5 rounded-full bg-white transition-transform ${K?"translate-x-6":"translate-x-1"}`})})]},T))})}),e.jsx(Oe,{isOpen:$,onClose:()=>_(!1),title:"Referral Code",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-emerald-500/20 to-teal-500/20 rounded-lg p-6 text-center border border-emerald-500/30",children:[e.jsx(Ye,{className:"text-4xl text-emerald-400 mx-auto mb-3"}),e.jsx("p",{className:"text-white/60 text-sm mb-2",children:"Your Referral Code"}),e.jsx("p",{className:"text-2xl font-bold text-white mb-4 font-mono",children:nt}),e.jsxs("button",{onClick:Ke,className:"px-4 py-2 bg-emerald-500 text-slate-900 rounded-lg hover:bg-emerald-400 transition font-medium flex items-center gap-2 mx-auto",children:[e.jsx(Is,{}),"Copy Code"]})]}),e.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[e.jsx("p",{className:"text-white font-medium mb-2",children:"How it works:"}),e.jsxs("ul",{className:"text-white/60 text-sm space-y-1",children:[e.jsx("li",{children:"â€¢ Share your code with friends"}),e.jsx("li",{children:"â€¢ They get â‚¹50 off on first order"}),e.jsx("li",{children:"â€¢ You get â‚¹50 when they place an order"})]})]})]})}),e.jsx(Oe,{isOpen:se,onClose:()=>he(!1),title:"Account Security",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(ae,{icon:Tt,label:"Change Password",value:"Update your account password",onClick:()=>alert("Password change coming soon!")}),e.jsx(ae,{icon:It,label:"Two-Factor Authentication",value:"Add an extra layer of security",onClick:()=>alert("2FA coming soon!")}),e.jsx(ae,{icon:Ms,label:"Account Activity",value:"View recent login activity",onClick:()=>alert("Account activity coming soon!")})]})}),e.jsx(Oe,{isOpen:Pe,onClose:()=>{ne(!1),ue("")},title:"Delete Account",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-white/80 text-sm",children:"This will permanently delete your FLYP account and all associated data (profile, addresses, order history). This action cannot be undone."}),e.jsxs("p",{className:"text-white/60 text-sm",children:["Type ",e.jsx("strong",{className:"text-red-400",children:"DELETE"})," below to confirm."]}),e.jsx("input",{type:"text",value:we,onChange:T=>ue(T.target.value),placeholder:"Type DELETE to confirm",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-red-500"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{ne(!1),ue("")},className:"flex-1 py-3 border border-slate-600 rounded-lg text-slate-400 hover:bg-slate-700 transition font-medium",children:"Cancel"}),e.jsx("button",{onClick:it,disabled:we!=="DELETE"||O,className:"flex-1 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed transition font-medium",children:O?"Deletingâ€¦":"Delete Account"})]})]})}),e.jsx(Dt,{isOpen:S,onClose:()=>k(!1),preSelectedOrder:null})]})},Za=({orderNumber:t,onTrack:l,onHome:s})=>e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm px-6",children:e.jsxs(E.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"bg-slate-800/95 backdrop-blur-xl rounded-2xl p-6 w-full max-w-sm text-center border border-white/10",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-emerald-500/20 border border-emerald-500/30 flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-4xl",children:"ðŸŽ‰"})}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Order Placed!"}),e.jsx("p",{className:"text-white/60 mb-2",children:"Your order has been placed successfully"}),e.jsxs("p",{className:"text-sm text-emerald-400 font-medium mb-6",children:["Order #",t]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:l,className:"w-full py-3 bg-emerald-500 text-slate-900 rounded-xl font-semibold hover:bg-emerald-400 transition",children:"Track Order"}),e.jsx("button",{onClick:s,className:"w-full py-3 bg-white/10 text-white rounded-xl font-semibold hover:bg-white/15 border border-white/10 transition",children:"Back to Home"})]})]})}),Xa=()=>{const{isLoggedIn:t,loading:l}=_e(),[s,a]=r.useState("home"),[n,o]=r.useState("home"),[i,c]=r.useState([]),[h,x]=r.useState(null),[d,f]=r.useState(null),[b,N]=r.useState(null),[g,w]=r.useState(!1),[v,u]=r.useState(""),[m,S]=r.useState(""),[k,A]=r.useState(!1);r.useEffect(()=>{h||x({lat:19.076,lng:72.8777,label:"Mumbai"}),(()=>{if(!navigator.geolocation){x({lat:19.076,lng:72.8777,label:"Mumbai"});return}navigator.geolocation.getCurrentPosition(_=>{x({lat:_.coords.latitude,lng:_.coords.longitude,label:"Current Location"})},_=>{x({lat:19.076,lng:72.8777,label:"Mumbai"})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})})()},[]);const C=Yt.useRef(!1);r.useEffect(()=>{l||t||C.current||(C.current=!0,o("home"),a("home"))},[l,t]);const R=($,_={})=>{c(se=>[...se,n]),o($),_.store&&f(_.store),_.orderId&&N(_.orderId)},y=()=>{try{if(n==="tracking"){if(N(null),i.length>0){const $=i[i.length-1];c(_=>_.slice(0,-1)),o($),$==="orders"&&a("orders")}else o("orders"),a("orders");return}if(i.length>0){const $=i[i.length-1];c(_=>_.slice(0,-1)),o($)}else o("home"),a("home")}catch($){console.error("Navigation error:",$),window.history.length>1?window.history.back():(o("home"),a("home"),c([]))}},F=$=>{if(a($),c([]),!t&&($==="orders"||$==="profile")){o("login");return}switch($){case"home":o("home");break;case"search":o("search");break;case"cart":o("cart");break;case"orders":o("orders");break;case"profile":o("profile");break;default:o("home")}},L=()=>{t?R("checkout"):(A(!0),o("login"),a("profile"))},G=()=>{k?(A(!1),R("checkout")):(o("home"),a("home"))},B=()=>{A(!1),o(k?"cart":"home"),a(k?"cart":"home")},P=$=>{R("store",{store:$})},I=($,_)=>{S($),u(_),w(!0)};if(l)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0B0F14] via-[#0D1117] to-[#0B0F14] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(E.img,{src:"/assets/flyp_logo.png",alt:"FLYP",className:"w-24 h-24 mx-auto mb-6",animate:{scale:[1,1.1,1],opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0}}),e.jsx("div",{className:"w-10 h-10 border-2 border-emerald-500/20 border-t-emerald-500 rounded-full animate-spin mx-auto"})]})});const z=!t&&["login","orders","profile","checkout"].includes(n),J=["home","search","cart","orders","profile"].includes(n);return e.jsxs("div",{className:"bg-[#0B0F14] relative w-full h-screen overflow-hidden flex flex-col",children:[!z&&e.jsxs("div",{className:"pointer-events-none fixed inset-0 opacity-30 z-0",children:[e.jsx("div",{className:"absolute -top-24 -left-24 w-[60vmax] h-[60vmax] rounded-full blur-3xl bg-gradient-to-tr from-emerald-500/30 via-teal-400/20 to-transparent"}),e.jsx("div",{className:"absolute -bottom-24 -right-24 w-[50vmax] h-[50vmax] rounded-full blur-3xl bg-gradient-to-tr from-teal-500/20 via-emerald-400/15 to-transparent"})]}),e.jsxs("main",{className:`relative z-10 w-full flex-1 min-h-0 flex flex-col ${z?"overflow-hidden":"overflow-y-auto"}`,style:{paddingBottom:J?"calc(80px + env(safe-area-inset-bottom))":"0"},children:[z&&e.jsx("div",{className:"w-full flex-1 min-h-0 overflow-hidden",style:{position:"fixed",inset:0,zIndex:20},children:e.jsx(Js,{onLoginSuccess:G,onContinueAsGuest:B,isCheckoutFlow:k})}),!z&&n==="home"&&e.jsx("div",{className:"bg-transparent w-full h-full",children:e.jsx(ca,{location:h,onNavigate:F,onStoreSelect:P,onCategorySelect:$=>R("search")})}),!z&&n==="store"&&d&&e.jsx("div",{className:"bg-transparent",children:e.jsx(ua,{storeId:d.id,onBack:y,onCartClick:()=>R("cart")})}),!z&&n==="search"&&e.jsx("div",{className:"bg-transparent",children:e.jsx(ba,{location:h,onBack:()=>F("home"),onStoreSelect:$=>{R("store",{store:{id:$}})}})}),!z&&n==="cart"&&e.jsx("div",{className:"bg-transparent",children:e.jsx(ja,{onBack:y,onCheckout:L,onStoreClick:$=>R("store",{store:{id:$}})})}),!z&&n==="checkout"&&e.jsx("div",{className:"bg-transparent",children:e.jsx(Oa,{onBack:y,onOrderPlaced:I})}),!z&&n==="tracking"&&b&&e.jsx("div",{className:"bg-transparent",children:e.jsx(qa,{orderId:b,onBack:y})}),!z&&n==="orders"&&e.jsx("div",{className:"bg-transparent",children:e.jsx(Wa,{onBack:()=>F("home"),onOrderClick:$=>R("tracking",{orderId:$})})}),!z&&n==="profile"&&e.jsx("div",{className:"bg-transparent",children:e.jsx(Ja,{onBack:()=>F("home")})})]}),J&&e.jsx(Ws,{activeTab:s,onTabChange:F}),g&&e.jsx(Za,{orderNumber:v,onTrack:()=>{w(!1),R("tracking",{orderId:m})},onHome:()=>{w(!1),F("home")}})]})},ul=()=>e.jsx(Qs,{children:e.jsx(Vs,{children:e.jsx(Gs,{children:e.jsx(Xa,{})})})});export{ul as default};
