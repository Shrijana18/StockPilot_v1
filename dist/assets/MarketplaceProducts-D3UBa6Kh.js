import{l as d,j as t}from"./index-DRC3F7i0.js";import{r as l}from"./router-BPBaD_i0.js";import{p as pe,j as fe,T as U,U as L,V as D,W as be,P as $,Q as _,X as ge,Y as ye,Z as N,_ as we,$ as je,C as ve}from"./index-CprmGC-M.js";import{a as Ne,b as Pe,g as ke,c as Q,d as H,e as Se,u as Ce,r as Fe,f as V}from"./retailerMarketplaceService-JKOUhufm.js";import{R as Y,g as Ae}from"./marketplaceOffers-DYmwRj2h.js";import{A as q}from"./index-DSciU07p.js";import{m as P}from"./proxy-BgUy8BPw.js";import"./vendor-Ckhrjn13.js";import"./firebase-DWi1MSv1.js";import"./index.esm-Bux_mLJ0.js";const De=()=>{const[z,G]=l.useState(!0),[k,g]=l.useState(!1),[h,K]=l.useState([]),[p,E]=l.useState([]),[W,X]=l.useState(null),[i,f]=l.useState([]),[I,Z]=l.useState(""),[S,J]=l.useState("all"),[c,R]=l.useState("inventory"),[y,a]=l.useState({type:"",text:""}),[o,M]=l.useState(null),[u,b]=l.useState({offerPrice:"",discountPercent:"",returnPolicy:"inherit"}),[C,w]=l.useState(null),[F,O]=l.useState(""),[B,ee]=l.useState("inherit"),[T,j]=l.useState(!1);l.useEffect(()=>{x()},[]);const x=async()=>{try{const e=d.currentUser?.uid;if(!e)return;const[s,r,n]=await Promise.all([Ne(e),Pe(e),ke(e)]);K(s),E(r),X(n)}catch(e){console.error("Error loading products:",e),a({type:"error",text:"Failed to load products"})}finally{G(!1)}},te=new Set(p.map(e=>e.originalProductId||e.id)),m=(c==="inventory"?h:p).filter(e=>{const r=(e.productName||e.name||"").toLowerCase().includes(I.toLowerCase()),n=S==="all"||e.category===S;return r&&n}),se=[...new Set(h.map(e=>e.category).filter(Boolean))],re=e=>{f(s=>s.includes(e)?s.filter(r=>r!==e):[...s,e])},ae=()=>{const e=m.map(r=>r.id),s=e.every(r=>i.includes(r));f(s?r=>r.filter(n=>!e.includes(n)):r=>[...new Set([...r,...e])])},le=async()=>{const e=d.currentUser?.uid;if(!(!e||i.length===0)){g(!0),a({type:"",text:""});try{const s=h.filter(n=>i.includes(n.id)),r=await Q(e,s);r.success?(a({type:"success",text:`${r.count} products synced to marketplace!`}),await x(),f([])):a({type:"error",text:r.error||"Sync failed"})}catch(s){a({type:"error",text:s.message})}finally{g(!1)}}},ie=async e=>{const s=d.currentUser?.uid;if(s)try{(await Se(s,e)).success&&(a({type:"success",text:`${e.productName||e.name} synced!`}),await x())}catch(r){a({type:"error",text:r.message})}},ne=async e=>{const s=d.currentUser?.uid;if(s)try{(await Fe(s,e)).success&&(a({type:"success",text:"Product removed from marketplace"}),await x())}catch(r){a({type:"error",text:r.message})}},ce=async(e,s)=>{const r=d.currentUser?.uid;if(r)try{await Ce(r,e,{isAvailable:!s}),E(n=>n.map(A=>A.id===e?{...A,isAvailable:!s}:A))}catch(n){a({type:"error",text:n.message})}},oe=async()=>{const e=d.currentUser?.uid;if(e){g(!0);try{const s=await Q(e,h);s.success&&(a({type:"success",text:`All ${s.count} products synced!`}),await x())}catch(s){a({type:"error",text:s.message})}finally{g(!1)}}},de=e=>{M(e),b({offerPrice:e.offerPrice!=null?String(e.offerPrice):"",discountPercent:e.discountPercent!=null?String(e.discountPercent):"",returnPolicy:e.returnPolicy||"inherit"})},v=()=>{M(null),b({offerPrice:"",discountPercent:"",returnPolicy:"inherit"})},xe=async()=>{const e=d.currentUser?.uid;if(!(!e||!o)){w(o.id);try{const s={returnPolicy:u.returnPolicy};u.offerPrice.trim()!==""?(s.offerPrice=parseFloat(u.offerPrice),s.discountPercent=null):u.discountPercent.trim()!==""?(s.discountPercent=parseFloat(u.discountPercent),s.offerPrice=null):(s.offerPrice=null,s.discountPercent=null);const r=await V(e,o.id,s);r.success?(a({type:"success",text:"Offer & return policy published!"}),await x(),v()):a({type:"error",text:r.error||"Failed to update"})}catch(s){a({type:"error",text:s.message})}finally{w(null)}}},ue=async()=>{const e=d.currentUser?.uid;if(!(!e||!o)){w(o.id);try{const s=await V(e,o.id,{offerPrice:null,discountPercent:null,returnPolicy:"inherit"});s.success?(a({type:"success",text:"Offer cleared. Using regular price."}),await x(),v()):a({type:"error",text:s.error||"Failed to clear"})}catch(s){a({type:"error",text:s.message})}finally{w(null)}}},me=async()=>{const e=d.currentUser?.uid,s=parseFloat(F);if(!e||i.length===0||isNaN(s)||s<1||s>99){a({type:"error",text:"Enter a discount between 1 and 99%"});return}j(!0);try{const r=await H(e,i,{discountPercent:s});r.success?(a({type:"success",text:`${r.count} products updated with ${s}% off!`}),await x(),f([]),O("")):a({type:"error",text:r.error||"Bulk update failed"})}catch(r){a({type:"error",text:r.message})}finally{j(!1)}},he=async()=>{const e=d.currentUser?.uid;if(!(!e||i.length===0)){j(!0);try{const s=await H(e,i,{returnPolicy:B});s.success?(a({type:"success",text:`Return policy set for ${s.count} products!`}),await x(),f([])):a({type:"error",text:s.error||"Bulk update failed"})}catch(s){a({type:"error",text:s.message})}finally{j(!1)}}};return z?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx("div",{className:"w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin"})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[t.jsx("p",{className:"text-white/60 text-sm",children:"Total Inventory"}),t.jsx("p",{className:"text-2xl font-bold text-white",children:h.length})]}),t.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[t.jsx("p",{className:"text-white/60 text-sm",children:"On Marketplace"}),t.jsx("p",{className:"text-2xl font-bold text-emerald-400",children:p.length})]}),t.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[t.jsx("p",{className:"text-white/60 text-sm",children:"Available"}),t.jsx("p",{className:"text-2xl font-bold text-green-400",children:p.filter(e=>e.isAvailable).length})]}),t.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[t.jsx("p",{className:"text-white/60 text-sm",children:"Out of Stock"}),t.jsx("p",{className:"text-2xl font-bold text-red-400",children:p.filter(e=>!e.inStock).length})]})]}),t.jsx(q,{children:y.text&&t.jsxs(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0},className:`p-3 rounded-lg flex items-center gap-2 ${y.type==="success"?"bg-emerald-500/20 text-emerald-300":"bg-red-500/20 text-red-300"}`,children:[y.type==="success"?t.jsx(pe,{}):t.jsx(fe,{}),y.text]})}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>R("inventory"),className:`px-4 py-2 rounded-lg font-medium transition ${c==="inventory"?"bg-emerald-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20"}`,children:[t.jsx(U,{className:"inline mr-2"}),"Inventory (",h.length,")"]}),t.jsxs("button",{onClick:()=>R("marketplace"),className:`px-4 py-2 rounded-lg font-medium transition ${c==="marketplace"?"bg-emerald-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20"}`,children:[t.jsx(L,{className:"inline mr-2"}),"Marketplace (",p.length,")"]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[c==="inventory"&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:le,disabled:k||i.length===0,className:"px-4 py-2 bg-emerald-500/20 text-emerald-300 rounded-lg hover:bg-emerald-500/30 transition disabled:opacity-50 flex items-center gap-2",children:[t.jsx(D,{}),"Sync Selected (",i.length,")"]}),t.jsxs("button",{onClick:oe,disabled:k,className:"px-4 py-2 bg-blue-500/20 text-blue-300 rounded-lg hover:bg-blue-500/30 transition disabled:opacity-50 flex items-center gap-2",children:[k?t.jsx("div",{className:"w-4 h-4 border-2 border-blue-300 border-t-transparent rounded-full animate-spin"}):t.jsx(be,{}),"Sync All"]})]}),c==="marketplace"&&i.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("input",{type:"number",min:"1",max:"99",value:F,onChange:e=>O(e.target.value),placeholder:"%",className:"w-14 px-2 py-1.5 bg-white/10 border border-white/20 rounded-lg text-white text-sm"}),t.jsxs("button",{onClick:me,disabled:T||!F,className:"px-3 py-1.5 bg-amber-500/20 text-amber-300 rounded-lg text-sm hover:bg-amber-500/30 transition disabled:opacity-50 flex items-center gap-1",children:[t.jsx($,{})," Apply % off"]})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("select",{value:B,onChange:e=>ee(e.target.value),className:"px-2 py-1.5 bg-white/10 border border-white/20 rounded-lg text-white text-sm",children:Y.map(e=>t.jsx("option",{value:e.value,className:"bg-slate-800",children:e.label},e.value))}),t.jsxs("button",{onClick:he,disabled:T,className:"px-3 py-1.5 bg-emerald-500/20 text-emerald-300 rounded-lg text-sm hover:bg-emerald-500/30 transition disabled:opacity-50 flex items-center gap-1",children:[t.jsx(_,{})," Set return"]})]})]})]})]}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[t.jsxs("div",{className:"flex-1 relative",children:[t.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-white/40"}),t.jsx("input",{type:"text",value:I,onChange:e=>Z(e.target.value),placeholder:"Search products...",className:"w-full pl-10 pr-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-emerald-500"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ye,{className:"text-white/40"}),t.jsxs("select",{value:S,onChange:e=>J(e.target.value),className:"px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-emerald-500",children:[t.jsx("option",{value:"all",className:"bg-slate-800",children:"All Categories"}),se.map(e=>t.jsx("option",{value:e,className:"bg-slate-800",children:e},e))]})]})]}),m.length>0&&t.jsx("div",{className:"flex items-center gap-3",children:t.jsxs("button",{onClick:ae,className:"flex items-center gap-2 text-sm text-white/60 hover:text-white transition",children:[t.jsx("div",{className:`w-5 h-5 rounded border ${m.every(e=>i.includes(e.id))?"bg-emerald-500 border-emerald-500":"border-white/30"} flex items-center justify-center`,children:m.every(e=>i.includes(e.id))&&t.jsx(N,{className:"text-white text-xs"})}),"Select All (",m.length,")"]})}),t.jsx("div",{className:"space-y-3",children:m.length===0?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(U,{className:"text-4xl text-white/20 mx-auto mb-3"}),t.jsx("p",{className:"text-white/60",children:"No products found"})]}):m.map(e=>{const s=c==="inventory"?te.has(e.id):!0,r=i.includes(e.id);return t.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`bg-white/5 rounded-xl p-4 border transition ${r?"border-emerald-500":"border-white/10"}`,children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{onClick:()=>re(e.id),className:`w-6 h-6 rounded border flex-shrink-0 flex items-center justify-center ${r?"bg-emerald-500 border-emerald-500":"border-white/30 hover:border-emerald-400"}`,children:r&&t.jsx(N,{className:"text-white text-xs"})}),t.jsx("div",{className:"w-16 h-16 rounded-lg bg-white/10 flex-shrink-0 overflow-hidden",children:e.imageUrl||e.image?t.jsx("img",{src:e.imageUrl||e.image,alt:e.productName||e.name,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(U,{className:"text-white/30 text-xl"})})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h4",{className:"font-semibold text-white truncate",children:e.productName||e.name}),s&&c==="inventory"&&t.jsx("span",{className:"px-2 py-0.5 bg-emerald-500/20 text-emerald-300 text-xs rounded-full",children:"Synced"}),c==="marketplace"&&!e.isAvailable&&t.jsx("span",{className:"px-2 py-0.5 bg-red-500/20 text-red-300 text-xs rounded-full",children:"Hidden"})]}),t.jsxs("div",{className:"flex items-center gap-4 text-sm text-white/60",children:[t.jsx("span",{children:e.category||"General"}),t.jsxs("span",{children:["SKU: ",e.sku||"N/A"]}),t.jsxs("span",{children:["Stock: ",e.quantity||0]}),c==="marketplace"&&t.jsxs("span",{className:"text-white/40 flex items-center gap-1",children:[t.jsx(_,{className:"text-xs"}),Ae(e.returnPolicy==="inherit"?W?.returnPolicyDefault||"replacement_available":e.returnPolicy)]})]}),t.jsxs("div",{className:"flex items-center gap-3 mt-1 flex-wrap",children:[t.jsxs("span",{className:"text-emerald-400 font-semibold",children:["₹",e.sellingPrice||e.price||0]}),e.mrp&&e.mrp>(e.sellingPrice||e.price||0)&&t.jsxs("span",{className:"text-white/40 line-through text-sm",children:["₹",e.mrp]}),e.offerLabel&&t.jsxs("span",{className:"px-2 py-0.5 bg-amber-500/20 text-amber-300 text-xs rounded-full flex items-center gap-1",children:[t.jsx($,{className:"text-xs"})," ",e.offerLabel]})]})]}),t.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:c==="inventory"?t.jsx("button",{onClick:()=>ie(e),disabled:s,className:`px-3 py-2 rounded-lg text-sm font-medium transition ${s?"bg-white/5 text-white/40 cursor-not-allowed":"bg-emerald-500/20 text-emerald-300 hover:bg-emerald-500/30"}`,children:s?t.jsxs(t.Fragment,{children:[t.jsx(N,{className:"inline mr-1"})," Synced"]}):t.jsxs(t.Fragment,{children:[t.jsx(D,{className:"inline mr-1"})," Sync"]})}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>de(e),className:"p-2 rounded-lg bg-amber-500/20 text-amber-300 hover:bg-amber-500/30 transition",title:"Edit offer & return policy",children:t.jsx(we,{})}),t.jsx("button",{onClick:()=>ce(e.id,e.isAvailable),className:`p-2 rounded-lg transition ${e.isAvailable?"bg-emerald-500/20 text-emerald-300 hover:bg-emerald-500/30":"bg-white/10 text-white/40 hover:bg-white/20"}`,title:e.isAvailable?"Hide from customers":"Show to customers",children:e.isAvailable?t.jsx(L,{}):t.jsx(je,{})}),t.jsx("button",{onClick:()=>ne(e.id),className:"p-2 rounded-lg bg-red-500/20 text-red-300 hover:bg-red-500/30 transition",title:"Remove from marketplace",children:t.jsx(ve,{})})]})})]})},e.id)})}),t.jsx(q,{children:o&&t.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70",onClick:v,children:t.jsxs(P.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:e=>e.stopPropagation(),className:"w-full max-w-md bg-slate-800 rounded-xl border border-white/10 p-5 shadow-xl",children:[t.jsxs("h3",{className:"text-lg font-semibold text-white mb-1 flex items-center gap-2",children:[t.jsx($,{className:"text-amber-400"}),"Offer & Return Policy"]}),t.jsx("p",{className:"text-white/50 text-sm mb-4 truncate",children:o.name}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-white/60 mb-1",children:"Offer price (₹) – optional"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:u.offerPrice,onChange:e=>b(s=>({...s,offerPrice:e.target.value,discountPercent:""})),placeholder:`MRP ₹${o.mrp||o.sellingPrice||0}`,className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-amber-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-white/60 mb-1",children:"Or discount % – optional"}),t.jsx("input",{type:"number",min:"1",max:"99",value:u.discountPercent,onChange:e=>b(s=>({...s,discountPercent:e.target.value,offerPrice:""})),placeholder:"e.g. 20",className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-amber-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-white/60 mb-1",children:"Return policy"}),t.jsx("select",{value:u.returnPolicy,onChange:e=>b(s=>({...s,returnPolicy:e.target.value})),className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-amber-500",children:Y.map(e=>t.jsx("option",{value:e.value,className:"bg-slate-800",children:e.label},e.value))})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2 mt-6",children:[t.jsxs("button",{onClick:xe,disabled:C,className:"flex-1 min-w-[120px] px-4 py-2.5 bg-amber-500 text-white rounded-lg font-medium hover:bg-amber-600 transition disabled:opacity-50 flex items-center justify-center gap-2",children:[C?t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):t.jsx(N,{}),"Publish"]}),t.jsx("button",{onClick:ue,disabled:C,className:"px-4 py-2.5 border border-white/20 text-white/70 rounded-lg hover:bg-white/10 transition disabled:opacity-50",children:"Clear offer"}),t.jsx("button",{onClick:v,className:"px-4 py-2.5 border border-white/20 text-white/70 rounded-lg hover:bg-white/10 transition",children:"Cancel"})]})]})})})]})};export{De as default};
