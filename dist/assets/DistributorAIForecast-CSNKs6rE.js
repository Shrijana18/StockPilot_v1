import{d as A,l as _,j as e,y as W}from"./index-DRC3F7i0.js";import{r as R}from"./router-BPBaD_i0.js";import{C as le,T as E,a as V,p as Q,am as T,u as K,k as B,A as G,K as H,al as L,o as z,aJ as Z,aK as ee,aL as de,N as oe,aM as ce,a3 as me}from"./index-CprmGC-M.js";import{d as te,e as se,c as Y,g as ae,p as re}from"./firebase-DWi1MSv1.js";import{i as xe,a as he,w as ue}from"./aiForecastingEngine-DtSDBlba.js";import{d as $}from"./dayjs.min-BE7Gq_ss.js";import{D as pe}from"./DistributorOrderRequestForm-0fxn6v9l.js";import{m as M}from"./proxy-BgUy8BPw.js";import{A as J}from"./index-DSciU07p.js";import"./vendor-Ckhrjn13.js";import"./index.esm-Bux_mLJ0.js";import"./orderStatus-BwkCpksU.js";$.extend(xe);$.extend(he);$.extend(ue);const ge=async(t,l,s)=>{try{const a=await ye(t,l),n=Number(s.quantity||0),i=Number(s.costPrice||0),r=Number(s.sellingPrice||0),c=r>0?(r-i)/r*100:0;if(!a||a.length===0)return X(s,a?.length||0);const h=be(a),g=je(a),m=we(a),u=fe(a),k=Ne(u,n,i,r),j=ve(u,n,h,m),p=ke(u,n,i,h),x=Oe(n,u,g,m),O=u.dailyDemand,v=O>0?Math.floor(n/O):null,y=Pe(v,u,g);return{...u,currentStock:n,daysUntilStockout:v,demandPattern:h,retailerAnalysis:g,seasonalPattern:m,cashFlowImpact:k,optimalOrderTiming:j,bulkOrderOpportunity:p,riskAnalysis:x,stockoutRisk:y,strategicRecommendations:Se({currentStock:n,forecast:u,demandPattern:h,retailerAnalysis:g,seasonalPattern:m,cashFlowImpact:k,optimalOrderTiming:j,riskAnalysis:x,profitMargin:c}),marketInsights:De(a,g),confidence:Re(a,g),dataQuality:Me(a)}}catch(a){return console.error("Error calculating strategic forecast:",a),X(s,0)}},ye=async(t,l)=>{try{const s=[],a={},i=$().subtract(90,"days"),r=te(A,`businesses/${t}/products`,l),c=await se(r),g=(c.exists()?c.data():null)?.sku,m=Y(A,`businesses/${t}/orderRequests`),u=await ae(m),k=["ACCEPTED","DELIVERED","SHIPPED","OUT_FOR_DELIVERY"];u.forEach(p=>{const x=p.data(),O=String(x.statusCode||x.status||"").toUpperCase();if(!k.some(d=>O.includes(d)))return;const v=x.items||[],y=x.retailerId,f=x.retailerName||"Unknown Retailer";v.forEach(d=>{const I=d.sku||d.SKU,N=d.distributorProductId||d.productId;if(!(I&&g&&I===g||N&&N===l))return;let S=null;if(x.statusTimestamps?.acceptedAt?S=x.statusTimestamps.acceptedAt.toDate?x.statusTimestamps.acceptedAt.toDate():new Date(x.statusTimestamps.acceptedAt):x.timestamp?S=x.timestamp.toDate?x.timestamp.toDate():new Date(x.timestamp):x.createdAt&&(S=x.createdAt.toDate?x.createdAt.toDate():new Date(x.createdAt)),!S||$(S).isBefore(i))return;const D=Number(d.quantity||d.qty||0),o=Number(d.price||d.sellingPrice||d.unitPrice||0)*D;s.push({date:$(S),quantity:D,revenue:o,retailerId:y,retailerName:f,orderId:p.id}),a[y]||(a[y]={name:f,totalQuantity:0,totalRevenue:0,orderCount:0,avgOrderSize:0,lastOrderDate:null,orderingFrequency:null}),a[y].totalQuantity+=D,a[y].totalRevenue+=o,a[y].orderCount+=1,(!a[y].lastOrderDate||$(S).isAfter(a[y].lastOrderDate))&&(a[y].lastOrderDate=$(S))})}),Object.keys(a).forEach(p=>{const x=a[p];x.avgOrderSize=x.totalQuantity/x.orderCount;const O=s.filter(v=>v.retailerId===p).map(v=>v.date).sort((v,y)=>v.valueOf()-y.valueOf());if(O.length>1){const v=O[O.length-1].diff(O[0],"day");x.orderingFrequency=v/(O.length-1)}});const j={};return s.forEach(p=>{const x=p.date.format("YYYY-MM-DD");j[x]||(j[x]={date:p.date,quantity:0,revenue:0,retailers:new Set,orderCount:0}),j[x].quantity+=p.quantity,j[x].revenue+=p.revenue,j[x].retailers.add(p.retailerId),j[x].orderCount+=1}),{daily:Object.values(j).sort((p,x)=>p.date.valueOf()-x.date.valueOf()).map(p=>({date:p.date,quantity:p.quantity,revenue:p.revenue,retailerCount:p.retailers.size,orderCount:p.orderCount})),retailerBreakdown:a,totalRetailers:Object.keys(a).length}}catch(s){return console.error("Error fetching strategic sales data:",s),null}},be=t=>{const l=t.daily||[];if(l.length<7)return{type:"insufficient_data",trend:"stable",volatility:"low"};const s=l.map(y=>y.quantity),a=s.reduce((y,f)=>y+f,0)/s.length,n=s.slice(0,Math.floor(s.length/2)),i=s.slice(Math.floor(s.length/2)),r=n.reduce((y,f)=>y+f,0)/n.length,h=(i.reduce((y,f)=>y+f,0)/i.length-r)/r*100,g=s.reduce((y,f)=>y+Math.pow(f-a,2),0)/s.length,m=Math.sqrt(g),u=a>0?m/a:0;let k="stable";h>20?k="growing":h<-20?k="declining":u>.5&&(k="irregular");const j={};l.forEach(y=>{const f=y.date.day();j[f]||(j[f]=[]),j[f].push(y.quantity)});const p=Object.values(j).map(y=>y.reduce((d,I)=>d+I,0)/y.length),x=Math.max(...p),O=Math.min(...p),v=x>0?(x-O)/x*100:0;return v>30&&(k="seasonal"),{type:k,trend:h>5?"increasing":h<-5?"decreasing":"stable",trendPercentage:Math.round(h),volatility:u<.3?"low":u<.6?"medium":"high",weeklyPattern:v>30,peakDay:p.indexOf(x)}},je=t=>{const l=t.retailerBreakdown||{},s=Object.values(l);if(s.length===0)return{totalRetailers:0,topRetailers:[],orderingPatterns:{}};const a=s.sort((r,c)=>c.totalQuantity-r.totalQuantity).slice(0,5).map((r,c)=>({rank:c+1,name:r.name,totalQuantity:r.totalQuantity,totalRevenue:r.totalRevenue,orderCount:r.orderCount,avgOrderSize:Math.round(r.avgOrderSize),orderingFrequency:r.orderingFrequency?Math.round(r.orderingFrequency):null,contribution:0})),n=s.reduce((r,c)=>r+c.totalQuantity,0);a.forEach(r=>{r.contribution=n>0?Math.round(r.totalQuantity/n*100):0});const i={frequent:s.filter(r=>r.orderingFrequency&&r.orderingFrequency<=7).length,weekly:s.filter(r=>r.orderingFrequency&&r.orderingFrequency>7&&r.orderingFrequency<=14).length,monthly:s.filter(r=>r.orderingFrequency&&r.orderingFrequency>14).length,irregular:s.filter(r=>!r.orderingFrequency||r.orderCount<2).length};return{totalRetailers:s.length,topRetailers:a,orderingPatterns:i,concentrationRisk:a[0]?.contribution>50}},we=t=>{const l=t.daily||[];if(l.length<30)return{hasPattern:!1};const s={};l.forEach(m=>{const u=m.date.format("YYYY-MM");s[u]||(s[u]={quantity:0,count:0}),s[u].quantity+=m.quantity,s[u].count+=1});const a=Object.entries(s).map(([m,u])=>({month:m,avgDaily:u.quantity/u.count})),n=a.reduce((m,u)=>u.avgDaily>m.avgDaily?u:m,a[0]),i=a.reduce((m,u)=>u.avgDaily<m.avgDaily?u:m,a[0]),r=n.avgDaily>0?(n.avgDaily-i.avgDaily)/n.avgDaily*100:0,c=$().format("YYYY-MM"),h=$().add(1,"month").format("YYYY-MM");s[c];const g=s[h]||a.find(m=>m.month===h);return{hasPattern:r>20,peakMonth:n.month,lowMonth:i.month,variation:Math.round(r),nextMonthPrediction:g?{month:h,expectedDemand:g.avgDaily*30,confidence:"medium"}:null}},fe=t=>{const l=t.daily||[];if(l.length===0)return{dailyDemand:0,weeklyDemand:0,monthlyDemand:0};const s=l.reduce((i,r)=>i+r.quantity,0),a=l.length,n=s/a;return{dailyDemand:Math.round(n*10)/10,weeklyDemand:Math.round(n*7),monthlyDemand:Math.round(n*30)}},Ne=(t,l,s,a)=>{const n=a-s,i=t.monthlyDemand*a,r=t.monthlyDemand*n,c=l*s,g=Math.max(0,t.monthlyDemand*1.5-l)*s,m=g>0?r/g*100:0;return{currentInventoryValue:Math.round(c),monthlyRevenuePotential:Math.round(i),monthlyProfitPotential:Math.round(r),recommendedOrderValue:Math.round(g),monthlyROI:Math.round(m),profitMargin:Math.round(n/a*100)}},ve=(t,l,s,a)=>{const n=t.dailyDemand,i=n>0?Math.floor(l/n):null,r=7,c=n*7,h=Math.ceil(n*r+c),g=l>h?Math.floor((l-h)/n):0;let m="normal";return i&&i<7?m="urgent":i&&i<14&&(m="high"),a?.nextMonthPrediction&&a.nextMonthPrediction.expectedDemand>t.monthlyDemand*1.5&&(m="high"),{reorderPoint:h,daysUntilReorder:Math.max(0,g),reorderDate:$().add(g,"days"),urgency:m,leadTime:r,safetyStock:Math.ceil(c),reason:i<r?"Order now to avoid stockout before delivery":g<=3?"Order within 3 days to maintain optimal stock":"Plan to order based on current demand"}},ke=(t,l,s,a)=>{const n=t.monthlyDemand,i=Math.max(0,n*1.5-l),c=[{minQty:100,discount:5},{minQty:250,discount:10},{minQty:500,discount:15},{minQty:1e3,discount:20}].find(k=>i<k.minQty);if(!c)return{hasOpportunity:!0,currentOrder:i,bulkThreshold:null,additionalQty:0,potentialSavings:0,recommendation:"You qualify for bulk pricing!"};const h=c.minQty-i,g=h*s*c.discount/100,m=n*3,u=i+h<=m;return{hasOpportunity:u&&h<=n,currentOrder:i,bulkThreshold:c.minQty,additionalQty:u?h:0,potentialSavings:u?Math.round(g):0,recommendation:u&&h>0?`Order ${h} more units to get ${c.discount}% bulk discount. Save â‚¹${Math.round(g)}!`:"Current order size is optimal"}},Oe=(t,l,s,a)=>{const n=l.dailyDemand,i=n>0?Math.floor(t/n):null,r=[],c=[];return i&&i<7?r.push({type:"stockout",severity:"critical",message:`Will run out in ${i} days. Risk of losing sales and retailers.`,impact:"high"}):i&&i<14&&r.push({type:"stockout",severity:"high",message:`Low stock (${i} days left). Order soon to avoid stockout.`,impact:"medium"}),s.concentrationRisk&&r.push({type:"concentration",severity:"medium",message:`${s.topRetailers[0]?.name} accounts for ${s.topRetailers[0]?.contribution}% of sales. High dependency risk.`,impact:"medium"}),a?.nextMonthPrediction&&a.nextMonthPrediction.expectedDemand>l.monthlyDemand*1.5&&r.push({type:"seasonal",severity:"high",message:`Upcoming seasonal spike expected. Demand may increase ${Math.round((a.nextMonthPrediction.expectedDemand/l.monthlyDemand-1)*100)}% next month.`,impact:"high"}),l.monthlyDemand>0&&t>l.monthlyDemand*2&&c.push({type:"overstock",message:`You have ${Math.round(t/l.monthlyDemand)} months of stock. Consider reducing next order.`}),s.totalRetailers>5&&c.push({type:"growth",message:`Selling to ${s.totalRetailers} retailers. Strong market demand!`}),{risks:r,opportunities:c,overallRisk:r.some(h=>h.severity==="critical")?"critical":r.some(h=>h.severity==="high")?"high":r.some(h=>h.severity==="medium")?"medium":"low"}},Pe=(t,l,s)=>{if(t===null)return{level:"low",probability:0,impact:"low",message:"Cannot calculate - no demand data"};let a="low",n=0;t<3?(a="critical",n=95):t<7?(a="high",n=70):t<14?(a="medium",n=40):t<30&&(a="low",n=20),s.concentrationRisk&&a!=="critical"&&(n+=10);const i=a==="critical"?"high":a==="high"?"medium":"low";return{level:a,probability:Math.min(100,n),impact:i,message:t<7?`High probability (${n}%) of stockout in ${t} days. Immediate action required.`:`Low probability (${n}%) of stockout. Monitor closely.`}},Se=t=>{const l=[],{forecast:s,demandPattern:a,retailerAnalysis:n,seasonalPattern:i,cashFlowImpact:r,optimalOrderTiming:c}=t;return c.urgency==="urgent"&&l.push({priority:1,category:"stockout_prevention",title:"ðŸš¨ Order Immediately",message:`Order ${Math.ceil(s.monthlyDemand*1.5)} units now to prevent stockout.`,action:"order_now",impact:"critical",estimatedValue:`Prevent loss of â‚¹${Math.round(s.weeklyDemand*r.profitMargin)} in sales`}),r.recommendedOrderValue>0&&r.monthlyROI>50&&l.push({priority:2,category:"profit_optimization",title:"ðŸ’° High ROI Opportunity",message:`Ordering now yields ${r.monthlyROI}% monthly ROI. Strong profit potential!`,action:"order_bulk",impact:"high",estimatedValue:`Potential profit: â‚¹${r.monthlyProfitPotential}/month`}),i?.nextMonthPrediction&&l.push({priority:3,category:"seasonal_planning",title:"ðŸ“… Prepare for Seasonal Spike",message:`Demand expected to increase ${Math.round((i.nextMonthPrediction.expectedDemand/s.monthlyDemand-1)*100)}% next month. Stock up now!`,action:"order_seasonal",impact:"high",estimatedValue:`Capture additional â‚¹${Math.round((i.nextMonthPrediction.expectedDemand-s.monthlyDemand)*r.profitMargin)} in profit`}),n.concentrationRisk&&l.push({priority:4,category:"risk_mitigation",title:"ðŸŽ¯ Diversify Retailer Base",message:`Top retailer accounts for ${n.topRetailers[0]?.contribution}% of sales. Consider expanding to reduce dependency.`,action:"expand_retailers",impact:"medium",estimatedValue:"Reduce business risk"}),a.trend==="growing"&&a.trendPercentage>20&&l.push({priority:5,category:"growth_opportunity",title:"ðŸ“ˆ Growing Demand Detected",message:`Sales increasing ${a.trendPercentage}%. Consider increasing stock to capture growth.`,action:"increase_stock",impact:"medium",estimatedValue:`Potential additional revenue: â‚¹${Math.round(s.monthlyDemand*.2*r.profitMargin)}/month`}),l.sort((h,g)=>h.priority-g.priority)},De=(t,l)=>{const s=[];l.totalRetailers>10&&s.push({type:"market_penetration",message:`Strong market presence: Serving ${l.totalRetailers} retailers`,strength:"high"});const a=l.orderingPatterns.frequent||0;return a>l.totalRetailers*.5&&s.push({type:"customer_loyalty",message:`${a} retailers order weekly. High customer retention!`,strength:"high"}),s},Re=(t,l)=>{const a=(t.daily||[]).length;let n=0;return a>=60?n=90:a>=30?n=75:a>=14?n=60:a>=7?n=50:a>=3?n=40:a>=1&&(n=35),l.totalRetailers>5&&(n+=5),l.totalRetailers>10&&(n+=5),Math.min(95,n)},Me=t=>{const l=t.daily||[],s=l.length;return{daysOfData:s,isSufficient:s>=7,quality:s>=30?"excellent":s>=14?"good":s>=7?"fair":s>=3?"limited":"insufficient",retailers:t.totalRetailers||0,dataPoints:l.reduce((a,n)=>a+n.orderCount,0)}},X=(t,l)=>{const s=Number(t.quantity||0),a=Number(t.costPrice||0),n=Number(t.sellingPrice||0);let i="low",r="low",c=[];return s===0?(i="critical",r="urgent",c.push({priority:1,category:"stockout_prevention",title:"ðŸš¨ Out of Stock",message:"This product is out of stock. Order immediately to fulfill retailer orders.",action:"order_now",impact:"critical"})):s<=5?(i="high",r="high",c.push({priority:1,category:"stockout_prevention",title:"âš ï¸ Very Low Stock",message:`Only ${s} units remaining. Order now to avoid stockout.`,action:"order_urgent",impact:"high"})):s<=10&&(i="medium",r="medium",c.push({priority:2,category:"inventory_management",title:"ðŸ“¦ Stock Getting Low",message:`Stock is ${s} units. Plan to reorder soon.`,action:"order_soon",impact:"medium"})),{dailyDemand:0,weeklyDemand:0,monthlyDemand:0,currentStock:s,daysUntilStockout:null,demandPattern:{type:"insufficient_data",trend:"stable"},retailerAnalysis:{totalRetailers:0,topRetailers:[]},seasonalPattern:{hasPattern:!1},cashFlowImpact:{currentInventoryValue:Math.round(s*a),monthlyRevenuePotential:0,monthlyProfitPotential:0,recommendedOrderValue:s<=10?Math.round(20*a):0,monthlyROI:0,profitMargin:n>0?Math.round((n-a)/n*100):0},optimalOrderTiming:{reorderPoint:10,daysUntilReorder:0,reorderDate:$(),urgency:r,leadTime:7,safetyStock:5,reason:"Based on current stock levels"},bulkOrderOpportunity:{hasOpportunity:!1},riskAnalysis:{risks:i!=="low"?[{type:"stock",severity:i,message:`Current stock: ${s} units`,impact:i==="critical"?"high":"medium"}]:[],opportunities:[],overallRisk:i},stockoutRisk:{level:i,probability:i==="critical"?100:i==="high"?70:0,impact:i==="critical"?"high":"medium",message:i==="critical"?"Out of stock!":i==="high"?"Very low stock":"Stock is good"},strategicRecommendations:c,marketInsights:[],confidence:20,dataQuality:{daysOfData:l,isSufficient:!1,quality:"insufficient",retailers:0,dataPoints:0}}},Fe=({forecast:t,onClose:l})=>{const[s,a]=R.useState([]),[n,i]=R.useState(!0),[r,c]=R.useState(null),[h,g]=R.useState(!1),[m,u]=R.useState({}),k=_.currentUser?.uid,j=t?.sku,p=t?.productName,x=t?.recommendedOrderQuantity||t?.optimalOrderTiming?.reorderPoint||0;R.useEffect(()=>{if(!k)return;const d=Y(A,`businesses/${k}/connectedProductOwners`),I=re(d,async N=>{const C=[];for(const S of N.docs){const D=S.data(),o=D.productOwnerId||S.id;try{const b=te(A,"businesses",o),F=await se(b),q=F.exists()?F.data():{};C.push({id:o,productOwnerId:o,...D,...q,businessName:q.businessName||D.productOwnerName||"Product Owner"})}catch(b){console.error(`Error fetching product owner ${o}:`,b),C.push({id:o,productOwnerId:o,...D,businessName:D.productOwnerName||"Product Owner"})}}a(C),C.length>0&&(j||p)?O(C):i(!1)});return()=>I()},[k,j,p]);const O=async d=>{const I={};for(const N of d)try{const C=Y(A,`businesses/${N.productOwnerId}/products`),S=await ae(C),D=[];S.forEach(o=>{const b=o.data(),F=b.sku||b.SKU||"",q=(b.name||b.productName||"").toLowerCase(),U=(p||"").toLowerCase(),P=(j||"").toLowerCase();(P&&F.toLowerCase()===P||U&&q.includes(U)||P&&q.includes(P))&&D.push({id:o.id,...b,productOwnerId:N.productOwnerId})}),D.length>0&&(I[N.productOwnerId]=D)}catch(C){console.error(`Error checking products for ${N.productOwnerId}:`,C)}u(I),i(!1)},v=d=>{c(d),g(!0)},y=()=>{W.success("Order request sent to product owner!"),g(!1),c(null),l()},f=s.filter(d=>m[d.productOwnerId]?.length>0);return h&&r?e.jsx(pe,{productOwner:r,onClose:()=>{g(!1),c(null)},onSuccess:y,initialProduct:{productName:p,sku:j,quantity:x>0?x:1,unitPrice:0}}):e.jsx(M.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:l,children:e.jsxs(M.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:d=>d.stopPropagation(),className:"bg-slate-900 rounded-xl border border-white/10 p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Order from Product Owner"}),e.jsxs("p",{className:"text-sm text-white/60 mt-1",children:[p," ",j&&`(${j})`]}),e.jsxs("p",{className:"text-sm text-emerald-400 mt-1",children:["Recommended: ",x," units"]})]}),e.jsx("button",{onClick:l,className:"text-white/60 hover:text-white text-2xl",children:e.jsx(le,{})})]}),n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-white/60",children:"Loading product owners..."})}):s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"text-4xl text-white/30 mx-auto mb-4"}),e.jsx("p",{className:"text-white/80 text-lg mb-2",children:"No Product Owners Connected"}),e.jsx("p",{className:"text-white/60 text-sm mb-4",children:"You need to connect with product owners first to place orders."}),e.jsx("button",{onClick:()=>{window.location.hash="#/distributor-dashboard?tab=product-owners",l()},className:"px-4 py-2 bg-emerald-500 hover:bg-emerald-600 rounded-lg text-white text-sm",children:"Connect with Product Owners"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-white/60 text-sm mb-4",children:"Select a product owner to place your order:"}),f.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-emerald-400/80 mb-2 font-medium",children:["âœ“ Product Available (",f.length,")"]}),f.map(d=>{const N=(m[d.productOwnerId]||[])[0];return e.jsx(M.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-emerald-500/10 rounded-lg p-4 border border-emerald-500/30 hover:border-emerald-500/50 hover:bg-emerald-500/15 transition cursor-pointer",onClick:()=>v(d),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(V,{className:"text-emerald-400 text-xl"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white text-lg",children:d.businessName||d.productOwnerName||"Product Owner"}),d.ownerName&&e.jsx("p",{className:"text-sm text-white/60",children:d.ownerName})]})]}),e.jsxs("div",{className:"ml-8 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Q,{className:"text-emerald-400 text-xs"}),e.jsxs("span",{className:"text-emerald-300",children:["Product available: ",N.name||N.productName]})]}),N.sku&&e.jsxs("p",{className:"text-xs text-white/50 ml-5",children:["SKU: ",N.sku]}),N.quantity!==void 0&&e.jsxs("p",{className:"text-xs text-white/50 ml-5",children:["Stock: ",N.quantity," units"]}),N.sellingPrice||N.mrp?e.jsxs("p",{className:"text-xs text-emerald-400 ml-5",children:["Price: â‚¹",N.sellingPrice||N.mrp||0]}):null]}),d.productOwnerEmail&&e.jsx("p",{className:"text-xs text-white/50 mt-2 ml-8",children:d.productOwnerEmail})]}),e.jsxs("button",{className:"ml-4 px-4 py-2 bg-emerald-500 hover:bg-emerald-600 rounded-lg text-white text-sm font-medium flex items-center gap-2",children:[e.jsx(T,{}),"Order"]})]})},d.id)})]}),s.filter(d=>!m[d.productOwnerId]?.length).length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-amber-400/80 mb-2 font-medium mt-4",children:["âš  Product Not Found in Catalog (",s.filter(d=>!m[d.productOwnerId]?.length).length,")"]}),s.filter(d=>!m[d.productOwnerId]?.length).map(d=>e.jsx(M.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white/5 rounded-lg p-4 border border-amber-500/30 hover:border-amber-500/50 hover:bg-white/10 transition cursor-pointer",onClick:()=>v(d),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(V,{className:"text-amber-400 text-xl"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white text-lg",children:d.businessName||d.productOwnerName||"Product Owner"}),d.ownerName&&e.jsx("p",{className:"text-sm text-white/60",children:d.ownerName})]})]}),e.jsxs("div",{className:"ml-8 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(E,{className:"text-amber-400 text-xs"}),e.jsx("span",{className:"text-amber-300",children:"Product not found in catalog - you can still order manually"})]}),e.jsxs("p",{className:"text-xs text-white/50 ml-5",children:["Product: ",p," ",j&&`(${j})`]})]}),d.productOwnerEmail&&e.jsx("p",{className:"text-xs text-white/50 mt-2 ml-8",children:d.productOwnerEmail})]}),e.jsxs("button",{className:"ml-4 px-4 py-2 bg-amber-500 hover:bg-amber-600 rounded-lg text-white text-sm font-medium flex items-center gap-2",children:[e.jsx(T,{}),"Order"]})]})},d.id))]}),s.filter(d=>!m[d.productOwnerId]?.length).length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-amber-400/80 mb-2 font-medium mt-4",children:["âš  Product Not Found in Catalog (",s.filter(d=>!m[d.productOwnerId]?.length).length,")"]}),s.filter(d=>!m[d.productOwnerId]?.length).map(d=>e.jsx(M.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white/5 rounded-lg p-4 border border-amber-500/30 hover:border-amber-500/50 hover:bg-white/10 transition cursor-pointer",onClick:()=>v(d),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(V,{className:"text-amber-400 text-xl"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white text-lg",children:d.businessName||d.productOwnerName||"Product Owner"}),d.ownerName&&e.jsx("p",{className:"text-sm text-white/60",children:d.ownerName})]})]}),e.jsxs("div",{className:"ml-8 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(E,{className:"text-amber-400 text-xs"}),e.jsx("span",{className:"text-amber-300",children:"Product not found in catalog - you can still order manually"})]}),e.jsxs("p",{className:"text-xs text-white/50 ml-5",children:["Product: ",p," ",j&&`(${j})`]})]}),d.productOwnerEmail&&e.jsx("p",{className:"text-xs text-white/50 mt-2 ml-8",children:d.productOwnerEmail})]}),e.jsxs("button",{className:"ml-4 px-4 py-2 bg-amber-500 hover:bg-amber-600 rounded-lg text-white text-sm font-medium flex items-center gap-2",children:[e.jsx(T,{}),"Order"]})]})},d.id))]})]})]})})},Be=()=>{const[t,l]=R.useState([]),[s,a]=R.useState([]),[n,i]=R.useState(!0),[r,c]=R.useState(null),[h,g]=R.useState(!1),[m,u]=R.useState("all"),[k,j]=R.useState(!1),[p,x]=R.useState(null);R.useEffect(()=>{const o=_.currentUser?.uid;if(!o)return;const b=Y(A,`businesses/${o}/products`),F=re(b,async q=>{const U=q.docs.map(P=>({id:P.id,...P.data()}));l(U),U.length>0?await O(o,U):(a([]),i(!1))});return()=>F()},[]);const O=async(o,b)=>{g(!0);try{const F=b.map(async P=>{const w=await ge(o,P.id,P);return{productId:P.id,productName:P.name||P.productName,sku:P.sku,dailyDemand:w.dailyDemand,weeklyDemand:w.weeklyDemand,monthlyDemand:w.monthlyDemand,currentStock:w.currentStock,daysUntilStockout:w.daysUntilStockout,demandPattern:w.demandPattern,retailerAnalysis:w.retailerAnalysis,seasonalPattern:w.seasonalPattern,cashFlowImpact:w.cashFlowImpact,optimalOrderTiming:w.optimalOrderTiming,bulkOrderOpportunity:w.bulkOrderOpportunity,riskAnalysis:w.riskAnalysis,stockoutRisk:w.stockoutRisk,strategicRecommendations:w.strategicRecommendations,marketInsights:w.marketInsights,confidence:w.confidence,riskLevel:w.riskAnalysis.overallRisk,riskMessage:w.stockoutRisk.message,trend:w.demandPattern.trend,trendPercentage:w.demandPattern.trendPercentage,recommendedOrderQuantity:w.optimalOrderTiming.reorderPoint,urgency:w.optimalOrderTiming.urgency,insights:w.strategicRecommendations,dataProgress:w.dataQuality}}),q=await Promise.all(F),U={critical:0,high:1,medium:2,low:3};q.sort((P,w)=>{const ie=U[P.riskLevel]??3,ne=U[w.riskLevel]??3;return ie-ne}),a(q)}catch(F){console.error("Error calculating forecasts:",F),W.error("Failed to calculate forecasts")}finally{i(!1),g(!1)}},v=async()=>{const o=_.currentUser?.uid;!o||t.length===0||(await O(o,t),W.success("Updated!"))},y=s.filter(o=>m==="all"?!0:m==="critical"?o.riskLevel==="critical":m==="high"?o.riskLevel==="high"||o.riskLevel==="critical":!0),f=s.filter(o=>o.riskLevel==="critical"),d=s.filter(o=>o.riskLevel==="high"),I=f.length+d.length,N=s.reduce((o,b)=>o+(b.recommendedOrderQuantity||0),0),C=s.reduce((o,b)=>o+(b.weeklyDemand||0),0);s.reduce((o,b)=>o+(b.retailerAnalysis?.totalRetailers||0),0),s.reduce((o,b)=>o+(b.cashFlowImpact?.currentInventoryValue||0),0),s.reduce((o,b)=>o+(b.cashFlowImpact?.monthlyProfitPotential||0),0);const S=s.reduce((o,b)=>b.daysUntilStockout&&b.daysUntilStockout<7?o+(b.weeklyDemand||0):o,0),D=s.reduce((o,b)=>{const F=b.strategicRecommendations?.[0];return F&&F.action==="order_now"?o+(b.recommendedOrderQuantity||0):o},0);return n?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(K,{className:"animate-spin text-4xl text-emerald-400"}),e.jsx("p",{className:"ml-4 text-white/60",children:"Analyzing your products..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(B,{className:"text-emerald-400"}),"Smart Stock Predictor"]}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"See which products will finish soon and how much to order"})]}),e.jsxs("button",{onClick:v,disabled:h,className:"px-4 py-2 bg-emerald-500 hover:bg-emerald-600 disabled:bg-emerald-500/50 rounded-lg text-white text-sm flex items-center gap-2 transition",children:[h?e.jsx(K,{className:"animate-spin"}):"ðŸ”„"," Update"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-red-500/10 border border-red-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-red-300 text-sm",children:"Will Finish Soon"}),e.jsx("p",{className:"text-xs text-red-200/70 mb-1",children:"(Less than 7 days)"}),e.jsx("p",{className:"text-2xl font-bold text-white mt-1",children:f.length})]}),e.jsx(G,{className:"text-red-400 text-2xl"})]})}),e.jsx(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-300 text-sm",children:"Order Needed"}),e.jsx("p",{className:"text-xs text-amber-200/70 mb-1",children:"(Within 2 weeks)"}),e.jsx("p",{className:"text-2xl font-bold text-white mt-1",children:d.length})]}),e.jsx(H,{className:"text-amber-400 text-2xl"})]})}),e.jsx(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-300 text-sm",children:"Total Products"}),e.jsx("p",{className:"text-xs text-blue-200/70 mb-1",children:"(In your stock)"}),e.jsx("p",{className:"text-2xl font-bold text-white mt-1",children:s.length})]}),e.jsx(E,{className:"text-blue-400 text-2xl"})]})}),e.jsx(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-purple-500/10 border border-purple-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-300 text-sm",children:"This Week Need"}),e.jsx("p",{className:"text-xs text-purple-200/70 mb-1",children:"(From retailers)"}),e.jsx("p",{className:"text-2xl font-bold text-white mt-1",children:S||Math.round(C)})]}),e.jsx(L,{className:"text-purple-400 text-2xl"})]})}),e.jsx(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-emerald-300 text-sm",children:"Order from PO"}),e.jsx("p",{className:"text-xs text-emerald-200/70 mb-1",children:"(Recommended)"}),e.jsx("p",{className:"text-2xl font-bold text-white mt-1",children:D||Math.round(N)})]}),e.jsx(T,{className:"text-emerald-400 text-2xl"})]})})]}),e.jsxs("div",{className:"flex gap-2 bg-white/5 rounded-lg p-1 border border-white/10",children:[e.jsx("button",{onClick:()=>u("all"),className:`flex-1 px-4 py-2 rounded-md text-sm transition ${m==="all"?"bg-emerald-500 text-white":"text-white/70 hover:text-white"}`,children:"All Products"}),e.jsxs("button",{onClick:()=>u("high"),className:`flex-1 px-4 py-2 rounded-md text-sm transition ${m==="high"?"bg-amber-500 text-white":"text-white/70 hover:text-white"}`,children:["Need Order (",I,")"]}),e.jsxs("button",{onClick:()=>u("critical"),className:`flex-1 px-4 py-2 rounded-md text-sm transition ${m==="critical"?"bg-red-500 text-white":"text-white/70 hover:text-white"}`,children:["Urgent (",f.length,")"]})]}),y.length===0?e.jsxs("div",{className:"bg-white/5 rounded-xl p-8 text-center border border-white/10",children:[e.jsx(z,{className:"text-4xl text-white/40 mx-auto mb-4"}),e.jsx("p",{className:"text-white/60",children:m==="all"?"No products found. Add products to get smart predictions.":"No products need attention right now. Great job!"})]}):e.jsx("div",{className:"space-y-3",children:y.map((o,b)=>e.jsx(Ie,{forecast:o,index:b,onSelect:()=>c(o)},o.productId))}),e.jsx(J,{children:r&&e.jsx($e,{forecast:r,onClose:()=>c(null),onOrderClick:o=>{x(o),j(!0),c(null)}})}),e.jsx(J,{children:k&&p&&e.jsx(Fe,{forecast:p,onClose:()=>{j(!1),x(null)}})})]})},Ie=({forecast:t,index:l,onSelect:s})=>{const n=t.daysUntilStockout===null||t.daysUntilStockout===1/0?{type:"good",color:"emerald",icon:e.jsx(Q,{className:"text-emerald-400"}),message:"Stock is good"}:t.daysUntilStockout<7?{type:"urgent",color:"red",icon:e.jsx(G,{className:"text-red-400"}),message:`Will finish in ${t.daysUntilStockout} days!`}:t.daysUntilStockout<14?{type:"warning",color:"amber",icon:e.jsx(H,{className:"text-amber-400"}),message:`Will finish in ${t.daysUntilStockout} days`}:{type:"good",color:"emerald",icon:e.jsx(Q,{className:"text-emerald-400"}),message:`Stock will last ${t.daysUntilStockout} days`},i=t.confidence>20,r=t.confidence>50;return e.jsx(M.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:l*.05},onClick:s,className:`border rounded-xl p-4 cursor-pointer hover:bg-white/5 transition ${n.type==="urgent"?"border-red-500/50 bg-red-500/10":n.type==="warning"?"border-amber-500/50 bg-amber-500/10":"border-emerald-500/50 bg-emerald-500/10"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.icon,e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white text-lg",children:t.productName}),t.sku&&e.jsxs("p",{className:"text-xs text-white/50",children:["SKU: ",t.sku]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"You Have"}),e.jsxs("p",{className:"text-xl font-bold text-white",children:[t.currentStock," units"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Will Finish In"}),e.jsx("p",{className:`text-xl font-bold ${t.daysUntilStockout===null||t.daysUntilStockout===1/0?"text-emerald-400":t.daysUntilStockout<7?"text-red-400":"text-amber-400"}`,children:t.daysUntilStockout===null||t.daysUntilStockout===1/0?"Not soon":`${t.daysUntilStockout} days`})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Sell Per Week"}),e.jsxs("p",{className:"text-xl font-bold text-white",children:[t.weeklyDemand||0," units",!r&&e.jsx("span",{className:"text-xs text-white/40 ml-1",children:"(est.)"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Order This Much"}),e.jsxs("p",{className:"text-xl font-bold text-emerald-400",children:[t.recommendedOrderQuantity||0," units",!r&&e.jsx("span",{className:"text-xs text-emerald-400/60 ml-1",children:"(est.)"})]})]})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-white/10",children:i?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:`text-sm font-medium ${n.type==="urgent"?"text-red-300":n.type==="warning"?"text-amber-300":"text-emerald-300"}`,children:[n.message,t.recommendedOrderQuantity>0&&e.jsxs("span",{className:"ml-2 text-white/80",children:["â†’ Order ",t.recommendedOrderQuantity," units"]})]}),!r&&e.jsx("p",{className:"text-xs text-blue-300/80",children:"ðŸ’¡ Based on current stock levels. More accurate predictions coming as we collect sales data!"})]}):e.jsxs("div",{className:"space-y-2",children:[t.insights&&t.insights.length>0&&t.insights.map((c,h)=>e.jsxs("div",{className:`p-2 rounded-lg text-sm ${c.type==="critical"?"bg-red-500/20 border border-red-500/40 text-red-200":c.type==="warning"?"bg-amber-500/20 border border-amber-500/40 text-amber-200":c.type==="success"?"bg-emerald-500/20 border border-emerald-500/40 text-emerald-200":"bg-blue-500/20 border border-blue-500/40 text-blue-200"}`,children:[e.jsx("span",{className:"mr-2",children:c.icon}),c.message]},h)),t.dataProgress&&t.dataProgress.daysOfData<t.dataProgress.minDaysRequired&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-500/10 to-purple-500/10 border border-blue-500/30 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsxs("span",{className:"text-white/70",children:[t.dataProgress.daysOfData," / ",t.dataProgress.minDaysRequired," days"]}),e.jsxs("span",{className:"text-blue-400",children:[Math.round(t.dataProgress.progressPercent),"%"]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-1 overflow-hidden",children:e.jsx(M.div,{initial:{width:0},animate:{width:`${t.dataProgress.progressPercent}%`},transition:{duration:.5},className:"h-full bg-gradient-to-r from-blue-500 to-purple-500"})})]})]})}),i&&t.trend!=="stable"&&e.jsx("div",{className:"mt-2 flex items-center gap-2 text-sm",children:t.trend==="increasing"?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"text-emerald-400"}),e.jsx("span",{className:"text-emerald-300",children:"Sales going up! Retailers buying more."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"text-red-400"}),e.jsx("span",{className:"text-red-300",children:"Sales going down. Retailers buying less."})]})})]})})})},Ce=({forecast:t})=>{const l=t.dataProgress||{daysOfData:0,daysNeeded:7,minDaysRequired:7,progressPercent:0},s=()=>{window.location.hash="#/distributor-dashboard?tab=retailer-requests"};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500/20 via-purple-500/20 to-pink-500/20 border border-blue-500/30 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"bg-blue-500/20 rounded-full p-3",children:e.jsx(z,{className:"text-3xl text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-white text-lg mb-2",children:'What is "Sales Data"?'}),e.jsxs("p",{className:"text-white/80 text-sm leading-relaxed",children:[e.jsx("strong",{className:"text-white",children:"Sales data"})," means orders from retailers. When retailers order this product from you, we track how much they buy and when. This helps us predict how much you'll need in the future!"]})]})]})}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(B,{className:"text-emerald-400"}),"Data Collection Progress"]}),e.jsxs("span",{className:"text-sm text-white/60",children:[l.daysOfData," / ",l.minDaysRequired," days"]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 mb-4 overflow-hidden",children:e.jsx(M.div,{initial:{width:0},animate:{width:`${l.progressPercent}%`},transition:{duration:.8,ease:"easeOut"},className:"h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 rounded-full"})}),e.jsx("div",{className:"bg-white/5 rounded-lg p-4",children:l.daysOfData===0?e.jsxs("p",{className:"text-white/80 text-sm",children:[e.jsx("span",{className:"font-semibold text-white",children:"You need to start collecting data!"}),e.jsx("br",{}),"We need at least ",e.jsxs("strong",{className:"text-emerald-400",children:[l.minDaysRequired," days"]})," of sales (orders from retailers) to make accurate predictions."]}):e.jsxs("p",{className:"text-white/80 text-sm",children:["Great progress! You have ",e.jsxs("strong",{className:"text-emerald-400",children:[l.daysOfData," day",l.daysOfData>1?"s":""]})," of data.",e.jsx("br",{}),"Need ",e.jsxs("strong",{className:"text-amber-400",children:[l.daysNeeded," more day",l.daysNeeded>1?"s":""]})," to unlock smart predictions!"]})})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10",children:[e.jsxs("h4",{className:"font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(L,{className:"text-purple-400"}),"How to Get Sales Data (3 Simple Steps)"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center text-white font-bold",children:"1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-white mb-1",children:"Connect with Retailers"}),e.jsx("p",{className:"text-white/70 text-sm mb-2",children:"Accept connection requests from retailers who want to buy from you."}),e.jsx("button",{onClick:s,className:"text-sm px-4 py-2 bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-500/50 rounded-lg text-emerald-300 transition",children:"Go to Retailer Requests â†’"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold",children:"2"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-white mb-1",children:"Share Your Product Catalog"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Make sure retailers can see this product in your catalog. They need to see it to order it!"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold",children:"3"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-white mb-1",children:"Wait for Orders"}),e.jsxs("p",{className:"text-white/70 text-sm",children:["Once retailers start ordering this product, we'll automatically track the data. After ",l.minDaysRequired," days of orders, you'll get smart predictions!"]})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-500/10 to-teal-500/10 border border-emerald-500/30 rounded-xl p-6",children:[e.jsxs("h4",{className:"font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(Q,{className:"text-emerald-400"}),"What You'll Get Once You Have Data"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white/5 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Smart Predictions"}),e.jsx("p",{className:"text-white font-semibold",children:"Know when to order"})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Avoid Stockouts"}),e.jsx("p",{className:"text-white font-semibold",children:"Never run out"})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Save Money"}),e.jsx("p",{className:"text-white font-semibold",children:"Order the right amount"})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Save Time"}),e.jsx("p",{className:"text-white font-semibold",children:"Auto recommendations"})]})]})]}),e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(z,{className:"text-amber-400 text-xl mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-amber-300 mb-1",children:"ðŸ’¡ Quick Tip"}),e.jsx("p",{className:"text-white/80 text-sm",children:"The more retailers order this product, the better our predictions become! Share your catalog with more retailers to get more sales data faster."})]})]})})]})},$e=({forecast:t,onClose:l,onOrderClick:s})=>{const a=t.confidence>20,n=t.retailerAnalysis||t.cashFlowImpact||t.strategicRecommendations;return e.jsx(M.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:l,children:e.jsxs(M.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:i=>i.stopPropagation(),className:"bg-slate-900 rounded-xl border border-white/10 p-6 max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:t.productName}),t.sku&&e.jsxs("p",{className:"text-sm text-white/50 mt-1",children:["SKU: ",t.sku]})]}),e.jsx("button",{onClick:l,className:"text-white/60 hover:text-white text-2xl",children:"âœ•"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:`rounded-lg p-4 border ${t.daysUntilStockout!==null&&t.daysUntilStockout<7?"bg-red-500/10 border-red-500/30":t.daysUntilStockout!==null&&t.daysUntilStockout<14?"bg-amber-500/10 border-amber-500/30":"bg-emerald-500/10 border-emerald-500/30"}`,children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.daysUntilStockout!==null&&t.daysUntilStockout<7?e.jsx(G,{className:"text-red-400 text-2xl"}):t.daysUntilStockout!==null&&t.daysUntilStockout<14?e.jsx(H,{className:"text-amber-400 text-2xl"}):e.jsx(Q,{className:"text-emerald-400 text-2xl"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold text-white",children:t.daysUntilStockout===null||t.daysUntilStockout===1/0?"Stock is Good":`Will Finish in ${t.daysUntilStockout} Days`}),e.jsxs("p",{className:"text-sm text-white/60",children:["You currently have ",t.currentStock," units"]})]})]})}),t.strategicRecommendations&&t.strategicRecommendations.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-purple-500/10 to-blue-500/10 border border-purple-500/30 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(de,{className:"text-purple-400"}),"Strategic Recommendations"]}),e.jsx("div",{className:"space-y-3",children:t.strategicRecommendations.slice(0,3).map((i,r)=>e.jsx("div",{className:`p-3 rounded-lg border ${i.impact==="critical"?"bg-red-500/20 border-red-500/40":i.impact==="high"?"bg-amber-500/20 border-amber-500/40":"bg-blue-500/20 border-blue-500/40"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:i.title.split(" ")[0]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-white text-sm mb-1",children:i.title}),e.jsx("p",{className:`text-xs ${i.impact==="critical"?"text-red-200":i.impact==="high"?"text-amber-200":"text-blue-200"}`,children:i.message}),i.estimatedValue&&e.jsxs("p",{className:"text-xs text-emerald-300 mt-1",children:["ðŸ’° ",i.estimatedValue]})]})]})},r))})]}),t.retailerAnalysis&&t.retailerAnalysis.totalRetailers>0&&e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsxs("h4",{className:"font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(L,{className:"text-blue-400"}),"Retailer Analysis",e.jsxs("span",{className:"text-xs text-white/50 ml-2",children:["(",t.retailerAnalysis.totalRetailers," retailer",t.retailerAnalysis.totalRetailers>1?"s":"",")"]})]}),t.retailerAnalysis.topRetailers&&t.retailerAnalysis.topRetailers.length>0&&e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsx("p",{className:"text-xs text-white/60 mb-2",children:"Top Retailers:"}),t.retailerAnalysis.topRetailers.slice(0,3).map((i,r)=>e.jsxs("div",{className:"flex items-center justify-between bg-white/5 rounded p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-white/50",children:["#",i.rank]}),e.jsx("span",{className:"text-sm text-white",children:i.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs text-white/60",children:[i.contribution,"% of sales"]}),e.jsxs("p",{className:"text-xs text-white/40",children:[i.avgOrderSize," units/order"]})]})]},r))]}),t.retailerAnalysis.concentrationRisk&&e.jsx("div",{className:"bg-amber-500/20 border border-amber-500/40 rounded p-2 text-xs text-amber-200",children:"âš ï¸ High dependency on top retailer. Consider diversifying."})]}),t.demandPattern&&e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsxs("h4",{className:"font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(B,{className:"text-emerald-400"}),"Demand Pattern"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Pattern Type"}),e.jsx("p",{className:"text-sm font-semibold text-white capitalize",children:t.demandPattern.type||"stable"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Trend"}),e.jsxs("p",{className:`text-sm font-semibold flex items-center gap-1 ${t.demandPattern.trend==="increasing"?"text-emerald-400":t.demandPattern.trend==="decreasing"?"text-red-400":"text-white"}`,children:[t.demandPattern.trend==="increasing"&&e.jsx(Z,{}),t.demandPattern.trend==="decreasing"&&e.jsx(ee,{}),t.demandPattern.trend||"stable",t.demandPattern.trendPercentage&&` (${t.demandPattern.trendPercentage}%)`]})]})]})]}),a&&e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsxs("h4",{className:"font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(L,{className:"text-blue-400"}),"What Retailers Will Need"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Per Day"}),e.jsxs("p",{className:"text-xl font-bold text-white",children:[t.dailyDemand||0," units"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"This Week"}),e.jsxs("p",{className:"text-xl font-bold text-white",children:[t.weeklyDemand||0," units"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"This Month"}),e.jsxs("p",{className:"text-xl font-bold text-white",children:[t.monthlyDemand||0," units"]})]})]})]}),t.cashFlowImpact&&e.jsxs("div",{className:"bg-gradient-to-r from-emerald-500/10 to-blue-500/10 border border-emerald-500/30 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(oe,{className:"text-emerald-400"}),"Cash Flow Impact"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Current Inventory Value"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:["â‚¹",t.cashFlowImpact.currentInventoryValue?.toLocaleString()||0]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Monthly Profit Potential"}),e.jsxs("p",{className:"text-lg font-bold text-emerald-400",children:["â‚¹",t.cashFlowImpact.monthlyProfitPotential?.toLocaleString()||0]})]}),t.cashFlowImpact.monthlyROI>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Monthly ROI"}),e.jsxs("p",{className:"text-lg font-bold text-blue-400",children:[t.cashFlowImpact.monthlyROI,"%"]})]}),t.cashFlowImpact.profitMargin>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Profit Margin"}),e.jsxs("p",{className:"text-lg font-bold text-purple-400",children:[t.cashFlowImpact.profitMargin,"%"]})]})]})]}),t.bulkOrderOpportunity&&t.bulkOrderOpportunity.hasOpportunity&&e.jsxs("div",{className:"bg-gradient-to-r from-amber-500/10 to-orange-500/10 border border-amber-500/30 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-white mb-2 flex items-center gap-2",children:[e.jsx(ce,{className:"text-amber-400"}),"Bulk Order Opportunity"]}),e.jsx("p",{className:"text-sm text-white/80 mb-2",children:t.bulkOrderOpportunity.recommendation}),t.bulkOrderOpportunity.potentialSavings>0&&e.jsxs("p",{className:"text-lg font-bold text-emerald-400",children:["Save â‚¹",t.bulkOrderOpportunity.potentialSavings.toLocaleString(),"!"]})]}),t.seasonalPattern&&t.seasonalPattern.hasPattern&&e.jsxs("div",{className:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/30 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-white mb-2 flex items-center gap-2",children:[e.jsx(me,{className:"text-purple-400"}),"Seasonal Pattern Detected"]}),t.seasonalPattern.nextMonthPrediction&&e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-white/80",children:["Demand expected to increase ",Math.round((t.seasonalPattern.nextMonthPrediction.expectedDemand/(t.monthlyDemand||1)-1)*100),"% next month"]})})]}),a&&e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsx("h4",{className:"font-semibold text-white mb-3",children:"Past Sales"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Last 7 Days"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:[t.last7DaysSales||0," units"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Last 30 Days"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:[t.last30DaysSales||0," units"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Average Per Day"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:[t.avgDailySales||0," units"]})]})]})]}),t.recommendedOrderQuantity>0&&e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-emerald-300 mb-2 flex items-center gap-2",children:[e.jsx(T,{className:"text-emerald-400"}),"Our Recommendation"]}),e.jsx("p",{className:"text-white/80 mb-3",children:"Based on how much retailers are buying, we suggest you order:"}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-emerald-400",children:t.recommendedOrderQuantity}),e.jsx("p",{className:"text-sm text-white/60 mt-1",children:"units from Product Owner"})]}),t.optimalOrderTiming&&e.jsx("p",{className:"text-xs text-white/50 mt-2",children:t.optimalOrderTiming.reason||"This will keep you stocked for about 30 days"})]}),!a&&!n&&e.jsx(Ce,{forecast:t}),t.recommendedOrderQuantity>0&&e.jsxs("button",{onClick:()=>{s?s(t):(setOrderForecast(t),setShowQuickOrder(!0))},className:"w-full py-3 bg-emerald-500 hover:bg-emerald-600 rounded-lg text-white font-semibold flex items-center justify-center gap-2 transition",children:[e.jsx(T,{}),"Order ",t.recommendedOrderQuantity," units from Product Owner"]})]})]})})};export{Be as default};
