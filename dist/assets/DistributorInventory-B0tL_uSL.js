import{p as or,j as e,q as Xe,d as je,y as M,r as tt,s as lr,u as At,g as rt,t as dr,v as yt,l as Oe,_ as cr}from"./index-DRC3F7i0.js";import{r as l,R as st}from"./router-BPBaD_i0.js";import{d as te,c as le,s as Ge,l as at,q as Rt,w as ur,g as mr,b as It,n as De,p as $e,o as hr,e as Nt,m as Ze,u as et,a as pr}from"./firebase-DWi1MSv1.js";import{P as xr,a as gr,M as br,f as fr,i as jt,b as vt,l as wr}from"./MagicScanDisplay-BEI3JqVX.js";import{l as ge}from"./logInventoryChange-kGfLyhaN.js";import{P as xe,b as yr}from"./pricing-SUVGnFgL.js";import{A as Nr}from"./AdvancedBrandInputForm-SuxBeOfL.js";import{A as jr,S as vr,R as St,Q as Sr,L as Cr,a as kr,V as Pr,b as Ar}from"./RestockOrderHistory-BifXGS1-.js";import{m as Rr}from"./proxy-BgUy8BPw.js";import"./vendor-Ckhrjn13.js";import"./index.esm-Bux_mLJ0.js";import"./index-aK8Jn4kw.js";import"./pdf-DQxUCnop.js";function Ir({rows:r,onAutofill:a,onAddSelected:c}){const[n,y]=st.useState(()=>{const N={};return r.forEach((R,V)=>N[V]=!0),N}),[d,m]=st.useState({}),o=(N,R,V)=>{m(B=>({...B,[N]:{...B[N],[R]:V}}))},b=N=>y(R=>({...R,[N]:!R[N]})),P=r.length>0&&r.every((N,R)=>n[R]),q=r.filter((N,R)=>n[R]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-auto rounded-lg border border-white/10 max-h-[60vh]",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white/10 sticky top-0 backdrop-blur-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 w-12",children:e.jsx("input",{type:"checkbox",checked:P,onChange:N=>{const R={};r.forEach((V,B)=>R[B]=N.target.checked),y(R)}})}),e.jsx("th",{className:"p-2 text-left",children:"Product"}),e.jsx("th",{className:"p-2 w-32",children:"Quantity"}),e.jsx("th",{className:"p-2 w-32",children:"Cost Price"}),e.jsx("th",{className:"p-2 w-24",children:"MRP"}),e.jsx("th",{className:"p-2 w-24",children:"Unit"}),e.jsx("th",{className:"p-2 w-16",children:"Conf."}),e.jsx("th",{className:"p-2 w-20"})]})}),e.jsxs("tbody",{children:[r.map((N,R)=>e.jsxs("tr",{className:`border-t border-white/10 ${n[R]?"bg-white/5":"opacity-60"}`,children:[e.jsx("td",{className:"p-2 text-center",children:e.jsx("input",{type:"checkbox",checked:!!n[R],onChange:()=>b(R)})}),e.jsxs("td",{className:"p-2",children:[e.jsxs("div",{className:"font-medium",children:[N.brand?`${N.brand} `:"",N.productName]}),e.jsx("div",{className:"text-xs text-white/70",children:N.category})]}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",placeholder:"Qty",className:"w-full p-1.5 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-1 focus:ring-emerald-400/50",onChange:V=>o(R,"quantity",V.target.value)})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",placeholder:"Cost",className:"w-full p-1.5 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-1 focus:ring-emerald-400/50",onChange:V=>o(R,"costPrice",V.target.value)})}),e.jsxs("td",{className:"p-2 text-center",children:[N.mrp?`â‚¹${N.mrp}`:"-",N.sellingPrice&&N.sellingPrice!==N.mrp&&e.jsxs("div",{className:"text-xs text-white/60",children:["SP: â‚¹",N.sellingPrice]})]}),e.jsx("td",{className:"p-2 text-center",children:N.unit||"-"}),e.jsxs("td",{className:"p-2 text-center",children:[Math.round((N.confidence||0)*100),"%"]}),e.jsx("td",{className:"p-2 text-right",children:e.jsx("button",{className:"text-xs px-2 py-1 rounded bg-emerald-400/20 hover:bg-emerald-400/30",onClick:()=>a(N),children:"Fill Form"})})]},R)),!r.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-4 text-center text-white/70",children:"No items detected"})})]})]})}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-white/70",children:[q.length," of ",r.length," products selected"]}),e.jsx("button",{disabled:!q.length,onClick:()=>c(q,d),className:"px-3 py-2 rounded-xl font-semibold text-slate-900 bg-gradient-to-r from-emerald-400 via-teal-300 to-cyan-400 disabled:opacity-50",children:"Add Selected Products to Inventory"})]})]})}const Mr=()=>{const{user:r}=or();if(!r)return console.warn("No current user found in context."),e.jsx("div",{className:"p-4 text-red-500",children:"Loading user info..."});const[a,c]=l.useState(!1),[n,y]=l.useState({productName:"",sku:"",brand:"",category:"",quantity:"",costPrice:"",sellingPrice:"",unit:"",description:"",image:null}),[d,m]=l.useState(xe.LEGACY),[o,b]=l.useState({mrp:"",basePrice:"",taxRate:"",legacySellingPrice:"",hsnCode:"",taxSource:"",taxConfidence:""}),[P,q]=l.useState(!1),[N,R]=l.useState(null),[V,B]=l.useState(!1),[g,L]=l.useState(""),[C,j]=l.useState(!1),[S,f]=l.useState(!1),[h,U]=l.useState(!1),[O,W]=l.useState(!1),[K,H]=l.useState(!1),[Q,re]=l.useState({items:[],count:0}),[D,Z]=l.useState([]),[ae,ce]=l.useState(""),be=async s=>{const w=String(s||"").trim();if(w)try{L(w),f(!0),ce("");const k=Xe();if(!k)return;const E=Rt(le(je,"businesses",k,"products"),ur("barcode","==",w)),v=await mr(E);if(!v.empty){const $=v.docs[0].data();y(T=>({...T,productName:$.productName||T.productName,brand:$.brand||T.brand,category:$.category||T.category,sku:$.sku||T.sku,unit:$.unit||T.unit,description:$.description||T.description})),ce("your-inventory"),Z([]),M.info("This barcode already exists in your inventory. Pre-filled from your record.");return}try{const $=await wr(w);y(T=>({...T,productName:$.productName||T.productName,brand:$.brand||T.brand,category:$.category||T.category,unit:$.size||T.unit})),ce($.source||"catalog"),Z([]),M.success("âœ¨ Auto-filled from barcode lookup. Please confirm price & tax.")}catch{M.warn("No public info found for this code. Please enter details manually.")}}catch(k){console.warn("prefillFromCode error:",k),M.error("Failed to look up product details.")}finally{f(!1)}},Se=(s={})=>{y(w=>({...w,productName:s.productName||w.productName,brand:s.brand||w.brand,category:s.category||w.category,sku:s.sku||w.sku,unit:s.unit||w.unit,description:s.description||w.description})),s.hsn&&b(w=>({...w,hsnCode:s.hsn,taxSource:"AI"})),s.gst!==void 0&&s.gst!==null&&s.gst!==""&&b(w=>({...w,taxRate:s.gst})),s.mrp!==void 0&&s.mrp!==null&&s.mrp!==""?b(w=>({...w,mrp:s.mrp})):s.priceMRP!==void 0&&s.priceMRP!==null&&s.priceMRP!==""&&b(w=>({...w,mrp:s.priceMRP})),s.sellingPrice!==void 0&&s.sellingPrice!==null&&s.sellingPrice!==""?b(w=>({...w,legacySellingPrice:s.sellingPrice})):s.price!==void 0&&s.price!==null&&s.price!==""&&b(w=>({...w,legacySellingPrice:s.price}))},_e=async(s,w)=>{ce(s.source||"vision");let k=[];Array.isArray(s.suggestions)&&s.suggestions.length>0?k=s.suggestions:Array.isArray(s.labels)&&s.labels.length>0&&(k=s.labels),Z(v=>Array.from(new Set([...v||[],...k||[]]))),s.code&&(await be(s.code),L(s.code)),y(v=>({...v,productName:w?.productName||s.productName||v.productName,brand:w?.brand||s.brand||v.brand,category:w?.category??s.category??v.category,sku:w?.sku||s.sku||v.sku,unit:w?.unit||s.unit||s.size||v.unit,description:w?.description||s.description||v.description})),s.hsn&&b(v=>({...v,hsnCode:s.hsn,taxSource:s.taxSource||"AI",taxConfidence:s.confidence||""})),s.gst!==void 0&&b(v=>({...v,taxRate:s.gst}));const E={high:.9,medium:.7,low:.5};typeof s.confidence=="string"&&E[s.confidence]&&b(v=>({...v,taxConfidence:E[s.confidence]})),s.mrp!==void 0&&s.mrp!==null&&s.mrp!==""?b(v=>({...v,mrp:s.mrp})):s.priceMRP!==void 0&&s.priceMRP!==null&&s.priceMRP!==""&&b(v=>({...v,mrp:s.priceMRP})),s.sellingPrice!==void 0&&s.sellingPrice!==null&&s.sellingPrice!==""?b(v=>({...v,legacySellingPrice:s.sellingPrice})):s.price!==void 0&&s.price!==null&&s.price!==""&&d===xe.LEGACY&&(o.legacySellingPrice===""||o.legacySellingPrice===void 0)&&b(v=>({...v,legacySellingPrice:s.price})),!N&&s.imageUrl&&R(s.imageUrl)},Ce=async({base64:s,framesBase64:w,barcode:k})=>{try{if(U(!0),k&&L(k),O){const T=await jt({base64:s,maxProducts:12});re(T||{items:[],count:0}),H(!0),c(!1),(T?.count??0)===0?M.info("No products detected. Try a closer photo."):M.success(`Found ${T.count} products`);return}const E=await vt({base64:s,framesBase64:Array.isArray(w)?w:void 0,barcode:k}),v=E?.autofill;v&&Se(v);const $=E?.best||{};await _e({...$,suggestions:E?.suggestions},v),M.success("âœ¨ Magic Scan completed! Fields auto-filled."),c(!1)}catch(E){console.error("Magic Scan live error:",E),M.warn("Could not identify the image. Please enter details manually.")}finally{U(!1)}},ke=async s=>{const w=s.target.files?.[0];if(w)try{U(!0);const k=await fr(w);if(O){const T=await jt({base64:k,maxProducts:20});re(T||{items:[],count:0}),H(!0),(T?.count??0)===0?M.info("No products detected. Try a closer photo."):M.success(`Found ${T.count} products`);return}const E=await vt({base64:k}),v=E?.autofill;v&&Se(v);const $=E?.best||{};await _e({...$,suggestions:E?.suggestions},v),M.success("âœ¨ Magic Scan completed! Fields auto-filled.")}catch(k){console.error("Magic Scan image identify error:",k),M.warn("Could not identify the image. Please enter details manually.")}finally{U(!1),s.target.value=""}},J=s=>{const{name:w,value:k,files:E}=s.target;if(w==="image"){const v=E[0];y({...n,image:v}),R(URL.createObjectURL(v))}else y({...n,[w]:k})},Ee=async()=>{try{if(o.hsnCode&&String(o.hsnCode).trim()){M.info("HSN already filled. Clear it first to use AI.");return}if(!n.productName?.trim()){M.warn("Enter Product Name first.");return}if(P)return;q(!0);const s=await fetch("https://us-central1-stockpilotv1.cloudfunctions.net/generateHSNAndGST",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productName:n.productName,brand:n.brand,category:n.category,unit:n.unit})});let w="";try{w=await s.clone().text()}catch{}if(!s.ok){let E="";try{const v=JSON.parse(w||"{}");E=v.details||v.error||""}catch{}if(s.status===429){M.error(`Rate limited by AI: ${E||"Please wait a moment and try again."}`);return}throw new Error(`Failed to fetch HSN and GST (${s.status}) ${E||w||""}`)}const k=await s.json();b(E=>({...E,hsnCode:k.hsn||"",taxRate:k.gst!==void 0?k.gst:"",taxSource:"AI",taxConfidence:k.taxConfidence||k.confidence||""})),M.success("âœ¨ HSN & GST auto-suggest applied!")}catch(s){console.error("Auto-suggest error:",s),M.error("âŒ Failed to auto-suggest HSN & GST.")}finally{q(!1)}},fe=async s=>{s.preventDefault();const w=Xe();if(!w)return;B(!0);const{productName:k,sku:E,quantity:v,costPrice:$}=n;let T="";if(d===xe.LEGACY?!o.legacySellingPrice&&!n.sellingPrice&&(T="Please enter Selling Price."):d===xe.MRP_INCLUSIVE?o.mrp||(T="Please enter MRP (incl. GST)."):d===xe.BASE_PLUS_TAX&&(o.basePrice||(T="Please enter Unit/Base Price.")),!k||!E||!v||!$||T){M.error(T||"Please fill all required fields"),B(!1);return}try{const z=yr(d,{mrp:Number(o.mrp),basePrice:Number(o.basePrice),taxRate:Number(o.taxRate),legacySellingPrice:Number(o.legacySellingPrice!==""?o.legacySellingPrice:n.sellingPrice)});let ie="";if(n.image){const pe=tt(lr,`inventory/${w}/${Date.now()}_${n.image.name}`);await At(pe,n.image),ie=await rt(pe)}const ne=te(le(je,"businesses",w,"products"));await at(ne,{productName:n.productName,sku:n.sku,brand:n.brand,category:n.category,quantity:Number(n.quantity),costPrice:Number(n.costPrice),sellingPrice:z.sellingPrice,pricingMode:z.pricingMode,...z.mrp!==void 0?{mrp:z.mrp}:{},...z.basePrice!==void 0?{basePrice:z.basePrice}:{},...z.taxRate!==void 0?{taxRate:z.taxRate}:{},...o.hsnCode?{hsnCode:o.hsnCode}:{},...o.taxSource?{taxSource:o.taxSource}:{},...o.taxConfidence?{taxConfidence:Number(o.taxConfidence)}:{},...g?{barcode:g}:{},unit:n.unit,description:n.description,imageUrl:ie,id:ne.id,createdAt:Ge(),addedBy:w}),await ge({productId:ne.id,sku:n.sku,previousData:{},updatedData:{productName:n.productName,sku:n.sku,brand:n.brand,category:n.category,quantity:Number(n.quantity),costPrice:Number(n.costPrice),sellingPrice:z.sellingPrice,pricingMode:z.pricingMode,...z.mrp!==void 0?{mrp:z.mrp}:{},...z.basePrice!==void 0?{basePrice:z.basePrice}:{},...z.taxRate!==void 0?{taxRate:z.taxRate}:{},...o.hsnCode?{hsnCode:o.hsnCode}:{},...o.taxSource?{taxSource:o.taxSource}:{},...o.taxConfidence?{taxConfidence:Number(o.taxConfidence)}:{},...g?{barcode:g}:{},unit:n.unit,description:n.description,imageUrl:ie},action:"created",source:"manual"}),M.success("âœ… Product added successfully!"),y({productName:"",sku:"",brand:"",category:"",quantity:"",costPrice:"",sellingPrice:"",unit:"",description:"",image:null}),m(xe.LEGACY),b({mrp:"",basePrice:"",taxRate:"",legacySellingPrice:"",hsnCode:"",taxSource:"",taxConfidence:""}),R(null),L(""),j(!1)}catch(z){console.error("Error adding product:",z),M.error("âŒ Failed to add product. Please try again.")}finally{B(!1)}};return e.jsxs("div",{className:"p-4 mt-4 rounded-xl bg-white/10 backdrop-blur-xl border border-white/10 shadow-[0_8px_40px_rgba(0,0,0,0.35)] text-white",children:[e.jsx("div",{className:"mb-4 p-4 rounded-xl border border-white/15 bg-gradient-to-r from-purple-600/30 via-pink-500/20 to-orange-400/20",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-base font-semibold text-white flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"âœ¨"})," FLYP Magic Scan"]}),e.jsx("p",{className:"text-xs text-white/80 mt-1",children:"Point your camera or upload a photo â€” we'll magically read the product and auto-fill details."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>c(!0),className:"px-4 py-2 rounded-xl font-semibold text-white bg-gradient-to-r from-purple-500 via-pink-400 to-orange-400 shadow-lg hover:shadow-xl text-sm flex items-center gap-2",title:"Scan live with camera",children:"ðŸ“· Magic Scan (Live)"}),e.jsx("button",{type:"button",onClick:()=>document.getElementById("magic-photo-input-top")?.click(),className:"px-4 py-2 rounded-xl font-semibold text-white bg-gradient-to-r from-purple-500 via-pink-400 to-orange-400 shadow-lg hover:shadow-xl text-sm flex items-center gap-2",title:"Upload a product photo",children:"ðŸ–¼ï¸ Upload Photo"}),e.jsx("input",{id:"magic-photo-input-top",type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:ke}),e.jsxs("label",{className:"ml-1 inline-flex items-center gap-2 text-[11px] text-white/85 px-2 py-1 rounded-lg border border-white/15 bg-white/5",children:[e.jsx("input",{type:"checkbox",checked:O,onChange:s=>W(s.target.checked),className:"accent-emerald-400"}),"Batch mode"]})]})]})}),e.jsx("h2",{className:"text-lg font-semibold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-white via-white to-emerald-200",children:"Add Inventory Manually"}),e.jsxs("form",{onSubmit:fe,className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx("input",{type:"text",name:"productName",placeholder:"Product Name",value:n.productName,onChange:J,required:!0,className:"p-2 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}),e.jsx("input",{type:"text",name:"sku",placeholder:"SKU",value:n.sku,onChange:J,required:!0,className:"p-2 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}),e.jsx("input",{type:"text",name:"brand",placeholder:"Brand",value:n.brand,onChange:J,className:"p-2 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}),e.jsx("input",{type:"text",name:"category",placeholder:"Category",value:n.category,onChange:J,className:"p-2 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("input",{type:"text",name:"barcode",placeholder:"Barcode / QR (optional)",value:g,onChange:s=>L(s.target.value.trim()),className:"p-2 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2 flex-wrap",children:[e.jsx("button",{type:"button",onClick:()=>j(!0),className:"px-3 py-2 rounded-md border border-white/20 bg-white/5 hover:bg-white/10 text-white text-sm",title:"Scan with camera",children:"Scan Barcode / QR"}),e.jsx("button",{type:"button",onClick:()=>be(g),disabled:!g||S,className:"px-3 py-2 rounded-md border border-white/20 bg-white/5 hover:bg-white/10 text-white text-sm disabled:opacity-50",title:"Lookup details for the typed code",children:"Fetch details"})]}),S&&e.jsx("p",{className:"mt-1 text-xs text-white/60",children:"Looking up product detailsâ€¦"}),h&&e.jsx("p",{className:"mt-1 text-xs text-pink-200 animate-pulse",children:"âœ¨ Scanning magicallyâ€¦"}),ae&&!S&&!h&&e.jsxs("p",{className:"mt-1 text-xs text-emerald-300/90",children:["Auto-filled from"," ",e.jsx("span",{className:"font-semibold",children:(()=>{const s=(ae||"").toLowerCase();return s.includes("gemini")?"Gemini AI":s.includes("gpt-4o")?"ChatGPT":s.includes("hybrid-ai")?"Hybrid AI":s.includes("vision+kg+search")?"vision + KG + web":s.includes("vision+kg")?"vision + KG":s.includes("vision+search")?"vision + web":s.includes("kg+search")?"KG + web":s==="vision"?"vision":s==="kg"?"KG":s==="search"||s==="web"?"web":s==="your-inventory"?"your inventory":s==="openfoodfacts"?"OpenFoodFacts":s==="digit-eyes"?"Digit-Eyes":s==="vision-batch"?"vision (batch)":ae})()})]}),!!D.length&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-xs text-white/70",children:"Did you mean:"}),D.filter((s,w,k)=>s&&k.indexOf(s)===w).slice(0,5).map((s,w)=>e.jsx("button",{type:"button",onClick:()=>y(k=>({...k,productName:s})),className:"text-xs px-2 py-1 rounded-full border border-white/20 bg-white/5 hover:bg-white/10 text-white",title:"Use this as Product Name",children:s.length>36?s.slice(0,34)+"â€¦":s},w))]})]}),e.jsx("input",{type:"number",name:"quantity",placeholder:"Quantity",value:n.quantity,onChange:J,required:!0,className:"p-2 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}),e.jsx("input",{type:"number",name:"costPrice",placeholder:"Cost Price",value:n.costPrice,onChange:J,required:!0,className:"p-2 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}),e.jsxs("div",{className:"col-span-2 rounded-xl border border-white/15 bg-white/5 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-white/90 mb-2",children:"Pricing"}),e.jsx(xr,{mode:d,setMode:m,values:o,onChange:s=>b(w=>({...w,...s})),productName:n.productName,category:n.category})]}),e.jsxs("div",{className:"col-span-2 rounded-xl border border-white/15 bg-white/5 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-white/90 mb-2",children:"Tax Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 items-end",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-white/60 flex items-center gap-2",children:[e.jsx("span",{children:"HSN Code"}),o.taxSource==="AI"&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-emerald-400/15 text-emerald-300 ring-1 ring-emerald-400/25",children:"âœ¨ AI Suggested"})]}),e.jsx("input",{type:"text",name:"hsnCode",placeholder:"Enter HSN (leave blank to Auto-Suggest)",value:o.hsnCode,onChange:s=>b(w=>({...w,hsnCode:s.target.value})),className:"w-full p-2 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("p",{className:"text-xs text-white/50",children:["Not sure? Click ",e.jsx("span",{className:"font-medium",children:"Auto-Suggest"}),"."]}),o.hsnCode?.toString().trim()&&e.jsx("button",{type:"button",onClick:()=>b(s=>({...s,hsnCode:"",taxSource:"",taxConfidence:""})),className:"text-xs text-sky-300 hover:underline",children:"Clear"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-white/60",children:"GST %"}),e.jsx("input",{type:"number",name:"taxRate",placeholder:"GST %",value:o.taxRate,onChange:s=>b(w=>({...w,taxRate:s.target.value})),className:"w-full p-2 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}),e.jsx("div",{className:"md:justify-self-end",children:e.jsx("button",{type:"button",onClick:Ee,disabled:P||!n.productName?.trim()||o.hsnCode&&String(o.hsnCode).trim(),title:o.hsnCode&&String(o.hsnCode).trim()?"HSN is already filled manually. Clear it to use AI.":n.productName?.trim()?"Let AI suggest HSN & GST":"Enter Product Name first",className:"w-full md:w-auto px-4 py-2 rounded-xl font-semibold text-slate-900 bg-gradient-to-r from-emerald-400 via-teal-300 to-cyan-400 hover:shadow-[0_10px_30px_rgba(16,185,129,0.35)] disabled:opacity-50 disabled:cursor-not-allowed",children:P?"Suggestingâ€¦":"Auto-Suggest"})})]})]}),e.jsx("input",{type:"text",name:"unit",placeholder:"Unit (e.g., box, piece)",value:n.unit,onChange:J,className:"p-2 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}),e.jsx("textarea",{name:"description",placeholder:"Description",value:n.description,onChange:J,className:"p-2 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 col-span-2"}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("input",{type:"file",name:"image",accept:"image/*",onChange:J,className:"mb-2 p-2 rounded bg-white/10 border border-white/20 text-white file:bg-white/10 file:border-0 file:px-3 file:py-1 file:mr-3 file:rounded cursor-pointer"}),N&&e.jsx("img",{src:N,alt:"Product preview",className:"h-24 w-24 object-cover rounded border border-white/20 ring-1 ring-white/10"})]}),e.jsx("button",{type:"submit",disabled:V,className:"px-4 py-2 rounded-xl font-semibold text-slate-900 bg-gradient-to-r from-emerald-400 via-teal-300 to-cyan-400 hover:shadow-[0_10px_30px_rgba(16,185,129,0.35)] col-span-2 disabled:opacity-60 disabled:cursor-not-allowed",children:V?"Uploading...":"Add Product"}),e.jsx(gr,{open:C,onClose:()=>j(!1),onDetected:({rawValue:s})=>{j(!1),be(s)}})]}),K&&e.jsx("div",{className:"fixed inset-0 z-[1150] bg-black/70 backdrop-blur-sm flex items-center justify-center",children:e.jsxs("div",{className:"w-[min(760px,95vw)] max-h-[85vh] overflow-auto rounded-2xl border border-white/15 bg-white/10 p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"font-semibold",children:["Detected Products ",Q?.count?`(${Q.count})`:""]}),e.jsx("button",{onClick:()=>H(!1),className:"text-white/70 hover:text-white",children:"âœ•"})]}),e.jsx(Ir,{rows:Q?.items||[],onAutofill:s=>{Se({productName:s.productName,brand:s.brand,category:s.category,unit:s.unit,mrp:s.mrp,sellingPrice:s.sellingPrice,priceMRP:s.mrp,sku:s.barcode||""}),ce("vision-batch"),!N&&(s.imageUrl||s.thumbBase64)&&R(s.imageUrl||s.thumbBase64),s.barcode&&L(s.barcode),M.success("Added to form"),H(!1)},onAddSelected:async s=>{if(s.length)try{const w=Xe();for(const k of s){const E=te(le(je,"businesses",w,"products")),v=k.barcode&&String(k.barcode).trim()||`SKU-${Date.now()}-${Math.random().toString(36).slice(2,7).toUpperCase()}`,$=Number(k.mrp||0)||0,T=editedRows[s.indexOf(k)]?.quantity,z=editedRows[s.indexOf(k)]?.costPrice,ie={id:E.id,productName:k.productName||"",sku:v,brand:k.brand||"",category:k.category||"",quantity:Number(T||0),costPrice:Number(z||0),sellingPrice:$,pricingMode:xe.LEGACY,mrp:$,unit:k.unit||"",...k.barcode?{barcode:k.barcode}:{},createdAt:Ge(),addedBy:w};await at(E,ie),await ge({productId:E.id,sku:ie.sku,previousData:{},updatedData:ie,action:"created",source:"magic-batch"})}M.success(`Added ${s.length} products`),H(!1)}catch(w){console.error(w),M.error("Failed adding selected products.")}}})]})}),h&&e.jsx("div",{className:"fixed inset-0 z-[1000] bg-black/70 backdrop-blur-sm flex items-center justify-center",children:e.jsxs("div",{className:"w-[min(520px,90vw)] rounded-2xl border border-white/20 bg-white/10 p-6 text-center shadow-2xl",children:[e.jsxs("div",{className:"relative h-28 overflow-hidden rounded-xl border border-white/20 bg-black/40 mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/60 to-transparent animate-[scan_2s_linear_infinite]"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:e.jsx("div",{className:"w-full h-full animate-pulse opacity-30 bg-[radial-gradient(circle_at_30%_50%,rgba(255,255,255,0.25),transparent_40%),radial-gradient(circle_at_70%_50%,rgba(255,255,255,0.15),transparent_40%)]"})})]}),e.jsx("div",{className:"text-white font-semibold",children:"Analyzing product with FLYP Magicâ€¦"}),e.jsx("div",{className:"text-white/80 text-xs mt-1",children:"Reading labels, brand & size â€¢ Finding HSN/GST â€¢ Looking up catalogs"})]})}),e.jsx("style",{children:`
        @keyframes scan {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(100%); }
        }
        @keyframes scanline {
          0% { transform: translateY(-50%); opacity: 0.0; }
          10% { opacity: 1; }
          100% { transform: translateY(50%); opacity: 0.0; }
        }
      `}),e.jsx(br,{open:a,onClose:()=>c(!1),onCapture:Ce,busy:h,title:"Magic Scan (Live)",subtitle:O?"Capture once to detect multiple products.":"Align the product, hold steady, then tap Scan. We'll capture a quick burst for accuracy.",badge:O?"Batch mode":void 0})]})};let Lr={data:""},Fr=r=>typeof window=="object"?((r?r.querySelector("#_goober"):window._goober)||Object.assign((r||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:r||Lr,Dr=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Ur=/\/\*[^]*?\*\/|  +/g,Ct=/\n+/g,me=(r,a)=>{let c="",n="",y="";for(let d in r){let m=r[d];d[0]=="@"?d[1]=="i"?c=d+" "+m+";":n+=d[1]=="f"?me(m,d):d+"{"+me(m,d[1]=="k"?"":a)+"}":typeof m=="object"?n+=me(m,a?a.replace(/([^,])+/g,o=>d.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,b=>/&/.test(b)?b.replace(/&/g,o):o?o+" "+b:b)):d):m!=null&&(d=/^--/.test(d)?d:d.replace(/[A-Z]/g,"-$&").toLowerCase(),y+=me.p?me.p(d,m):d+":"+m+";")}return c+(a&&y?a+"{"+y+"}":y)+n},oe={},Mt=r=>{if(typeof r=="object"){let a="";for(let c in r)a+=c+Mt(r[c]);return a}return r},_r=(r,a,c,n,y)=>{let d=Mt(r),m=oe[d]||(oe[d]=(b=>{let P=0,q=11;for(;P<b.length;)q=101*q+b.charCodeAt(P++)>>>0;return"go"+q})(d));if(!oe[m]){let b=d!==r?r:(P=>{let q,N,R=[{}];for(;q=Dr.exec(P.replace(Ur,""));)q[4]?R.shift():q[3]?(N=q[3].replace(Ct," ").trim(),R.unshift(R[0][N]=R[0][N]||{})):R[0][q[1]]=q[2].replace(Ct," ").trim();return R[0]})(r);oe[m]=me(y?{["@keyframes "+m]:b}:b,c?"":"."+m)}let o=c&&oe.g?oe.g:null;return c&&(oe.g=oe[m]),((b,P,q,N)=>{N?P.data=P.data.replace(N,b):P.data.indexOf(b)===-1&&(P.data=q?b+P.data:P.data+b)})(oe[m],a,n,o),m},Er=(r,a,c)=>r.reduce((n,y,d)=>{let m=a[d];if(m&&m.call){let o=m(c),b=o&&o.props&&o.props.className||/^go/.test(o)&&o;m=b?"."+b:o&&typeof o=="object"?o.props?"":me(o,""):o===!1?"":o}return n+y+(m??"")},"");function Ve(r){let a=this||{},c=r.call?r(a.p):r;return _r(c.unshift?c.raw?Er(c,[].slice.call(arguments,1),a.p):c.reduce((n,y)=>Object.assign(n,y&&y.call?y(a.p):y),{}):c,Fr(a.target),a.g,a.o,a.k)}let Lt,it,nt;Ve.bind({g:1});let de=Ve.bind({k:1});function qr(r,a,c,n){me.p=a,Lt=r,it=c,nt=n}function he(r,a){let c=this||{};return function(){let n=arguments;function y(d,m){let o=Object.assign({},d),b=o.className||y.className;c.p=Object.assign({theme:it&&it()},o),c.o=/ *go\d+/.test(b),o.className=Ve.apply(c,n)+(b?" "+b:"");let P=r;return r[0]&&(P=o.as||r,delete o.as),nt&&P[0]&&nt(o),Lt(P,o)}return y}}var Tr=r=>typeof r=="function",ot=(r,a)=>Tr(r)?r(a):r,Br=(()=>{let r=0;return()=>(++r).toString()})(),$r=(()=>{let r;return()=>{if(r===void 0&&typeof window<"u"){let a=matchMedia("(prefers-reduced-motion: reduce)");r=!a||a.matches}return r}})(),Or=20,Ft="default",Dt=(r,a)=>{let{toastLimit:c}=r.settings;switch(a.type){case 0:return{...r,toasts:[a.toast,...r.toasts].slice(0,c)};case 1:return{...r,toasts:r.toasts.map(m=>m.id===a.toast.id?{...m,...a.toast}:m)};case 2:let{toast:n}=a;return Dt(r,{type:r.toasts.find(m=>m.id===n.id)?1:0,toast:n});case 3:let{toastId:y}=a;return{...r,toasts:r.toasts.map(m=>m.id===y||y===void 0?{...m,dismissed:!0,visible:!1}:m)};case 4:return a.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(m=>m.id!==a.toastId)};case 5:return{...r,pausedAt:a.time};case 6:let d=a.time-(r.pausedAt||0);return{...r,pausedAt:void 0,toasts:r.toasts.map(m=>({...m,pauseDuration:m.pauseDuration+d}))}}},Gr=[],Vr={toasts:[],pausedAt:void 0,settings:{toastLimit:Or}},ve={},Ut=(r,a=Ft)=>{ve[a]=Dt(ve[a]||Vr,r),Gr.forEach(([c,n])=>{c===a&&n(ve[a])})},_t=r=>Object.keys(ve).forEach(a=>Ut(r,a)),zr=r=>Object.keys(ve).find(a=>ve[a].toasts.some(c=>c.id===r)),lt=(r=Ft)=>a=>{Ut(a,r)},Hr=(r,a="blank",c)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:a,ariaProps:{role:"status","aria-live":"polite"},message:r,pauseDuration:0,...c,id:c?.id||Br()}),Ue=r=>(a,c)=>{let n=Hr(a,r,c);return lt(n.toasterId||zr(n.id))({type:2,toast:n}),n.id},G=(r,a)=>Ue("blank")(r,a);G.error=Ue("error");G.success=Ue("success");G.loading=Ue("loading");G.custom=Ue("custom");G.dismiss=(r,a)=>{let c={type:3,toastId:r};a?lt(a)(c):_t(c)};G.dismissAll=r=>G.dismiss(void 0,r);G.remove=(r,a)=>{let c={type:4,toastId:r};a?lt(a)(c):_t(c)};G.removeAll=r=>G.remove(void 0,r);G.promise=(r,a,c)=>{let n=G.loading(a.loading,{...c,...c?.loading});return typeof r=="function"&&(r=r()),r.then(y=>{let d=a.success?ot(a.success,y):void 0;return d?G.success(d,{id:n,...c,...c?.success}):G.dismiss(n),y}).catch(y=>{let d=a.error?ot(a.error,y):void 0;d?G.error(d,{id:n,...c,...c?.error}):G.dismiss(n)}),r};var Qr=de`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Wr=de`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Kr=de`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Yr=he("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Qr} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Wr} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${r=>r.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Kr} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Jr=de`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Xr=he("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${r=>r.secondary||"#e0e0e0"};
  border-right-color: ${r=>r.primary||"#616161"};
  animation: ${Jr} 1s linear infinite;
`,Zr=de`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,es=de`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,ts=he("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Zr} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${es} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${r=>r.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,rs=he("div")`
  position: absolute;
`,ss=he("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,as=de`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,is=he("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${as} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,ns=({toast:r})=>{let{icon:a,type:c,iconTheme:n}=r;return a!==void 0?typeof a=="string"?l.createElement(is,null,a):a:c==="blank"?null:l.createElement(ss,null,l.createElement(Xr,{...n}),c!=="loading"&&l.createElement(rs,null,c==="error"?l.createElement(Yr,{...n}):l.createElement(ts,{...n})))},os=r=>`
0% {transform: translate3d(0,${r*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,ls=r=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${r*-150}%,-1px) scale(.6); opacity:0;}
`,ds="0%{opacity:0;} 100%{opacity:1;}",cs="0%{opacity:1;} 100%{opacity:0;}",us=he("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,ms=he("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,hs=(r,a)=>{let c=r.includes("top")?1:-1,[n,y]=$r()?[ds,cs]:[os(c),ls(c)];return{animation:a?`${de(n)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${de(y)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}};l.memo(({toast:r,position:a,style:c,children:n})=>{let y=r.height?hs(r.position||a||"top-center",r.visible):{opacity:0},d=l.createElement(ns,{toast:r}),m=l.createElement(ms,{...r.ariaProps},ot(r.message,r));return l.createElement(us,{className:r.className,style:{...y,...c,...r.style}},typeof n=="function"?n({icon:d,message:m}):l.createElement(l.Fragment,null,d,m))});qr(l.createElement);Ve`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`;const ps=({distributorId:r})=>{const[a,c]=l.useState(null),[n,y]=l.useState(null),[d,m]=l.useState([]),[o,b]=l.useState(!1),[P,q]=l.useState(""),[N,R]=l.useState(""),V=j=>j.split(`
`).filter(f=>typeof f=="string"&&f.trim()!=="").map(f=>{const h=f.split(",").map(U=>U.trim());if(h.length>=4)return{productName:h[0]||"",quantity:h[1]||"",unit:h[2]||"",cost:h[3]||"",brand:h[4]||"",category:h[5]||"",description:h[6]||"",sku:h[7]||"",imageUrl:h[8]||""};{const U=f.trim().split(" "),O=U.find(K=>!isNaN(K)),W=U.find(K=>["pcs","kg","ltr","box","unit"].some(H=>K.toLowerCase().includes(H)));return{productName:f.replace(O,"").replace(W,"").trim(),quantity:O||"1",unit:W||"",cost:"",brand:"",category:"",description:"",sku:"",imageUrl:""}}}),B=j=>{const S=j.target.files[0];if(!S)return;c(S);const f=new FileReader;f.onloadend=()=>y(f.result),f.readAsDataURL(S)},g=j=>new Promise((S,f)=>{const h=new FileReader;h.readAsDataURL(j),h.onload=()=>S(h.result.split(",")[1]),h.onerror=U=>f(U)}),L=async(j=!1)=>{if(a){if(a.type!=="application/pdf"&&!a.type.startsWith("image/")){G.error("Unsupported file format. Please upload an image or PDF.");return}b(!0);try{const S=await g(a);if(!S){G.error("Failed to convert file."),b(!1);return}const f=a.type==="application/pdf",h=j?"https://us-central1-stockpilotv1.cloudfunctions.net/parseCatalogueWithAI":"https://us-central1-stockpilotv1.cloudfunctions.net/ocrFromFile",U=f?{pdfBase64:S,mimeType:"application/pdf"}:{imageBase64:S};j&&(P?.trim()&&(U.brandHint=P.trim()),N?.trim()&&(U.categoryHint=N.trim()));const O=j?new AbortController:null,W=j?setTimeout(()=>O?.abort(),13e4):null,K=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(U),signal:O?.signal});W&&clearTimeout(W);const H=await K.json();if(!K.ok){G.error(H?.error||(j?"AI parse failed.":"Scan failed.")),b(!1);return}let Q=H.products||[];if(!j&&(!Array.isArray(Q)||Q.length===0)){const re=Z=>(Z||"").trim().split(`
`).map(ae=>ae.replace(/^\s*[\d\-.:]+\s*/,"").trim()).filter(ae=>ae),D=H?.text||"";D&&(Q=V(re(D).join(`
`)))}if(Array.isArray(Q)&&Q.length>0){const re=Q.map(D=>({productName:D?.productName||D?.name||"",quantity:D?.quantity??"1",unit:D?.unit||"",costPrice:D?.cost??D?.costPrice??"",sellingPrice:D?.sellingPrice??D?.price??D?.mrp??"",mrp:D?.mrp??"",brand:D?.brand||"",category:D?.category||"",description:D?.description||"",sku:D?.sku||"",imageUrl:D?.imageUrl||""})).filter(D=>D.productName);m(re),G.success(j?"AI parse complete!":f?"PDF extracted!":"OCR scan completed!")}else G.error(j?"AI found no products. Try cropping to one table section or a clearer image.":"No valid product data found. Try **Parse with AI** for catalogues.")}catch(S){console.error(j?"AI parse failed:":"OCR/PDF failed:",S);const f=S?.name==="AbortError";G.error(f?"Parsing took too long (max 2 min). Try a smaller crop or one section.":j?"AI parse failed.":"Failed to scan file.")}b(!1)}},C=async()=>{if(!d.length)return;if(!r){G.error("Distributor ID missing. Cannot save.");return}const j=d.filter(f=>f&&typeof f.productName=="string"&&f.productName.trim()!=="");if(console.log("Saving for distributorId:",r),console.log("Valid products to save:",j),!j.length){G.error("No valid products to save.");return}const S=j.map(f=>It(le(je,"businesses",r,"products"),{productName:f.productName?.trim()||"",brand:f.brand?.trim()||"",category:f.category?.trim()||"",quantity:Number(f.quantity)||0,unit:f.unit?.trim()||"",costPrice:Number(f.costPrice)||0,sellingPrice:Number(f.sellingPrice)||0,mrp:f.mrp?Number(f.mrp):void 0,description:f.description?.trim()||"",sku:f.sku?.trim()||"",imageUrl:f.imageUrl||"",createdAt:Ge()}).catch(h=>{console.error("Failed to add product:",f,h)}));try{await Promise.all(S),console.log("Products saved successfully."),G.success("All products saved!"),m([])}catch(f){console.error("Saving failed:",f),G.error("Failed to save products.")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-white/80",children:"Upload Image or Price-List PDF"}),e.jsx("input",{type:"file",accept:"image/*,application/pdf",onChange:B,className:"block w-full rounded-lg bg-slate-800/60 border border-white/10 text-white placeholder-white/50 p-2 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/40"}),n&&e.jsx("div",{className:"mt-3",children:a?.type==="application/pdf"?e.jsxs("div",{className:"px-3 py-2 rounded-lg border border-white/10 bg-slate-800/40 text-white/90 text-sm",children:["ðŸ“„ PDF: ",a?.name||"Uploaded"," â€” ready to extract"]}):e.jsx("img",{src:n,alt:"Preview",className:"max-w-xs rounded-lg border border-white/10 shadow-lg"})}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-0.5",children:"Brand hint (optional)"}),e.jsx("input",{type:"text",value:P,onChange:j=>q(j.target.value),placeholder:"e.g. Ashirvad",className:"w-full px-2 py-1.5 rounded bg-slate-800/60 border border-white/20 text-white placeholder-white/40 text-sm focus:outline-none focus:ring-1 focus:ring-emerald-400/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-0.5",children:"Category hint (optional)"}),e.jsx("input",{type:"text",value:N,onChange:j=>R(j.target.value),placeholder:"e.g. CPVC plumbing, Fittings",className:"w-full px-2 py-1.5 rounded bg-slate-800/60 border border-white/20 text-white placeholder-white/40 text-sm focus:outline-none focus:ring-1 focus:ring-emerald-400/50"})]})]}),e.jsx("p",{className:"mt-1 text-xs text-white/50",children:"Optional hints help the AI set brand/category when the catalogue is unclear."}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>L(!1),disabled:!a||o,className:`px-4 py-2 rounded-lg text-sm transition ${o||!a?"bg-slate-700/60 text-white/60 cursor-not-allowed":"bg-white/20 hover:bg-white/30 text-white border border-white/20"}`,children:o?"Scanningâ€¦":"Quick OCR"}),e.jsx("button",{onClick:()=>L(!0),disabled:!a||o,className:`px-4 py-2 rounded-lg text-sm transition ${o||!a?"bg-slate-700/60 text-white/60 cursor-not-allowed":"bg-emerald-500/90 hover:bg-emerald-500 text-white shadow-[0_6px_20px_rgba(16,185,129,.35)]"}`,title:"Best for catalogues, price lists, handwritten lists",children:o?"Parsingâ€¦":"Parse with AI"})]}),e.jsxs("p",{className:"mt-2 text-xs text-white/50",children:["Use ",e.jsx("strong",{children:"Parse with AI"})," for catalogues or handwritten lists."]}),d.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-5 rounded-xl border border-white/10 bg-slate-900/40 backdrop-blur-sm p-3",children:[e.jsx("h3",{className:"font-semibold mb-2 text-white/90",children:"Scanned Products"}),e.jsx("div",{className:"overflow-x-auto mt-4",children:e.jsxs("table",{className:"min-w-full bg-transparent rounded",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-xs bg-slate-800/60",children:[e.jsx("th",{className:"p-2 border border-white/10 text-white/80",children:"#"}),e.jsx("th",{className:"p-2 border border-white/10 text-white/80",children:"Product Name"}),e.jsx("th",{className:"p-2 border border-white/10 text-white/80",children:"Quantity"}),e.jsx("th",{className:"p-2 border border-white/10 text-white/80",children:"Unit"}),e.jsx("th",{className:"p-2 border border-white/10 text-white/80",children:"Cost Price"}),e.jsx("th",{className:"p-2 border border-white/10 text-white/80",children:"MRP"}),e.jsx("th",{className:"p-2 border border-white/10 text-white/80",children:"Selling Price"}),e.jsx("th",{className:"p-2 border border-white/10 text-white/80",children:"Action"})]})}),e.jsx("tbody",{children:d.map((j,S)=>e.jsxs("tr",{className:"text-sm",children:[e.jsx("td",{className:"p-2 border border-white/10 text-white/90",children:S+1}),e.jsx("td",{className:"p-2 border border-white/10 text-white/90",children:e.jsx("input",{type:"text",value:j.productName||"",onChange:f=>{const h=[...d];h[S].productName=f.target.value,m(h)},className:"w-full rounded-md bg-slate-800/60 border border-white/10 text-white p-1 focus:outline-none focus:ring-2 focus:ring-emerald-400/40 focus:border-emerald-400/30"})}),e.jsx("td",{className:"p-2 border border-white/10 text-white/90",children:e.jsx("input",{type:"number",value:j.quantity||"",onChange:f=>{const h=[...d];h[S].quantity=f.target.value,m(h)},className:"w-full rounded-md bg-slate-800/60 border border-white/10 text-white p-1 focus:outline-none focus:ring-2 focus:ring-emerald-400/40 focus:border-emerald-400/30"})}),e.jsx("td",{className:"p-2 border border-white/10 text-white/90",children:e.jsx("input",{type:"text",value:j.unit||"",onChange:f=>{const h=[...d];h[S].unit=f.target.value,m(h)},className:"w-full rounded-md bg-slate-800/60 border border-white/10 text-white p-1 focus:outline-none focus:ring-2 focus:ring-emerald-400/40 focus:border-emerald-400/30"})}),e.jsx("td",{className:"p-2 border border-white/10 text-white/90",children:e.jsx("input",{type:"number",value:j.costPrice||"",onChange:f=>{const h=[...d];h[S].costPrice=f.target.value,m(h)},className:"w-full rounded-md bg-slate-800/60 border border-white/10 text-white p-1 focus:outline-none focus:ring-2 focus:ring-emerald-400/40 focus:border-emerald-400/30"})}),e.jsx("td",{className:"p-2 border border-white/10 text-white/90",children:e.jsx("input",{type:"number",value:j.mrp||"",onChange:f=>{const h=[...d];h[S].mrp=f.target.value,m(h)},className:"w-full rounded-md bg-slate-800/60 border border-white/10 text-white p-1 focus:outline-none focus:ring-2 focus:ring-emerald-400/40 focus:border-emerald-400/30"})}),e.jsx("td",{className:"p-2 border border-white/10 text-white/90",children:e.jsx("input",{type:"number",value:j.sellingPrice||"",onChange:f=>{const h=[...d];h[S].sellingPrice=f.target.value,m(h)},className:"w-full rounded-md bg-slate-800/60 border border-white/10 text-white p-1 focus:outline-none focus:ring-2 focus:ring-emerald-400/40 focus:border-emerald-400/30"})}),e.jsx("td",{className:"p-2 border border-white/10 text-white/90",children:e.jsx("button",{onClick:()=>{const f=d.filter((h,U)=>U!==S);m(f)},className:"text-red-300 hover:text-red-400",children:"Delete"})})]},S))})]})})]}),e.jsx("button",{onClick:C,className:"mt-4 px-4 py-2 rounded-lg bg-emerald-500/90 hover:bg-emerald-500 text-white shadow-[0_6px_20px_rgba(16,185,129,.35)] transition",children:"Save All Products"})]})]})},xs=({userId:r})=>{const[a,c]=l.useState(""),[n,y]=l.useState([]),[d,m]=l.useState([]),[o,b]=l.useState(!1),P=De(dr),q=[0,5,12,18,28],N=["MRP_INCLUSIVE","BASE_PLUS_GST"],R=async g=>{const L=typeof g=="string"?g:g?.prompt;if(!L||typeof L!="string"||L.trim().length===0){M.error("Prompt is empty.");return}b(!0);try{const S=(await(await fetch("https://us-central1-stockpilotv1.cloudfunctions.net/generateInventoryByBrand",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:L})})).json()).inventory,f=[];if(Array.isArray(S))for(const h of S)!h.productName||!h.sku||f.push({productName:h.productName||"",brand:h.brand||"",category:h.category||"Food",sku:h.sku||"",unit:h.unit||"",quantity:"",costPrice:"",sellingPrice:h.price||h.mrp||h.sellingPrice||"",pricingMode:h.pricingMode||h.PricingMode||"MRP_INCLUSIVE",mrp:h.mrp??"",basePrice:h.basePrice??"",taxRate:h.gstRate??h.gst??h.taxRate??"",hsnCode:h.hsnCode||h.hsn||"",imageUrl:h.imageUrl||""});m(f),f.length===0&&M.info("No inventory returned. Try adjusting prompt.")}catch(C){console.error("Prompt-based inventory error:",C),M.error("Failed to fetch inventory.")}finally{b(!1)}},V=async()=>{if(!r||d.length===0){M.error("No inventory to upload.");return}try{for(const g of d){const L=await It(le(P,"businesses",r,"products"),{productName:g.productName||"",brand:g.brand||"",category:g.category||"",sku:g.sku||"",unit:g.unit||"",quantity:Number(g.quantity)||0,costPrice:Number(g.costPrice)||0,sellingPrice:Number(g.sellingPrice)||0,mrp:g.mrp?Number(g.mrp):void 0,pricingMode:g.pricingMode||"MRP_INCLUSIVE",basePrice:g.basePrice?Number(g.basePrice):void 0,taxRate:g.taxRate?Number(g.taxRate):void 0,gstRate:g.taxRate?Number(g.taxRate):void 0,hsnCode:g.hsnCode||"",imageUrl:g.imageUrl||"",source:"ai",createdAt:Ge()});await ge({productId:L.id,sku:g.sku,previousData:{},updatedData:g,action:"created",source:"ai"})}M.success("Inventory added successfully!"),m([])}catch(g){console.error("Upload Error:",g),M.error("Failed to add inventory.")}},B=(g,L,C)=>{const j=[...d];j[g][L]=C,m(j)};return e.jsxs("div",{className:"w-full",children:[e.jsx("style",{children:`
        .glass-card{background:rgba(16,23,32,0.6);border:1px solid rgba(255,255,255,0.08);box-shadow:0 6px 24px rgba(0,0,0,0.35);backdrop-filter:blur(10px);border-radius:14px}
        .soft-title{background:linear-gradient(90deg,rgba(255,255,255,.95),rgba(255,255,255,.75));-webkit-background-clip:text;background-clip:text;color:transparent}
        .ai-table th{position:sticky;top:0;background:rgba(23,33,45,.9);backdrop-filter:blur(8px);}
        .ai-input{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);color:#eef2f7}
        .ai-input::placeholder{color:rgba(255,255,255,0.45)}
        .ai-btn{border-radius:12px;padding:.6rem 1rem;border:1px solid rgba(255,255,255,.14)}
        .ai-btn-primary{background:linear-gradient(180deg,#2dd4bf,#06b6d4);color:#0b1020;border:none}
        .ai-btn-ghost{background:rgba(255,255,255,0.06);color:#e3eef8}
        .ai-btn-danger{background:rgba(239,68,68,.15);color:#fecaca}
        .ai-btn:hover{transform:translateY(-1px)}
        .row-alt:nth-child(even){background:rgba(255,255,255,0.03)}
      `}),e.jsxs("div",{className:"glass-card p-5 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold soft-title",children:"AIâ€‘Based Inventory Generator"}),e.jsx("div",{className:"text-xs md:text-sm text-white/60",children:"Quickly draft items by brand or freeâ€‘text prompt. Edit before saving."})]}),e.jsx("div",{className:"mt-4",children:e.jsx(Nr,{onGenerate:R})}),d.length>0&&e.jsxs("div",{className:"mt-6 glass-card p-3 md:p-4 overflow-hidden",children:[e.jsx("div",{className:"overflow-auto max-h-[52vh] rounded-lg",children:e.jsxs("table",{className:"min-w-full text-sm ai-table",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-white/80 border-b border-white/20",children:[e.jsx("th",{className:"px-3 py-3 w-[36%]",children:"Item Details"}),e.jsx("th",{className:"px-3 py-3",children:"HSN"}),e.jsx("th",{className:"px-3 py-3",children:"GST %"}),e.jsx("th",{className:"px-3 py-3",children:"Pricing Mode"}),e.jsx("th",{className:"px-3 py-3",children:"Base"}),e.jsx("th",{className:"px-3 py-3",children:"MRP"}),e.jsx("th",{className:"px-3 py-3",children:"Qty"}),e.jsx("th",{className:"px-3 py-3",children:"Cost"}),e.jsx("th",{className:"px-3 py-3",children:"Price"}),e.jsx("th",{className:"px-3 py-3 text-center",children:"Action"})]})}),e.jsx("tbody",{children:d.map((g,L)=>e.jsxs("tr",{className:"row-alt border-t border-white/10",children:[e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("input",{value:g.productName??"",onChange:C=>B(L,"productName",C.target.value),className:"ai-input w-full rounded-md px-2 py-2 outline-none focus:ring-2 focus:ring-cyan-400/40 font-semibold",placeholder:"Product name"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{value:g.brand??"",onChange:C=>B(L,"brand",C.target.value),className:"ai-input w-full rounded-md px-2 py-1.5 outline-none focus:ring-2 focus:ring-cyan-400/40",placeholder:"Brand"}),e.jsx("input",{value:g.category??"",onChange:C=>B(L,"category",C.target.value),className:"ai-input w-full rounded-md px-2 py-1.5 outline-none focus:ring-2 focus:ring-cyan-400/40",placeholder:"Category"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{value:g.sku??"",onChange:C=>B(L,"sku",C.target.value),className:"ai-input w-full rounded-md px-2 py-1.5 outline-none focus:ring-2 focus:ring-cyan-400/40",placeholder:"SKU"}),e.jsx("input",{value:g.unit??"",onChange:C=>B(L,"unit",C.target.value),className:"ai-input w-full rounded-md px-2 py-1.5 outline-none focus:ring-2 focus:ring-cyan-400/40",placeholder:"Unit"})]})]})}),e.jsx("td",{className:"px-2 py-3",children:e.jsx("input",{value:g.hsnCode??"",onChange:C=>B(L,"hsnCode",C.target.value),className:"ai-input w-20 rounded-md px-2 py-2 outline-none focus:ring-2 focus:ring-cyan-400/40",placeholder:"HSN"})}),e.jsx("td",{className:"px-2 py-3",children:e.jsxs("select",{value:g.gstRate??g.taxRate??"",onChange:C=>{const j=Number(C.target.value);B(L,"gstRate",j),B(L,"taxRate",j)},className:"ai-input w-20 rounded-md px-2 py-2 outline-none focus:ring-2 focus:ring-cyan-400/40",children:[e.jsx("option",{value:"",className:"bg-slate-900",children:"â€”"}),q.map(C=>e.jsx("option",{value:C,className:"bg-slate-900",children:C},C))]})}),e.jsx("td",{className:"px-2 py-3",children:e.jsxs("select",{value:g.pricingMode??"",onChange:C=>B(L,"pricingMode",C.target.value),className:"ai-input w-36 rounded-md px-2 py-2 outline-none focus:ring-2 focus:ring-cyan-400/40",children:[e.jsx("option",{value:"",className:"bg-slate-900",children:"â€”"}),N.map(C=>e.jsx("option",{value:C,className:"bg-slate-900",children:C},C))]})}),e.jsx("td",{className:"px-2 py-3",children:e.jsx("input",{type:"number",value:g.basePrice??"",onChange:C=>B(L,"basePrice",C.target.value),className:"ai-input w-20 rounded-md px-2 py-2 outline-none focus:ring-2 focus:ring-cyan-400/40",placeholder:"Base"})}),e.jsx("td",{className:"px-2 py-3",children:e.jsx("input",{type:"number",value:g.mrp??"",onChange:C=>B(L,"mrp",C.target.value),className:"ai-input w-20 rounded-md px-2 py-2 outline-none focus:ring-2 focus:ring-cyan-400/40",placeholder:"MRP"})}),e.jsx("td",{className:"px-2 py-3",children:e.jsx("input",{type:"number",value:g.quantity??"",onChange:C=>B(L,"quantity",C.target.value),className:"ai-input w-20 rounded-md px-2 py-2 outline-none focus:ring-2 focus:ring-cyan-400/40",placeholder:"Qty"})}),e.jsx("td",{className:"px-2 py-3",children:e.jsx("input",{type:"number",value:g.costPrice??"",onChange:C=>B(L,"costPrice",C.target.value),className:"ai-input w-20 rounded-md px-2 py-2 outline-none focus:ring-2 focus:ring-cyan-400/40",placeholder:"Cost"})}),e.jsx("td",{className:"px-2 py-3",children:e.jsx("input",{type:"number",value:g.sellingPrice??"",onChange:C=>B(L,"sellingPrice",C.target.value),className:"ai-input w-20 rounded-md px-2 py-2 outline-none focus:ring-2 focus:ring-cyan-400/40",placeholder:"Price"})}),e.jsx("td",{className:"px-2 py-3 text-center whitespace-nowrap",children:e.jsx("button",{className:"ai-btn ai-btn-danger hover:brightness-110",title:"Remove row",onClick:()=>{const C=[...d];C.splice(L,1),m(C)},children:"âœ• Remove"})})]},L))})]})}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:V,disabled:o,className:"ai-btn ai-btn-primary font-semibold disabled:opacity-60 disabled:cursor-not-allowed",children:o?"Savingâ€¦":"âž• Add to Inventory"}),e.jsx("button",{onClick:()=>m([]),disabled:o,className:"ai-btn ai-btn-ghost disabled:opacity-60",children:"Clear All"})]})]})]})]})},gs=({userId:r})=>{const[a,c]=l.useState("manual"),n="px-3 py-1.5 rounded-lg text-sm transition focus:outline-none ring-1 ring-white/10",y="bg-emerald-500 text-slate-900 ring-emerald-400/30",d="bg-white/5 text-white/90 hover:bg-white/10";return e.jsxs("div",{className:"text-white",children:[e.jsx("div",{className:"mb-3",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Add Inventory"})}),e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-white/60",children:"Select method:"}),e.jsx("button",{className:`${n} ${a==="manual"?y:d}`,onClick:()=>c("manual"),children:"Manual Entry"}),e.jsx("button",{className:`${n} ${a==="ocr"?y:d}`,onClick:()=>c("ocr"),children:"OCR Upload"}),e.jsx("button",{className:`${n} ${a==="ai"?y:d}`,onClick:()=>c("ai"),children:"AI Autogen"})]}),e.jsxs("div",{className:"mt-2",children:[a==="manual"&&e.jsx(Mr,{}),a==="ocr"&&e.jsx(ps,{distributorId:r}),a==="ai"&&e.jsx(xs,{userId:r})]})]})},ue=[{id:"image",label:"Image",minWidth:70,sticky:!1},{id:"productName",label:"Product",minWidth:200},{id:"sku",label:"SKU",minWidth:140},{id:"brand",label:"Brand",minWidth:140},{id:"category",label:"Category",minWidth:140},{id:"hsnCode",label:"HSN",minWidth:120},{id:"quantity",label:"Qty",minWidth:90},{id:"unit",label:"Unit",minWidth:90},{id:"costPrice",label:"Cost",minWidth:110},{id:"sellingPrice",label:"Sell",minWidth:110},{id:"mrp",label:"MRP",minWidth:110},{id:"gstRate",label:"GST %",minWidth:90},{id:"status",label:"Status",minWidth:100,align:"center"},{id:"location",label:"Location",minWidth:180},{id:"source",label:"Source",minWidth:120},{id:"qr",label:"QR",minWidth:80},{id:"delete",label:"Delete",minWidth:80},{id:"edit",label:"Edit",minWidth:80}],kt="FLYP_INVENTORY_COLUMNS_V2_DISTRIBUTOR",Pt=r=>["businesses",r,"preferences","inventoryColumns"],bs=(r="")=>String(r).trim().toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,""),Ne=({initialValue:r,onSave:a,type:c="text",step:n,className:y="w-full px-2 py-1 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/40 transition-shadow",parseSave:d=m=>m})=>{const[m,o]=st.useState(r??""),b=()=>{const P=c==="number"?parseFloat(m)||0:m;a(d(P))};return e.jsx("input",{type:c,step:n,className:y,value:m,onChange:P=>o(P.target.value),onBlur:b,onClick:P=>P.stopPropagation(),autoFocus:!0})},fs=({product:r,confirmationText:a,onChange:c,onCancel:n,onConfirm:y})=>e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded shadow-lg p-6 w-[90%] md:w-[400px]",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2 text-red-600",children:"Delete Product?"}),e.jsxs("p",{className:"mb-4",children:["Are you sure you want to delete ",e.jsx("strong",{children:r?.productName||"this product"})," (SKU: ",e.jsx("strong",{children:r?.sku||"N/A"}),")?"]}),e.jsxs("p",{className:"mb-2 text-sm text-gray-600",children:["Type ",e.jsx("code",{className:"bg-gray-100 px-1 rounded border",children:"delete"})," to confirm."]}),e.jsx("input",{type:"text",className:"w-full border rounded px-3 py-1 mb-4",placeholder:'Type "delete" to confirm',value:a,onChange:c}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:y,disabled:a.trim().toLowerCase()!=="delete",className:`px-4 py-2 rounded text-white ${a.trim().toLowerCase()==="delete"?"bg-red-600 hover:bg-red-700":"bg-gray-400 cursor-not-allowed"}`,children:"Delete"})]})]})}),ws=({userId:r})=>{const[a,c]=l.useState(!1),[n,y]=l.useState(null),[d,m]=l.useState([]),[o,b]=l.useState([]),[P,q]=l.useState(""),[N,R]=l.useState(""),[V,B]=l.useState("asc"),[g,L]=l.useState({rowId:null,field:null}),[C,j]=l.useState(""),[S,f]=l.useState(new Set),[h,U]=l.useState("quantity"),[O,W]=l.useState(""),[K,H]=l.useState(!1),[Q,re]=l.useState(""),[D,Z]=l.useState([]),[ae,ce]=l.useState(!1),[be,Se]=l.useState([]),[_e,Ce]=l.useState(!1),[ke,J]=l.useState(null),[Ee,fe]=l.useState(""),[s,w]=l.useState(!1),[k,E]=l.useState(null),[v,$]=l.useState(null),[T,z]=l.useState(!1),[ie,ne]=l.useState(""),[pe,Pe]=l.useState(null),[dt,Et]=l.useState([]),[ee,qe]=l.useState("view"),[qt,ze]=l.useState(!1),[ct,He]=l.useState(null),[Tt,Qe]=l.useState(!1),[Ae,We]=l.useState(null),[se,Ke]=l.useState(""),[Bt,ut]=l.useState(!1),[$t,mt]=l.useState(!1),[Ot,Gt]=l.useState("designer"),[Vt,Te]=l.useState(!1),[zt,ht]=l.useState(!1),[pt,Re]=l.useState(!1),[Ie,Me]=l.useState(ue),[Le,Fe]=l.useState(new Set),[Ns,Ht]=l.useState([]),[Qt,Ye]=l.useState(!1),[Je,xt]=l.useState("list"),X=De(),gt=async(t,x,i)=>{try{await at(te(De(),...Pt(t)),{order:x,hidden:i,updatedAt:Date.now()},{merge:!0})}catch{const F={order:x,hidden:i,updatedAt:Date.now()};localStorage.setItem(kt,JSON.stringify(F))}},Wt=async t=>{try{const i=await Nt(te(De(),...Pt(t)));if(i.exists()){const I=i.data(),F=Array.isArray(I.order)?I.order:ue.map(_=>_.id),u=Array.isArray(I.hidden)?new Set(I.hidden):new Set,A=[...F.map(_=>ue.find(Y=>Y.id===_)).filter(Boolean)];Me(A),Fe(u);return}}catch{}const x=localStorage.getItem(kt);if(x)try{const i=JSON.parse(x),I=Array.isArray(i.order)?i.order:ue.map(p=>p.id),F=new Set(Array.isArray(i.hidden)?i.hidden:[]),u=I.map(p=>ue.find(A=>A.id===p)).filter(Boolean);Me(u),Fe(F);return}catch{}Me(ue),Fe(new Set)};if(!r)return e.jsx("div",{className:"text-center p-4",children:"Loading user data..."});l.useEffect(()=>{r&&Wt(r)},[r]),l.useEffect(()=>{if(!r)return;console.log("Current user UID:",r);const t=le(X,"businesses",r,"products"),x=$e(t,async i=>{const I=yt(),F=await Promise.all(i.docs.map(async p=>{const A=p.data();let _="";try{if(A.imageUrl)_=A.imageUrl;else if(A.imagePath){const Y=tt(I,A.imagePath);_=await rt(Y)}}catch(Y){console.warn("Image fetch error for:",A.imagePath||"unknown",Y.message)}return{id:p.id,...A,imageUrl:_,imagePath:A.imagePath||""}}));m(F),b(F);const u=[...new Set(F.map(p=>p.brand).filter(Boolean))];Se(u)});return()=>x()},[r]),l.useEffect(()=>{if(!r)return;const t=le(X,"businesses",r,"customColumns"),x=$e(t,i=>{const I=i.docs.map(F=>{const u=F.data()||{},p=u.name||"Custom";return{id:u.key||bs(p),label:p,minWidth:140,type:u.type||"text",_docId:F.id}});Ht(I),Me(F=>{const u=F.map(A=>A.id),p=I.filter(A=>!u.includes(A.id));return[...F,...p]})});return()=>x()},[r]),l.useEffect(()=>{if(!Oe.currentUser?.uid)return;const t=Rt(le(X,`businesses/${Oe.currentUser.uid}/inventoryLogs`),hr("modifiedAt","desc")),x=$e(t,i=>{Et(i.docs.map(I=>I.data()))});return()=>x()},[]),l.useEffect(()=>{const t=P.toLowerCase(),x=d.filter(i=>{const I=i.productName?.toLowerCase().includes(t)||i.sku?.toLowerCase().includes(t)||i.brand?.toLowerCase().includes(t)||i.category?.toLowerCase().includes(t)||i.location?.fullPath?.toLowerCase().includes(t),F=!Q||Be(i.quantity)===Q,u=D.length===0||i.brand&&D.includes(i.brand),p=!se||i.location?.fullPath?.toLowerCase().includes(se.toLowerCase())||i.location?.shelf===se||i.location?.rack===se||i.location?.aisle===se;return I&&F&&u&&p});b(x)},[P,d,Q,D,se]),l.useEffect(()=>{if(!N){b(t=>[...t]);return}b(t=>[...t].sort((i,I)=>{const F=parseFloat(i[N])||0,u=parseFloat(I[N])||0;return V==="asc"?F-u:u-F}))},[N,V]);const we=(t,x,i)=>{L({rowId:t,field:x}),j(i)},ye=async(t,x,i)=>{try{const I=te(X,"businesses",r,"products",t),F=await Nt(I),u=F.exists()?F.data():{};await et(I,{[x]:i}),await ge({userId:r,productId:t,sku:u.sku||"N/A",productName:u.productName||"N/A",brand:u.brand||"N/A",category:u.category||"N/A",previousData:u,updatedData:{...u,[x]:i},action:"updated",source:"inline-edit"});const p=x==="quantity"||x==="gstRate"||x==="costPrice"||x==="sellingPrice"||x==="mrp"?Number(i):i;m(A=>A.map(_=>_.id===t?{..._,[x]:p,...x==="gstRate"?{taxRate:p}:{}}:_)),b(A=>A.map(_=>_.id===t?{..._,[x]:p,...x==="gstRate"?{taxRate:p}:{}}:_))}catch(I){console.error("Error updating inventory field:",I)}finally{L({rowId:null,field:null}),j("")}},Kt=t=>{f(x=>{const i=new Set(x);return i.has(t)?i.delete(t):i.add(t),i})},Yt=()=>{S.size>=o.length?f(new Set):f(new Set(o.map(t=>t.id)))},Jt=()=>f(new Set),Xt=[{id:"quantity",label:"Qty",type:"number"},{id:"hsnCode",label:"HSN Code",type:"text"},{id:"unit",label:"Unit",type:"text"},{id:"brand",label:"Brand",type:"text"},{id:"category",label:"Category",type:"text"}],Zt=async()=>{if(!(S.size===0||O===""&&h!=="quantity")){H(!0);try{const t=h,x=h==="quantity"?parseFloat(O)||0:String(O).trim(),i=Array.from(S),I=i.map(A=>te(X,"businesses",r,"products",A)),F=i.map(A=>o.find(_=>_.id===A)),u=Ze(X);for(let A=0;A<i.length;A++)u.update(I[A],{[t]:x});await u.commit();const p=t==="quantity"?Number(x):x;m(A=>A.map(_=>S.has(_.id)?{..._,[t]:p}:_)),b(A=>A.map(_=>S.has(_.id)?{..._,[t]:p}:_)),f(new Set),W(""),M.success(`Updated ${i.length} product(s).`),F.forEach((A,_)=>{const Y=A||{},nr={...Y,[t]:x};ge({userId:r,productId:i[_],sku:Y.sku||"N/A",productName:Y.productName||"N/A",brand:Y.brand||"N/A",category:Y.category||"N/A",previousData:Y,updatedData:nr,action:"updated",source:"bulk-edit"}).catch(()=>{})})}catch(t){console.error("Bulk update error:",t),M.error("Bulk update failed. Please try again.")}finally{H(!1)}}},er=async()=>{if(S.size!==0){H(!0);try{const t=Array.from(S).map(u=>({id:u,p:o.find(p=>p.id===u)})).filter(({p:u})=>u&&Number.isFinite(Number(u.mrp)));if(t.length===0){M.success("No products had MRP to sync."),H(!1);return}const x=t.map(({id:u})=>te(X,"businesses",r,"products",u)),i=Ze(X);t.forEach(({p:u},p)=>{i.update(x[p],{sellingPrice:Number(u.mrp)})}),await i.commit();const I=t.length,F=new Set(t.map(({id:u})=>u));m(u=>u.map(p=>F.has(p.id)?{...p,sellingPrice:Number(o.find(A=>A.id===p.id)?.mrp)}:p)),b(u=>u.map(p=>F.has(p.id)?{...p,sellingPrice:Number(o.find(A=>A.id===p.id)?.mrp)}:p)),f(new Set),M.success(`Synced Sell â† MRP for ${I} product(s).`),t.forEach(({id:u,p})=>{const A={...p},_={...p,sellingPrice:Number(p.mrp)};ge({userId:r,productId:u,sku:p.sku||"N/A",productName:p.productName||"N/A",brand:p.brand||"N/A",category:p.category||"N/A",previousData:A,updatedData:_,action:"updated",source:"bulk-sync-sell-from-mrp"}).catch(()=>{})})}catch(t){console.error("Bulk sync error:",t),M.error("Sync failed. Please try again.")}finally{H(!1)}}},tr=async()=>{if(S.size!==0){H(!0);try{const t=Array.from(S).map(u=>({id:u,p:o.find(p=>p.id===u),sellVal:Number(o.find(p=>p.id===u)?.sellingPrice)})).filter(({p:u,sellVal:p})=>u&&Number.isFinite(p));if(t.length===0){M.success("No products had Sell price to sync."),H(!1);return}const x=t.map(({id:u})=>te(X,"businesses",r,"products",u)),i=Ze(X);t.forEach(({sellVal:u},p)=>{i.update(x[p],{mrp:u})}),await i.commit();const I=t.length,F=new Map(t.map(({id:u,sellVal:p})=>[u,p]));m(u=>u.map(p=>F.has(p.id)?{...p,mrp:F.get(p.id)}:p)),b(u=>u.map(p=>F.has(p.id)?{...p,mrp:F.get(p.id)}:p)),f(new Set),M.success(`Synced MRP â† Sell for ${I} product(s).`),t.forEach(({id:u,p,sellVal:A})=>{const _={...p},Y={...p,mrp:A};ge({userId:r,productId:u,sku:p.sku||"N/A",productName:p.productName||"N/A",brand:p.brand||"N/A",category:p.category||"N/A",previousData:_,updatedData:Y,action:"updated",source:"bulk-sync-mrp-from-sell"}).catch(()=>{})})}catch(t){console.error("Bulk sync error:",t),M.error("Sync failed. Please try again.")}finally{H(!1)}}},rr=async t=>{if(Ae)try{const x=te(X,"businesses",r,"products",Ae.id),i=t?{floor:t.floor||null,aisle:t.aisle||null,rack:t.rack||null,shelf:t.shelf||null,lane:t.lane||null,fullPath:t.fullPath||(t.floor||t.aisle||t.rack||t.shelf||t.lane?[t.floor,t.aisle,t.rack,t.shelf,t.lane].filter(Boolean).join(" > "):null)}:null;await et(x,{location:i}),M.success("Location updated successfully! Changes will sync to Store Designer."),Qe(!1),We(null)}catch(x){console.error("Error saving location:",x),M.error("Failed to save location")}},bt=t=>{We(t),Qe(!0)},Be=t=>{const x=parseInt(t);return isNaN(x)?"Unknown":x<=5?"Low":"In Stock"},ft=t=>{J(t),fe(""),Ce(!0)},sr=async()=>{if(ke&&Ee.trim().toLowerCase()==="delete")try{const t=te(X,"businesses",r,"products",ke.id);await pr(t)}catch(t){console.error("Error deleting product:",t)}finally{Ce(!1),J(null),fe("")}},wt=t=>{E(t),$(null),z(!1),ne(""),Pe(null),w(!0)},ar=t=>{const x=t.target.files?.[0]||null;if($(x),ne(""),x){const i=URL.createObjectURL(x);Pe(i)}else Pe(null)},ir=async()=>{if(!k||!v&&!pe){M.error("No image selected");return}z(!0),ne("");try{let t=null,x=null;if(v){const I=yt(),F=v.name.split(".").pop();x=`product_images/${r}/${k.id}.${F}`;const u=tt(I,x);await At(u,v),t=await rt(u)}else pe&&(t=pe);const i=te(De(),"businesses",r,"products",k.id);await et(i,x?{imageUrl:t,imagePath:x}:{imageUrl:t}),M.success("Image uploaded successfully"),w(!1),E(null),$(null),Pe(null)}catch(t){console.error("Error uploading image:",t),ne("Image upload failed: "+(t?.message||"Unknown error")),M.error("Failed to upload image")}finally{z(!1)}};return e.jsxs("div",{className:"text-white px-0 md:px-0 py-4 md:py-6",children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"ðŸ” Search products by name, brand, SKU, or category...",value:P,onChange:t=>q(t.target.value),className:"w-full px-4 py-3 pl-12 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all shadow-lg"}),e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/60 text-lg",children:"ðŸ”"}),P&&e.jsx("button",{onClick:()=>q(""),className:"absolute right-4 top-1/2 -translate-y-1/2 text-white/60 hover:text-white transition-colors",title:"Clear search",children:"âœ•"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-white/70 whitespace-nowrap",children:"Status:"}),e.jsxs("select",{className:"px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all",onChange:t=>re(t.target.value),value:Q,children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"In Stock",children:"âœ… In Stock"}),e.jsx("option",{value:"Low",children:"âš ï¸ Low Stock"})]})]}),N&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-white/70 whitespace-nowrap",children:"Sort:"}),e.jsxs("select",{className:"px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all",onChange:t=>R(t.target.value),value:N,children:[e.jsx("option",{value:"",children:"None"}),e.jsx("option",{value:"quantity",children:"ðŸ“Š Quantity"}),e.jsx("option",{value:"costPrice",children:"ðŸ’° Cost Price"}),e.jsx("option",{value:"sellingPrice",children:"ðŸ’µ Selling Price"}),e.jsx("option",{value:"mrp",children:"ðŸ·ï¸ MRP"})]}),N&&e.jsx("button",{onClick:()=>B(V==="asc"?"desc":"asc"),className:"px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white hover:bg-white/15 transition-all text-sm",title:V==="asc"?"Ascending":"Descending",children:V==="asc"?"â†‘":"â†“"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-white/70 whitespace-nowrap",children:"ðŸ“ Location:"}),e.jsx("input",{type:"text",placeholder:"Search location...",value:se,onChange:t=>Ke(t.target.value),className:"px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{className:"px-3 py-2 rounded-lg min-w-[140px] text-left bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all hover:bg-white/15",type:"button",onClick:()=>ce(t=>!t),children:[e.jsx("span",{className:"text-white/70",children:"ðŸ·ï¸ "}),D.length===0?"All Brands":D.length===1?D[0]:`${D.length} selected`,e.jsx("span",{className:"ml-1 text-white/50",children:"â–¼"})]}),ae&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>ce(!1)}),e.jsxs("div",{className:"absolute left-0 mt-2 bg-[#0b0f14] border border-white/20 rounded-xl shadow-2xl z-20 p-3 min-w-[220px] max-h-64 overflow-y-auto backdrop-blur-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 pb-2 border-b border-white/10",children:[e.jsx("span",{className:"text-sm font-semibold text-white",children:"Select Brands"}),e.jsx("button",{className:"text-xs text-emerald-300 hover:text-emerald-200 font-medium",type:"button",onClick:()=>Z([]),children:"Clear All"})]}),be.length===0?e.jsx("div",{className:"text-xs text-white/50 px-2 py-4 text-center",children:"No brands available"}):e.jsx("div",{className:"space-y-1",children:be.map((t,x)=>e.jsxs("label",{className:"flex items-center px-3 py-2 cursor-pointer hover:bg-white/10 rounded-lg transition-colors group",children:[e.jsx("input",{type:"checkbox",checked:D.includes(t),onChange:i=>{i.target.checked?Z([...D,t]):Z(D.filter(I=>I!==t))},className:"mr-3 w-4 h-4 rounded border-white/30 text-emerald-500 focus:ring-emerald-400"}),e.jsx("span",{className:"text-sm text-white group-hover:text-emerald-300 transition-colors",children:t})]},x))})]})]})]}),(Q||N||se||D.length>0)&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Active filters:"}),Q&&e.jsxs("span",{className:"px-2 py-1 rounded-lg bg-emerald-500/20 text-emerald-300 text-xs border border-emerald-400/30",children:[Q,e.jsx("button",{onClick:()=>re(""),className:"ml-1 hover:text-white",children:"Ã—"})]}),N&&e.jsxs("span",{className:"px-2 py-1 rounded-lg bg-blue-500/20 text-blue-300 text-xs border border-blue-400/30",children:["Sort: ",N," ",V==="asc"?"â†‘":"â†“",e.jsx("button",{onClick:()=>R(""),className:"ml-1 hover:text-white",children:"Ã—"})]}),se&&e.jsxs("span",{className:"px-2 py-1 rounded-lg bg-purple-500/20 text-purple-300 text-xs border border-purple-400/30",children:["ðŸ“ ",se,e.jsx("button",{onClick:()=>Ke(""),className:"ml-1 hover:text-white",children:"Ã—"})]}),D.length>0&&e.jsxs("span",{className:"px-2 py-1 rounded-lg bg-orange-500/20 text-orange-300 text-xs border border-orange-400/30",children:["ðŸ·ï¸ ",D.length," brand",D.length>1?"s":"",e.jsx("button",{onClick:()=>Z([]),className:"ml-1 hover:text-white",children:"Ã—"})]}),e.jsx("button",{onClick:()=>{re(""),R(""),Ke(""),Z([]),q("")},className:"px-2 py-1 rounded-lg bg-white/10 hover:bg-white/20 text-white/70 hover:text-white text-xs border border-white/20 transition-all",children:"Clear All"})]})]})]}),e.jsxs("div",{className:"flex mb-2 gap-2 flex-wrap items-center",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>qe("view"),className:`px-4 py-2 rounded-lg border transition-all ${ee==="view"?"bg-emerald-500 text-slate-900 border-emerald-400 font-semibold shadow-lg":"bg-white/5 border-white/10 text-white/70 hover:text-white hover:bg-white/10"}`,children:"ðŸ“¦ Inventory"}),e.jsx("button",{onClick:()=>qe("shelf"),className:`px-4 py-2 rounded-lg border transition-all ${ee==="shelf"?"bg-emerald-500 text-slate-900 border-emerald-400 font-semibold shadow-lg":"bg-white/5 border-white/10 text-white/70 hover:text-white hover:bg-white/10"}`,children:"ðŸ—‚ï¸ Smart Shelf View"}),e.jsx("button",{onClick:()=>qe("recent"),className:`px-4 py-2 rounded-lg border transition-all ${ee==="recent"?"bg-emerald-500 text-slate-900 border-emerald-400 font-semibold shadow-lg":"bg-white/5 border-white/10 text-white/70 hover:text-white hover:bg-white/10"}`,children:"ðŸ• Recently Modified"}),e.jsx("button",{onClick:()=>qe("restock"),className:`px-4 py-2 rounded-lg border transition-all ${ee==="restock"?"bg-emerald-500 text-slate-900 border-emerald-400 font-semibold shadow-lg":"bg-white/5 border-white/10 text-white/70 hover:text-white hover:bg-white/10"}`,children:"ðŸ“‹ Restock Orders"})]}),ee==="view"&&e.jsx("div",{className:"ml-auto flex gap-2",children:d.filter(t=>(parseInt(t.quantity)||0)<=5).length>0&&e.jsxs("button",{onClick:()=>{Te(!0)},className:"px-4 py-2 rounded-lg border bg-gradient-to-r from-orange-500 to-amber-500 hover:brightness-110 text-white font-semibold shadow-lg animate-pulse",title:"Quick order for low stock items",children:["âš¡ Quick Order (",d.filter(t=>(parseInt(t.quantity)||0)<=5).length," low stock)"]})}),e.jsxs("div",{className:"ml-auto relative",children:[e.jsxs("button",{onClick:()=>Re(!pt),className:"px-4 py-2 rounded-lg border bg-white/5 border-white/10 text-white hover:bg-white/10 transition-all flex items-center gap-2",title:"Additional tools",children:["ðŸ› ï¸ Tools",e.jsx("span",{className:"text-xs",children:"â–¼"})]}),pt&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>Re(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-56 rounded-lg border border-white/10 bg-[#0B0F14] shadow-2xl z-20 overflow-hidden",children:[e.jsx("button",{onClick:()=>{Gt("designer"),ut(!0),Re(!1)},className:"w-full px-4 py-3 text-left text-white hover:bg-white/10 transition-colors flex items-center gap-2",children:"ðŸ§  Smart Store Designer"}),e.jsx("button",{onClick:()=>{mt(!0),Re(!1)},className:"w-full px-4 py-3 text-left text-white hover:bg-white/10 transition-colors flex items-center gap-2",children:"ðŸ‘ï¸ View Store Layout"}),e.jsx("div",{className:"border-t border-white/10"}),e.jsx("button",{onClick:()=>{ht(!0),Re(!1)},className:"w-full px-4 py-3 text-left text-white hover:bg-white/10 transition-colors flex items-center gap-2",children:"ðŸ“‹ Order History"})]})]})]})]}),ee==="view"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-end mb-4",children:[e.jsx("button",{className:`px-4 py-1 mr-2 rounded-lg border ${Je==="list"?"bg-emerald-600 text-white border-emerald-500":"bg-white/5 text-white/80 border-white/10 hover:text-white"}`,onClick:()=>xt("list"),children:"List View"}),e.jsx("button",{className:`px-4 py-1 rounded-lg border ${Je==="grid"?"bg-emerald-600 text-white border-emerald-500":"bg-white/5 text-white/80 border-white/10 hover:text-white"}`,onClick:()=>xt("grid"),children:"Grid View"})]}),Je==="list"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 p-4 rounded-xl bg-gradient-to-r from-white/5 to-white/3 border border-white/10 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{className:"px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white hover:bg-white/15 transition-all duration-200 text-sm font-medium flex items-center gap-2",onClick:()=>Ye(!0),type:"button",title:"Manage columns",children:[e.jsx("span",{children:"âš™ï¸"}),e.jsx("span",{children:"Manage Columns"})]}),e.jsx("div",{className:"h-6 w-px bg-white/20"}),e.jsxs("div",{className:"text-sm text-white/80",children:[e.jsx("span",{className:"font-semibold text-emerald-400",children:o.length}),e.jsx("span",{className:"text-white/60",children:" of "}),e.jsx("span",{className:"font-semibold",children:d.length}),e.jsx("span",{className:"text-white/60",children:" products"}),o.length!==d.length&&e.jsxs("span",{className:"ml-2 text-xs text-white/50",children:["(",d.length-o.length," hidden by filters)"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:d.filter(t=>(parseInt(t.quantity)||0)<=5).length>0&&e.jsxs("div",{className:"px-3 py-1.5 rounded-lg bg-rose-500/20 border border-rose-400/30 text-rose-300 text-xs font-medium",children:["âš ï¸ ",d.filter(t=>(parseInt(t.quantity)||0)<=5).length," low stock items"]})})]}),S.size>0&&e.jsxs("div",{className:"mb-3 px-4 py-3 rounded-xl border border-emerald-400/30 bg-emerald-500/10 flex flex-wrap items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-emerald-300",children:[S.size," selected"]}),e.jsx("select",{value:h,onChange:t=>U(t.target.value),className:"px-2 py-1.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:Xt.map(t=>e.jsx("option",{value:t.id,className:"bg-slate-800 text-white",children:t.label},t.id))}),e.jsx("span",{className:"text-white/70 text-sm",children:"to"}),e.jsx("input",{type:h==="quantity"?"number":"text",value:O,onChange:t=>W(t.target.value),placeholder:h==="quantity"?"e.g. 10":"value",className:"px-3 py-1.5 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/40 w-28 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}),e.jsx("button",{onClick:Zt,disabled:K||(h==="quantity"?O==="":!O.trim()),className:"px-4 py-1.5 rounded-lg bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed transition",children:K?"Updatingâ€¦":"Apply"}),e.jsx("span",{className:"text-white/40 text-sm",children:"|"}),e.jsx("button",{onClick:er,disabled:K,className:"px-3 py-1.5 rounded-lg border border-amber-400/40 bg-amber-500/20 text-amber-200 hover:bg-amber-500/30 text-sm transition",title:"Set Sell price = MRP for selected",children:"Sync Sell â† MRP"}),e.jsx("button",{onClick:tr,disabled:K,className:"px-3 py-1.5 rounded-lg border border-white/20 text-white/80 hover:bg-white/10 text-sm transition",title:"Set MRP = Sell price for selected",children:"Sync MRP â† Sell"}),e.jsx("button",{onClick:Jt,className:"px-3 py-1.5 rounded-lg border border-white/20 text-white/80 hover:bg-white/10 text-sm transition",children:"Clear selection"})]}),e.jsx("div",{className:"w-full overflow-hidden rounded-xl border border-white/10 bg-gradient-to-br from-white/5 via-white/3 to-white/5 backdrop-blur-xl shadow-2xl",children:e.jsx("div",{className:"overflow-x-auto overflow-y-visible scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent",style:{scrollbarWidth:"thin"},children:e.jsx("div",{className:"inline-block min-w-full align-middle",children:e.jsxs("table",{className:"w-full text-xs sm:text-sm md:text-base",children:[e.jsx("thead",{className:"bg-gradient-to-r from-white/15 via-white/10 to-white/15 text-left sticky top-0 z-10 backdrop-blur-md border-b-2 border-white/20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-3 w-10 border-r border-white/10 text-center",children:e.jsx("input",{type:"checkbox",checked:o.length>0&&S.size===o.length,onChange:Yt,className:"rounded border-white/30 bg-white/10 text-emerald-500 focus:ring-emerald-400/50",title:"Select all on page"})}),Ie.filter(t=>!Le.has(t.id)).map(t=>e.jsx("th",{className:"px-3 py-3 sm:px-4 sm:py-4 text-white font-semibold border-r border-white/10 last:border-r-0 "+(t.id==="status"?"text-center":"text-left")+" whitespace-nowrap",style:{minWidth:t.minWidth?`${t.minWidth}px`:"auto",maxWidth:t.id==="location"?"350px":t.id==="productName"?"250px":"auto"},children:e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{children:t.label})})},t.id))]})}),e.jsxs("tbody",{className:"divide-y divide-white/5",children:[o.map((t,x)=>e.jsxs("tr",{className:`border-b border-white/5 hover:bg-white/10 transition-all duration-200 group/row ${S.has(t.id)?"bg-emerald-500/10":"bg-white/0"} hover:bg-gradient-to-r hover:from-white/5 hover:to-white/0`,style:{animation:`fadeIn 0.3s ease-out ${x*.02}s both`},children:[e.jsx("td",{className:"px-2 py-3 border-r border-white/5 text-center align-middle",children:e.jsx("input",{type:"checkbox",checked:S.has(t.id),onChange:()=>Kt(t.id),onClick:i=>i.stopPropagation(),className:"rounded border-white/30 bg-white/10 text-emerald-500 focus:ring-emerald-400/50"})}),Ie.filter(i=>!Le.has(i.id)).map(i=>{switch(i.id){case"qr":return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0",children:e.jsx("button",{onClick:()=>{He(t),ze(!0)},className:"px-2.5 py-1.5 text-xs font-medium rounded-lg bg-gradient-to-r from-blue-500/20 to-blue-600/20 border border-blue-400/30 hover:from-blue-500/30 hover:to-blue-600/30 text-blue-300 transition-all duration-200 shadow-sm hover:shadow-md",title:"Generate QR",children:"Generate"})},i.id);case"image":return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0",children:e.jsx("div",{className:"inline-block cursor-pointer",onClick:()=>wt(t),title:"Click to upload image",children:e.jsx("img",{src:t.imageUrl||"/placeholder.png",alt:"product",className:"h-12 w-12 sm:h-14 sm:w-14 rounded-lg object-cover border-2 border-white/20 ring-2 ring-white/10 shadow-md hover:shadow-lg hover:scale-105 transition-all duration-200"})})},i.id);case"productName":return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0 max-w-[220px] sm:max-w-[250px] min-h-[2.5rem]",onClick:()=>we(t.id,"productName",t.productName),children:g.rowId===t.id&&g.field==="productName"?e.jsx(Ne,{initialValue:t.productName??"",onSave:u=>ye(t.id,"productName",u)}):e.jsx("span",{className:"text-sm sm:text-base font-medium text-white group-hover/row:text-emerald-300 transition-colors",children:t.productName})},i.id);case"sku":case"brand":case"category":case"hsnCode":case"unit":return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0 max-w-[150px] sm:max-w-[180px] break-words whitespace-normal min-h-[2.5rem]",onClick:()=>we(t.id,i.id,t[i.id]),children:g.rowId===t.id&&g.field===i.id?e.jsx(Ne,{initialValue:t[i.id]??"",onSave:u=>ye(t.id,i.id,u)}):e.jsx("span",{className:"text-xs sm:text-sm text-white/80",children:t[i.id]||"-"})},i.id);case"quantity":return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0 text-center min-h-[2.5rem]",onClick:()=>we(t.id,"quantity",t.quantity),children:g.rowId===t.id&&g.field==="quantity"?e.jsx(Ne,{type:"number",initialValue:t.quantity??"",onSave:u=>ye(t.id,"quantity",Number(u))}):e.jsx("span",{className:"text-sm sm:text-base font-semibold text-white",children:t.quantity||0})},i.id);case"costPrice":case"sellingPrice":case"mrp":return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0 min-h-[2.5rem]",onClick:()=>we(t.id,i.id,t[i.id]),children:g.rowId===t.id&&g.field===i.id?e.jsx(Ne,{type:"number",step:"0.01",initialValue:t[i.id]??"",onSave:u=>ye(t.id,i.id,Number(u))}):t[i.id]!==void 0?e.jsxs("span",{className:"text-sm sm:text-base font-medium text-white/90",children:["â‚¹",Number(t[i.id]).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]}):e.jsx("span",{className:"text-white/40",children:"-"})},i.id);case"gstRate":const I=t.gstRate!==void 0&&t.gstRate!==null?t.gstRate:t.taxRate;return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0 text-center min-h-[2.5rem]",onClick:()=>we(t.id,"gstRate",I),children:g.rowId===t.id&&g.field==="gstRate"?e.jsx(Ne,{type:"number",step:"0.01",initialValue:I??"",onSave:u=>ye(t.id,"gstRate",Number(u))}):e.jsx("span",{className:"text-sm sm:text-base font-medium text-white/80",children:I!=null?`${I}%`:"-"})},i.id);case"status":{const u=Be(t.quantity),p=u==="In Stock"?"InÂ Stock":u,A=u==="Low",_=u==="Unknown"||(parseInt(t.quantity)||0)===0;return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0 text-center whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{title:u,className:"inline-flex items-center justify-center min-w-[80px] sm:min-w-[90px] h-7 sm:h-8 px-3 sm:px-4 rounded-full text-xs sm:text-sm font-bold shadow-md "+(A?"bg-gradient-to-r from-rose-500 to-rose-600 text-white border border-rose-400/50":_?"bg-gradient-to-r from-gray-500 to-gray-600 text-white border border-gray-400/50":"bg-gradient-to-r from-emerald-400 to-emerald-500 text-slate-900 border border-emerald-300/50"),children:p}),(A||_)&&e.jsx("button",{onClick:()=>{Te(!0)},className:"px-2 py-1 rounded text-xs font-medium bg-orange-500/20 hover:bg-orange-500/30 text-orange-300 border border-orange-400/30 transition-all",title:"Quick add to restock order",children:"âš¡"})]})},i.id)}case"location":const F=t.location?.fullPath;return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0 min-w-[200px] sm:min-w-[220px] max-w-[300px] sm:max-w-[350px]",children:F?e.jsxs("div",{className:"flex items-start gap-2 group/loc",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-emerald-400 text-sm flex-shrink-0",children:"ðŸ“"}),e.jsx("span",{className:"text-xs text-emerald-300 font-medium break-words whitespace-normal leading-relaxed",title:F,children:F})]})}),e.jsx("button",{onClick:()=>bt(t),className:"text-xs px-2 py-1 rounded bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300 opacity-0 group-hover/loc:opacity-100 transition-opacity flex-shrink-0",title:"Change location",children:"Edit"})]}):e.jsxs("button",{onClick:()=>bt(t),className:"text-xs px-3 py-1.5 rounded bg-white/10 hover:bg-white/20 text-white/70 border border-white/20 hover:border-white/30 transition-all flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ“"}),e.jsx("span",{children:"Set Location"})]})},i.id);case"source":return e.jsx("td",{className:"p-2 min-w-[100px] max-w-[120px] text-center",children:t.sourceOrderId?e.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs bg-blue-500 text-white break-words whitespace-normal leading-snug",children:"From Order"}):""},i.id);case"delete":return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0 text-center",children:e.jsx("button",{onClick:()=>ft(t),className:"text-rose-400 hover:text-rose-300 hover:bg-rose-500/10 p-2 rounded-lg transition-all duration-200",title:"Delete Item",children:"ðŸ—‘ï¸"})},i.id);case"edit":return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0",children:e.jsx("button",{onClick:()=>{y(t.id),c(!0)},className:"text-sm text-emerald-300 underline",children:"Edit"})},i.id);default:return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0 max-w-[180px] break-words whitespace-normal min-h-[2.5rem]",onClick:()=>we(t.id,i.id,t[i.id]),children:g.rowId===t.id&&g.field===i.id?e.jsx(Ne,{initialValue:t[i.id]??"",onSave:u=>ye(t.id,i.id,u)}):e.jsx("span",{className:"text-xs sm:text-sm text-white/80",children:t[i.id]||"-"})},i.id)}})]},t.id)),o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:Ie.filter(t=>!Le.has(t.id)).length+1,className:"text-center px-3 py-8 sm:py-12 text-white/70",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"text-4xl",children:"ðŸ“¦"}),e.jsx("p",{className:"text-base sm:text-lg font-medium",children:d.length===0?"No products found":"Loading inventory..."}),d.length>0&&e.jsx("p",{className:"text-sm text-white/50",children:"Try adjusting your filters"})]})})}):null]})]})})})}),Qt&&e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"w-[96%] max-w-2xl rounded-2xl p-4 bg-white/10 backdrop-blur-2xl border border-white/15 shadow-[0_20px_80px_rgba(0,0,0,0.5)] text-white relative",children:[e.jsx("button",{onClick:()=>Ye(!1),className:"absolute top-2 right-2 text-white/70 hover:text-white",children:"âœ•"}),e.jsx(jr,{availableColumns:Ie,hiddenCols:Le,onToggle:t=>{const x=new Set(Le);x.has(t)?x.delete(t):x.add(t),Fe(x),gt(r,Ie.map(i=>i.id),Array.from(x))},onReset:()=>{Me(ue),Fe(new Set),gt(r,ue.map(x=>x.id),[])},onClose:()=>Ye(!1)})]})})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:o.map(t=>e.jsxs("div",{className:"p-4 rounded-xl border border-white/10 bg-white/5 shadow-lg flex flex-col hover:bg-white/10 transition-colors",children:[e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx("button",{className:"focus:outline-none",style:{width:"100%"},onClick:()=>wt(t),title:"Click to upload image",children:e.jsx("img",{src:t.imageUrl||"/placeholder.png",alt:t.productName,className:"w-full h-32 object-contain rounded border border-white/20 bg-white/5"})})}),e.jsx("h3",{className:"font-semibold mb-1",children:t.productName}),e.jsxs("p",{className:"text-sm text-white/70 mb-1",children:[t.brand," | ",t.category]}),e.jsxs("p",{className:"text-sm mb-1",children:["Qty: ",t.quantity," ",t.sellingPrice!==void 0&&e.jsxs(e.Fragment,{children:["| â‚¹",t.sellingPrice]})]}),(t.mrp!==void 0||t.gstRate!==void 0||t.taxRate!==void 0)&&e.jsxs("p",{className:"text-sm mb-1",children:[t.mrp!==void 0&&e.jsxs(e.Fragment,{children:["MRP: â‚¹",t.mrp]}),t.mrp!==void 0&&(t.gstRate!==void 0||t.taxRate!==void 0)&&e.jsx(e.Fragment,{children:" Â |Â  "}),(t.gstRate!==void 0||t.taxRate!==void 0)&&e.jsxs(e.Fragment,{children:["GST: ",t.gstRate??t.taxRate,"%"]})]}),e.jsxs("p",{className:"text-xs text-white/60 mb-1",children:["SKU: ",t.sku||"N/A"," | Unit: ",t.unit||"N/A"]}),t.hsnCode&&e.jsxs("p",{className:"text-xs text-white/60 mb-1",children:["HSN: ",t.hsnCode]}),e.jsxs("div",{className:"flex items-center gap-2 mt-auto",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded font-semibold ${(t.status||Be(t.quantity))==="In Stock"?"bg-emerald-500 text-slate-900":"bg-rose-500 text-white"}`,children:t.status||Be(t.quantity)}),e.jsx("button",{className:"text-xs px-2 py-1 rounded bg-white/10 border border-white/20 hover:bg-white/15 text-white",onClick:()=>{He(t),ze(!0)},title:"Generate QR",children:"QR"}),e.jsx("button",{className:"ml-auto text-rose-300 hover:text-rose-200 px-2",title:"Delete Item",onClick:()=>ft(t),children:"ðŸ—‘ï¸"})]})]},t.id))})]}),ee==="shelf"&&e.jsx(vr,{userId:r,products:d}),ee==="recent"&&e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Recent Inventory Modifications"}),dt.length===0?e.jsx("p",{className:"text-white/60",children:"No recent modifications found."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:dt.map((t,x)=>e.jsxs("div",{className:"shadow rounded-xl p-4 text-sm border border-white/10 bg-white/5 text-white",children:[e.jsxs("div",{className:"font-semibold text-gray-700 mb-1",children:["SKU: ",t.sku]}),e.jsxs("div",{children:["Product: ",t.productName||"N/A"]}),e.jsxs("div",{children:["Brand: ",t.brand||"N/A"]}),e.jsxs("div",{children:["Category: ",t.category||"N/A"]}),e.jsxs("div",{className:"mt-2 text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Action:"})," ",t.action,e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Source:"})," ",t.source,e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Modified By:"})," ",t.modifiedBy||"Unknown",e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Time:"})," ",t.modifiedAt?.toDate?.().toLocaleString?.()||"N/A",e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Changes:"}),e.jsx("ul",{className:"list-disc list-inside",children:Object.entries(t.changes||{}).map(([i,I])=>e.jsxs("li",{children:[i,": ",I.from??"N/A"," â†’ ",I.to??"N/A"]},i))})]})]},x))})]}),ee==="restock"&&e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Restock Order Management"}),e.jsx("button",{onClick:()=>Te(!0),className:"px-4 py-2 rounded-lg bg-gradient-to-r from-orange-500 to-amber-500 hover:brightness-110 text-white font-semibold shadow-lg",children:"âž• Create New Order"})]}),e.jsx(St,{userId:r,onClose:()=>{},embedded:!0})]}),_e&&e.jsx(fs,{product:ke,confirmationText:Ee,onChange:t=>fe(t.target.value),onCancel:()=>{Ce(!1),J(null),fe("")},onConfirm:sr}),s&&e.jsx(ys,{imageTargetProduct:k,setShowImageModal:w,setImageTargetProduct:E,setImageUploadFile:$,setImageUploadError:ne,setImagePreviewUrl:Pe,imageUploadFile:v,imageUploadLoading:T,imageUploadError:ie,imagePreviewUrl:pe,handleImageFileChange:ar,handleImageUpload:ir}),qt&&ct&&e.jsx(Sr,{product:ct,onClose:()=>{ze(!1),He(null)}}),Tt&&Ae&&e.jsx(Cr,{userId:r,productId:Ae.id,currentLocation:Ae.location,onSave:rr,onCancel:()=>{Qe(!1),We(null)}}),Bt&&e.jsx(kr,{userId:r,products:d,mode:Ot,onClose:()=>ut(!1)}),$t&&e.jsx(Pr,{userId:r,products:d,onClose:()=>mt(!1)}),Vt&&e.jsx(Ar,{userId:r,products:d,onClose:()=>Te(!1),preSelectLowStock:ee==="view"}),zt&&ee!=="restock"&&e.jsx(St,{userId:r,onClose:()=>ht(!1)})]})},ys=({imageTargetProduct:r,setShowImageModal:a,setImageTargetProduct:c,setImageUploadFile:n,setImageUploadError:y,setImagePreviewUrl:d,imageUploadFile:m,imageUploadLoading:o,imageUploadError:b,imagePreviewUrl:P,handleImageFileChange:q,handleImageUpload:N})=>{const[R,V]=l.useState(""),[B,g]=l.useState([]),[L,C]=l.useState(!1),[j,S]=l.useState("unsplash"),f=async()=>{C(!0);try{let U=[];if(j==="unsplash")try{U=(await(await fetch(`https://api.unsplash.com/search/photos?query=${R}&client_id=n_BViYvOrSv2B6zb_SIHtZu3fnUEijs_KVuD7IXYTVc`)).json()).results?.map(H=>H.urls?.regular||H.urls?.small)||[]}catch(O){console.error("Unsplash error:",O),U=[]}else{const O=(await cr(async()=>{const{default:W}=await import("./fetchGoogleImages-y1ah5QvM.js");return{default:W}},[])).default;U=await O(R)}g(U)}catch(U){console.error("Image search error:",U)}C(!1)};l.useEffect(()=>{const U=O=>{O.key==="Escape"&&h()};return window.addEventListener("keydown",U),()=>window.removeEventListener("keydown",U)},[]);const h=()=>{a(!1),c(null),n(null),y(""),d(null),V(""),g([])};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:h}),e.jsxs("div",{className:"relative w-[95%] max-w-2xl rounded-2xl border border-white/10 bg-[#0B0F14]/95 text-white shadow-[0_24px_70px_rgba(0,0,0,0.6)] backdrop-blur-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/10",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold leading-tight",children:"Update Product Image"}),e.jsx("p",{className:"text-xs text-white/60 mt-0.5",children:r?.productName||"Product"})]}),e.jsx("button",{onClick:h,className:"h-8 w-8 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center","aria-label":"Close",children:"âœ•"})]}),e.jsxs("div",{className:"px-5 py-4 space-y-4",children:[e.jsxs("div",{className:"inline-flex rounded-full bg-white/10 p-1 border border-white/10",children:[e.jsx("button",{onClick:()=>S("unsplash"),className:`px-3 py-1.5 rounded-full text-sm font-medium ${j==="unsplash"?"bg-emerald-500 text-white":"text-white/80 hover:text-white"}`,children:"Unsplash"}),e.jsx("button",{onClick:()=>S("google"),className:`px-3 py-1.5 rounded-full text-sm font-medium ${j==="google"?"bg-emerald-500 text-white":"text-white/80 hover:text-white"}`,children:"Google"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:`Search ${j==="unsplash"?"Unsplash":"Google"}â€¦`,value:R,onChange:U=>V(U.target.value),className:"flex-1 px-3 py-2 rounded-lg bg-white/10 border border-white/15 placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-400/40"}),e.jsx("button",{className:"px-4 py-2 rounded-lg bg-gradient-to-r from-emerald-500 to-cyan-500 hover:brightness-110",onClick:f,type:"button",disabled:L,children:L?"Searchingâ€¦":"Search"})]}),e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3 max-h-64 overflow-y-auto pr-1",children:[B.map((U,O)=>e.jsxs("button",{type:"button",className:"group relative aspect-square rounded-lg overflow-hidden border border-white/10 bg-white/5 hover:border-emerald-400/50",onClick:()=>{n(null),y(""),d(U)},children:[e.jsx("img",{src:U,alt:"search result",className:"h-full w-full object-cover",onError:W=>W.currentTarget.src="/placeholder.png"}),e.jsx("span",{className:"absolute inset-0 hidden group-hover:block bg-black/20"})]},O)),B.length===0&&e.jsx("div",{className:"col-span-full text-center text-sm text-white/60",children:"No images yet â€” try a different query."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:q,className:"block w-full text-sm file:mr-4 file:py-2 file:px-3 file:rounded-lg file:border-0 file:bg-white/10 file:text-white hover:file:bg-white/20",disabled:o}),(P||m)&&e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:P||"",alt:"Preview",className:"max-h-48 max-w-full rounded-lg border border-white/10 bg-white/5 object-contain"})}),b&&e.jsx("div",{className:"text-rose-400 text-sm",children:b})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 px-5 py-4 border-t border-white/10",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/15",disabled:o,children:"Cancel"}),e.jsx("button",{onClick:N,className:`px-4 py-2 rounded-lg ${(m||P)&&!o?"bg-emerald-600 hover:bg-emerald-700":"bg-white/10 cursor-not-allowed"} `,disabled:!(m||P)||o,children:o?"Uploadingâ€¦":"Upload"})]})]})]})},Us=()=>{const[r,a]=l.useState([]),[c,n]=l.useState("add"),y=Oe.currentUser?.uid;return l.useEffect(()=>{const d=Oe.currentUser;if(!d)return;const m=le(je,`businesses/${d.uid}/products`),o=$e(m,b=>{const P=b.docs.map(q=>({id:q.id,...q.data()}));a(P)});return()=>o()},[]),e.jsxs(Rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"p-2 md:p-4 text-white",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-3 mb-5",children:[{id:"add",label:"Add Inventory"},{id:"view",label:"View Inventory"},{id:"group",label:"Item Groups"},{id:"lowstock",label:"Low Stock Alerts"}].map(d=>e.jsx("button",{onClick:()=>n(d.id),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors border "+(c===d.id?"bg-emerald-500 text-slate-900 border-transparent shadow":"bg-white/10 text-white/90 border-white/15 hover:bg-white/15"),children:d.label},d.id))}),c==="add"&&e.jsx("div",{className:"mb-4",children:e.jsx("h3",{className:"text-base font-semibold",children:"Select Inventory Input Method"})}),e.jsxs("div",{className:"mt-3",children:[c==="add"&&e.jsx("div",{className:"mt-2",children:e.jsx(gs,{userId:y,role:"distributor"})}),c==="view"&&e.jsx("div",{className:"mt-2",children:e.jsx(ws,{userId:y,db:je,role:"distributor"})}),c==="group"&&e.jsx("div",{className:"text-white/70 italic",children:"This tab is under construction."}),c==="lowstock"&&e.jsx("div",{className:"text-white/70 italic",children:"This tab is under construction."})]})]})};export{Us as default};
