import{j as e,v as it,r as nt,g as ot,l as dt,y as f,_ as Qe,u as Zt}from"./index-DRC3F7i0.js";import{r as i,R as es}from"./router-BPBaD_i0.js";import{n as ye,c as Me,p as Be,q as ts,o as ss,d as A,u as V,e as ct,m as Oe,l as rs,a as as}from"./firebase-DWi1MSv1.js";import ls from"./fetchGoogleImages-y1ah5QvM.js";import{l as oe}from"./logInventoryChange-kGfLyhaN.js";import{getStockDisplay as is,formatLooseProductStock as ns,calculateSellingUnitPrice as ut,calculateSellingUnitStock as ht,validateLooseProductConfig as os}from"./looseProductUtils-DQPoVx_a.js";import{A as ds,S as cs,R as mt,Q as us,L as hs,a as ms,V as xs,b as bs}from"./RestockOrderHistory-BifXGS1-.js";import"./vendor-Ckhrjn13.js";import"./index.esm-Bux_mLJ0.js";import"./index-aK8Jn4kw.js";import"./pdf-DQxUCnop.js";const P=[{id:"image",label:"Image",minWidth:70,sticky:!1},{id:"productName",label:"Product",minWidth:200},{id:"sku",label:"SKU",minWidth:140},{id:"brand",label:"Brand",minWidth:140},{id:"category",label:"Category",minWidth:140},{id:"hsnCode",label:"HSN",minWidth:120},{id:"quantity",label:"Qty",minWidth:90},{id:"unit",label:"Unit",minWidth:90},{id:"costPrice",label:"Cost",minWidth:110},{id:"sellingPrice",label:"Sell",minWidth:110},{id:"mrp",label:"MRP",minWidth:110},{id:"gstRate",label:"GST %",minWidth:90},{id:"isLooseProduct",label:"Loose",minWidth:90,align:"center"},{id:"status",label:"Status",minWidth:100,align:"center"},{id:"location",label:"Location",minWidth:180},{id:"source",label:"Source",minWidth:120},{id:"qr",label:"QR",minWidth:80},{id:"delete",label:"Delete",minWidth:80},{id:"edit",label:"Edit",minWidth:80}],xt="FLYP_INVENTORY_COLUMNS_V2_RETAILER",Te=d=>["businesses",d,"preferences","inventoryColumns"],gs=(d="")=>String(d).trim().toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,""),Y=({initialValue:d,onSave:q,type:I="text",step:B,className:E="w-full px-2 py-1 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/40 transition-shadow",parseSave:w=y=>y})=>{const[y,b]=es.useState(d??""),C=()=>{const j=I==="number"?parseFloat(y)||0:y;q(w(j))};return e.jsx("input",{type:I,step:B,className:E,value:y,onChange:j=>b(j.target.value),onBlur:C,onClick:j=>j.stopPropagation(),autoFocus:!0})},ps=({product:d,confirmationText:q,onChange:I,onCancel:B,onConfirm:E})=>e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"rounded p-6 w-[90%] md:w-[400px] bg-white/10 backdrop-blur-2xl border border-white/10 shadow-[0_12px_50px_rgba(0,0,0,0.45)]",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2 text-rose-300",children:"Delete Product?"}),e.jsxs("p",{className:"mb-4",children:["Are you sure you want to delete ",e.jsx("strong",{children:d?.productName||"this product"})," (SKU: ",e.jsx("strong",{children:d?.sku||"N/A"}),")?"]}),e.jsxs("p",{className:"mb-2 text-sm text-white/70",children:["Type ",e.jsx("code",{className:"bg-gray-100 px-1 rounded border",children:"delete"})," to confirm."]}),e.jsx("input",{type:"text",className:"w-full rounded px-3 py-2 mb-4 bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:'Type "delete" to confirm',value:q,onChange:I}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:B,className:"px-4 py-2 rounded border border-white/20 bg-white/10 text-white hover:bg-white/15",children:"Cancel"}),e.jsx("button",{onClick:E,disabled:q.trim().toLowerCase()!=="delete",className:`px-4 py-2 rounded text-slate-900 ${q.trim().toLowerCase()==="delete"?"bg-gradient-to-r from-emerald-400 via-teal-300 to-cyan-400 hover:shadow-[0_8px_24px_rgba(16,185,129,0.35)]":"bg-white/20 text-white/70 cursor-not-allowed"}`,children:"Delete"})]})]})}),_s=({userId:d})=>{const[q,I]=i.useState(!1),[B,E]=i.useState(null),[w,y]=i.useState([]),[b,C]=i.useState([]),[j,J]=i.useState(""),[U,T]=i.useState(""),[D,de]=i.useState("asc"),[N,X]=i.useState({rowId:null,field:null}),[je,ce]=i.useState(""),[g,L]=i.useState(new Set),[R,bt]=i.useState("quantity"),[W,Ve]=i.useState(""),[ue,O]=i.useState(!1),[Q,Ne]=i.useState(""),[v,Z]=i.useState([]),[gt,We]=i.useState(!1),[$e,pt]=i.useState([]),[wt,ve]=i.useState(!1),[Se,ke]=i.useState(null),[ze,he]=i.useState(""),[ft,Ce]=i.useState(!1),[Ge,Pe]=i.useState(null),[yt,Ue]=i.useState(!1),[me,Le]=i.useState(null),[ee,xe]=i.useState(null),[jt,Re]=i.useState(!1),[Nt,te]=i.useState(""),[be,se]=i.useState(null),[fs,ys]=i.useState(""),[js,Ns]=i.useState([]),[vt,He]=i.useState(!1),[Fe,St]=i.useState(""),[kt,Ct]=i.useState([]),[Pt,Ke]=i.useState(!1),[Ye,Ut]=i.useState([]),[F,ge]=i.useState("view"),[_,Ae]=i.useState(""),[Lt,De]=i.useState(!1),[re,_e]=i.useState(null),[Rt,Je]=i.useState(!1),[Ft,Xe]=i.useState(!1),[At,Dt]=i.useState("designer"),[_t,pe]=i.useState(!1),[qt,Ze]=i.useState(!1),[et,ae]=i.useState(!1),[le,$]=i.useState(P),[ie,ne]=i.useState(new Set),[It,Et]=i.useState([]),[Mt,qe]=i.useState(!1),[Bt,z]=i.useState(!1),[p,G]=i.useState(null),[h,M]=i.useState({baseUnit:"",sellingUnit:"",conversionFactor:"",baseUnitCost:"",baseUnitSellingPrice:"",minSellingQuantity:"1"}),Ot=async()=>{if(!Fe)return;Ke(!0);const t=await ls(Fe);Ct(t||[]),Ke(!1)},[Ie,tt]=i.useState("list"),S=ye(),st=async(t,r,s)=>{try{const[n,o,a,l]=Te(t);await rs(A(ye(),...Te(t)),{order:r,hidden:s,updatedAt:Date.now()},{merge:!0})}catch{const o={order:r,hidden:s,updatedAt:Date.now()};localStorage.setItem(xt,JSON.stringify(o))}},Tt=async t=>{try{const s=await ct(A(ye(),...Te(t)));if(s.exists()){const n=s.data(),o=Array.isArray(n.order)?n.order:P.map(x=>x.id),a=Array.isArray(n.hidden)?new Set(n.hidden):new Set,l=o.map(x=>P.find(k=>k.id===x)).filter(Boolean),c=new Set(l.map(x=>x.id)),m=P.filter(x=>!c.has(x.id)),u=[...l,...m];$(u),ne(a);return}}catch{}const r=localStorage.getItem(xt);if(r)try{const s=JSON.parse(r),n=Array.isArray(s.order)?s.order:P.map(u=>u.id),o=new Set(Array.isArray(s.hidden)?s.hidden:[]),a=n.map(u=>P.find(x=>x.id===u)).filter(Boolean),l=new Set(a.map(u=>u.id)),c=P.filter(u=>!l.has(u.id)),m=[...a,...c];$(m),ne(o);return}catch{}$(P),ne(new Set)};if(!d)return e.jsx("div",{className:"text-center p-4",children:"Loading user data..."});i.useEffect(()=>{d&&Tt(d)},[d]),i.useEffect(()=>{if(!d)return;console.log("Current user UID:",d);const t=Me(S,"businesses",d,"products"),r=Be(t,async s=>{const n=it(),o=await Promise.all(s.docs.map(async l=>{const c=l.data();let m="";try{if(c.imageUrl)m=c.imageUrl;else if(c.imagePath){const u=nt(n,c.imagePath);m=await ot(u)}}catch(u){console.warn("Image fetch error for:",c.imagePath||"unknown",u.message)}return{id:l.id,...c,imageUrl:m,imagePath:c.imagePath||""}}));y(o),C(o);const a=[...new Set(o.map(l=>l.brand).filter(Boolean))];pt(a)});return()=>r()},[d]),i.useEffect(()=>{if(!d)return;const t=Me(S,"businesses",d,"customColumns"),r=Be(t,s=>{const n=s.docs.map(o=>{const a=o.data()||{},l=a.name||"Custom";return{id:a.key||gs(l),label:l,minWidth:140,type:a.type||"text",_docId:o.id}});Et(n),$(o=>{const a=o.map(c=>c.id),l=n.filter(c=>!a.includes(c.id));return[...o,...l]})});return()=>r()},[d]),i.useEffect(()=>{if(!dt.currentUser?.uid)return;const t=ts(Me(S,`businesses/${dt.currentUser.uid}/inventoryLogs`),ss("modifiedAt","desc")),r=Be(t,s=>{Ut(s.docs.map(n=>n.data()))});return()=>r()},[]),i.useEffect(()=>{const t=j.toLowerCase(),r=w.filter(s=>{const n=s.productName?.toLowerCase().includes(t)||s.sku?.toLowerCase().includes(t)||s.brand?.toLowerCase().includes(t)||s.category?.toLowerCase().includes(t)||s.location?.fullPath?.toLowerCase().includes(t),o=!Q||we(s.quantity)===Q,a=v.length===0||s.brand&&v.includes(s.brand),l=!_||s.location?.fullPath?.toLowerCase().includes(_.toLowerCase())||s.location?.shelf===_||s.location?.rack===_||s.location?.aisle===_;return n&&o&&a&&l});C(r)},[j,w,Q,v,_]),i.useEffect(()=>{if(!U){C(t=>[...t]);return}C(t=>[...t].sort((s,n)=>{const o=parseFloat(s[U])||0,a=parseFloat(n[U])||0;return D==="asc"?o-a:a-o}))},[U,D]);const H=(t,r,s)=>{X({rowId:t,field:r}),ce(s)},K=async(t,r,s)=>{try{const n=A(S,"businesses",d,"products",t),o=await ct(n),a=o.exists()?o.data():{};if(r==="quantity"&&a.isLooseProduct){const{calculateSellingUnitStock:c}=await Qe(async()=>{const{calculateSellingUnitStock:x}=await import("./looseProductUtils-DQPoVx_a.js");return{calculateSellingUnitStock:x}},[]),m=a.conversionFactor||1,u=c(Number(s)||0,m);await V(n,{quantity:Number(s),stockInSellingUnit:u})}else if(r==="gstRate"){const c=typeof s=="string"?Number(s):s;await V(n,{gstRate:c,taxRate:c})}else await V(n,{[r]:s});await oe({userId:d,productId:t,sku:a.sku||"N/A",productName:a.productName||"N/A",brand:a.brand||"N/A",category:a.category||"N/A",previousData:a,updatedData:r==="gstRate"?{...a,gstRate:s,taxRate:s}:{...a,[r]:s},action:"updated",source:"inline-edit"});const l=r==="quantity"||r==="gstRate"||r==="costPrice"||r==="sellingPrice"||r==="mrp"?Number(s):s;y(c=>c.map(m=>m.id===t?{...m,[r]:l,...r==="gstRate"?{taxRate:l}:{}}:m)),C(c=>c.map(m=>m.id===t?{...m,[r]:l,...r==="gstRate"?{taxRate:l}:{}}:m))}catch(n){console.error("Error updating inventory field:",n)}finally{X({rowId:null,field:null}),ce("")}},Qt=t=>{L(r=>{const s=new Set(r);return s.has(t)?s.delete(t):s.add(t),s})},Vt=()=>{g.size>=b.length?L(new Set):L(new Set(b.map(t=>t.id)))},Wt=()=>L(new Set),$t=[{id:"quantity",label:"Qty",type:"number"},{id:"hsnCode",label:"HSN Code",type:"text"},{id:"unit",label:"Unit",type:"text"},{id:"brand",label:"Brand",type:"text"},{id:"category",label:"Category",type:"text"}],zt=async()=>{if(!(g.size===0||W===""&&R!=="quantity")){O(!0);try{const t=R,r=R==="quantity"?parseFloat(W)||0:String(W).trim(),s=Array.from(g),n=s.map(u=>A(S,"businesses",d,"products",u)),o=s.map(u=>b.find(x=>x.id===u)),{calculateSellingUnitStock:a}=await Qe(async()=>{const{calculateSellingUnitStock:u}=await import("./looseProductUtils-DQPoVx_a.js");return{calculateSellingUnitStock:u}},[]),l=Oe(S);for(let u=0;u<s.length;u++){const x=o[u]||{};let k;if(t==="quantity"&&x.isLooseProduct){const fe=x.conversionFactor||1,Ee=a(Number(r)||0,fe);k={quantity:Number(r),stockInSellingUnit:Ee}}else k=t==="gstRate"?{[t]:r,taxRate:r}:{[t]:r};l.update(n[u],k)}await l.commit();const c=t==="quantity"?Number(r):r,m=s.length;y(u=>u.map(x=>g.has(x.id)?{...x,[t]:c,...t==="gstRate"?{taxRate:c}:{}}:x)),C(u=>u.map(x=>g.has(x.id)?{...x,[t]:c,...t==="gstRate"?{taxRate:c}:{}}:x)),L(new Set),Ve(""),f.success(`Updated ${m} product(s).`),o.forEach((u,x)=>{const k=u||{},fe={...k,[t]:c,...t==="gstRate"?{taxRate:c}:{}};if(t==="quantity"&&k.isLooseProduct){const Ee=k.conversionFactor||1;fe.stockInSellingUnit=a(Number(r)||0,Ee)}oe({userId:d,productId:s[x],sku:k.sku||"N/A",productName:k.productName||"N/A",brand:k.brand||"N/A",category:k.category||"N/A",previousData:k,updatedData:fe,action:"updated",source:"bulk-edit"}).catch(()=>{})})}catch(t){console.error("Bulk update error:",t),f.error("Bulk update failed. Please try again.")}finally{O(!1)}}},Gt=async()=>{if(g.size!==0){O(!0);try{const t=Array.from(g).map(a=>({id:a,p:b.find(l=>l.id===a)})).filter(({p:a})=>a&&Number.isFinite(Number(a.mrp)));if(t.length===0){f.success("No products had MRP to sync."),O(!1);return}const r=t.map(({id:a})=>A(S,"businesses",d,"products",a)),s=Oe(S);t.forEach(({p:a},l)=>{s.update(r[l],{sellingPrice:Number(a.mrp)})}),await s.commit();const n=t.length,o=new Set(t.map(({id:a})=>a));y(a=>a.map(l=>o.has(l.id)?{...l,sellingPrice:Number(b.find(c=>c.id===l.id)?.mrp)}:l)),C(a=>a.map(l=>o.has(l.id)?{...l,sellingPrice:Number(b.find(c=>c.id===l.id)?.mrp)}:l)),L(new Set),f.success(`Synced Sell â† MRP for ${n} product(s).`),t.forEach(({id:a,p:l})=>{const c={...l},m={...l,sellingPrice:Number(l.mrp)};oe({userId:d,productId:a,sku:l.sku||"N/A",productName:l.productName||"N/A",brand:l.brand||"N/A",category:l.category||"N/A",previousData:c,updatedData:m,action:"updated",source:"bulk-sync-sell-from-mrp"}).catch(()=>{})})}catch(t){console.error("Bulk sync error:",t),f.error("Sync failed. Please try again.")}finally{O(!1)}}},Ht=async()=>{if(g.size!==0){O(!0);try{const t=Array.from(g).map(a=>({id:a,p:b.find(l=>l.id===a),sellVal:Number(b.find(l=>l.id===a)?.sellingPrice)})).filter(({p:a,sellVal:l})=>a&&Number.isFinite(l));if(t.length===0){f.success("No products had Sell price to sync."),O(!1);return}const r=t.map(({id:a})=>A(S,"businesses",d,"products",a)),s=Oe(S);t.forEach(({sellVal:a},l)=>{s.update(r[l],{mrp:a})}),await s.commit();const n=t.length,o=new Map(t.map(({id:a,sellVal:l})=>[a,l]));y(a=>a.map(l=>o.has(l.id)?{...l,mrp:o.get(l.id)}:l)),C(a=>a.map(l=>o.has(l.id)?{...l,mrp:o.get(l.id)}:l)),L(new Set),f.success(`Synced MRP â† Sell for ${n} product(s).`),t.forEach(({id:a,p:l,sellVal:c})=>{const m={...l},u={...l,mrp:c};oe({userId:d,productId:a,sku:l.sku||"N/A",productName:l.productName||"N/A",brand:l.brand||"N/A",category:l.category||"N/A",previousData:m,updatedData:u,action:"updated",source:"bulk-sync-mrp-from-sell"}).catch(()=>{})})}catch(t){console.error("Bulk sync error:",t),f.error("Sync failed. Please try again.")}finally{O(!1)}}},Kt=async t=>{if(re)try{const r=A(S,"businesses",d,"products",re.id),s=t?{floor:t.floor||null,aisle:t.aisle||null,rack:t.rack||null,shelf:t.shelf||null,lane:t.lane||null,fullPath:t.fullPath||(t.floor||t.aisle||t.rack||t.shelf||t.lane?[t.floor,t.aisle,t.rack,t.shelf,t.lane].filter(Boolean).join(" > "):null)}:null;await V(r,{location:s}),f.success("Location updated successfully! Changes will sync to Store Designer."),De(!1),_e(null)}catch(r){console.error("Error saving location:",r),f.error("Failed to save location")}},rt=t=>{_e(t),De(!0)},we=t=>{const r=parseInt(t);return isNaN(r)?"Unknown":r<=5?"Low":"In Stock"},at=t=>{ke(t),he(""),ve(!0)},Yt=async()=>{if(Se&&ze.trim().toLowerCase()==="delete")try{const t=A(S,"businesses",d,"products",Se.id);await as(t)}catch(t){console.error("Error deleting product:",t)}finally{ve(!1),ke(null),he("")}},lt=t=>{Le(t),xe(null),Re(!1),te(""),se(null),Ue(!0)},Jt=t=>{const r=t.target.files?.[0]||null;if(xe(r),te(""),r){const s=URL.createObjectURL(r);se(s)}else se(null)},Xt=async()=>{if(!me||!ee&&!be){f.error("No image selected");return}Re(!0),te("");try{let t=null,r=null;if(ee){const n=it(),o=ee.name.split(".").pop();r=`product_images/${d}/${me.id}.${o}`;const a=nt(n,r);await Zt(a,ee),t=await ot(a)}else be&&(t=be);const s=A(ye(),"businesses",d,"products",me.id);await V(s,r?{imageUrl:t,imagePath:r}:{imageUrl:t}),f.success("Image uploaded successfully"),Ue(!1),Le(null),xe(null),se(null)}catch(t){console.error("Error uploading image:",t),te("Image upload failed: "+(t?.message||"Unknown error")),f.error("Failed to upload image")}finally{Re(!1)}};return e.jsxs("div",{className:"text-white px-0 md:px-0 py-4 md:py-6",children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"ðŸ” Search products by name, brand, SKU, or category...",value:j,onChange:t=>J(t.target.value),className:"w-full px-4 py-3 pl-12 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all shadow-lg"}),e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/60 text-lg",children:"ðŸ”"}),j&&e.jsx("button",{onClick:()=>J(""),className:"absolute right-4 top-1/2 -translate-y-1/2 text-white/60 hover:text-white transition-colors",title:"Clear search",children:"âœ•"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-white/70 whitespace-nowrap",children:"Status:"}),e.jsxs("select",{className:"px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all",onChange:t=>Ne(t.target.value),value:Q,children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"In Stock",children:"âœ… In Stock"}),e.jsx("option",{value:"Low",children:"âš ï¸ Low Stock"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-white/70 whitespace-nowrap",children:"Sort:"}),e.jsxs("select",{className:"px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all",onChange:t=>T(t.target.value),value:U,children:[e.jsx("option",{value:"",children:"None"}),e.jsx("option",{value:"quantity",children:"ðŸ“Š Quantity"}),e.jsx("option",{value:"costPrice",children:"ðŸ’° Cost Price"}),e.jsx("option",{value:"sellingPrice",children:"ðŸ’µ Selling Price"}),e.jsx("option",{value:"mrp",children:"ðŸ·ï¸ MRP"})]}),U&&e.jsx("button",{onClick:()=>de(D==="asc"?"desc":"asc"),className:"px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white hover:bg-white/15 transition-all text-sm",title:D==="asc"?"Ascending":"Descending",children:D==="asc"?"â†‘":"â†“"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-white/70 whitespace-nowrap",children:"ðŸ“ Location:"}),e.jsx("input",{type:"text",placeholder:"Search location...",value:_,onChange:t=>Ae(t.target.value),className:"px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{className:"px-3 py-2 rounded-lg min-w-[140px] text-left bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400/50 transition-all hover:bg-white/15",type:"button",onClick:()=>We(t=>!t),children:[e.jsx("span",{className:"text-white/70",children:"ðŸ·ï¸ "}),v.length===0?"All Brands":v.length===1?v[0]:`${v.length} selected`,e.jsx("span",{className:"ml-1 text-white/50",children:"â–¼"})]}),gt&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>We(!1)}),e.jsxs("div",{className:"absolute left-0 mt-2 bg-[#0b0f14] border border-white/20 rounded-xl shadow-2xl z-20 p-3 min-w-[220px] max-h-64 overflow-y-auto backdrop-blur-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 pb-2 border-b border-white/10",children:[e.jsx("span",{className:"text-sm font-semibold text-white",children:"Select Brands"}),e.jsx("button",{className:"text-xs text-emerald-300 hover:text-emerald-200 font-medium",type:"button",onClick:()=>Z([]),children:"Clear All"})]}),$e.length===0?e.jsx("div",{className:"text-xs text-white/50 px-2 py-4 text-center",children:"No brands available"}):e.jsx("div",{className:"space-y-1",children:$e.map((t,r)=>e.jsxs("label",{className:"flex items-center px-3 py-2 cursor-pointer hover:bg-white/10 rounded-lg transition-colors group",children:[e.jsx("input",{type:"checkbox",checked:v.includes(t),onChange:s=>{s.target.checked?Z([...v,t]):Z(v.filter(n=>n!==t))},className:"mr-3 w-4 h-4 rounded border-white/30 text-emerald-500 focus:ring-emerald-400"}),e.jsx("span",{className:"text-sm text-white group-hover:text-emerald-300 transition-colors",children:t})]},r))})]})]})]}),e.jsx("button",{onClick:()=>He(!0),className:"px-4 py-2 rounded-lg font-medium text-slate-900 bg-gradient-to-r from-emerald-400 via-teal-300 to-cyan-400 hover:shadow-[0_8px_24px_rgba(16,185,129,0.35)] text-sm",children:"Search with AI"})]}),(Q||U||_||v.length>0)&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Active filters:"}),Q&&e.jsxs("span",{className:"px-2 py-1 rounded-lg bg-emerald-500/20 text-emerald-300 text-xs border border-emerald-400/30",children:[Q,e.jsx("button",{onClick:()=>Ne(""),className:"ml-1 hover:text-white",children:"Ã—"})]}),U&&e.jsxs("span",{className:"px-2 py-1 rounded-lg bg-blue-500/20 text-blue-300 text-xs border border-blue-400/30",children:["Sort: ",U," ",D==="asc"?"â†‘":"â†“",e.jsx("button",{onClick:()=>T(""),className:"ml-1 hover:text-white",children:"Ã—"})]}),_&&e.jsxs("span",{className:"px-2 py-1 rounded-lg bg-purple-500/20 text-purple-300 text-xs border border-purple-400/30",children:["ðŸ“ ",_,e.jsx("button",{onClick:()=>Ae(""),className:"ml-1 hover:text-white",children:"Ã—"})]}),v.length>0&&e.jsxs("span",{className:"px-2 py-1 rounded-lg bg-orange-500/20 text-orange-300 text-xs border border-orange-400/30",children:["ðŸ·ï¸ ",v.length," brand",v.length>1?"s":"",e.jsx("button",{onClick:()=>Z([]),className:"ml-1 hover:text-white",children:"Ã—"})]}),e.jsx("button",{onClick:()=>{Ne(""),T(""),Ae(""),Z([]),J("")},className:"px-2 py-1 rounded-lg bg-white/10 hover:bg-white/20 text-white/70 hover:text-white text-xs border border-white/20 transition-all",children:"Clear All"})]})]}),e.jsxs("div",{className:"flex mb-2 gap-2 flex-wrap items-center",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>ge("view"),className:`px-4 py-2 rounded-lg border transition-all ${F==="view"?"bg-emerald-500 text-slate-900 border-emerald-400 font-semibold shadow-lg":"bg-white/5 border-white/10 text-white/70 hover:text-white hover:bg-white/10"}`,children:"ðŸ“¦ Inventory"}),e.jsx("button",{onClick:()=>ge("shelf"),className:`px-4 py-2 rounded-lg border transition-all ${F==="shelf"?"bg-emerald-500 text-slate-900 border-emerald-400 font-semibold shadow-lg":"bg-white/5 border-white/10 text-white/70 hover:text-white hover:bg-white/10"}`,children:"ðŸ—‚ï¸ Smart Shelf View"}),e.jsx("button",{onClick:()=>ge("recent"),className:`px-4 py-2 rounded-lg border transition-all ${F==="recent"?"bg-emerald-500 text-slate-900 border-emerald-400 font-semibold shadow-lg":"bg-white/5 border-white/10 text-white/70 hover:text-white hover:bg-white/10"}`,children:"ðŸ• Recently Modified"}),e.jsx("button",{onClick:()=>ge("restock"),className:`px-4 py-2 rounded-lg border transition-all ${F==="restock"?"bg-emerald-500 text-slate-900 border-emerald-400 font-semibold shadow-lg":"bg-white/5 border-white/10 text-white/70 hover:text-white hover:bg-white/10"}`,children:"ðŸ“‹ Restock Orders"})]}),F==="view"&&e.jsx("div",{className:"ml-auto flex gap-2",children:w.filter(t=>(parseInt(t.quantity)||0)<=5).length>0&&e.jsxs("button",{onClick:()=>pe(!0),className:"px-4 py-2 rounded-lg border bg-gradient-to-r from-orange-500 to-amber-500 hover:brightness-110 text-white font-semibold shadow-lg animate-pulse",title:"Quick order for low stock items",children:["âš¡ Quick Order (",w.filter(t=>(parseInt(t.quantity)||0)<=5).length," low stock)"]})}),e.jsxs("div",{className:"ml-auto relative",children:[e.jsxs("button",{onClick:()=>ae(!et),className:"px-4 py-2 rounded-lg border bg-white/5 border-white/10 text-white hover:bg-white/10 transition-all flex items-center gap-2",title:"Additional tools",children:["ðŸ› ï¸ Tools",e.jsx("span",{className:"text-xs",children:"â–¼"})]}),et&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>ae(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-56 rounded-lg border border-white/10 bg-[#0B0F14] shadow-2xl z-20 overflow-hidden",children:[e.jsx("button",{onClick:()=>{Dt("designer"),Je(!0),ae(!1)},className:"w-full px-4 py-3 text-left text-white hover:bg-white/10 transition-colors flex items-center gap-2",children:"ðŸ§  Smart Store Designer"}),e.jsx("button",{onClick:()=>{Xe(!0),ae(!1)},className:"w-full px-4 py-3 text-left text-white hover:bg-white/10 transition-colors flex items-center gap-2",children:"ðŸ‘ï¸ View Store Layout"}),e.jsx("div",{className:"border-t border-white/10"}),e.jsx("button",{onClick:()=>{Ze(!0),ae(!1)},className:"w-full px-4 py-3 text-left text-white hover:bg-white/10 transition-colors flex items-center gap-2",children:"ðŸ“‹ Order History"})]})]})]})]}),F==="view"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-end mb-4",children:[e.jsx("button",{className:`px-4 py-1 mr-2 rounded-lg border ${Ie==="list"?"bg-emerald-600 text-white border-emerald-500":"bg-white/5 text-white/80 border-white/10 hover:text-white"}`,onClick:()=>tt("list"),children:"List View"}),e.jsx("button",{className:`px-4 py-1 rounded-lg border ${Ie==="grid"?"bg-emerald-600 text-white border-emerald-500":"bg-white/5 text-white/80 border-white/10 hover:text-white"}`,onClick:()=>tt("grid"),children:"Grid View"})]}),Ie==="list"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 p-4 rounded-xl bg-gradient-to-r from-white/5 to-white/3 border border-white/10 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{className:"px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white hover:bg-white/15 transition-all duration-200 text-sm font-medium flex items-center gap-2",onClick:()=>qe(!0),type:"button",title:"Manage columns",children:[e.jsx("span",{children:"âš™ï¸"}),e.jsx("span",{children:"Manage Columns"})]}),e.jsx("div",{className:"h-6 w-px bg-white/20"}),e.jsxs("div",{className:"text-sm text-white/80",children:[e.jsx("span",{className:"font-semibold text-emerald-400",children:b.length}),e.jsx("span",{className:"text-white/60",children:" of "}),e.jsx("span",{className:"font-semibold",children:w.length}),e.jsx("span",{className:"text-white/60",children:" products"}),b.length!==w.length&&e.jsxs("span",{className:"ml-2 text-xs text-white/50",children:["(",w.length-b.length," hidden by filters)"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:w.filter(t=>(parseInt(t.quantity)||0)<=5).length>0&&e.jsxs("div",{className:"px-3 py-1.5 rounded-lg bg-rose-500/20 border border-rose-400/30 text-rose-300 text-xs font-medium",children:["âš ï¸ ",w.filter(t=>(parseInt(t.quantity)||0)<=5).length," low stock items"]})})]}),g.size>0&&e.jsxs("div",{className:"mb-3 px-4 py-3 rounded-xl border border-emerald-400/30 bg-emerald-500/10 flex flex-wrap items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-emerald-300",children:[g.size," selected"]}),e.jsx("select",{value:R,onChange:t=>bt(t.target.value),className:"px-2 py-1.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:$t.map(t=>e.jsx("option",{value:t.id,className:"bg-slate-800 text-white",children:t.label},t.id))}),e.jsx("span",{className:"text-white/70 text-sm",children:"to"}),e.jsx("input",{type:R==="quantity"?"number":"text",value:W,onChange:t=>Ve(t.target.value),placeholder:R==="quantity"?"e.g. 10":"value",className:"px-3 py-1.5 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/40 w-28 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}),e.jsx("button",{onClick:zt,disabled:ue||(R==="quantity"?W==="":!W.trim()),className:"px-4 py-1.5 rounded-lg bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed transition",children:ue?"Updatingâ€¦":"Apply"}),e.jsx("span",{className:"text-white/40 text-sm",children:"|"}),e.jsx("button",{onClick:Gt,disabled:ue,className:"px-3 py-1.5 rounded-lg border border-amber-400/40 bg-amber-500/20 text-amber-200 hover:bg-amber-500/30 text-sm transition",title:"Set Sell price = MRP for selected",children:"Sync Sell â† MRP"}),e.jsx("button",{onClick:Ht,disabled:ue,className:"px-3 py-1.5 rounded-lg border border-white/20 text-white/80 hover:bg-white/10 text-sm transition",title:"Set MRP = Sell price for selected",children:"Sync MRP â† Sell"}),e.jsx("button",{onClick:Wt,className:"px-3 py-1.5 rounded-lg border border-white/20 text-white/80 hover:bg-white/10 text-sm transition",children:"Clear selection"})]}),e.jsx("div",{className:"w-full overflow-hidden rounded-xl border border-white/10 bg-gradient-to-br from-white/5 via-white/3 to-white/5 backdrop-blur-xl shadow-2xl",children:e.jsx("div",{className:"overflow-x-auto overflow-y-visible scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent",style:{scrollbarWidth:"thin"},children:e.jsx("div",{className:"inline-block min-w-full align-middle",children:e.jsxs("table",{className:"w-full text-xs sm:text-sm md:text-base",children:[e.jsx("thead",{className:"bg-gradient-to-r from-white/15 via-white/10 to-white/15 text-left sticky top-0 z-10 backdrop-blur-md border-b-2 border-white/20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-3 w-10 border-r border-white/10 text-center",children:e.jsx("input",{type:"checkbox",checked:b.length>0&&g.size===b.length,onChange:Vt,className:"rounded border-white/30 bg-white/10 text-emerald-500 focus:ring-emerald-400/50",title:"Select all on page"})}),le.filter(t=>!ie.has(t.id)).map(t=>e.jsx("th",{className:"px-3 py-3 sm:px-4 sm:py-4 text-white font-semibold border-r border-white/10 last:border-r-0 "+(t.id==="status"||t.id==="isLooseProduct"?"text-center":"text-left")+" whitespace-nowrap",style:{minWidth:t.minWidth?`${t.minWidth}px`:"auto",maxWidth:t.id==="location"?"350px":t.id==="productName"?"250px":"auto"},children:e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{children:t.label})})},t.id))]})}),e.jsxs("tbody",{className:"divide-y divide-white/5",children:[b.map((t,r)=>e.jsxs("tr",{className:`border-b border-white/5 hover:bg-white/10 transition-all duration-200 group/row ${g.has(t.id)?"bg-emerald-500/10":"bg-white/0"} hover:bg-gradient-to-r hover:from-white/5 hover:to-white/0`,style:{animation:`fadeIn 0.3s ease-out ${r*.02}s both`},children:[e.jsx("td",{className:"px-2 py-3 border-r border-white/5 text-center align-middle",children:e.jsx("input",{type:"checkbox",checked:g.has(t.id),onChange:()=>Qt(t.id),onClick:s=>s.stopPropagation(),className:"rounded border-white/30 bg-white/10 text-emerald-500 focus:ring-emerald-400/50"})}),le.filter(s=>!ie.has(s.id)).map(s=>{switch(s.id){case"qr":return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0",children:e.jsx("button",{onClick:()=>{Pe(t),Ce(!0)},className:"px-2.5 py-1.5 text-xs font-medium rounded-lg bg-gradient-to-r from-blue-500/20 to-blue-600/20 border border-blue-400/30 hover:from-blue-500/30 hover:to-blue-600/30 text-blue-300 transition-all duration-200 shadow-sm hover:shadow-md",title:"Generate QR",children:"Generate"})},s.id);case"image":return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0",children:e.jsx("div",{className:"inline-block cursor-pointer",onClick:()=>lt(t),title:"Click to upload image",children:e.jsx("img",{src:t.imageUrl||"/placeholder.png",alt:"product",className:"h-12 w-12 sm:h-14 sm:w-14 rounded-lg object-cover border-2 border-white/20 ring-2 ring-white/10 shadow-md hover:shadow-lg hover:scale-105 transition-all duration-200"})})},s.id);case"productName":return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0 max-w-[220px] sm:max-w-[250px] break-words whitespace-normal min-h-[2.5rem]",onClick:()=>H(t.id,"productName",t.productName),children:N.rowId===t.id&&N.field==="productName"?e.jsx(Y,{initialValue:t.productName??"",onSave:a=>K(t.id,"productName",a)}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t.productName}),t.isLooseProduct&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-500/20 text-purple-300 border border-purple-500/30",title:"Loose Product",children:"ðŸ›’"})]})},s.id);case"sku":case"brand":case"category":case"hsnCode":case"unit":return e.jsx("td",{className:"p-2 max-w-[180px] break-words whitespace-normal min-h-[2.5rem]",onClick:()=>H(t.id,s.id,t[s.id]),children:N.rowId===t.id&&N.field===s.id?e.jsx(Y,{initialValue:t[s.id]??"",onSave:a=>K(t.id,s.id,a)}):e.jsx("div",{className:"flex flex-col gap-1",children:t.isLooseProduct?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-purple-500/20 text-purple-300 border border-purple-500/30",children:"Loose"})}),e.jsxs("div",{className:"text-xs text-white/90",children:[e.jsxs("div",{children:["Base: ",t.baseUnit||t.unit||""]}),e.jsxs("div",{className:"text-white/70",children:["Sell: ",t.sellingUnit||""]})]})]}):e.jsx("span",{children:t[s.id]||""})})},s.id);case"quantity":const n=is(t);return e.jsx("td",{className:"p-2 min-h-[2.5rem] align-middle",onClick:()=>H(t.id,"quantity",t.quantity),children:N.rowId===t.id&&N.field==="quantity"?e.jsx(Y,{type:"number",step:t.isLooseProduct?"0.01":"1",initialValue:t.quantity??"",onSave:a=>K(t.id,"quantity",Number(a))}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"font-medium",children:n.primary}),t.isLooseProduct&&n.secondary&&e.jsx("div",{className:"text-xs text-white/60",children:n.secondary})]})},s.id);case"costPrice":case"sellingPrice":case"mrp":return e.jsx("td",{className:"p-2 min-h-[2.5rem] align-middle",onClick:()=>H(t.id,s.id,t[s.id]),children:N.rowId===t.id&&N.field===s.id?e.jsx(Y,{type:"number",step:"0.01",initialValue:t[s.id]??"",onSave:a=>K(t.id,s.id,Number(a))}):t[s.id]!==void 0?e.jsxs(e.Fragment,{children:["â‚¹",t[s.id]]}):""},s.id);case"gstRate":const o=t.gstRate!==void 0&&t.gstRate!==null?t.gstRate:t.taxRate;return e.jsx("td",{className:"p-2 min-h-[2.5rem] align-middle",onClick:()=>H(t.id,"gstRate",o),children:N.rowId===t.id&&N.field==="gstRate"?e.jsx(Y,{type:"number",step:"0.01",initialValue:o??"",onSave:a=>K(t.id,"gstRate",Number(a))}):o!=null?e.jsxs(e.Fragment,{children:[o,"%"]}):""},s.id);case"isLooseProduct":return e.jsx("td",{className:"p-2 align-middle text-center",children:t.isLooseProduct?e.jsx("button",{onClick:a=>{a.stopPropagation(),G(t),M({baseUnit:t.baseUnit||t.unit||"",sellingUnit:t.sellingUnit||"",conversionFactor:t.conversionFactor?.toString()||"",baseUnitCost:t.baseUnitCost?.toString()||t.costPrice?.toString()||"",baseUnitSellingPrice:t.baseUnitSellingPrice?.toString()||t.sellingPrice?.toString()||"",minSellingQuantity:t.minSellingQuantity?.toString()||"1"}),z(!0)},className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-purple-500/20 text-purple-300 border border-purple-500/30 hover:bg-purple-500/30 transition cursor-pointer active:scale-95",title:"Click to edit loose product settings",children:"ðŸ›’ Loose"}):e.jsx("button",{onClick:a=>{a.stopPropagation(),G(t),M({baseUnit:t.unit||"",sellingUnit:"",conversionFactor:"",baseUnitCost:t.costPrice?.toString()||"",baseUnitSellingPrice:t.sellingPrice?.toString()||"",minSellingQuantity:"1"}),z(!0)},className:"text-xs px-2 py-1 rounded border border-white/20 bg-white/5 hover:bg-white/10 text-white/60 hover:text-white transition active:scale-95",title:"Click to enable loose product",children:"+ Enable"})},s.id);case"status":{const a=we(t.quantity),l=a==="In Stock"?"InÂ Stock":a,c=a==="Low",m=a==="Unknown"||(parseInt(t.quantity)||0)===0;return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle text-center border-r border-white/5 last:border-r-0 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{title:a,className:"inline-flex items-center justify-center min-w-[80px] sm:min-w-[90px] h-7 sm:h-8 px-3 sm:px-4 rounded-full text-xs sm:text-sm font-bold shadow-md "+(c?"bg-gradient-to-r from-rose-500 to-rose-600 text-white border border-rose-400/50":m?"bg-gradient-to-r from-gray-500 to-gray-600 text-white border border-gray-400/50":"bg-gradient-to-r from-emerald-400 to-emerald-500 text-slate-900 border border-emerald-300/50"),children:l}),(c||m)&&e.jsx("button",{onClick:()=>pe(!0),className:"px-2 py-1 rounded text-xs font-medium bg-orange-500/20 hover:bg-orange-500/30 text-orange-300 border border-orange-400/30 transition-all",title:"Quick add to restock order",children:"âš¡"})]})},s.id)}case"location":{const a=t.location?.fullPath;return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0 min-w-[200px] sm:min-w-[220px] max-w-[300px] sm:max-w-[350px]",children:a?e.jsxs("div",{className:"flex items-start gap-2 group/loc",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-emerald-400 text-sm flex-shrink-0",children:"ðŸ“"}),e.jsx("span",{className:"text-xs text-emerald-300 font-medium break-words whitespace-normal leading-relaxed",title:a,children:a})]})}),e.jsx("button",{onClick:()=>rt(t),className:"text-xs px-2 py-1 rounded bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300 opacity-0 group-hover/loc:opacity-100 transition-opacity flex-shrink-0",title:"Change location",children:"Edit"})]}):e.jsxs("button",{onClick:()=>rt(t),className:"text-xs px-3 py-1.5 rounded bg-white/10 hover:bg-white/20 text-white/70 border border-white/20 hover:border-white/30 transition-all flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ“"}),e.jsx("span",{children:"Set Location"})]})},s.id)}case"source":return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0 min-w-[100px] max-w-[120px] text-center",children:t.sourceOrderId?e.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs bg-blue-500 text-white break-words whitespace-normal leading-snug",children:"From Order"}):""},s.id);case"delete":return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0",children:e.jsx("button",{onClick:()=>at(t),className:"text-rose-300 hover:text-rose-200",title:"Delete Item",children:"ðŸ—‘ï¸"})},s.id);case"edit":return e.jsx("td",{className:"px-3 py-3 sm:px-4 sm:py-4 align-middle border-r border-white/5 last:border-r-0",children:e.jsx("button",{onClick:()=>{E(t.id),I(!0)},className:"text-sm text-emerald-300 underline",children:"Edit"})},s.id);default:return e.jsx("td",{className:"p-2 max-w-[180px] break-words whitespace-normal min-h-[2.5rem]",onClick:()=>H(t.id,s.id,t[s.id]),children:N.rowId===t.id&&N.field===s.id?e.jsx(Y,{initialValue:t[s.id]??"",onSave:a=>K(t.id,s.id,a)}):t[s.id]||""},s.id)}})]},t.id)),b.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:le.filter(t=>!ie.has(t.id)).length+1,className:"text-center p-4 text-white/70",children:w.length===0?"No products found.":"Loading inventory..."})}):null]})]})})})}),Mt&&e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"w-[96%] max-w-2xl rounded-2xl p-4 bg-white/10 backdrop-blur-2xl border border-white/15 shadow-[0_20px_80px_rgba(0,0,0,0.5)] text-white relative",children:[e.jsx("button",{onClick:()=>qe(!1),className:"absolute top-2 right-2 text-white/70 hover:text-white",children:"âœ•"}),e.jsx(ds,{availableColumns:[...P,...It],hiddenCols:ie,onToggle:t=>{const r=new Set(ie);r.has(t)?r.delete(t):r.add(t),ne(r);const s=P.map(l=>l.id),n=le.map(l=>l.id),o=s.filter(l=>!n.includes(l)),a=[...n,...o];$([...le,...P.filter(l=>o.includes(l.id))]),st(d,a,Array.from(r))},onReset:()=>{$(P),ne(new Set),st(d,P.map(r=>r.id),[])},onClose:()=>qe(!1)})]})})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:b.map(t=>e.jsxs("div",{className:"p-4 rounded-xl flex flex-col bg-white/10 backdrop-blur-xl border border-white/10 shadow-[0_8px_40px_rgba(0,0,0,0.35)]",children:[e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx("button",{className:"focus:outline-none",style:{width:"100%"},onClick:()=>lt(t),title:"Click to upload image",children:e.jsx("img",{src:t.imageUrl||"/placeholder.png",alt:t.productName,className:"w-full h-32 object-contain rounded border border-white/20 ring-1 ring-white/10"})})}),e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold",children:t.productName}),t.isLooseProduct&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-500/20 text-purple-300 border border-purple-500/30",title:"Loose Product",children:"ðŸ›’ Loose"})]}),e.jsxs("p",{className:"text-sm text-white/70 mb-1",children:[t.brand," | ",t.category]}),e.jsx("p",{className:"text-sm mb-1",children:t.isLooseProduct?e.jsxs(e.Fragment,{children:["Stock: ",ns(t),t.sellingUnitPrice!==void 0&&e.jsxs(e.Fragment,{children:[" | â‚¹",t.sellingUnitPrice?.toFixed(2),"/",t.sellingUnit]})]}):e.jsxs(e.Fragment,{children:["Qty: ",t.quantity," ",t.unit&&t.unit," ",t.sellingPrice!==void 0&&e.jsxs(e.Fragment,{children:["| â‚¹",t.sellingPrice]})]})}),(t.mrp!==void 0||t.gstRate!==void 0||t.taxRate!==void 0)&&e.jsxs("p",{className:"text-sm mb-1",children:[t.mrp!==void 0&&e.jsxs(e.Fragment,{children:["MRP: â‚¹",t.mrp]}),t.mrp!==void 0&&(t.gstRate!==void 0||t.taxRate!==void 0)&&e.jsx(e.Fragment,{children:" Â |Â  "}),(t.gstRate!==void 0||t.taxRate!==void 0)&&e.jsxs(e.Fragment,{children:["GST: ",t.gstRate??t.taxRate,"%"]})]}),e.jsxs("p",{className:"text-xs text-white/60 mb-1",children:["SKU: ",t.sku||"N/A"," | ",t.isLooseProduct?e.jsxs(e.Fragment,{children:["Base: ",t.baseUnit||"N/A"," | Sell: ",t.sellingUnit||"N/A"]}):e.jsxs(e.Fragment,{children:["Unit: ",t.unit||"N/A"]})]}),t.hsnCode&&e.jsxs("p",{className:"text-xs text-white/60 mb-1",children:["HSN: ",t.hsnCode]}),e.jsxs("div",{className:"flex items-center gap-2 mt-auto",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded font-semibold ${(t.status||we(t.quantity))==="In Stock"?"bg-emerald-500 text-slate-900":"bg-rose-500 text-white"}`,children:t.status||we(t.quantity)}),e.jsx("button",{className:"text-xs px-2 py-1 rounded bg-white/10 border border-white/20 hover:bg-white/15",onClick:()=>{Pe(t),Ce(!0)},title:"Generate QR",children:"QR"}),e.jsx("button",{className:"ml-auto text-rose-300 hover:text-rose-200 px-2",title:"Delete Item",onClick:()=>at(t),children:"ðŸ—‘ï¸"})]})]},t.id))})]}),F==="shelf"&&e.jsx(cs,{userId:d,products:w}),F==="recent"&&e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3 bg-clip-text text-transparent bg-gradient-to-r from-white via-white to-emerald-200",children:"Recent Inventory Modifications"}),Ye.length===0?e.jsx("p",{className:"text-white/70",children:"No recent modifications found."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:Ye.map((t,r)=>e.jsxs("div",{className:"p-4 text-sm rounded-md bg-white/10 backdrop-blur-xl border border-white/10 shadow-[0_8px_40px_rgba(0,0,0,0.35)]",children:[e.jsxs("div",{className:"font-semibold text-white mb-1",children:["SKU: ",t.sku]}),e.jsxs("div",{children:["Product: ",t.productName||"N/A"]}),e.jsxs("div",{children:["Brand: ",t.brand||"N/A"]}),e.jsxs("div",{children:["Category: ",t.category||"N/A"]}),e.jsxs("div",{className:"mt-2 text-white/70",children:[e.jsx("span",{className:"font-medium",children:"Action:"})," ",t.action,e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Source:"})," ",t.source,e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Modified By:"})," ",t.modifiedBy||"Unknown",e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Time:"})," ",t.modifiedAt?.toDate?.().toLocaleString?.()||"N/A",e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Changes:"}),e.jsx("ul",{className:"list-disc list-inside",children:Object.entries(t.changes||{}).map(([s,n])=>e.jsxs("li",{children:[s,": ",n.from??"N/A"," â†’ ",n.to??"N/A"]},s))})]})]},r))})]}),F==="restock"&&e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Restock Order Management"}),e.jsx("button",{onClick:()=>pe(!0),className:"px-4 py-2 rounded-lg bg-gradient-to-r from-orange-500 to-amber-500 hover:brightness-110 text-white font-semibold shadow-lg",children:"âž• Create New Order"})]}),e.jsx(mt,{userId:d,onClose:()=>{},embedded:!0})]}),wt&&e.jsx(ps,{product:Se,confirmationText:ze,onChange:t=>he(t.target.value),onCancel:()=>{ve(!1),ke(null),he("")},onConfirm:Yt}),yt&&e.jsx(ws,{imageTargetProduct:me,setShowImageModal:Ue,setImageTargetProduct:Le,setImageUploadFile:xe,setImageUploadError:te,setImagePreviewUrl:se,imageUploadFile:ee,imageUploadLoading:jt,imageUploadError:Nt,imagePreviewUrl:be,handleImageFileChange:Jt,handleImageUpload:Xt}),vt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:e.jsxs("div",{className:"p-6 rounded w-11/12 max-w-2xl relative bg-white/10 backdrop-blur-2xl border border-white/10 shadow-[0_12px_50px_rgba(0,0,0,0.45)] text-white",children:[e.jsx("button",{onClick:()=>He(!1),className:"absolute top-2 right-2 text-white/70 hover:text-rose-300",children:"âœ•"}),e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Search Product Images"}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Enter product description...",className:"flex-grow px-4 py-2 rounded bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/50",value:Fe,onChange:t=>St(t.target.value)}),e.jsx("button",{onClick:Ot,className:"px-4 py-2 rounded-xl font-medium text-slate-900 bg-gradient-to-r from-emerald-400 via-teal-300 to-cyan-400 hover:shadow-[0_8px_24px_rgba(16,185,129,0.35)]",children:Pt?"Searching...":"Search"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 max-h-80 overflow-y-auto",children:kt.map((t,r)=>e.jsx("img",{src:t,alt:"AI result",className:"w-full h-28 object-cover rounded cursor-pointer border border-white/20 hover:border-emerald-300/50 ring-1 ring-white/10",onClick:()=>{navigator.clipboard.writeText(t),alert("Image URL copied to clipboard!")}},r))})]})}),ft&&Ge&&e.jsx(us,{product:Ge,size:220,businessId:d,onClose:()=>{Ce(!1),Pe(null)}}),Lt&&re&&e.jsx(hs,{userId:d,productId:re.id,currentLocation:re.location,onSave:Kt,onCancel:()=>{De(!1),_e(null)}}),Rt&&e.jsx(ms,{userId:d,products:w,mode:At,onClose:()=>Je(!1)}),Ft&&e.jsx(xs,{userId:d,products:w,onClose:()=>Xe(!1)}),_t&&e.jsx(bs,{userId:d,products:w,onClose:()=>pe(!1),preSelectLowStock:F==="view"}),qt&&F!=="restock"&&e.jsx(mt,{userId:d,onClose:()=>Ze(!1)}),Bt&&p&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-950 rounded-2xl shadow-2xl border border-white/10 p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white",children:[p.isLooseProduct?"Edit":"Enable"," Loose Product"]}),e.jsx("p",{className:"text-sm text-white/60 mt-1",children:p.productName})]}),e.jsx("button",{onClick:()=>{z(!1),G(null)},className:"w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-white/70 hover:text-white transition",children:"âœ•"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-white/70 mb-1",children:["Base Unit ",e.jsx("span",{className:"text-white/50",children:"(What you buy)"})]}),e.jsx("input",{type:"text",value:h.baseUnit,onChange:t=>M(r=>({...r,baseUnit:t.target.value})),placeholder:"e.g., 1 Packet (100 pieces)",className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-purple-400/50"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-white/70 mb-1",children:["Selling Unit ",e.jsx("span",{className:"text-white/50",children:"(What you sell)"})]}),e.jsx("input",{type:"text",value:h.sellingUnit,onChange:t=>M(r=>({...r,sellingUnit:t.target.value})),placeholder:"e.g., 1 piece",className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-purple-400/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Conversion Factor"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:h.conversionFactor,onChange:t=>M(r=>({...r,conversionFactor:t.target.value})),placeholder:"e.g., 100",className:"flex-1 px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-purple-400/50"}),e.jsx("button",{type:"button",onClick:()=>{const t=h.baseUnit.toLowerCase(),r=h.sellingUnit.toLowerCase(),s={"1 packet (100 pieces)":{"1 piece":100,piece:100},"1kg":{"100g":10,"500g":2,gram:1e3,g:1e3},"1 strip (10 tablets)":{"1 tablet":10,tablet:10},"1 packet":{"1 piece":100,piece:100}};let n=!1;for(const[o,a]of Object.entries(s))if(t.includes(o.split("(")[0].trim())||t.includes(o)){for(const[l,c]of Object.entries(a))if(r.includes(l)){M(m=>({...m,conversionFactor:c.toString()})),n=!0,f.success(`Auto-calculated: 1 ${h.baseUnit} = ${c} ${h.sellingUnit}`);break}if(n)break}n||f.info("Could not auto-calculate. Please enter manually.")},className:"px-3 py-2 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 text-white text-sm",children:"Auto"})]}),e.jsxs("p",{className:"text-xs text-white/50 mt-1",children:["How many ",h.sellingUnit||"selling units"," = 1 ",h.baseUnit||"base unit","?"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Base Unit Cost (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:h.baseUnitCost,onChange:t=>M(r=>({...r,baseUnitCost:t.target.value})),placeholder:p.costPrice?.toString()||"Cost per base unit",className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-purple-400/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Base Unit Selling Price (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:h.baseUnitSellingPrice,onChange:t=>M(r=>({...r,baseUnitSellingPrice:t.target.value})),placeholder:p.sellingPrice?.toString()||"Selling price per base unit",className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-purple-400/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Min. Selling Quantity"}),e.jsx("input",{type:"number",step:"0.01",value:h.minSellingQuantity,onChange:t=>M(r=>({...r,minSellingQuantity:t.target.value})),className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-purple-400/50"})]}),h.baseUnitSellingPrice&&h.conversionFactor&&e.jsxs("div",{className:"p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsx("div",{className:"text-xs text-emerald-300 font-medium mb-1",children:"Calculated Values"}),e.jsxs("div",{className:"text-sm text-white",children:["Selling Price: â‚¹",ut(parseFloat(h.baseUnitSellingPrice)||0,parseFloat(h.conversionFactor)||1).toFixed(2)," per ",h.sellingUnit||"selling unit"]}),p.quantity!==void 0&&e.jsxs("div",{className:"text-xs text-white/70 mt-1",children:["Available: ",ht(parseFloat(p.quantity)||0,parseFloat(h.conversionFactor)||1)," ",h.sellingUnit||"selling units"]})]}),p.isLooseProduct&&e.jsx("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/20",children:e.jsx("button",{type:"button",onClick:async()=>{try{const t=A(S,"businesses",d,"products",p.id);await V(t,{isLooseProduct:!1,unit:p.baseUnit||p.unit,sellingPrice:p.baseUnitSellingPrice||p.sellingPrice}),f.success("Loose product disabled"),z(!1),G(null)}catch(t){console.error("Error disabling loose product:",t),f.error("Failed to disable loose product")}},className:"text-sm text-red-300 hover:text-red-200 underline",children:"Disable Loose Product Mode"})})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-white/10",children:[e.jsx("button",{onClick:()=>{z(!1),G(null)},className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white transition",children:"Cancel"}),e.jsxs("button",{onClick:async()=>{const t=os({isLooseProduct:!0,baseUnit:h.baseUnit,sellingUnit:h.sellingUnit,conversionFactor:parseFloat(h.conversionFactor)||0});if(!t.valid){f.error(t.errors[0]);return}try{const r=parseFloat(h.conversionFactor)||1,s=parseFloat(h.baseUnitCost)||p.costPrice||0,n=parseFloat(h.baseUnitSellingPrice)||p.sellingPrice||0,o=ut(n,r),a=ht(p.quantity||0,r),l=A(S,"businesses",d,"products",p.id);await V(l,{isLooseProduct:!0,baseUnit:h.baseUnit,sellingUnit:h.sellingUnit,conversionFactor:r,stockInSellingUnit:a,baseUnitCost:s,baseUnitSellingPrice:n,sellingUnitPrice:o,minSellingQuantity:parseFloat(h.minSellingQuantity)||1,unit:h.baseUnit,sellingPrice:o}),await oe({userId:d,productId:p.id,sku:p.sku,previousData:p,updatedData:{...p,isLooseProduct:!0,baseUnit:h.baseUnit,sellingUnit:h.sellingUnit,conversionFactor:r,stockInSellingUnit:a,baseUnitCost:s,baseUnitSellingPrice:n,sellingUnitPrice:o,minSellingQuantity:parseFloat(h.minSellingQuantity)||1},action:"updated",source:"loose-product-quick-setup"}),f.success("âœ… Loose product configured successfully!"),z(!1),G(null)}catch(r){console.error("Error configuring loose product:",r),f.error("Failed to configure loose product")}},className:"px-4 py-2 rounded-lg bg-gradient-to-r from-purple-500 via-pink-400 to-orange-400 text-white font-semibold hover:shadow-lg hover:shadow-purple-500/30 transition",children:[p.isLooseProduct?"Update":"Enable"," Loose Product"]})]})]})})]})},ws=({imageTargetProduct:d,setShowImageModal:q,setImageTargetProduct:I,setImageUploadFile:B,setImageUploadError:E,setImagePreviewUrl:w,imageUploadFile:y,imageUploadLoading:b,imageUploadError:C,imagePreviewUrl:j,handleImageFileChange:J,handleImageUpload:U})=>{const[T,D]=i.useState(""),[de,N]=i.useState([]),[X,je]=i.useState(!1),ce=async()=>{if(T?.trim()){je(!0);try{const g=(await Qe(async()=>{const{default:R}=await import("./fetchGoogleImages-y1ah5QvM.js");return{default:R}},[])).default,L=await g(T.trim());N(L||[])}catch(g){console.error("Image search error:",g)}finally{je(!1)}}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60"}),e.jsxs("div",{className:"relative w-11/12 max-w-2xl rounded-2xl border border-slate-700 bg-slate-900 shadow-2xl p-6 text-white",children:[e.jsx("button",{onClick:()=>{q(!1),I(null),B(null),E(""),w(null),D(""),N([])},className:"absolute top-3 right-3 rounded-md px-2 py-1 text-white/70 hover:text-white hover:bg-slate-800","aria-label":"Close",children:"âœ•"}),e.jsx("h2",{className:"text-lg font-semibold mb-1",children:"Upload Product Image"}),e.jsx("p",{className:"mb-4 text-white/70",children:d?.productName||"Product"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Find an image with Google"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Search product image on Googleâ€¦",value:T,onChange:g=>D(g.target.value),className:"flex-grow px-3 py-2 rounded-md bg-slate-800 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-emerald-400/40"}),e.jsx("button",{onClick:ce,disabled:X,className:"px-4 py-2 rounded-md bg-emerald-500 text-slate-900 font-medium hover:bg-emerald-400 disabled:opacity-60",children:X?"Searchingâ€¦":"Google Search"})]}),de?.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-3 max-h-48 overflow-y-auto",children:de.map((g,L)=>e.jsx("img",{src:g,alt:"Search result",className:"w-full h-24 object-cover rounded border border-slate-700 hover:border-emerald-300/60 cursor-pointer",onClick:()=>{B(null),E(""),w(g)},onError:R=>R.currentTarget.style.display="none"},L))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Or upload from device"}),e.jsx("input",{type:"file",accept:"image/*",onChange:J,className:"block w-full cursor-pointer rounded-md px-3 py-2 bg-slate-800 border border-slate-700 file:bg-slate-700 file:text-white file:border-0 file:px-3 file:py-1",disabled:b})]}),(j||y)&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-white/70 mb-2",children:"Preview"}),e.jsxs("div",{className:"flex items-center gap-3",children:[j&&e.jsx("img",{src:j,alt:"Preview",className:"max-h-36 rounded border border-slate-700",style:{objectFit:"contain"}}),y&&e.jsx("div",{className:"text-xs text-white/60",children:y.name})]})]}),C&&e.jsx("div",{className:"mb-3 text-rose-300 text-sm",children:C}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{onClick:()=>{q(!1),I(null),B(null),E(""),w(null),D(""),N([])},className:"px-4 py-2 rounded-md bg-slate-800 border border-slate-700 text-white hover:bg-slate-700",disabled:b,children:"Cancel"}),e.jsx("button",{onClick:U,className:`px-4 py-2 rounded-md font-medium ${(y||j)&&!b?"bg-emerald-500 text-slate-900 hover:bg-emerald-400":"bg-slate-700 text-white/70 cursor-not-allowed"}`,disabled:!(y||j)||b,children:b?"Uploadingâ€¦":"Upload"})]})]})]})};export{_s as default};
