import{j as e,l as L,d as S}from"./index-DRC3F7i0.js";import{r as k,R as oe}from"./router-BPBaD_i0.js";import{e as ne,d as I,g as Y,c as J,u as M}from"./firebase-DWi1MSv1.js";import{u as de}from"./useTranslation-C_4YkXWs.js";import{m}from"./proxy-BgUy8BPw.js";import{A as le}from"./index-DSciU07p.js";import"./vendor-Ckhrjn13.js";import"./index.esm-Bux_mLJ0.js";const F={hidden:{opacity:0,y:14},show:{opacity:1,y:0,transition:{duration:.35}}},K={hidden:{opacity:1},show:{opacity:1,transition:{delayChildren:.05,staggerChildren:.06}}},ce={hidden:{opacity:0,scale:.98},show:{opacity:1,scale:1,transition:{duration:.35}}},$=({className:n="",children:l})=>e.jsxs(m.div,{variants:ce,whileHover:{scale:1.01},whileTap:{scale:.995},className:`relative rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl transition duration-300 vignette overflow-hidden ${n}`,children:[e.jsx("span",{className:"pointer-events-none absolute -inset-px rounded-xl opacity-0 group-hover:opacity-100 transition duration-300"}),l]}),A=({label:n,value:l,note:T,tone:c="default"})=>{const O={default:"text-white",yellow:"text-amber-300",green:"text-emerald-300",blue:"text-cyan-300",purple:"text-fuchsia-300"};return e.jsxs($,{className:"p-4 group",children:[e.jsx(m.p,{className:"text-xs uppercase tracking-wide text-white/70",variants:F,children:n}),e.jsx(m.div,{variants:F,className:`mt-1 text-2xl font-semibold ${O[c]||O.default}`,children:l}),T&&e.jsx(m.div,{variants:F,className:"mt-2 text-[11px] text-white/70 space-y-1",children:T})]})},D=({children:n,tone:l="neutral"})=>{const T={danger:"bg-red-400/15 text-red-300",warning:"bg-orange-400/15 text-orange-300",amber:"bg-amber-400/15 text-amber-300",info:"bg-sky-400/15 text-sky-300",purple:"bg-fuchsia-400/15 text-fuchsia-300",neutral:"bg-white/10 text-white/90"}[l];return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${T}`,children:n})},q=({title:n,icon:l})=>e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:l}),e.jsx("h3",{className:"font-semibold text-lg bg-clip-text text-transparent bg-gradient-to-r from-white via-white to-emerald-200",children:n})]}),e.jsx(m.div,{initial:{scaleX:0,opacity:0},whileInView:{scaleX:1,opacity:1},viewport:{once:!0,amount:.6},transition:{duration:.5},className:"h-px w-24 origin-left bg-gradient-to-r from-emerald-300/60 to-transparent mt-1"})]}),ye=()=>{const{t:n}=de(),[l,T]=k.useState({totalOrders:0,pendingOrders:0,completedOrders:0,totalRevenue:0,dueCreditTotal:0,inventoryCount:0,lowStockCount:0,yetToShip:0,outForDelivery:0}),[c,O]=k.useState({overdue:[],today:[],tomorrow:[],upcoming:[],totals:{overdue:0,today:0,tomorrow:0,upcoming:0,allDue:0}}),[g,P]=k.useState({bucket:"ALL",sort:"dueDate",dir:"asc",query:""}),[B,Q]=k.useState({}),[G,Z]=k.useState({ownerName:"",businessName:""}),ee=s=>Q(t=>({...t,[s]:!t[s]})),_=s=>{if(!s)return null;if(typeof s.toDate=="function")return s.toDate();if(s.seconds)return new Date(s.seconds*1e3);const t=new Date(s);return isNaN(t.getTime())?null:t},te=s=>{const t=_(s.creditDueDate||s.dueDate);if(t)return t;const o=_(s.deliveredAt),a=Number(s.creditDays||0);if(!o||!a)return null;const d=new Date(o);return d.setDate(d.getDate()+a),d},H=s=>{if(!s)return null;const t=new Date;t.setHours(0,0,0,0);const o=new Date(s);return o.setHours(0,0,0,0),Math.round((o.getTime()-t.getTime())/(1e3*60*60*24))};k.useEffect(()=>{(async()=>{const t=L.currentUser?.uid;if(t)try{const o=await ne(I(S,"businesses",t));if(o.exists()){const a=o.data();Z({ownerName:a.ownerName||a.name||a.userName||"",businessName:a.businessName||a.distributorName||a.name||""})}}catch(o){console.error("Failed to load distributor profile",o)}})()},[]),k.useEffect(()=>{(async()=>{const t=L.currentUser?.uid;if(t)try{const o=await Y(J(S,`businesses/${t}/orderRequests`)),a=i=>{if(!i||typeof i!="object")return 0;const r=i?.chargesSnapshot?.breakdown;return r&&r.grandTotal!=null?Number(r.grandTotal)||0:i?.chargesSnapshot?.grandTotal!=null?Number(i.chargesSnapshot.grandTotal)||0:i?.proforma?.grandTotal!=null?Number(i.proforma.grandTotal)||0:i?.itemsSubTotal!=null?Number(i.itemsSubTotal)||0:i?.estimate?.subtotal!=null&&Number(i.estimate.subtotal)||0};let d=0,u=0,p=0,x=0,f=0,y=0;const h=[],w=[],v=[],j=[];o.forEach(i=>{const r=i.data();if(d++,(r.status==="Accepted"||r.status==="Modified")&&f++,(r.status==="Shipped"||r.status==="Out for Delivery")&&y++,r.status==="Delivered"){u++;const X=a(r);if(r.isPaid===!0)p+=X;else if(r.isPaid===!1){const z=X;x+=z;const W=te(r),U=H(W),E={id:i.id,retailerId:r.retailerId,retailer:r.retailerBusinessName||r.retailerName||"N/A",amount:z,dueDate:W,daysLeft:U,deliveredAt:_(r.deliveredAt),creditDays:Number(r.creditDays||0),paymentMode:r.paymentMode||r.paymentMethod||"Credit Cycle"};U===0?w.push(E):U===1?v.push(E):U<0?h.push(E):j.push(E)}}});const R=await Y(J(S,`businesses/${t}/products`));let C=0,b=0;R.forEach(i=>{const r=i.data();C++,r.quantity<5&&b++}),T({totalOrders:d,pendingOrders:f+y,completedOrders:u,totalRevenue:p,dueCreditTotal:x,inventoryCount:C,lowStockCount:b,yetToShip:f,outForDelivery:y});const N=(i,r)=>(i.dueDate?.getTime?.()||0)-(r.dueDate?.getTime?.()||0);h.sort(N),w.sort(N),v.sort(N),j.sort(N),O({overdue:h,today:w,tomorrow:v,upcoming:j,totals:{overdue:h.reduce((i,r)=>i+r.amount,0),today:w.reduce((i,r)=>i+r.amount,0),tomorrow:v.reduce((i,r)=>i+r.amount,0),upcoming:j.reduce((i,r)=>i+r.amount,0),allDue:h.concat(w,v,j).reduce((i,r)=>i+r.amount,0)}})}catch(o){console.error("Error loading distributor stats:",o)}})()},[]);const se=()=>{let s=[...c.overdue,...c.today,...c.tomorrow,...c.upcoming];g.bucket!=="ALL"&&(s={OVERDUE:c.overdue,TODAY:c.today,TOMORROW:c.tomorrow,UPCOMING:c.upcoming}[g.bucket]||s);const t=(g.query||"").toLowerCase();t&&(s=s.filter(a=>(a.retailer||"").toLowerCase().includes(t)||(a.id||"").toLowerCase().includes(t)));const o=g.dir==="desc"?-1:1;return s.sort((a,d)=>{if(g.sort==="amount")return(Number(a.amount)-Number(d.amount))*o;if(g.sort==="retailer")return(a.retailer||"").localeCompare(d.retailer||"")*o;const u=a.dueDate?new Date(a.dueDate).getTime():0,p=d.dueDate?new Date(d.dueDate).getTime():0;return(u-p)*o}),s},ae=s=>{O(t=>{const o=f=>f.filter(y=>y.id!==s),a=o(t.overdue),d=o(t.today),u=o(t.tomorrow),p=o(t.upcoming),x=f=>f.reduce((y,h)=>y+Number(h.amount||0),0);return{overdue:a,today:d,tomorrow:u,upcoming:p,totals:{overdue:x(a),today:x(d),tomorrow:x(u),upcoming:x(p),allDue:x(a)+x(d)+x(u)+x(p)}}})},re=async s=>{try{const t=L.currentUser?.uid;if(!t)return;const o=I(S,`businesses/${t}/orderRequests/${s.id}`),a=s.retailerId?I(S,`businesses/${s.retailerId}/sentOrders/${s.id}`):null,d={isPaid:!0,paymentStatus:"Paid",paidAt:new Date().toISOString()};await M(o,d),a&&await M(a,d),ae(s.id)}catch(t){console.error("Failed to mark paid:",t),alert("Failed to mark paid. Please try again.")}},ie=async s=>{try{const t=Number(s.creditDays||15),o=window.prompt("Set new total credit days for this order",String(t));if(o===null)return;const a=Number(o);if(!Number.isFinite(a)||a<=0){alert("Invalid number of days");return}const d=s.deliveredAt?new Date(s.deliveredAt):new Date,u=new Date(d);u.setDate(u.getDate()+a);const p=L.currentUser?.uid;if(!p)return;const x=I(S,`businesses/${p}/orderRequests/${s.id}`),f=s.retailerId?I(S,`businesses/${s.retailerId}/sentOrders/${s.id}`):null,y={creditDays:a,creditDueDate:u.toISOString()};await M(x,y),f&&await M(f,y),O(h=>{const w=N=>N.map(i=>i.id===s.id?{...i,creditDays:a,dueDate:u,daysLeft:H(u)}:i),v=w(h.overdue),j=w(h.today),R=w(h.tomorrow),C=w(h.upcoming),b=N=>N.reduce((i,r)=>i+Number(r.amount||0),0);return{overdue:v,today:j,tomorrow:R,upcoming:C,totals:{overdue:b(v),today:b(j),tomorrow:b(R),upcoming:b(C),allDue:b(v)+b(j)+b(R)+b(C)}}})}catch(t){console.error("Failed to extend credit:",t),alert("Failed to update credit days.")}},V=()=>{try{const t=window.location.hash||"#/distributor-dashboard",[o]=t.split("?"),a=new URLSearchParams;a.set("tab","track-orders"),a.set("sub","payment-due"),window.location.hash=`${o}?${a.toString()}`}catch{window.location.hash="#/distributor-dashboard?tab=track-orders&sub=payment-due"}};return e.jsxs(m.div,{variants:K,initial:"hidden",animate:"show",className:"space-y-4 text-white relative",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-sm text-white/60",children:new Date().toLocaleDateString("en-IN",{weekday:"short",day:"2-digit",month:"short"})}),e.jsxs("h2",{className:"mt-1 text-3xl md:text-4xl font-extrabold tracking-tight drop-shadow",children:["Welcome back, ",e.jsx("span",{className:"text-emerald-300",children:G.ownerName||"Distributor"})," âœ¦"]}),e.jsxs("div",{className:"mt-2 text-sm flex flex-wrap gap-2",children:[e.jsxs(D,{children:["Business: ",G.businessName||"â€”"]}),e.jsxs(D,{children:["ID: ",L.currentUser?.uid?.slice(0,8),"â€¦"]}),e.jsxs(D,{children:["Email: ",L.currentUser?.email||"â€”"]})]})]}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(m.h2,{variants:F,className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-white to-emerald-200",children:"ðŸ“¦ Distributor Business Snapshot"}),e.jsx(m.div,{initial:{scaleX:0,opacity:0},animate:{scaleX:1,opacity:1},transition:{duration:.5,delay:.05},className:"absolute -bottom-1 left-0 right-0 h-px bg-gradient-to-r from-transparent via-emerald-300/40 to-transparent"})]}),e.jsxs(m.div,{variants:K,className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(A,{label:n("dashboard.totalOrders"),value:l.totalOrders}),e.jsx(A,{label:n("dashboard.pendingOrders"),value:l.pendingOrders,tone:"yellow",note:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["â€¢ ",n("dashboard.yetToShip")]}),e.jsx("span",{className:"font-semibold text-white",children:l.yetToShip})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["â€¢ ",n("dashboard.outForDelivery")]}),e.jsx("span",{className:"font-semibold text-white",children:l.outForDelivery})]})]})}),e.jsx(A,{label:n("dashboard.completedOrders"),value:l.completedOrders,tone:"green"}),e.jsx(A,{label:`${n("dashboard.revenue")} (${n("invoices.paid")})`,value:`â‚¹${l.totalRevenue.toFixed(2)}`,tone:"blue"}),e.jsx(A,{label:n("dashboard.dueCredit"),value:`â‚¹${l.dueCreditTotal.toFixed(2)}`,tone:"purple"})]}),e.jsxs($,{className:"p-5 mt-2",children:[e.jsxs(m.div,{variants:F,className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["ðŸ§¾ ",n("credit.title")]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[e.jsxs(D,{tone:"danger",children:[n("credit.overdue"),": â‚¹",c.totals.overdue.toLocaleString()]}),e.jsxs(D,{tone:"warning",children:[n("credit.dueToday"),": â‚¹",c.totals.today.toLocaleString()]}),e.jsxs(D,{tone:"amber",children:[n("credit.dueTomorrow"),": â‚¹",c.totals.tomorrow.toLocaleString()]}),e.jsxs(D,{tone:"info",children:[n("credit.upcoming"),": â‚¹",c.totals.upcoming.toLocaleString()]}),e.jsxs(D,{tone:"purple",children:[n("credit.totalDue"),": â‚¹",c.totals.allDue.toLocaleString()]})]})]}),e.jsxs("div",{className:"sticky top-0 z-10 px-4 py-2 mb-3 text-sm bg-[#0b1220]/70 backdrop-blur supports-[backdrop-filter]:backdrop-blur-xl border-b border-white/10 flex flex-wrap items-center gap-2 rounded-t-lg",children:[e.jsxs("select",{className:"rounded-lg bg-white/10 border border-white/20 text-white px-2 py-1 focus:outline-none focus:ring-2 focus:ring-emerald-400/50",value:g.bucket,onChange:s=>P(t=>({...t,bucket:s.target.value})),"aria-label":"Filter bucket",children:[e.jsx("option",{className:"text-slate-900",value:"ALL",children:n("common.all")}),e.jsx("option",{className:"text-slate-900",value:"OVERDUE",children:n("credit.overdue")}),e.jsx("option",{className:"text-slate-900",value:"TODAY",children:n("credit.dueToday")}),e.jsx("option",{className:"text-slate-900",value:"TOMORROW",children:n("credit.dueTomorrow")}),e.jsx("option",{className:"text-slate-900",value:"UPCOMING",children:n("credit.upcoming")})]}),e.jsxs("select",{className:"rounded-lg bg-white/10 border border-white/20 text-white px-2 py-1 focus:outline-none focus:ring-2 focus:ring-emerald-400/50",value:g.sort,onChange:s=>P(t=>({...t,sort:s.target.value})),"aria-label":"Sort by",children:[e.jsx("option",{className:"text-slate-900",value:"dueDate",children:"Sort: Due date"}),e.jsx("option",{className:"text-slate-900",value:"amount",children:"Sort: Amount"}),e.jsx("option",{className:"text-slate-900",value:"retailer",children:"Sort: Retailer"})]}),e.jsxs("select",{className:"rounded-lg bg-white/10 border border-white/20 text-white px-2 py-1 focus:outline-none focus:ring-2 focus:ring-emerald-400/50",value:g.dir,onChange:s=>P(t=>({...t,dir:s.target.value})),"aria-label":"Sort direction",children:[e.jsx("option",{className:"text-slate-900",value:"asc",children:"Asc"}),e.jsx("option",{className:"text-slate-900",value:"desc",children:"Desc"})]}),e.jsx("input",{type:"text",className:"rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 px-2 py-1 flex-1 min-w-[160px] focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"Search retailer or order ID",value:g.query,onChange:s=>P(t=>({...t,query:s.target.value}))})]}),e.jsx("div",{className:"w-full overflow-x-hidden border border-white/10 rounded-lg",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{className:"bg-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-white/80",children:"Retailer"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-semibold text-white/80",children:"Amount"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-white/80",children:"Due Date"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-white/80",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-semibold text-white/80",children:"Actions"})]})}),e.jsx("tbody",{children:e.jsx(le,{initial:!1,children:(()=>{const s=se().slice(0,12);return s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-3 py-6 text-center text-white/60",children:"No credit dues found."})}):s.map(t=>e.jsxs(oe.Fragment,{children:[e.jsxs(m.tr,{layout:!0,initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},className:"border-t border-white/10 hover:bg-white/5",children:[e.jsxs("td",{className:"px-3 py-2 text-sm font-medium text-white",children:[e.jsx("button",{onClick:()=>ee(t.id),className:"text-emerald-300 hover:underline mr-2",children:B[t.id]?"Hide":"Show"}),t.retailer,e.jsxs("div",{className:"text-[11px] text-white/60",children:["#",t.id.slice(0,8)]})]}),e.jsxs("td",{className:"px-3 py-2 text-sm text-right",children:["â‚¹",Number(t.amount||0).toLocaleString()]}),e.jsx("td",{className:"px-3 py-2 text-sm",children:t.dueDate?new Date(t.dueDate).toLocaleDateString("en-GB"):"â€”"}),e.jsxs("td",{className:"px-3 py-2 text-sm",children:[t.daysLeft<0&&e.jsxs("span",{className:"px-2 py-1 rounded-full bg-red-400/15 text-red-300 text-xs font-semibold",children:[Math.abs(t.daysLeft)," day(s) overdue"]}),t.daysLeft===0&&e.jsx("span",{className:"px-2 py-1 rounded-full bg-orange-400/15 text-orange-300 text-xs font-semibold",children:"Due today"}),t.daysLeft===1&&e.jsx("span",{className:"px-2 py-1 rounded-full bg-amber-400/15 text-amber-300 text-xs font-semibold",children:"Due tomorrow"}),t.daysLeft>1&&e.jsxs("span",{className:"px-2 py-1 rounded-full bg-sky-400/15 text-sky-300 text-xs font-semibold",children:[t.daysLeft," days left"]})]}),e.jsx("td",{className:"px-3 py-2 text-sm text-right",children:e.jsxs("div",{className:"inline-flex gap-2",children:[e.jsx("button",{onClick:()=>re(t),className:"px-3 py-1.5 rounded-full text-xs font-medium text-slate-900 bg-gradient-to-r from-emerald-400 via-teal-300 to-cyan-400 hover:shadow-[0_8px_24px_rgba(16,185,129,0.35)] focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300/60",children:"Mark Paid"}),e.jsx("button",{onClick:()=>ie(t),className:"px-3 py-1.5 rounded-full text-xs font-medium text-slate-900 bg-gradient-to-r from-sky-400 to-indigo-500 hover:shadow-[0_8px_24px_rgba(56,189,248,0.35)] focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-300/60",children:"Extend"})]})})]}),B[t.id]&&e.jsx(m.tr,{layout:!0,initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"border-t border-white/10 bg-white/5",children:e.jsx("td",{colSpan:5,className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex flex-wrap gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white/70 text-xs",children:"Delivered"}),e.jsx("div",{className:"font-medium",children:t.deliveredAt?new Date(t.deliveredAt).toLocaleDateString("en-GB"):"â€”"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white/70 text-xs",children:"Credit Days"}),e.jsx("div",{className:"font-medium",children:t.creditDays||"â€”"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white/70 text-xs",children:"Payment Mode"}),e.jsx("div",{className:"font-medium",children:t.paymentMode})]}),e.jsx("div",{children:e.jsx("button",{onClick:V,className:"text-emerald-300 hover:underline",children:"Open in Track Orders"})})]})})})]},t.id))})()})})]})}),e.jsx("div",{className:"mt-3 text-right text-sm",children:e.jsx("button",{onClick:V,className:"text-emerald-300 hover:underline hover:brightness-110 transition",children:"Go to Track Orders â†’ Payment Due"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[e.jsxs($,{className:"p-4",children:[e.jsx(q,{title:"Order Trends",icon:e.jsx("span",{children:"ðŸ“Š"})}),e.jsxs(m.div,{initial:{opacity:0},whileInView:{opacity:1},viewport:{once:!0},className:"h-40 rounded bg-white/5 flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(110deg,rgba(255,255,255,0.06),rgba(255,255,255,0.14),rgba(255,255,255,0.06))] bg-[length:200%_100%] animate-[shimmer_1.8s_infinite]"}),e.jsx("style",{children:"@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}"}),e.jsx("span",{className:"text-white/60 text-sm relative z-10",children:"Loading chartâ€¦"})]})]}),e.jsxs($,{className:"p-4",children:[e.jsx(q,{title:"Revenue Insights",icon:e.jsx("span",{children:"ðŸ’¸"})}),e.jsxs(m.div,{initial:{opacity:0},whileInView:{opacity:1},viewport:{once:!0},className:"h-40 rounded bg-white/5 flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(110deg,rgba(255,255,255,0.06),rgba(255,255,255,0.14),rgba(255,255,255,0.06))] bg-[length:200%_100%] animate-[shimmer_1.8s_infinite]"}),e.jsx("style",{children:"@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}"}),e.jsx("span",{className:"text-white/60 text-sm relative z-10",children:"Loading chartâ€¦"})]})]})]}),e.jsxs($,{className:"p-4 mt-6 hover:shadow-emerald-400/10",children:[e.jsx(q,{title:"Todayâ€™s Collection Schedule",icon:e.jsx("span",{children:"ðŸ“…"})}),e.jsx("p",{className:"text-sm text-white/70",children:"Data will list retailers with dues today (future enhancement)"})]})]})};export{ye as default};
