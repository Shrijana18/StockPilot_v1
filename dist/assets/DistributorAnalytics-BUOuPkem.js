import{d as _,j as e}from"./index-DRC3F7i0.js";import{r as b}from"./router-BPBaD_i0.js";import{p as te,c as Z,g as J,d as Ne,e as De}from"./firebase-DWi1MSv1.js";import{d as u}from"./dayjs.min-BE7Gq_ss.js";import{L as fe,C as se,a as re,b as ae,P as ue,c as he,B as ce,p as de,d as ie,e as le,A as xe,D as je,f as ve,g as Pe}from"./index-o1kP7bB5.js";import{m as X}from"./proxy-BgUy8BPw.js";import{u as Se}from"./useTranslation-C_4YkXWs.js";import{A as Re}from"./index-DSciU07p.js";import"./vendor-Ckhrjn13.js";import"./index.esm-Bux_mLJ0.js";se.register(re,ae,ue,he,ce,de,ie,le,xe);const Me=({distributorId:j,dateRange:w})=>{const[I,C]=b.useState([]),[M,q]=b.useState([]),[N,B]=b.useState([]),[U,L]=b.useState(!0);b.useEffect(()=>{if(!j)return;L(!0);const h=[],P=te(Z(_,`businesses/${j}/orderRequests`),c=>{const f=c.docs.map(d=>({id:d.id,...d.data()}));C(f)});h.push(P);const o=te(Z(_,`businesses/${j}/connectedRetailers`),c=>{const f=c.docs.map(d=>({id:d.id,...d.data(),type:"connected"}));J(Z(_,`businesses/${j}/provisionalRetailers`)).then(d=>{const O=d.docs.map(i=>({id:i.id,...i.data(),type:"provisional"}));q([...f,...O])}).catch(()=>q(f))});return h.push(o),J(Z(_,`businesses/${j}/products`)).then(c=>{const f=c.docs.map(d=>({id:d.id,...d.data()}));B(f)}).finally(()=>L(!1)),()=>h.forEach(c=>c())},[j]);const S=h=>h?.chargesSnapshot?.breakdown?.grandTotal?Number(h.chargesSnapshot.breakdown.grandTotal):h?.proforma?.grandTotal?Number(h.proforma.grandTotal):h?.items&&Array.isArray(h.items)?h.items.reduce((P,o)=>{const c=Number(o.sellingPrice||o.price||o.unitPrice||0),f=Number(o.quantity||o.qty||0);return P+c*f},0):0,k=b.useMemo(()=>{if(!w?.start||!w?.end)return I;const h=u(w.start),P=u(w.end);return I.filter(o=>{const c=u(o.timestamp?.toDate?.()||o.timestamp||o.createdAt?.toDate?.()||o.createdAt);return c.isAfter(h.subtract(1,"day"))&&c.isBefore(P.add(1,"day"))})},[I,w]),p=b.useMemo(()=>{const h=k.filter(l=>l.status==="Delivered"||l.statusCode==="DELIVERED"),P=h.reduce((l,m)=>l+S(m),0),o=h.reduce((l,m)=>{const g=S(m);if(m.items&&Array.isArray(m.items)){const v=m.items.reduce((V,F)=>{const z=Number(F.sellingPrice||F.price||F.unitPrice||0),W=Number(F.costPrice||F.distributorPrice||0),K=Number(F.quantity||F.qty||0);return V+(z-W)*K},0);return l+v}return l+g*.15},0),c=new Set,f=u().subtract(30,"day");k.forEach(l=>{if(u(l.timestamp?.toDate?.()||l.timestamp||l.createdAt?.toDate?.()||l.createdAt).isAfter(f)){const g=l.retailerId||l.provisionalRetailerId;g&&c.add(g)}});const d=k.filter(l=>u(l.timestamp?.toDate?.()||l.timestamp||l.createdAt?.toDate?.()||l.createdAt).isAfter(u().subtract(7,"day"))),O=k.filter(l=>{const m=u(l.timestamp?.toDate?.()||l.timestamp||l.createdAt?.toDate?.()||l.createdAt);return m.isAfter(u().subtract(14,"day"))&&m.isBefore(u().subtract(7,"day"))}),i=d.filter(l=>l.status==="Delivered"||l.statusCode==="DELIVERED").reduce((l,m)=>l+S(m),0),x=O.filter(l=>l.status==="Delivered"||l.statusCode==="DELIVERED").reduce((l,m)=>l+S(m),0),R=x>0?(i-x)/x*100:0,Y={};h.forEach(l=>{l.items&&Array.isArray(l.items)&&l.items.forEach(m=>{const g=m.distributorProductId||m.productId;if(!g)return;const v=String(m.productName||m.name||"Unknown");Y[g]||(Y[g]={name:v,revenue:0,qty:0});const V=Number(m.quantity||m.qty||0),F=Number(m.sellingPrice||m.price||m.unitPrice||0);Y[g].revenue+=F*V,Y[g].qty+=V})});const s=Object.values(Y).sort((l,m)=>m.revenue-l.revenue).slice(0,5),t={};h.forEach(l=>{const m=l.retailerId||l.provisionalRetailerId;if(!m)return;const g=String(l.retailerBusinessName||l.retailerName||"Unknown");t[m]||(t[m]={name:g,revenue:0,orders:0}),t[m].revenue+=S(l),t[m].orders+=1});const r=Object.values(t).sort((l,m)=>m.revenue-l.revenue).slice(0,5),a={},n=Array.from({length:30},(l,m)=>u().subtract(29-m,"day").format("YYYY-MM-DD"));return h.forEach(l=>{const m=u(l.timestamp?.toDate?.()||l.timestamp||l.createdAt?.toDate?.()||l.createdAt).format("YYYY-MM-DD");n.includes(m)&&(a[m]=(a[m]||0)+S(l))}),{totalOrders:h.length,totalRevenue:P,totalProfit:o,activeRetailers:c.size,totalProducts:N.length,revenueGrowth:R,topProducts:s,topRetailers:r,dailyRevenue:n.map(l=>a[l]||0),dailyLabels:n.map(l=>u(l).format("MMM DD"))}},[k,N]),D=h=>`â‚¹${Number(h||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,T=h=>{const P={emerald:{border:"border-emerald-500/30",bg:"bg-gradient-to-br from-emerald-500/20 to-emerald-600/20",glow:"bg-emerald-500/10",text:"text-emerald-300",badge:"bg-emerald-500/20 text-emerald-300"},purple:{border:"border-purple-500/30",bg:"bg-gradient-to-br from-purple-500/20 to-purple-600/20",glow:"bg-purple-500/10",text:"text-purple-300",badge:"bg-purple-500/20 text-purple-300"},blue:{border:"border-blue-500/30",bg:"bg-gradient-to-br from-blue-500/20 to-blue-600/20",glow:"bg-blue-500/10",text:"text-blue-300",badge:"bg-blue-500/20 text-blue-300"},amber:{border:"border-amber-500/30",bg:"bg-gradient-to-br from-amber-500/20 to-amber-600/20",glow:"bg-amber-500/10",text:"text-amber-300",badge:"bg-amber-500/20 text-amber-300"}};return P[h]||P.emerald};if(U)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"text-white/60",children:"Loading analytics..."})});const A={labels:p.dailyLabels,datasets:[{label:"Revenue (â‚¹)",data:p.dailyRevenue,borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.4,fill:!0}]};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative rounded-2xl border border-white/10 bg-gradient-to-br from-emerald-500/10 via-blue-500/10 to-purple-500/10 backdrop-blur-xl p-8 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent animate-shimmer"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-3",children:"Your Business at a Glance"}),e.jsxs("p",{className:"text-white/80 text-lg mb-4",children:[u(w?.start).format("MMM DD")," - ",u(w?.end).format("MMM DD, YYYY")]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Revenue Growth"}),e.jsxs("p",{className:`text-2xl font-bold ${p.revenueGrowth>=0?"text-emerald-400":"text-red-400"}`,children:[p.revenueGrowth>=0?"â†‘":"â†“"," ",Math.abs(p.revenueGrowth).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Profit Margin"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-400",children:[p.totalRevenue>0?(p.totalProfit/p.totalRevenue*100).toFixed(1):0,"%"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white/10 rounded-xl p-4 backdrop-blur-sm border border-white/20",children:[e.jsx("p",{className:"text-white/60 text-xs mb-1",children:"Orders"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:p.totalOrders})]}),e.jsxs("div",{className:"bg-white/10 rounded-xl p-4 backdrop-blur-sm border border-white/20",children:[e.jsx("p",{className:"text-white/60 text-xs mb-1",children:"Active Retailers"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:p.activeRetailers})]})]})]})})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"Total Revenue",value:D(p.totalRevenue),subtitle:"All delivered orders",color:"emerald",icon:"ðŸ’°"},{label:"Total Profit",value:D(p.totalProfit),subtitle:`${p.totalRevenue>0?(p.totalProfit/p.totalRevenue*100).toFixed(1):0}% margin`,color:"purple",icon:"ðŸ“ˆ"},{label:"Active Retailers",value:p.activeRetailers,subtitle:"Last 30 days",color:"blue",icon:"ðŸª"},{label:"Total Products",value:p.totalProducts,subtitle:"In inventory",color:"amber",icon:"ðŸ“¦"}].map((h,P)=>{const o=T(h.color);return e.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:P*.1},whileHover:{scale:1.05,y:-4},className:`relative rounded-xl border ${o.border} ${o.bg} backdrop-blur-xl p-6 overflow-hidden group`,children:[e.jsx("div",{className:`absolute top-0 right-0 w-24 h-24 ${o.glow} rounded-full blur-2xl -translate-y-1/2 translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity`}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-2xl",children:h.icon}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${o.badge}`,children:h.label.split(" ")[0]})]}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-white mb-1",children:h.value}),e.jsx("p",{className:"text-xs text-white/60",children:h.subtitle})]})]},h.label)})}),e.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Revenue Trend (Last 30 Days)"}),e.jsx(fe,{data:A,options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1},tooltip:{callbacks:{label:h=>`â‚¹${h.parsed.y.toLocaleString("en-IN")}`}}},scales:{y:{beginAtZero:!0,ticks:{callback:h=>`â‚¹${(h/1e3).toFixed(0)}k`,color:"rgba(255,255,255,0.7)"},grid:{color:"rgba(255,255,255,0.1)"}},x:{ticks:{color:"rgba(255,255,255,0.7)"},grid:{color:"rgba(255,255,255,0.1)"}}}}})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(X.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ†"})," Top 5 Products"]}),e.jsx("div",{className:"space-y-3",children:p.topProducts.length===0?e.jsx("p",{className:"text-white/60",children:"No product data available"}):p.topProducts.map((h,P)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center text-emerald-400 font-bold text-sm",children:P+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:h.name}),e.jsxs("p",{className:"text-xs text-white/60",children:[h.qty," units sold"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-bold text-emerald-400",children:D(h.revenue)})})]},P))})]}),e.jsxs(X.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.4},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"â­"})," Top 5 Retailers"]}),e.jsx("div",{className:"space-y-3",children:p.topRetailers.length===0?e.jsx("p",{className:"text-white/60",children:"No retailer data available"}):p.topRetailers.map((h,P)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400 font-bold text-sm",children:P+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:h.name}),e.jsxs("p",{className:"text-xs text-white/60",children:[h.orders," orders"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-bold text-blue-400",children:D(h.revenue)})})]},P))})]})]}),e.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"rounded-xl border border-white/10 bg-gradient-to-br from-purple-500/10 to-pink-500/10 backdrop-blur-xl p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ’¡"})," Quick Insights"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Average Order Value"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:D(p.totalOrders>0?p.totalRevenue/p.totalOrders:0)})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Orders per Retailer"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:p.activeRetailers>0?(p.totalOrders/p.activeRetailers).toFixed(1):0})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Daily Average Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:D(p.dailyRevenue.filter(h=>h>0).length>0?p.dailyRevenue.reduce((h,P)=>h+P,0)/p.dailyRevenue.filter(h=>h>0).length:0)})]})]})]})]})};se.register(re,ae,ue,he,ce,de,ie,le,xe);const ke=({distributorId:j,dateRange:w,filters:I,onDateRangeChange:C,onFiltersChange:M})=>{const[q,N]=b.useState([]),[B,U]=b.useState([]),[L,S]=b.useState(!0),[k,p]=b.useState("overview"),[D,T]=b.useState(null),[A,h]=b.useState(w||{start:u().subtract(30,"day").format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")}),[P,o]=b.useState(I||{brand:"",category:"",minProfit:0});b.useEffect(()=>{w&&h(w)},[w]),b.useEffect(()=>{I&&o(I)},[I]),b.useEffect(()=>{if(!j)return;S(!0);const s=[],t=te(Z(_,`businesses/${j}/products`),a=>{const n=a.docs.map(l=>({id:l.id,...l.data()}));N(n)});s.push(t);const r=te(Z(_,`businesses/${j}/orderRequests`),a=>{const n=a.docs.map(l=>({id:l.id,...l.data()}));U(n),S(!1)});return s.push(r),()=>s.forEach(a=>a())},[j]);const c=b.useMemo(()=>{const s=A||w;if(!s||!s.start||!s.end)return B;const t=u(s.start).startOf("day"),r=u(s.end).endOf("day");return B.filter(a=>{const n=u(a.timestamp?.toDate?.()||a.timestamp||a.createdAt?.toDate?.()||a.createdAt);return(n.isAfter(t.subtract(1,"second"))||n.isSame(t))&&(n.isBefore(r.add(1,"second"))||n.isSame(r))})},[B,A,w]),f=b.useMemo(()=>{const s={},t={};q.forEach(g=>{const v=g.id,V=g.createdAt?.toDate?.()||g.createdAt||g.timestamp?.toDate?.()||g.timestamp,F=V?u().diff(u(V),"day"):0,z=Number(g.quantity||0),W=Number(g.costPrice||g.price||g.distributorPrice||0),K=Number(g.sellingPrice||g.mrp||0),E=z*W,y=z*K,G=y-E;s[v]={id:v,name:g.name||g.productName||"Unknown",sku:g.sku||"N/A",brand:g.brand||"N/A",category:g.category||"N/A",totalSold:0,totalRevenue:0,totalCost:0,totalProfit:0,currentStock:z,costPrice:W,sellingPrice:K,totalInventoryCost:E,totalInventoryValue:y,potentialProfit:G,daysInInventory:F,ordersCount:0,geographicData:{},trend:[],lastSoldDate:null,avgSellingPrice:0,turnoverRate:0},t[v]=g}),console.log("[ProductAnalytics] Total products in inventory:",q.length),console.log("[ProductAnalytics] Total orders:",c.length),console.log("[ProductAnalytics] Orders with items:",c.filter(g=>g.items&&Array.isArray(g.items)).length);const r={},a={};q.forEach(g=>{const v=(g.name||g.productName||"").toLowerCase().trim(),V=(g.brand||"").toLowerCase().trim(),F=(g.sku||"").toLowerCase().trim();v&&V&&(r[`${v}::${V}`]=g),F&&(a[F]=g)});let n=0,l=0,m=0;return c.forEach(g=>{if(!g.items||!Array.isArray(g.items))return;const v=String(g.status||"").toUpperCase(),V=String(g.statusCode||"").toUpperCase();if(!(v==="DELIVERED"||V==="DELIVERED"||v==="INVOICED"||V==="INVOICED"||String(g.status||"").toLowerCase()==="delivered"||String(g.statusCode||"").toLowerCase()==="delivered"))return;n++;const z=g.retailerState||g.state||"Unknown",W=g.retailerCity||g.city||"Unknown",K=u(g.timestamp?.toDate?.()||g.timestamp||g.createdAt?.toDate?.()||g.createdAt);g.items.forEach(E=>{let y=E.distributorProductId||E.productId||E.inventoryId||E.id,G=null;if(y&&(G=t[y]),!G){const $=(E.productName||E.name||"").toLowerCase().trim(),pe=(E.brand||"").toLowerCase().trim(),me=(E.sku||"").toLowerCase().trim();if(me&&a[me])G=a[me],y=G.id,console.log("[ProductAnalytics] Matched product by SKU:",me,"->",y);else if($&&pe){const oe=`${$}::${pe}`;r[oe]&&(G=r[oe],y=G.id,console.log("[ProductAnalytics] Matched product by name+brand:",$,pe,"->",y))}!G&&$&&(G=q.find(oe=>{const ge=(oe.name||oe.productName||"").toLowerCase().trim();return ge&&$&&(ge.includes($)||$.includes(ge))}),G&&(y=G.id,console.log("[ProductAnalytics] Matched product by fuzzy name:",$,"->",y))),G||console.log("[ProductAnalytics] Could not match product:",{itemName:E.productName||E.name,itemBrand:E.brand,itemSku:E.sku,productId:E.distributorProductId||E.productId})}if(y||(y=`temp_${E.productName||E.name||"unknown"}_${E.brand||"unknown"}`),!s[y]){const $=G||t[y]||{};s[y]={id:y,name:E.productName||E.name||$?.name||$?.productName||"Unknown",sku:E.sku||$?.sku||"N/A",brand:E.brand||$?.brand||"N/A",category:E.category||$?.category||"N/A",totalSold:0,totalRevenue:0,totalCost:0,totalProfit:0,currentStock:$?Number($.quantity||0):0,costPrice:$?Number($.costPrice||$.price||$.distributorPrice||0):0,sellingPrice:$?Number($.sellingPrice||$.mrp||0):0,totalInventoryCost:$?Number($.quantity||0)*Number($.costPrice||$.price||$.distributorPrice||0):0,totalInventoryValue:$?Number($.quantity||0)*Number($.sellingPrice||$.mrp||0):0,potentialProfit:0,daysInInventory:$&&$.createdAt?u().diff(u($.createdAt?.toDate?.()||$.createdAt),"day"):0,ordersCount:0,geographicData:{},trend:[],lastSoldDate:null,avgSellingPrice:0,turnoverRate:0},$&&$.quantity&&(s[y].potentialProfit=s[y].totalInventoryValue-s[y].totalInventoryCost)}const Q=G||t[y]||s[y]||{},H=Number(E.quantity||E.qty||0),ee=Number(E.sellingPrice||E.price||E.unitPrice||0),ye=Number(Q.costPrice||Q.price||Q.distributorPrice||s[y]?.costPrice||0),ne=ee*H,we=ye*H,be=ne-we;l++,(G||t[y])&&m++,console.log("[ProductAnalytics] Processing sale:",{productId:y,productName:s[y].name,qty:H,sellingPrice:ee,costPrice:ye,revenue:ne,profit:be,retailerState:z,retailerCity:W,matched:!!(G||t[y])}),s[y].totalSold+=H,s[y].totalRevenue+=ne,s[y].totalCost+=we,s[y].totalProfit+=be,s[y].ordersCount+=1,(!s[y].lastSoldDate||K.isAfter(s[y].lastSoldDate))&&(s[y].lastSoldDate=K),s[y].geographicData[z]||(s[y].geographicData[z]={}),s[y].geographicData[z][W]||(s[y].geographicData[z][W]={qty:0,revenue:0}),s[y].geographicData[z][W].qty+=H,s[y].geographicData[z][W].revenue+=ne,u().diff(K,"day")<=30&&s[y].trend.push({date:K.format("YYYY-MM-DD"),sold:H,revenue:ne,profit:be})})}),console.log("[ProductAnalytics] Summary:",{deliveredOrders:n,processedItems:l,matchedItems:m,productsWithSales:Object.values(s).filter(g=>g.totalSold>0).length,totalProducts:Object.keys(s).length}),Object.keys(s).forEach(g=>{const v=s[g];v.avgProfitMargin=v.totalRevenue>0?v.totalProfit/v.totalRevenue*100:0,v.avgSellingPrice=v.totalSold>0?v.totalRevenue/v.totalSold:v.sellingPrice||0,v.turnoverRate=v.currentStock>0&&v.totalSold>0?v.totalSold/(v.currentStock+v.totalSold)*100:v.totalSold>0?100:0,v.daysSinceLastSale=v.lastSoldDate?u().diff(v.lastSoldDate,"day"):null,v.daysInInventory>90?v.inventoryAgeStatus="old":v.daysInInventory>30?v.inventoryAgeStatus="moderate":v.inventoryAgeStatus="new",v.roi=v.totalInventoryCost>0?(v.totalProfit+v.potentialProfit)/v.totalInventoryCost*100:0;const V={};v.trend.forEach(F=>{V[F.date]||(V[F.date]={sold:0,revenue:0,profit:0}),V[F.date].sold+=F.sold,V[F.date].revenue+=F.revenue,V[F.date].profit+=F.profit}),v.trend=Object.entries(V).map(([F,z])=>({date:F,...z})).sort((F,z)=>F.date.localeCompare(z.date))}),Object.values(s)},[q,c]),d=b.useMemo(()=>{let s=f;const t=P||I;return t?.brand&&t.brand.trim()&&(s=s.filter(r=>r.brand.toLowerCase().includes(t.brand.toLowerCase()))),t?.category&&t.category.trim()&&(s=s.filter(r=>r.category.toLowerCase().includes(t.category.trim().toLowerCase()))),t?.minProfit&&t.minProfit>0&&(s=s.filter(r=>r.totalProfit>=t.minProfit)),s},[f,P,I]),O=b.useMemo(()=>{if(!D)return null;const s=d.find(r=>r.id===D);if(!s||!s.geographicData)return null;const t={};return Object.keys(s.geographicData).forEach(r=>{const a=s.geographicData[r];t[r]={totalQty:0,totalRevenue:0,cities:Object.keys(a).map(n=>({name:n,qty:a[n].qty,revenue:a[n].revenue}))},Object.values(a).forEach(n=>{t[r].totalQty+=n.qty,t[r].totalRevenue+=n.revenue})}),t},[D,d]),i=s=>`â‚¹${Number(s||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,x=s=>{const t={emerald:{border:"border-emerald-500/30",bg:"bg-gradient-to-br from-emerald-500/20 to-emerald-600/20"},purple:{border:"border-purple-500/30",bg:"bg-gradient-to-br from-purple-500/20 to-purple-600/20"},blue:{border:"border-blue-500/30",bg:"bg-gradient-to-br from-blue-500/20 to-blue-600/20"},amber:{border:"border-amber-500/30",bg:"bg-gradient-to-br from-amber-500/20 to-amber-600/20"}};return t[s]||t.emerald},R=b.useMemo(()=>{const s={};return d.forEach(t=>{const r=t.brand||"Unknown";s[r]||(s[r]={revenue:0,profit:0,products:0}),s[r].revenue+=t.totalRevenue,s[r].profit+=t.totalProfit,s[r].products+=1}),Object.entries(s).map(([t,r])=>({brand:t,...r})).sort((t,r)=>r.revenue-t.revenue)},[d]),Y=b.useMemo(()=>{const s={};return d.forEach(t=>{const r=t.category||"Unknown";s[r]||(s[r]={revenue:0,profit:0,products:0}),s[r].revenue+=t.totalRevenue,s[r].profit+=t.totalProfit,s[r].products+=1}),Object.entries(s).map(([t,r])=>({category:t,...r})).sort((t,r)=>r.revenue-t.revenue)},[d]);return L?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"text-white/60",children:"Loading product analytics..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-white to-emerald-200",children:"Product Analytics"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Deep insights into product performance, trends, geographic distribution, and profitability"})]})}),e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-1",children:"Date Range Start"}),e.jsx("input",{type:"date",value:A.start,onChange:s=>{const t={...A,start:s.target.value};h(t),C&&C(t)},className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-1",children:"Date Range End"}),e.jsx("input",{type:"date",value:A.end,onChange:s=>{const t={...A,end:s.target.value};h(t),C&&C(t)},className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-1",children:"Filter by Brand"}),e.jsx("input",{type:"text",placeholder:"Enter brand name",value:P.brand,onChange:s=>{const t={...P,brand:s.target.value};o(t),M&&M(t)},className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-emerald-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-1",children:"Filter by Category"}),e.jsx("input",{type:"text",placeholder:"Enter category",value:P.category,onChange:s=>{const t={...P,category:s.target.value};o(t),M&&M(t)},className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-emerald-500/50"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{const s={brand:"",category:"",minProfit:0};o(s),M&&M(s)},className:"w-full px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white text-sm font-medium transition border border-white/20",children:"Clear Filters"})})]})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["overview","geographic","trends","brands","categories"].map(s=>e.jsx("button",{onClick:()=>p(s),className:`px-4 py-2 rounded-lg text-sm font-medium transition ${k===s?"bg-emerald-500 text-white shadow-lg shadow-emerald-500/30":"bg-white/10 text-white/80 hover:bg-white/20"}`,children:s.charAt(0).toUpperCase()+s.slice(1)},s))}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"Total Products",value:q.length,subtitle:"In inventory",color:"emerald",icon:"ðŸ“¦"},{label:"Products Sold",value:d.filter(s=>s.totalSold>0).length,subtitle:"With sales",color:"blue",icon:"âœ¨"},{label:"Total Revenue",value:i(d.reduce((s,t)=>s+t.totalRevenue,0)),subtitle:"From sales",color:"purple",icon:"ðŸ’°"},{label:"Inventory Value",value:i(d.reduce((s,t)=>s+t.totalInventoryValue,0)),subtitle:"At selling price",color:"amber",icon:"ðŸ“Š"}].map((s,t)=>{const r=x(s.color);return e.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1},className:`rounded-xl border ${r.border} ${r.bg} p-4`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-xl",children:s.icon})}),e.jsx("p",{className:"text-xs text-white/60 mb-1",children:s.label}),e.jsx("p",{className:"text-xl font-bold text-white",children:s.value}),s.subtitle&&e.jsx("p",{className:"text-xs text-white/50 mt-1",children:s.subtitle})]},s.label)})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"Total Inventory Cost",value:i(d.reduce((s,t)=>s+t.totalInventoryCost,0)),subtitle:"Cost of current stock",color:"blue",icon:"ðŸ’µ"},{label:"Total Profit",value:i(d.reduce((s,t)=>s+t.totalProfit,0)),subtitle:"From sales",color:"purple",icon:"ðŸ“ˆ"},{label:"Potential Profit",value:i(d.reduce((s,t)=>s+t.potentialProfit,0)),subtitle:"If all stock sold",color:"emerald",icon:"ðŸŽ¯"},{label:"Total Units Sold",value:d.reduce((s,t)=>s+t.totalSold,0).toLocaleString("en-IN"),subtitle:"All time",color:"amber",icon:"ðŸ“¦"}].map((s,t)=>{const r=x(s.color);return e.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:(t+4)*.1},className:`rounded-xl border ${r.border} ${r.bg} p-4`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-xl",children:s.icon})}),e.jsx("p",{className:"text-xs text-white/60 mb-1",children:s.label}),e.jsx("p",{className:"text-xl font-bold text-white",children:s.value}),s.subtitle&&e.jsx("p",{className:"text-xs text-white/50 mt-1",children:s.subtitle})]},s.label)})}),k==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"All Products in Inventory"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:d.length===0?e.jsx("p",{className:"text-white/60 text-center py-8",children:"No products found"}):d.sort((s,t)=>(t.totalRevenue||0)-(s.totalRevenue||0)).map((s,t)=>e.jsxs("div",{onClick:()=>T(s.id),className:"flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${s.totalSold>0?"bg-emerald-500/20 text-emerald-400":"bg-gray-500/20 text-gray-400"}`,children:t+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-white truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-white/60",children:[s.brand," â€¢ ",s.category]}),e.jsxs("p",{className:"text-xs text-white/50 mt-1",children:["Stock: ",s.currentStock," | Sold: ",s.totalSold," | Days: ",s.daysInInventory]})]})]}),e.jsx("div",{className:"text-right ml-4",children:s.totalRevenue>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-bold text-emerald-400",children:i(s.totalRevenue)}),e.jsxs("p",{className:"text-xs text-white/60",children:[s.totalSold," sold"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-bold text-blue-400",children:i(s.totalInventoryCost)}),e.jsx("p",{className:"text-xs text-white/60",children:"Inventory cost"})]})})]},s.id))})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Performance Summary"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg border border-white/10",children:[e.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Total Inventory Cost"}),e.jsx("p",{className:"text-3xl font-bold text-white",children:i(d.reduce((s,t)=>s+t.totalInventoryCost,0))}),e.jsx("p",{className:"text-xs text-white/50 mt-1",children:"Cost of all products in stock"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg border border-white/10",children:[e.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Total Inventory Value"}),e.jsx("p",{className:"text-3xl font-bold text-emerald-400",children:i(d.reduce((s,t)=>s+t.totalInventoryValue,0))}),e.jsx("p",{className:"text-xs text-white/50 mt-1",children:"At selling price"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg border border-white/10",children:[e.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Total Revenue from Sales"}),e.jsx("p",{className:"text-3xl font-bold text-purple-400",children:i(d.reduce((s,t)=>s+t.totalRevenue,0))}),e.jsx("p",{className:"text-xs text-white/50 mt-1",children:"From delivered orders"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg border border-white/10",children:[e.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Total Units Sold"}),e.jsx("p",{className:"text-3xl font-bold text-white",children:d.reduce((s,t)=>s+t.totalSold,0).toLocaleString("en-IN")}),e.jsx("p",{className:"text-xs text-white/50 mt-1",children:"All time"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg border border-white/10",children:[e.jsx("p",{className:"text-sm text-white/60 mb-2",children:"Average Days in Inventory"}),e.jsx("p",{className:"text-3xl font-bold text-white",children:d.length>0?Math.round(d.reduce((s,t)=>s+t.daysInInventory,0)/d.length):0}),e.jsx("p",{className:"text-xs text-white/50 mt-1",children:"Across all products"})]})]})]})]}),k==="geographic"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-4",children:[e.jsx("label",{className:"block text-sm text-white/80 mb-2",children:"Select Product to View Geographic Distribution"}),e.jsxs("select",{value:D||"",onChange:s=>T(s.target.value||null),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500/50",children:[e.jsx("option",{value:"",children:"-- Select a Product --"}),d.sort((s,t)=>t.totalRevenue-s.totalRevenue).map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.brand,")"]},s.id))]})]}),D&&O?Object.keys(O).length>0?e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4",children:["Geographic Distribution: ",d.find(s=>s.id===D)?.name]}),e.jsx("div",{className:"mb-4 p-3 bg-emerald-500/10 rounded-lg border border-emerald-500/20",children:e.jsxs("p",{className:"text-sm text-white/80",children:[e.jsx("span",{className:"font-semibold text-emerald-400",children:"Top Selling Areas:"})," This product has been sold in ",Object.keys(O).length," state(s)"]})}),e.jsx("div",{className:"space-y-4",children:Object.entries(O).sort((s,t)=>t[1].totalRevenue-s[1].totalRevenue).map(([s,t])=>e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-semibold text-white text-lg flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“"})," ",s]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-emerald-400 font-bold",children:i(t.totalRevenue)}),e.jsxs("p",{className:"text-xs text-white/60",children:[t.totalQty," units sold"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-xs text-white/60 mb-2",children:["Cities in ",s,":"]}),t.cities.length>0?t.cities.sort((r,a)=>a.revenue-r.revenue).map(r=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/5 rounded border border-white/10 hover:bg-white/10 transition",children:[e.jsx("span",{className:"text-white/80 font-medium",children:r.name}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-white/60 text-sm",children:[r.qty," units"]}),e.jsx("span",{className:"text-emerald-400 font-semibold",children:i(r.revenue)})]})]},r.name)):e.jsx("p",{className:"text-white/60 text-sm",children:"No city data available"})]})]},s))})]}):e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:e.jsx("p",{className:"text-white/60 text-center py-8",children:"No geographic data available for this product. This product hasn't been sold yet or location data is missing."})}):D?e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:e.jsx("p",{className:"text-white/60 text-center py-8",children:"Loading geographic data..."})}):null]}),k==="trends"&&e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:d.sort((s,t)=>t.totalRevenue-s.totalRevenue).slice(0,4).map(s=>{const t={labels:s.trend.map(r=>u(r.date).format("MMM DD")),datasets:[{label:"Units Sold",data:s.trend.map(r=>r.sold),borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.4}]};return e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:s.name}),e.jsx(fe,{data:t,options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{color:"rgba(255,255,255,0.7)"},grid:{color:"rgba(255,255,255,0.1)"}},x:{ticks:{color:"rgba(255,255,255,0.7)"},grid:{color:"rgba(255,255,255,0.1)"}}}}})]},s.id)})}),k==="brands"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Brand Performance"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:R.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center text-purple-400 font-bold text-sm",children:t+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:s.brand}),e.jsxs("p",{className:"text-xs text-white/60",children:[s.products," products"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-purple-400",children:i(s.revenue)}),e.jsxs("p",{className:"text-xs text-white/60",children:[i(s.profit)," profit"]})]})]},s.brand))})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Brand Revenue Distribution"}),e.jsx(je,{data:{labels:R.slice(0,10).map(s=>s.brand),datasets:[{data:R.slice(0,10).map(s=>s.revenue),backgroundColor:["rgba(16, 185, 129, 0.8)","rgba(59, 130, 246, 0.8)","rgba(139, 92, 246, 0.8)","rgba(236, 72, 153, 0.8)","rgba(251, 146, 60, 0.8)","rgba(34, 197, 94, 0.8)","rgba(168, 85, 247, 0.8)","rgba(239, 68, 68, 0.8)","rgba(14, 165, 233, 0.8)","rgba(245, 158, 11, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"bottom",labels:{color:"rgba(255,255,255,0.8)"}}}}})]})]}),k==="categories"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Category Performance"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:Y.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400 font-bold text-sm",children:t+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:s.category}),e.jsxs("p",{className:"text-xs text-white/60",children:[s.products," products"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-blue-400",children:i(s.revenue)}),e.jsxs("p",{className:"text-xs text-white/60",children:[i(s.profit)," profit"]})]})]},s.category))})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Category Revenue Distribution"}),e.jsx(ve,{data:{labels:Y.slice(0,10).map(s=>s.category),datasets:[{label:"Revenue (â‚¹)",data:Y.slice(0,10).map(s=>s.revenue),backgroundColor:"rgba(59, 130, 246, 0.8)"}]},options:{responsive:!0,maintainAspectRatio:!0,indexAxis:"y",plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,ticks:{callback:s=>`â‚¹${(s/1e3).toFixed(0)}k`,color:"rgba(255,255,255,0.7)"},grid:{color:"rgba(255,255,255,0.1)"}},y:{ticks:{color:"rgba(255,255,255,0.7)"},grid:{color:"rgba(255,255,255,0.1)"}}}}})]})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"All Products Performance"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/20",children:[e.jsx("th",{className:"text-left py-2 px-3 text-white/80",children:"Product"}),e.jsx("th",{className:"text-left py-2 px-3 text-white/80",children:"Brand"}),e.jsx("th",{className:"text-left py-2 px-3 text-white/80",children:"Category"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Stock"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Cost Price"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Selling Price"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Inventory Cost"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Days in Inv."}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Sold"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Revenue"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Profit"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Margin %"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Orders"})]})}),e.jsx("tbody",{children:d.sort((s,t)=>(t.totalRevenue||0)-(s.totalRevenue||0)).map(s=>e.jsxs("tr",{className:"border-b border-white/10 hover:bg-white/5",children:[e.jsx("td",{className:"py-2 px-3 text-white font-medium",children:s.name}),e.jsx("td",{className:"py-2 px-3 text-white/60",children:s.brand}),e.jsx("td",{className:"py-2 px-3 text-white/60",children:s.category}),e.jsx("td",{className:"py-2 px-3 text-right text-white",children:s.currentStock}),e.jsx("td",{className:"py-2 px-3 text-right text-white/60",children:i(s.costPrice)}),e.jsx("td",{className:"py-2 px-3 text-right text-white/60",children:i(s.sellingPrice)}),e.jsx("td",{className:"py-2 px-3 text-right text-blue-400 font-semibold",children:i(s.totalInventoryCost)}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.daysInInventory>90?"bg-red-500/20 text-red-300":s.daysInInventory>30?"bg-amber-500/20 text-amber-300":"bg-emerald-500/20 text-emerald-300"}`,children:[s.daysInInventory," days"]})}),e.jsx("td",{className:"py-2 px-3 text-right text-white",children:s.totalSold}),e.jsx("td",{className:"py-2 px-3 text-right text-emerald-400 font-semibold",children:i(s.totalRevenue)}),e.jsx("td",{className:"py-2 px-3 text-right text-purple-400 font-semibold",children:i(s.totalProfit)}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.avgProfitMargin>=30?"bg-emerald-500/20 text-emerald-300":s.avgProfitMargin>=20?"bg-blue-500/20 text-blue-300":s.avgProfitMargin>=10?"bg-amber-500/20 text-amber-300":s.avgProfitMargin>0?"bg-red-500/20 text-red-300":"bg-gray-500/20 text-gray-300"}`,children:[s.avgProfitMargin>0?s.avgProfitMargin.toFixed(1):"0","%"]})}),e.jsx("td",{className:"py-2 px-3 text-right text-white/60",children:s.ordersCount})]},s.id))})]})})]})]})};se.register(re,ae,ue,he,ce,de,ie,le,xe);const Ye=({distributorId:j,dateRange:w,filters:I,onDateRangeChange:C,onFiltersChange:M})=>{const[q,N]=b.useState([]),[B,U]=b.useState([]),[L,S]=b.useState(!0),[k,p]=b.useState(null),[D,T]=b.useState(""),[A,h]=b.useState(w||{start:u().subtract(30,"day").format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")}),[P,o]=b.useState(I||{retailerType:"",state:"",minRevenue:0});b.useEffect(()=>{w&&h(w)},[w]),b.useEffect(()=>{I&&o(I)},[I]),b.useEffect(()=>{if(!j)return;S(!0);const t=[],r=te(Z(_,`businesses/${j}/orderRequests`),n=>{const l=n.docs.map(m=>({id:m.id,...m.data()}));N(l)});t.push(r);const a=te(Z(_,`businesses/${j}/connectedRetailers`),n=>{const l=n.docs.map(m=>({id:m.id,...m.data(),type:"connected"}));J(Z(_,`businesses/${j}/provisionalRetailers`)).then(m=>{const g=m.docs.map(v=>({id:v.id,...v.data(),type:"provisional"}));U([...l,...g]),S(!1)}).catch(()=>{U(l),S(!1)})});return t.push(a),()=>t.forEach(n=>n())},[j]);const c=t=>t?.chargesSnapshot?.breakdown?.grandTotal?Number(t.chargesSnapshot.breakdown.grandTotal):t?.items?t.items.reduce((r,a)=>{const n=Number(a.sellingPrice||a.price||a.unitPrice||0),l=Number(a.quantity||a.qty||0);return r+n*l},0):0,f=b.useMemo(()=>{const t=A||w;if(!t||!t.start||!t.end)return q;const r=u(t.start),a=u(t.end);return q.filter(n=>{const l=u(n.timestamp?.toDate?.()||n.timestamp||n.createdAt?.toDate?.()||n.createdAt);return l.isAfter(r.subtract(1,"day"))&&l.isBefore(a.add(1,"day"))})},[q,A,w]),d=b.useMemo(()=>{const t={},r={};return B.forEach(a=>{r[a.id]=a,a.provisionalId&&(r[a.provisionalId]=a)}),f.forEach(a=>{const n=a.retailerId||a.provisionalRetailerId;if(!n)return;const l=r[n]||{},m=a.retailerBusinessName||a.retailerName||l.businessName||l.name||"Unknown",g=a.retailerEmail||l.email||"",v=a.retailerPhone||l.phone||"",V=a.retailerCity||a.city||l.city||"",F=a.retailerState||a.state||l.state||"",z=c(a),W=a.isPaid===!0||a.paymentStatus==="Paid",K=a.status==="Delivered"||a.statusCode==="DELIVERED";t[n]||(t[n]={id:n,name:m,email:g,phone:v,city:V,state:F,type:l.type||(a.provisionalRetailerId?"provisional":"connected"),totalOrders:0,deliveredOrders:0,totalRevenue:0,paidRevenue:0,pendingRevenue:0,totalProfit:0,firstOrderDate:null,lastOrderDate:null,avgOrderValue:0,orderFrequency:0,daysSinceLastOrder:null,orderHistory:[],productPreferences:{}});const E=u(a.timestamp?.toDate?.()||a.timestamp||a.createdAt?.toDate?.()||a.createdAt);if(t[n].totalOrders+=1,K){t[n].deliveredOrders+=1,t[n].totalRevenue+=z,W?t[n].paidRevenue+=z:t[n].pendingRevenue+=z;const Q=z*.15;t[n].totalProfit+=Q}(!t[n].firstOrderDate||E.isBefore(t[n].firstOrderDate))&&(t[n].firstOrderDate=E),(!t[n].lastOrderDate||E.isAfter(t[n].lastOrderDate))&&(t[n].lastOrderDate=E);let y="Unknown";a.paymentModeLabel?y=a.paymentModeLabel:a.paymentMode?typeof a.paymentMode=="string"?y=a.paymentMode:typeof a.paymentMode=="object"&&a.paymentMode.label?y=a.paymentMode.label:typeof a.paymentMode=="object"&&a.paymentMode.code&&(y=a.paymentMode.code):a.paymentNormalized&&(typeof a.paymentNormalized=="object"&&a.paymentNormalized.label?y=a.paymentNormalized.label:typeof a.paymentNormalized=="object"&&a.paymentNormalized.code&&(y=a.paymentNormalized.code));let G="Unknown";a.status?G=typeof a.status=="string"?a.status:String(a.status):a.statusCode&&(G=typeof a.statusCode=="string"?a.statusCode:String(a.statusCode)),t[n].orderHistory.push({orderId:a.id,date:E,total:z,status:G,isPaid:W,isDelivered:K,items:a.items||[],paymentMode:y}),a.items&&Array.isArray(a.items)&&a.items.forEach(Q=>{const H=Q.productName||Q.name||"Unknown";t[n].productPreferences[H]||(t[n].productPreferences[H]={name:H,count:0,totalQty:0,totalRevenue:0}),t[n].productPreferences[H].count+=1,t[n].productPreferences[H].totalQty+=Number(Q.quantity||Q.qty||0),t[n].productPreferences[H].totalRevenue+=Number(Q.sellingPrice||Q.price||Q.unitPrice||0)*Number(Q.quantity||Q.qty||0)})}),Object.keys(t).forEach(a=>{const n=t[a];if(n.avgOrderValue=n.deliveredOrders>0?n.totalRevenue/n.deliveredOrders:0,n.firstOrderDate&&n.lastOrderDate){const l=n.lastOrderDate.diff(n.firstOrderDate,"month",!0)||1;n.orderFrequency=n.totalOrders/l}n.daysSinceLastOrder=n.lastOrderDate?u().diff(n.lastOrderDate,"day"):null,n.orderHistory.sort((l,m)=>m.date-l.date),n.topProducts=Object.values(n.productPreferences).sort((l,m)=>m.count-l.count).slice(0,5)}),Object.values(t)},[B,f]),O=b.useMemo(()=>{let t=d;const r=P||I;return r?.retailerType&&r.retailerType.trim()&&(t=t.filter(a=>a.type===r.retailerType)),r?.minRevenue&&r.minRevenue>0&&(t=t.filter(a=>a.totalRevenue>=r.minRevenue)),r?.state&&r.state.trim()&&(t=t.filter(a=>a.state.toLowerCase().includes(r.state.toLowerCase()))),t},[d,P,I]),i=b.useMemo(()=>{if(!k)return[];const t=O.find(a=>a.id===k);if(!t)return[];let r=t.orderHistory;if(D){const a=u(D);r=r.filter(n=>n.date.format("YYYY-MM-DD")===a.format("YYYY-MM-DD"))}return r},[k,O,D]),x=t=>`â‚¹${Number(t||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,R=t=>{const r={emerald:{border:"border-emerald-500/30",bg:"bg-gradient-to-br from-emerald-500/20 to-emerald-600/20"},purple:{border:"border-purple-500/30",bg:"bg-gradient-to-br from-purple-500/20 to-purple-600/20"},blue:{border:"border-blue-500/30",bg:"bg-gradient-to-br from-blue-500/20 to-blue-600/20"},amber:{border:"border-amber-500/30",bg:"bg-gradient-to-br from-amber-500/20 to-amber-600/20"}};return r[t]||r.emerald},Y=b.useMemo(()=>[...O].filter(t=>t.totalRevenue>0).sort((t,r)=>r.totalRevenue-t.totalRevenue).slice(0,10),[O]),s=b.useMemo(()=>O.filter(t=>{const r=t.daysSinceLastOrder;return r!==null&&r<=30}),[O]);return L?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"text-white/60",children:"Loading retailer analytics..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-white to-emerald-200",children:"Retailer Analytics"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Comprehensive retailer performance, order history, revenue, and activity insights"})]})}),e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-1",children:"Date Range Start"}),e.jsx("input",{type:"date",value:A.start,onChange:t=>{const r={...A,start:t.target.value};h(r),C&&C(r)},className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-1",children:"Date Range End"}),e.jsx("input",{type:"date",value:A.end,onChange:t=>{const r={...A,end:t.target.value};h(r),C&&C(r)},className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-1",children:"Retailer Type"}),e.jsxs("select",{value:P.retailerType,onChange:t=>{const r={...P,retailerType:t.target.value};o(r),M&&M(r)},className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"connected",children:"Connected"}),e.jsx("option",{value:"provisional",children:"Provisional"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-1",children:"State"}),e.jsx("input",{type:"text",placeholder:"Enter state",value:P.state,onChange:t=>{const r={...P,state:t.target.value};o(r),M&&M(r)},className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-emerald-500/50"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{const t={retailerType:"",state:"",minRevenue:0};o(t),M&&M(t)},className:"w-full px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white text-sm font-medium transition border border-white/20",children:"Clear Filters"})})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"Total Retailers",value:B.length,color:"emerald",icon:"ðŸª"},{label:"Active Retailers",value:s.length,color:"blue",icon:"âœ¨"},{label:"Total Revenue",value:x(O.reduce((t,r)=>t+r.totalRevenue,0)),color:"purple",icon:"ðŸ’°"},{label:"Pending Payments",value:x(O.reduce((t,r)=>t+r.pendingRevenue,0)),color:"amber",icon:"â³"}].map((t,r)=>{const a=R(t.color);return e.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:r*.1},className:`rounded-xl border ${a.border} ${a.bg} p-4`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-xl",children:t.icon})}),e.jsx("p",{className:"text-xs text-white/60 mb-1",children:t.label}),e.jsx("p",{className:"text-xl font-bold text-white",children:t.value})]},t.label)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"All Retailers"}),e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:O.sort((t,r)=>r.totalRevenue-t.totalRevenue).map(t=>e.jsxs("div",{onClick:()=>p(t.id),className:`p-3 rounded-lg border cursor-pointer transition ${k===t.id?"bg-emerald-500/20 border-emerald-500/50":"bg-white/5 border-white/10 hover:bg-white/10"}`,children:[e.jsx("p",{className:"font-semibold text-white",children:t.name}),e.jsx("p",{className:"text-xs text-white/60",children:t.city&&t.state?`${t.city}, ${t.state}`:t.email||t.phone}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("span",{className:"text-xs text-white/60",children:[t.totalOrders," orders"]}),e.jsx("span",{className:"text-sm font-bold text-emerald-400",children:x(t.totalRevenue)})]})]},t.id))})]}),e.jsx("div",{className:"lg:col-span-2 space-y-6",children:k?(()=>{const t=O.find(r=>r.id===k);return t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-xl border border-white/10 bg-gradient-to-br from-blue-500/10 to-purple-500/10 backdrop-blur-xl p-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:t.name}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Total Orders"}),e.jsx("p",{className:"text-xl font-bold text-white",children:t.totalOrders})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Total Revenue"}),e.jsx("p",{className:"text-xl font-bold text-emerald-400",children:x(t.totalRevenue)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Total Profit"}),e.jsx("p",{className:"text-xl font-bold text-purple-400",children:x(t.totalProfit)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Avg Order Value"}),e.jsx("p",{className:"text-xl font-bold text-white",children:x(t.avgOrderValue)})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Location"}),e.jsx("p",{className:"text-sm text-white",children:t.city&&t.state?`${t.city}, ${t.state}`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Last Order"}),e.jsx("p",{className:"text-sm text-white",children:t.lastOrderDate?t.lastOrderDate.format("MMM DD, YYYY"):"Never"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Order Frequency"}),e.jsxs("p",{className:"text-sm text-white",children:[t.orderFrequency.toFixed(1)," orders/month"]})]})]})]}),t.topProducts&&t.topProducts.length>0&&e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Frequently Ordered Products"}),e.jsx("div",{className:"space-y-2",children:t.topProducts.map((r,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:r.name}),e.jsxs("p",{className:"text-xs text-white/60",children:["Ordered ",r.count," times â€¢ ",r.totalQty," units"]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-bold text-emerald-400",children:x(r.totalRevenue)})})]},a))})]}),e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm text-white/80",children:"Filter Orders by Date:"}),e.jsx("input",{type:"date",value:D,onChange:r=>T(r.target.value),className:"px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50"}),D&&e.jsx("button",{onClick:()=>T(""),className:"px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white text-sm transition",children:"Clear"})]})}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4",children:["Order History ",D?`(${u(D).format("MMM DD, YYYY")})`:""]}),e.jsx("div",{className:"space-y-3 max-h-[500px] overflow-y-auto",children:i.length===0?e.jsx("p",{className:"text-white/60",children:"No orders found for the selected date range."}):i.map(r=>e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-white",children:["Order #",r.orderId.substring(0,8),"..."]}),e.jsx("p",{className:"text-xs text-white/60",children:r.date.format("MMM DD, YYYY hh:mm A")})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-emerald-400",children:x(r.total)}),e.jsx("p",{className:"text-xs text-white/60",children:r.isPaid?e.jsx("span",{className:"text-green-400",children:"Paid"}):e.jsx("span",{className:"text-amber-400",children:"Pending"})})]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-white/10",children:[e.jsxs("p",{className:"text-xs text-white/60 mb-1",children:["Payment: ",r.paymentMode]}),e.jsxs("p",{className:"text-xs text-white/60 mb-2",children:["Status: ",r.status]}),r.items&&r.items.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-xs text-white/60 mb-1",children:["Items (",r.items.length,"):"]}),e.jsxs("div",{className:"space-y-1",children:[r.items.slice(0,3).map((a,n)=>{const l=a.productName||a.name||"Unknown Product",m=a.quantity||a.qty||0;return e.jsxs("p",{className:"text-xs text-white/80",children:["â€¢ ",String(l)," (Qty: ",Number(m),")"]},n)}),r.items.length>3&&e.jsxs("p",{className:"text-xs text-white/60",children:["+ ",r.items.length-3," more items"]})]})]})]})]},r.orderId))})]})]}):null})():e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-12 text-center",children:e.jsx("p",{className:"text-white/60 text-lg",children:"Select a retailer to view detailed analytics"})})})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Top 10 Retailers by Revenue"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/20",children:[e.jsx("th",{className:"text-left py-2 px-3 text-white/80",children:"Retailer"}),e.jsx("th",{className:"text-left py-2 px-3 text-white/80",children:"Type"}),e.jsx("th",{className:"text-left py-2 px-3 text-white/80",children:"Location"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Orders"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Revenue"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Profit"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Avg Order"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Last Order"})]})}),e.jsx("tbody",{children:Y.map(t=>e.jsxs("tr",{onClick:()=>p(t.id),className:"border-b border-white/10 hover:bg-white/5 cursor-pointer",children:[e.jsx("td",{className:"py-2 px-3 text-white font-medium",children:t.name}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${t.type==="connected"?"bg-blue-500/20 text-blue-300":"bg-amber-500/20 text-amber-300"}`,children:t.type==="connected"?"Connected":"Provisional"})}),e.jsx("td",{className:"py-2 px-3 text-white/60",children:t.city&&t.state?`${t.city}, ${t.state}`:"N/A"}),e.jsx("td",{className:"py-2 px-3 text-right text-white",children:t.totalOrders}),e.jsx("td",{className:"py-2 px-3 text-right text-emerald-400 font-semibold",children:x(t.totalRevenue)}),e.jsx("td",{className:"py-2 px-3 text-right text-purple-400 font-semibold",children:x(t.totalProfit)}),e.jsx("td",{className:"py-2 px-3 text-right text-white/60",children:x(t.avgOrderValue)}),e.jsx("td",{className:"py-2 px-3 text-right",children:t.daysSinceLastOrder!==null?e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${t.daysSinceLastOrder<=7?"bg-emerald-500/20 text-emerald-300":t.daysSinceLastOrder<=30?"bg-amber-500/20 text-amber-300":"bg-red-500/20 text-red-300"}`,children:[t.daysSinceLastOrder,"d ago"]}):e.jsx("span",{className:"text-white/40",children:"Never"})})]},t.id))})]})})]})]})};se.register(re,ae,ue,he,ce,de,ie,le);const Ce=({distributorId:j,dateRange:w,filters:I,onDateRangeChange:C})=>{const[M,q]=b.useState([]),[N,B]=b.useState(!0),[U,L]=b.useState(w||{start:u().subtract(30,"day").format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")});b.useEffect(()=>{w&&L(w)},[w]),b.useEffect(()=>{if(!j)return;(async()=>{B(!0);try{const c=Z(_,`businesses/${j}/orderRequests`),d=(await J(c)).docs.map(O=>({id:O.id,...O.data()}));q(d)}catch(c){console.error("[RevenueProfitAnalytics] Error fetching data:",c)}finally{B(!1)}})()},[j]);const S=o=>o?.chargesSnapshot?.breakdown?.grandTotal?Number(o.chargesSnapshot.breakdown.grandTotal):o?.items?o.items.reduce((c,f)=>{const d=Number(f.sellingPrice||f.price||f.unitPrice||0),O=Number(f.quantity||f.qty||0);return c+d*O},0):0,k=b.useMemo(()=>{const o=U||w;if(!o||!o.start||!o.end)return M;const c=u(o.start),f=u(o.end);return M.filter(d=>{const O=u(d.timestamp?.toDate?.()||d.timestamp||d.createdAt?.toDate?.()||d.createdAt);return O.isAfter(c.subtract(1,"day"))&&O.isBefore(f.add(1,"day"))})},[M,U,w]),p=b.useMemo(()=>{const o={};return k.forEach(c=>{if(c.status!=="Delivered"&&c.statusCode!=="DELIVERED")return;const f=u(c.timestamp?.toDate?.()||c.timestamp||c.createdAt?.toDate?.()||c.createdAt).format("YYYY-MM-DD"),d=c.chargesSnapshot?.breakdown?.grandTotal||S(c),O=d*.15;o[f]||(o[f]={date:f,revenue:0,profit:0,orders:0}),o[f].revenue+=d,o[f].profit+=O,o[f].orders+=1}),Object.values(o).sort((c,f)=>c.date.localeCompare(f.date))},[k]),D=b.useMemo(()=>{const o={};return p.forEach(c=>{const f=u(c.date).format("YYYY-MM");o[f]||(o[f]={month:f,revenue:0,profit:0,orders:0}),o[f].revenue+=c.revenue,o[f].profit+=c.profit,o[f].orders+=c.orders}),Object.values(o).sort((c,f)=>c.month.localeCompare(f.month))},[p]),T=b.useMemo(()=>{const o=Array.from({length:30},(f,d)=>u().subtract(29-d,"day").format("YYYY-MM-DD")),c={};return p.forEach(f=>{c[f.date]=f}),{labels:o.map(f=>u(f).format("MMM DD")),datasets:[{label:"Revenue (â‚¹)",data:o.map(f=>c[f]?.revenue||0),borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.4,yAxisID:"y"},{label:"Profit (â‚¹)",data:o.map(f=>c[f]?.profit||0),borderColor:"rgb(139, 92, 246)",backgroundColor:"rgba(139, 92, 246, 0.1)",tension:.4,yAxisID:"y"}]}},[p]),A=b.useMemo(()=>{const o=D.slice(-6);return{labels:o.map(c=>u(c.month).format("MMM YYYY")),datasets:[{label:"Revenue (â‚¹)",data:o.map(c=>c.revenue),backgroundColor:"rgba(16, 185, 129, 0.8)"},{label:"Profit (â‚¹)",data:o.map(c=>c.profit),backgroundColor:"rgba(139, 92, 246, 0.8)"}]}},[D]),h=b.useMemo(()=>{const o=p.reduce((r,a)=>r+a.revenue,0),c=p.reduce((r,a)=>r+a.profit,0),f=p.reduce((r,a)=>r+a.orders,0),d=p.length>0?o/p.length:0,O=p.length>0?c/p.length:0,i=o>0?c/o*100:0,x=p.slice(-7),R=p.slice(-14,-7),Y=x.reduce((r,a)=>r+a.revenue,0),s=R.reduce((r,a)=>r+a.revenue,0),t=s>0?(Y-s)/s*100:0;return{totalRevenue:o,totalProfit:c,totalOrders:f,avgDailyRevenue:d,avgDailyProfit:O,profitMargin:i,revenueGrowth:t}},[p]),P=o=>`â‚¹${Number(o||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`;return N?e.jsx("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10",children:e.jsx("div",{className:"text-center text-white/60",children:"Loading revenue & profit analytics..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-white to-emerald-200",children:"Revenue & Profit Analytics"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Track revenue trends, profit margins, and financial performance"})]})}),e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-1",children:"Date Range Start"}),e.jsx("input",{type:"date",value:U.start,onChange:o=>{const c={...U,start:o.target.value};L(c),C&&C(c)},className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-1",children:"Date Range End"}),e.jsx("input",{type:"date",value:U.end,onChange:o=>{const c={...U,end:o.target.value};L(c),C&&C(c)},className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-1",children:"Quick Filters"}),e.jsxs("select",{onChange:o=>{const c=o.target.value;if(!c)return;let f;c==="today"?f={start:u().format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")}:c==="week"?f={start:u().subtract(7,"day").format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")}:c==="month"?f={start:u().subtract(30,"day").format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")}:c==="quarter"?f={start:u().subtract(90,"day").format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")}:c==="year"&&(f={start:u().subtract(365,"day").format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")}),f&&(L(f),C&&C(f)),o.target.value=""},className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50",children:[e.jsx("option",{value:"",children:"Custom Range"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"Last 7 Days"}),e.jsx("option",{value:"month",children:"Last 30 Days"}),e.jsx("option",{value:"quarter",children:"Last 90 Days"}),e.jsx("option",{value:"year",children:"Last Year"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{const o={start:u().subtract(30,"day").format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")};L(o),C&&C(o)},className:"w-full px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white text-sm font-medium transition border border-white/20",children:"Reset Filters"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-500/20 to-emerald-600/20 rounded-xl p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:P(h.totalRevenue)}),e.jsxs("p",{className:"text-xs text-emerald-300 mt-1",children:[h.revenueGrowth>=0?"â†‘":"â†“"," ",Math.abs(h.revenueGrowth).toFixed(1),"% vs last week"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/20 to-purple-600/20 rounded-xl p-4 border border-purple-500/30",children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Total Profit"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:P(h.totalProfit)}),e.jsxs("p",{className:"text-xs text-purple-300 mt-1",children:[h.profitMargin.toFixed(1),"% profit margin"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/20 to-blue-600/20 rounded-xl p-4 border border-blue-500/30",children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Avg Daily Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:P(h.avgDailyRevenue)}),e.jsx("p",{className:"text-xs text-blue-300 mt-1",children:"Per day average"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-500/20 to-amber-600/20 rounded-xl p-4 border border-amber-500/30",children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:h.totalOrders}),e.jsxs("p",{className:"text-xs text-amber-300 mt-1",children:[p.length>0?(h.totalOrders/p.length).toFixed(1):0," ","orders/day"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Revenue & Profit Trend (Last 30 Days)"}),e.jsx(fe,{data:T,options:{responsive:!0,maintainAspectRatio:!0,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"top",labels:{color:"rgba(255,255,255,0.8)"}},tooltip:{callbacks:{label:o=>`${o.dataset.label}: â‚¹${o.parsed.y.toLocaleString("en-IN")}`}}},scales:{y:{beginAtZero:!0,ticks:{callback:o=>`â‚¹${o.toLocaleString("en-IN")}`,color:"rgba(255,255,255,0.7)"},grid:{color:"rgba(255,255,255,0.1)"}},x:{ticks:{color:"rgba(255,255,255,0.7)"},grid:{color:"rgba(255,255,255,0.1)"}}}}})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Monthly Comparison (Last 6 Months)"}),e.jsx(ve,{data:A,options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"top",labels:{color:"rgba(255,255,255,0.8)"}},tooltip:{callbacks:{label:o=>`${o.dataset.label}: â‚¹${o.parsed.y.toLocaleString("en-IN")}`}}},scales:{y:{beginAtZero:!0,ticks:{callback:o=>`â‚¹${o.toLocaleString("en-IN")}`,color:"rgba(255,255,255,0.7)"},grid:{color:"rgba(255,255,255,0.1)"}},x:{ticks:{color:"rgba(255,255,255,0.7)"},grid:{color:"rgba(255,255,255,0.1)"}}}}})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Daily Revenue & Profit Breakdown"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/20",children:[e.jsx("th",{className:"text-left py-2 px-3 text-white/80",children:"Date"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Orders"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Revenue"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Profit"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Margin %"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Avg Order Value"})]})}),e.jsx("tbody",{children:p.slice().reverse().map(o=>{const c=o.revenue>0?o.profit/o.revenue*100:0,f=o.orders>0?o.revenue/o.orders:0;return e.jsxs("tr",{className:"border-b border-white/10 hover:bg-white/5",children:[e.jsx("td",{className:"py-2 px-3 text-white",children:u(o.date).format("DD MMM YYYY")}),e.jsx("td",{className:"py-2 px-3 text-right text-white",children:o.orders}),e.jsx("td",{className:"py-2 px-3 text-right text-emerald-400 font-semibold",children:P(o.revenue)}),e.jsx("td",{className:"py-2 px-3 text-right text-purple-400 font-semibold",children:P(o.profit)}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${c>=20?"bg-emerald-500/20 text-emerald-300":c>=10?"bg-blue-500/20 text-blue-300":"bg-amber-500/20 text-amber-300"}`,children:[c.toFixed(1),"%"]})}),e.jsx("td",{className:"py-2 px-3 text-right text-white/60",children:P(f)})]},o.date)})})]})})]})]})};se.register(re,ae,ce,de,ie,le,xe);const Ae=({distributorId:j,dateRange:w,filters:I,onDateRangeChange:C})=>{const[M,q]=b.useState([]),[N,B]=b.useState([]),[U,L]=b.useState(!0),[S,k]=b.useState("category"),[p,D]=b.useState(w||{start:u().subtract(30,"day").format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")});b.useEffect(()=>{w&&D(w)},[w]),b.useEffect(()=>{if(!j)return;(async()=>{L(!0);try{const x=Z(_,`businesses/${j}/orderRequests`),Y=(await J(x)).docs.map(a=>({id:a.id,...a.data()}));q(Y);const s=Z(_,`businesses/${j}/products`),r=(await J(s)).docs.map(a=>({id:a.id,...a.data()}));B(r)}catch(x){console.error("[CategoryBrandAnalytics] Error fetching data:",x)}finally{L(!1)}})()},[j]);const T=b.useMemo(()=>{const i=p||w;if(!i||!i.start||!i.end)return M;const x=u(i.start),R=u(i.end);return M.filter(Y=>{const s=u(Y.timestamp?.toDate?.()||Y.timestamp||Y.createdAt?.toDate?.()||Y.createdAt);return s.isAfter(x.subtract(1,"day"))&&s.isBefore(R.add(1,"day"))})},[M,p,w]),A=b.useMemo(()=>{const i={},x={};N.forEach(s=>{x[s.id]=s});const R={},Y={};return N.forEach(s=>{const t=(s.name||s.productName||"").toLowerCase().trim(),r=(s.brand||"").toLowerCase().trim(),a=(s.sku||"").toLowerCase().trim();t&&r&&(R[`${t}::${r}`]=s),a&&(Y[a]=s)}),T.forEach(s=>{const t=String(s.status||"").toUpperCase(),r=String(s.statusCode||"").toUpperCase();(t==="DELIVERED"||r==="DELIVERED"||t==="INVOICED"||r==="INVOICED"||String(s.status||"").toLowerCase()==="delivered"||String(s.statusCode||"").toLowerCase()==="delivered")&&(!s.items||!Array.isArray(s.items)||s.items.forEach(n=>{let l=n.distributorProductId||n.productId||n.inventoryId||n.id,m=null;if(l&&(m=x[l]),!m){const y=(n.productName||n.name||"").toLowerCase().trim(),G=(n.brand||"").toLowerCase().trim(),Q=(n.sku||"").toLowerCase().trim();if(Q&&Y[Q])m=Y[Q],l=m.id;else if(y&&G){const H=`${y}::${G}`;R[H]&&(m=R[H],l=m.id)}!m&&y&&(m=N.find(H=>{const ee=(H.name||H.productName||"").toLowerCase().trim();return ee&&y&&(ee.includes(y)||y.includes(ee))}),m&&(l=m.id))}const g=m||x[l]||{},v=n.category||g.category||"Uncategorized",V=Number(n.quantity||n.qty||0),F=Number(n.sellingPrice||n.price||n.unitPrice||0),z=Number(g.costPrice||g.price||g.distributorPrice||0),W=F*V,K=z*V,E=W-K;i[v]||(i[v]={name:v,totalSold:0,totalRevenue:0,totalCost:0,totalProfit:0,ordersCount:0,productsCount:new Set}),i[v].totalSold+=V,i[v].totalRevenue+=W,i[v].totalCost+=K,i[v].totalProfit+=E,i[v].ordersCount+=1,i[v].productsCount.add(l)}))}),Object.keys(i).forEach(s=>{const t=i[s];t.avgProfitMargin=t.totalRevenue>0?t.totalProfit/t.totalRevenue*100:0,t.productsCount=t.productsCount.size,t.avgOrderValue=t.ordersCount>0?t.totalRevenue/t.ordersCount:0}),Object.values(i)},[N,T]),h=b.useMemo(()=>{const i={},x={};N.forEach(s=>{x[s.id]=s});const R={},Y={};return N.forEach(s=>{const t=(s.name||s.productName||"").toLowerCase().trim(),r=(s.brand||"").toLowerCase().trim(),a=(s.sku||"").toLowerCase().trim();t&&r&&(R[`${t}::${r}`]=s),a&&(Y[a]=s)}),T.forEach(s=>{const t=String(s.status||"").toUpperCase(),r=String(s.statusCode||"").toUpperCase();(t==="DELIVERED"||r==="DELIVERED"||t==="INVOICED"||r==="INVOICED"||String(s.status||"").toLowerCase()==="delivered"||String(s.statusCode||"").toLowerCase()==="delivered")&&(!s.items||!Array.isArray(s.items)||s.items.forEach(n=>{let l=n.distributorProductId||n.productId||n.inventoryId||n.id,m=null;if(l&&(m=x[l]),!m){const y=(n.productName||n.name||"").toLowerCase().trim(),G=(n.brand||"").toLowerCase().trim(),Q=(n.sku||"").toLowerCase().trim();if(Q&&Y[Q])m=Y[Q],l=m.id;else if(y&&G){const H=`${y}::${G}`;R[H]&&(m=R[H],l=m.id)}!m&&y&&(m=N.find(H=>{const ee=(H.name||H.productName||"").toLowerCase().trim();return ee&&y&&(ee.includes(y)||y.includes(ee))}),m&&(l=m.id))}const g=m||x[l]||{},v=n.brand||g.brand||"Unbranded",V=Number(n.quantity||n.qty||0),F=Number(n.sellingPrice||n.price||n.unitPrice||0),z=Number(g.costPrice||g.price||g.distributorPrice||0),W=F*V,K=z*V,E=W-K;i[v]||(i[v]={name:v,totalSold:0,totalRevenue:0,totalCost:0,totalProfit:0,ordersCount:0,productsCount:new Set}),i[v].totalSold+=V,i[v].totalRevenue+=W,i[v].totalCost+=K,i[v].totalProfit+=E,i[v].ordersCount+=1,i[v].productsCount.add(l)}))}),Object.keys(i).forEach(s=>{const t=i[s];t.avgProfitMargin=t.totalRevenue>0?t.totalProfit/t.totalRevenue*100:0,t.productsCount=t.productsCount.size,t.avgOrderValue=t.ordersCount>0?t.totalRevenue/t.ordersCount:0}),Object.values(i)},[N,T]),P=b.useMemo(()=>{const i=[...A].sort((x,R)=>R.totalRevenue-x.totalRevenue).slice(0,10);return{labels:i.map(x=>x.name),datasets:[{label:"Revenue (â‚¹)",data:i.map(x=>x.totalRevenue),backgroundColor:["rgba(16, 185, 129, 0.8)","rgba(59, 130, 246, 0.8)","rgba(139, 92, 246, 0.8)","rgba(236, 72, 153, 0.8)","rgba(251, 146, 60, 0.8)","rgba(34, 197, 94, 0.8)","rgba(168, 85, 247, 0.8)","rgba(239, 68, 68, 0.8)","rgba(14, 165, 233, 0.8)","rgba(245, 158, 11, 0.8)"]}]}},[A]),o=b.useMemo(()=>{const i=[...h].sort((x,R)=>R.totalRevenue-x.totalRevenue).slice(0,10);return{labels:i.map(x=>x.name),datasets:[{label:"Revenue (â‚¹)",data:i.map(x=>x.totalRevenue),backgroundColor:["rgba(16, 185, 129, 0.8)","rgba(59, 130, 246, 0.8)","rgba(139, 92, 246, 0.8)","rgba(236, 72, 153, 0.8)","rgba(251, 146, 60, 0.8)","rgba(34, 197, 94, 0.8)","rgba(168, 85, 247, 0.8)","rgba(239, 68, 68, 0.8)","rgba(14, 165, 233, 0.8)","rgba(245, 158, 11, 0.8)"]}]}},[h]),c=i=>`â‚¹${Number(i||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`;if(U)return e.jsx("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10",children:e.jsx("div",{className:"text-center text-white/60",children:"Loading category & brand analytics..."})});const f=S==="category"?A:h,d=S==="category"?P:o,O=[...f].sort((i,x)=>x.totalRevenue-i.totalRevenue);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-white to-emerald-200",children:"Category & Brand Analytics"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Compare performance across categories and brands"})]})}),e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-1",children:"Date Range Start"}),e.jsx("input",{type:"date",value:p.start,onChange:i=>{const x={...p,start:i.target.value};D(x),C&&C(x)},className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-1",children:"Date Range End"}),e.jsx("input",{type:"date",value:p.end,onChange:i=>{const x={...p,end:i.target.value};D(x),C&&C(x)},className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/60 mb-1",children:"Quick Filters"}),e.jsxs("select",{onChange:i=>{const x=i.target.value;if(!x)return;let R;x==="today"?R={start:u().format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")}:x==="week"?R={start:u().subtract(7,"day").format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")}:x==="month"?R={start:u().subtract(30,"day").format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")}:x==="quarter"?R={start:u().subtract(90,"day").format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")}:x==="year"&&(R={start:u().subtract(365,"day").format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")}),R&&(D(R),C&&C(R)),i.target.value=""},className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50",children:[e.jsx("option",{value:"",children:"Custom Range"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"Last 7 Days"}),e.jsx("option",{value:"month",children:"Last 30 Days"}),e.jsx("option",{value:"quarter",children:"Last 90 Days"}),e.jsx("option",{value:"year",children:"Last Year"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{const i={start:u().subtract(30,"day").format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")};D(i),C&&C(i)},className:"w-full px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white text-sm font-medium transition border border-white/20",children:"Reset Filters"})})]})}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:["category","brand"].map(i=>e.jsxs("button",{onClick:()=>k(i),className:`px-4 py-2 rounded-lg text-sm font-medium transition ${S===i?"bg-emerald-500 text-white shadow-lg shadow-emerald-500/30":"bg-white/10 text-white/80 hover:bg-white/20"}`,children:[i.charAt(0).toUpperCase()+i.slice(1)," Performance"]},i))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-500/20 to-emerald-600/20 rounded-xl p-4 border border-emerald-500/30",children:[e.jsxs("p",{className:"text-xs text-white/60 mb-1",children:["Total ",S==="category"?"Categories":"Brands"]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:f.length})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/20 to-blue-600/20 rounded-xl p-4 border border-blue-500/30",children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:c(f.reduce((i,x)=>i+x.totalRevenue,0))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/20 to-purple-600/20 rounded-xl p-4 border border-purple-500/30",children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Total Profit"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:c(f.reduce((i,x)=>i+x.totalProfit,0))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-500/20 to-amber-600/20 rounded-xl p-4 border border-amber-500/30",children:[e.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Total Units Sold"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:f.reduce((i,x)=>i+x.totalSold,0).toLocaleString("en-IN")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4",children:["Top 10 ",S==="category"?"Categories":"Brands"," by Revenue"]}),e.jsx(je,{data:d,options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"bottom",labels:{color:"rgba(255,255,255,0.8)"}},tooltip:{callbacks:{label:i=>{const x=i.label||"",R=i.parsed||0,Y=i.dataset.data.reduce((t,r)=>t+r,0),s=Y>0?(R/Y*100).toFixed(1):0;return`${x}: â‚¹${R.toLocaleString("en-IN")} (${s}%)`}}}}}})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4",children:["Top ",S==="category"?"Categories":"Brands"," by Revenue"]}),e.jsx(ve,{data:d,options:{responsive:!0,maintainAspectRatio:!0,indexAxis:"y",plugins:{legend:{display:!1},tooltip:{callbacks:{label:i=>`â‚¹${i.parsed.x.toLocaleString("en-IN")}`}}},scales:{x:{beginAtZero:!0,ticks:{callback:i=>`â‚¹${i.toLocaleString("en-IN")}`,color:"rgba(255,255,255,0.7)"},grid:{color:"rgba(255,255,255,0.1)"}},y:{ticks:{color:"rgba(255,255,255,0.7)",maxRotation:0},grid:{color:"rgba(255,255,255,0.1)"}}}}})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4",children:["All ",S==="category"?"Categories":"Brands"," Performance"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/20",children:[e.jsx("th",{className:"text-left py-2 px-3 text-white/80",children:S==="category"?"Category":"Brand"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Products"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Units Sold"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Orders"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Revenue"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Profit"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Margin %"}),e.jsx("th",{className:"text-right py-2 px-3 text-white/80",children:"Avg Order Value"})]})}),e.jsx("tbody",{children:O.map(i=>e.jsxs("tr",{className:"border-b border-white/10 hover:bg-white/5",children:[e.jsx("td",{className:"py-2 px-3 text-white font-medium",children:i.name}),e.jsx("td",{className:"py-2 px-3 text-right text-white/60",children:i.productsCount}),e.jsx("td",{className:"py-2 px-3 text-right text-white",children:i.totalSold.toLocaleString("en-IN")}),e.jsx("td",{className:"py-2 px-3 text-right text-white/60",children:i.ordersCount}),e.jsx("td",{className:"py-2 px-3 text-right text-emerald-400 font-semibold",children:c(i.totalRevenue)}),e.jsx("td",{className:"py-2 px-3 text-right text-purple-400 font-semibold",children:c(i.totalProfit)}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${i.avgProfitMargin>=30?"bg-emerald-500/20 text-emerald-300":i.avgProfitMargin>=20?"bg-blue-500/20 text-blue-300":i.avgProfitMargin>=10?"bg-amber-500/20 text-amber-300":"bg-red-500/20 text-red-300"}`,children:[i.avgProfitMargin.toFixed(1),"%"]})}),e.jsx("td",{className:"py-2 px-3 text-right text-white/60",children:c(i.avgOrderValue)})]},i.name))})]})})]})]})},Oe=({distributorId:j})=>{const[w,I]=b.useState(null),[C,M]=b.useState(0);return b.useEffect(()=>{j&&(async()=>{const N=Z(_,"businesses",j,"orderRequests"),B=await J(N);let U=0,L=0;B.forEach(k=>{const p=k.data(),D=p.orderAcceptedAt||p.createdAt,T=p.orderShippedAt||p.deliveredAt;if(D&&T){const A=u(D),P=u(T).diff(A,"minute");!isNaN(P)&&P>=0&&(U+=P,L+=1)}});const S=L>0?(U/L).toFixed(1):null;I(S),M(L)})()},[j]),e.jsxs("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸšš"})," Dispatch Speed Tracker"]}),w!==null?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-white/80",children:["Average Dispatch Time: ",e.jsxs("strong",{className:"text-emerald-400 text-xl",children:[w," minutes"]})]}),e.jsxs("p",{className:"text-white/60 text-sm",children:["Across ",C," orders"]}),e.jsx("div",{className:"mt-4 p-3 bg-emerald-500/10 rounded-lg border border-emerald-500/20",children:e.jsx("p",{className:"text-xs text-emerald-300",children:w<60?"âš¡ Excellent dispatch speed!":w<120?"âœ… Good dispatch performance":"âš ï¸ Consider optimizing dispatch process"})})]}):e.jsx("p",{className:"text-white/60",children:"No dispatch data available."})]})},Ee=({distributorId:j})=>{const[w,I]=b.useState([]);return b.useEffect(()=>{j&&(async()=>{const M=Z(_,"businesses",j,"orderRequests"),q=await J(M),N={},U=u().subtract(7,"day");q.forEach(S=>{const k=S.data();u(k.timestamp?.toDate?.()||k.timestamp).isAfter(U)&&Array.isArray(k.items)&&k.items.forEach(D=>{const T=D.distributorProductId,A=parseInt(D.quantity)||0;N[T]||(N[T]={name:D.productName,sold:0}),N[T].sold+=A})});const L=[];for(const S in N){const k=Ne(_,"businesses",j,"products",S),D=(await De(k)).data();if(D){const T=parseInt(D.quantity||0),A=N[S].sold/7,h=A>0?Math.floor(T/A):"âˆž";L.push({name:N[S].name,currentStock:T,avgDailySale:A.toFixed(1),daysLeft:h})}}I(L)})()},[j]),e.jsxs("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“¦"})," Inventory Drain Forecast"]}),w.length===0?e.jsx("p",{className:"text-white/60",children:"No data available for forecast."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b border-white/20",children:[e.jsx("th",{className:"py-2 px-3 text-white/80",children:"Product"}),e.jsx("th",{className:"py-2 px-3 text-right text-white/80",children:"Stock"}),e.jsx("th",{className:"py-2 px-3 text-right text-white/80",children:"Avg Sold/Day"}),e.jsx("th",{className:"py-2 px-3 text-right text-white/80",children:"Est. Days Left"})]})}),e.jsx("tbody",{children:w.map((C,M)=>{const q=typeof C.daysLeft=="number"?C.daysLeft:1/0,N=q<7,B=q<30;return e.jsxs("tr",{className:"border-b border-white/10 hover:bg-white/5",children:[e.jsx("td",{className:"py-2 px-3 text-white font-medium",children:C.name}),e.jsx("td",{className:"py-2 px-3 text-right text-white",children:C.currentStock}),e.jsx("td",{className:"py-2 px-3 text-right text-white/60",children:C.avgDailySale}),e.jsx("td",{className:"py-2 px-3 text-right",children:q===1/0?e.jsx("span",{className:"text-white/40",children:"âˆž"}):e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${N?"bg-red-500/20 text-red-300":B?"bg-amber-500/20 text-amber-300":"bg-emerald-500/20 text-emerald-300"}`,children:[q," days"]})})]},M)})})]})})]})};se.register(xe,ie,le,re,ae);const Le=({distributorId:j})=>{const[w,I]=b.useState([]),[C,M]=b.useState(!1);b.useEffect(()=>{j&&(async()=>{const B=Z(_,"businesses",j,"orderRequests"),U=await J(B),L={};let S=0;U.forEach(T=>{const h=T.data().retailerName||"Unknown";L[h]=(L[h]||0)+1,S+=1});const k=Object.entries(L).sort((T,A)=>A[1]-T[1]).map(([T,A])=>({name:T,count:A})),D=k.slice(0,3).reduce((T,A)=>T+A.count,0)/S*100;M(D>60),I(k)})()},[j]);const q={labels:w.map(N=>N.name),datasets:[{data:w.map(N=>N.count),backgroundColor:["#4CAF50","#FF9800","#2196F3","#F44336","#9C27B0","#3F51B5","#009688","#FF5722","#607D8B"]}]};return e.jsxs("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸŽ¯"})," Retailer Dependency Risk"]}),w.length===0?e.jsx("p",{className:"text-white/60",children:"No data yet."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"max-w-md mx-auto",children:e.jsx(Pe,{data:q,options:{plugins:{legend:{position:"bottom",labels:{color:"rgba(255,255,255,0.8)",padding:15}},tooltip:{callbacks:{label:N=>{const B=N.label||"",U=N.parsed||0,L=N.dataset.data.reduce((k,p)=>k+p,0),S=L>0?(U/L*100).toFixed(1):0;return`${B}: ${U} orders (${S}%)`}}}}}})}),C&&e.jsx("div",{className:"mt-4 p-4 bg-red-500/10 rounded-lg border border-red-500/20",children:e.jsxs("p",{className:"text-red-300 font-medium flex items-center gap-2",children:[e.jsx("span",{children:"âš ï¸"})," High dependency on a few retailers. Consider diversifying your reach."]})})]})]})},Ie=({distributorId:j})=>{const[w,I]=b.useState([]);b.useEffect(()=>{j&&(async()=>{const q=Z(_,"businesses",j,"orderRequests"),N=await J(q),B={};N.forEach(L=>{const S=L.data();S.status==="Delivered"&&Array.isArray(S.items)&&S.items.forEach(k=>{const p=k.brand||"Unknown",D=parseInt(k.quantity)||0,T=(k.unitPrice||0)*D,A=(k.price||0)*D,h=T-A;B[p]||(B[p]={quantity:0,revenue:0,profit:0}),B[p].quantity+=D,B[p].revenue+=T,B[p].profit+=h})});const U=Object.entries(B).map(([L,S])=>({brand:L,...S}));U.sort((L,S)=>S.profit-L.profit),I(U)})()},[j]);const C=M=>`â‚¹${Number(M||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`;return e.jsxs("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“Š"})," Brand Performance Tracker"]}),w.length===0?e.jsx("p",{className:"text-white/60",children:"No brand data available."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b border-white/20",children:[e.jsx("th",{className:"py-2 px-3 text-white/80",children:"Brand"}),e.jsx("th",{className:"py-2 px-3 text-right text-white/80",children:"Units Sold"}),e.jsx("th",{className:"py-2 px-3 text-right text-white/80",children:"Revenue"}),e.jsx("th",{className:"py-2 px-3 text-right text-white/80",children:"Profit"}),e.jsx("th",{className:"py-2 px-3 text-right text-white/80",children:"Margin %"})]})}),e.jsx("tbody",{children:w.map((M,q)=>{const N=M.revenue>0?M.profit/M.revenue*100:0;return e.jsxs("tr",{className:"border-b border-white/10 hover:bg-white/5",children:[e.jsx("td",{className:"py-2 px-3 text-white font-medium",children:M.brand}),e.jsx("td",{className:"py-2 px-3 text-right text-white",children:M.quantity.toLocaleString("en-IN")}),e.jsx("td",{className:"py-2 px-3 text-right text-emerald-400 font-semibold",children:C(M.revenue)}),e.jsx("td",{className:"py-2 px-3 text-right text-purple-400 font-semibold",children:C(M.profit)}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${N>=20?"bg-emerald-500/20 text-emerald-300":N>=10?"bg-blue-500/20 text-blue-300":"bg-amber-500/20 text-amber-300"}`,children:[N.toFixed(1),"%"]})})]},q)})})]})})]})},_e=({distributorId:j})=>{const{t:w}=Se(),[I,C]=b.useState("overview"),[M,q]=b.useState({start:u().subtract(30,"day").format("YYYY-MM-DD"),end:u().format("YYYY-MM-DD")}),[N,B]=b.useState({brand:"",category:"",retailerType:"",state:"",minRevenue:0,minProfit:0}),[U,L]=b.useState({totalOrders:0,totalRevenue:0,totalProfit:0,activeRetailers:0,totalProducts:0}),[S,k]=b.useState(!0),[p,D]=b.useState([]),[T,A]=b.useState([]),[h,P]=b.useState([]),o=d=>d?.chargesSnapshot?.breakdown?.grandTotal?Number(d.chargesSnapshot.breakdown.grandTotal):d?.proforma?.grandTotal?Number(d.proforma.grandTotal):d?.items&&Array.isArray(d.items)?d.items.reduce((O,i)=>{const x=Number(i.sellingPrice||i.price||i.unitPrice||0),R=Number(i.quantity||i.qty||0);return O+x*R},0):0;b.useEffect(()=>{if(!j)return;k(!0);const d=[],O=te(Z(_,`businesses/${j}/orderRequests`),x=>{const R=x.docs.map(Y=>({id:Y.id,...Y.data()}));D(R)},x=>{console.error("[DistributorAnalytics] Error fetching orders:",x),D([])});d.push(O);const i=te(Z(_,`businesses/${j}/connectedRetailers`),x=>{const R=x.docs.map(Y=>({id:Y.id,...Y.data(),type:"connected"}));J(Z(_,`businesses/${j}/provisionalRetailers`)).then(Y=>{const s=Y.docs.map(t=>({id:t.id,...t.data(),type:"provisional"}));A([...R,...s])}).catch(Y=>{console.error("[DistributorAnalytics] Error fetching provisional retailers:",Y),A(R)})},x=>{console.error("[DistributorAnalytics] Error fetching retailers:",x),A([])});return d.push(i),J(Z(_,`businesses/${j}/products`)).then(x=>{const R=x.docs.map(Y=>({id:Y.id,...Y.data()}));P(R)}).catch(x=>{console.error("[DistributorAnalytics] Error fetching products:",x),P([])}).finally(()=>{k(!1)}),()=>{d.forEach(x=>x())}},[j]),b.useEffect(()=>{if(p.length===0&&T.length===0&&h.length===0){S||L({totalOrders:0,totalRevenue:0,totalProfit:0,activeRetailers:0,totalProducts:0});return}const d=p,O=d.filter(s=>s.status==="Delivered"||s.statusCode==="DELIVERED"||s.status==="delivered"||s.statusCode==="delivered"),i=O.reduce((s,t)=>{const r=o(t);return s+r},0),x=O.reduce((s,t)=>{const r=o(t);if(t.items&&Array.isArray(t.items)){const a=t.items.reduce((n,l)=>{const m=Number(l.sellingPrice||l.price||l.unitPrice||0),g=Number(l.costPrice||l.distributorPrice||0),v=Number(l.quantity||l.qty||0);return n+(m-g)*v},0);return s+a}return s+r*.15},0),R=new Set,Y=u().subtract(30,"day");d.forEach(s=>{if(u(s.timestamp?.toDate?.()||s.timestamp||s.createdAt?.toDate?.()||s.createdAt||new Date).isAfter(Y)){const r=s.retailerId||s.provisionalRetailerId;r&&R.add(r)}}),L({totalOrders:O.length,totalRevenue:i,totalProfit:x,activeRetailers:R.size,totalProducts:h.length})},[p,T,h,S]);const c=[{id:"overview",label:w("analytics.overview"),icon:"ðŸ“Š"},{id:"products",label:w("analytics.products"),icon:"ðŸ“¦"},{id:"retailers",label:w("analytics.retailers"),icon:"ðŸª"},{id:"revenue",label:w("analytics.revenueProfit"),icon:"ðŸ’°"},{id:"categories",label:w("analytics.categoriesBrands"),icon:"ðŸ·ï¸"},{id:"insights",label:w("analytics.advancedInsights"),icon:"ðŸ”"}],f={hidden:{opacity:1},show:{opacity:1,transition:{delayChildren:.1,staggerChildren:.08}}};return e.jsxs("div",{className:"w-full",children:[e.jsx("style",{children:`
        .vignette { position: relative; }
        .vignette:before { content: ""; position: absolute; inset: 0; border-radius: 0.75rem; pointer-events: none; box-shadow: inset 0 0 120px rgba(0,0,0,.18); }
        .vignette:after { content: ""; position: absolute; inset: 0; border-radius: 0.75rem; pointer-events: none; box-shadow: inset 0 1px 0 rgba(255,255,255,.08); }
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        .animate-shimmer {
          background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
          background-size: 1000px 100%;
          animation: shimmer 3s infinite;
        }
      `}),e.jsxs("div",{className:"w-full space-y-6",children:[e.jsx(X.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-2",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-white via-white to-emerald-200 mb-2 tracking-tight",children:w("analytics.title")}),e.jsx("p",{className:"text-white/60 text-sm md:text-base",children:w("analytics.subtitle")}),e.jsx(X.div,{initial:{scaleX:0,opacity:0},animate:{scaleX:1,opacity:1},transition:{delay:.3,duration:.6},className:"h-px w-32 origin-left bg-gradient-to-r from-emerald-300/60 to-transparent mt-2"})]})}),e.jsx(X.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2,duration:.4},className:"sticky top-0 z-20 bg-[#0B1220]/90 backdrop-blur-xl border-b border-white/10 pb-2 -mx-4 md:-mx-6 px-4 md:px-6 pt-2 shadow-lg",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(d=>e.jsxs(X.button,{onClick:()=>C(d.id),whileHover:{scale:1.05},whileTap:{scale:.98},className:`relative px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-300 ${I===d.id?"bg-gradient-to-r from-emerald-500 to-emerald-600 text-white shadow-lg shadow-emerald-500/30 ring-2 ring-emerald-400/20":"bg-white/5 text-white/80 hover:bg-white/10 hover:text-white border border-white/10"}`,children:[e.jsx("span",{className:"mr-2",children:d.icon}),d.label,I===d.id&&e.jsx(X.div,{layoutId:"activeTab",className:"absolute inset-0 rounded-lg bg-gradient-to-r from-emerald-500/20 to-emerald-600/20 -z-10",transition:{type:"spring",bounce:.2,duration:.6}})]},d.id))})}),e.jsx("div",{className:"mt-6",children:e.jsx(Re,{mode:"wait",children:S&&I==="overview"?e.jsx(X.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-8 text-center text-white/60 vignette",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-pulse"}),e.jsx("span",{children:w("analytics.loadingAnalytics")})]})},"loading"):e.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[I==="overview"&&e.jsx(Me,{distributorId:j,dateRange:M}),I==="products"&&e.jsx(ke,{distributorId:j,dateRange:M,filters:N,onDateRangeChange:q,onFiltersChange:d=>B({...N,...d})}),I==="retailers"&&e.jsx(Ye,{distributorId:j,dateRange:M,filters:N,onDateRangeChange:q,onFiltersChange:d=>B({...N,...d})}),I==="revenue"&&e.jsx(Ce,{distributorId:j,dateRange:M,filters:N,onDateRangeChange:q}),I==="categories"&&e.jsx(Ae,{distributorId:j,dateRange:M,filters:N,onDateRangeChange:q}),I==="insights"&&e.jsxs(X.div,{variants:f,initial:"hidden",animate:"show",className:"space-y-4",children:[e.jsx(Oe,{distributorId:j}),e.jsx(Ee,{distributorId:j}),e.jsx(Le,{distributorId:j}),e.jsx(Ie,{distributorId:j})]})]},I)})})]})]})};export{_e as default};
