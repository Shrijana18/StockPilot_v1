import{D as J,d as te,j as e,b as o,C as X,E as Se,F as we,G as U,e as Ae,H as je}from"./index-DRC3F7i0.js";import{r as c,u as Ce}from"./router-BPBaD_i0.js";import{P as Te}from"./POSBilling-BOIPLYLF.js";import{F as ie,m as ke,C as Ue,as as Me,Z as Le,at as Fe,u as Z,I as Ie,ac as Ne,K as pe,p as le,a1 as ve,ar as Pe,au as Re,s as De,L as Oe,aH as he,ae as _e,aI as $e,ao as Be,ai as ze,T as ne,k as xe,a2 as ue}from"./index-CprmGC-M.js";import{u as qe,G as He,M as Ee,D as We}from"./esm-LCaBFwtY.js";import{s as Ge,b as Ke,m as Ve,c as Qe}from"./deliveryEmployeeService-DSIf8GOm.js";import{c as ce,q as be,o as Ye,p as ye,u as Ze,d as G,l as de,s as se,b as Je,w as ge,e as fe,t as Xe,f as et,h as tt,v as st,g as rt}from"./firebase-DWi1MSv1.js";import{m as R}from"./proxy-BgUy8BPw.js";import{l as at}from"./authUtils-CTtBfGOB.js";import{httpsCallable as ot}from"./index.esm-Bux_mLJ0.js";import"./vendor-Ckhrjn13.js";import"./index-aK8Jn4kw.js";import"./CustomerForm-oVhzeonX.js";import"./index-DSciU07p.js";const lt=({order:n,employee:N,onClose:v})=>{const D=J(),[B,L]=c.useState([]),[O,I]=c.useState(""),[z,S]=c.useState(!1),[F,u]=c.useState(!0),g=c.useRef(null),E=c.useRef(null),K=()=>{g.current?.scrollIntoView({behavior:"smooth"})};c.useEffect(()=>{K()},[B]),c.useEffect(()=>{if(!n?.orderId&&!n?.id)return;const m=n.orderId||n.id;(async()=>{const i=G(te,"orderChats",m);try{await de(i,{orderId:m,orderNumber:n.orderData?.orderNumber||m.slice(-8),customerId:n.orderData?.customerId||n.customerId,customerName:n.orderData?.customerName||n.customerName||"Customer",customerPhone:n.orderData?.customerPhone||n.customerPhone,storeId:D?.retailerId,storeName:n.orderData?.storeName||"Store",deliveryAgent:{id:D?.employeeId,name:N?.name||"Delivery Agent",flypEmployeeId:N?.flypEmployeeId||D?.employeeId},createdAt:se()},{merge:!0})}catch(f){console.error("Error initializing chat:",f)}})();const $=ce(te,"orderChats",m,"messages"),q=be($,Ye("createdAt","asc")),a=ye(q,i=>{const f=i.docs.map(C=>({id:C.id,...C.data(),createdAt:C.data().createdAt?.toDate()||new Date}));L(f);const b=f.filter(C=>C.senderType==="customer"&&!C.read);b.length>0&&b.forEach(C=>{Ze(G(te,"orderChats",m,"messages",C.id),{read:!0}).catch(console.error)})},i=>{console.error("Error fetching chat:",i)});return()=>a()},[n?.orderId,n?.id,D,N]);const W=async()=>{if(!O.trim()||z)return;const m=O.trim();I(""),S(!0);try{const j=n.orderId||n.id,$=ce(te,"orderChats",j,"messages");await Je($,{text:m,senderId:D?.employeeId||o.currentUser?.uid||"employee",senderName:N?.name||"Delivery Agent",senderType:"delivery",createdAt:se(),read:!1});const q=G(te,"orderChats",j);await de(q,{lastMessage:m,lastMessageAt:se(),lastMessageBy:"delivery"},{merge:!0})}catch(j){console.error("Error sending message:",j),I(m)}finally{S(!1),E.current?.focus()}},re=m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),W())},p=m=>m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),ee=["I'm on my way","Arriving in 5 minutes","I'm at your location","Please come to collect","Unable to reach you","Call me when you're ready"],_=n.orderData?.customerName||n.customerName||"Customer",V=n.orderData?.customerPhone||n.customerPhone,ae=n.orderId||n.id;return e.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:v,children:e.jsxs(R.div,{initial:{scale:.95,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.95,opacity:0,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"bg-slate-900 rounded-2xl w-full max-w-md h-[85vh] max-h-[700px] flex flex-col overflow-hidden shadow-2xl border border-white/10",onClick:m=>m.stopPropagation(),children:[e.jsx("div",{className:"bg-gradient-to-r from-cyan-600 to-emerald-500 px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-full bg-white/20 flex items-center justify-center text-white text-lg",children:_?.charAt(0)?.toUpperCase()||e.jsx(ie,{})}),e.jsxs("div",{className:"text-white",children:[e.jsx("h3",{className:"font-semibold text-base",children:_}),e.jsxs("p",{className:"text-xs text-white/70",children:["Order #",n.orderData?.orderNumber||ae?.slice(-8)?.toUpperCase()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[V&&e.jsx("a",{href:`tel:${V}`,className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-white hover:bg-white/30 transition-all hover:scale-105",title:"Call customer",children:e.jsx(ke,{className:"text-sm"})}),e.jsx("button",{onClick:v,className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-white hover:bg-red-500/50 transition-all hover:scale-105",children:e.jsx(Ue,{})})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 bg-slate-800/50",style:{backgroundImage:"radial-gradient(circle at 50% 50%, rgba(6, 182, 212, 0.03) 0%, transparent 50%)"},children:B.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center px-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-cyan-500/20 to-emerald-500/20 flex items-center justify-center mb-4",children:e.jsx(ie,{className:"text-3xl text-cyan-400/60"})}),e.jsx("h3",{className:"font-semibold text-white text-lg mb-2",children:"Start the conversation"}),e.jsx("p",{className:"text-sm text-white/50 max-w-xs leading-relaxed",children:"Coordinate delivery with the customer"})]}):e.jsxs("div",{className:"space-y-4",children:[B.map(m=>{const j=m.senderType==="customer";return m.senderType,e.jsx(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${j?"justify-start":"justify-end"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-2xl px-4 py-3 shadow-md ${j?"bg-slate-700 text-white rounded-tl-sm":"bg-gradient-to-br from-cyan-500 to-cyan-600 text-white rounded-tr-sm"}`,children:[e.jsx("p",{className:`text-xs font-medium mb-1 ${j?"text-emerald-400":"text-white/80"}`,children:j?m.senderName||"Customer":m.senderName||"You"}),e.jsx("p",{className:"text-sm leading-relaxed",children:m.text}),e.jsxs("div",{className:`flex items-center justify-end gap-1.5 mt-2 ${j?"text-white/50":"text-white/70"}`,children:[e.jsx("span",{className:"text-[10px]",children:p(m.createdAt)}),!j&&(m.read?e.jsx(Me,{className:"text-[10px]"}):e.jsx(Le,{className:"text-[10px]"}))]})]})},m.id)}),e.jsx("div",{ref:g})]})}),F&&e.jsxs("div",{className:"px-3 py-2 bg-slate-800 border-t border-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-[10px] text-white/40 uppercase tracking-wide",children:"Quick Replies"}),e.jsx("button",{onClick:()=>u(!1),className:"text-white/30 hover:text-white/60 text-xs",children:"Hide"})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 scrollbar-hide",children:ee.map((m,j)=>e.jsx("button",{onClick:()=>{I(m),u(!1),E.current?.focus()},className:"px-3 py-1.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-full text-xs text-white/70 whitespace-nowrap transition-all hover:border-cyan-500/50 hover:text-cyan-400",children:m},j))})]}),e.jsx("div",{className:"bg-slate-900 border-t border-white/10 px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[!F&&e.jsx("button",{onClick:()=>u(!0),className:"w-10 h-10 rounded-xl bg-white/5 hover:bg-white/10 flex items-center justify-center text-white/50 hover:text-white/80 transition-all text-lg",title:"Quick replies",children:"‚ö°"}),e.jsx("div",{className:"flex-1 relative",children:e.jsx("input",{ref:E,type:"text",value:O,onChange:m=>I(m.target.value),onKeyPress:re,onFocus:()=>u(!1),placeholder:"Type a message...",className:"w-full px-4 py-3 bg-white/5 rounded-xl text-white placeholder-white/30 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 border border-white/10 focus:border-cyan-500/50 transition-all text-sm"})}),e.jsx("button",{onClick:W,disabled:!O.trim()||z,className:`w-11 h-11 rounded-xl flex items-center justify-center transition-all ${O.trim()?"bg-gradient-to-br from-cyan-500 to-cyan-600 text-white shadow-lg shadow-cyan-500/30 hover:shadow-cyan-500/50 hover:scale-105":"bg-white/5 text-white/30 cursor-not-allowed"}`,children:e.jsx(Fe,{className:`text-sm ${z?"animate-pulse":""}`})})]})})]})})},nt="AIzaSyBPkkXZWll0VifG5kb0DDSsoV5UB-n5pFE",it=["places","geometry"],ct={width:"100%",height:"250px",borderRadius:"8px"},dt=()=>{const n=J(),N=n?.retailerId||"",v=n?.employeeId||"",[D,B]=c.useState([]),[L,O]=c.useState([]),[I,z]=c.useState(!0),[S,F]=c.useState(null),[u,g]=c.useState(null),[E,K]=c.useState(!1),[W,re]=c.useState(!1),[p,ee]=c.useState(null),[_,V]=c.useState({}),[ae,m]=c.useState({}),[j,$]=c.useState({}),[q,a]=c.useState(null),[i,f]=c.useState({}),{isLoaded:b,loadError:C}=qe({id:"google-map-script-delivery",googleMapsApiKey:nt,libraries:it});c.useEffect(()=>{const t=()=>re(window.innerWidth<768);return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),c.useEffect(()=>{(async()=>{if(N)try{const r=G(X,"stores",N),d=await fe(r);if(d.exists()){const s=d.data();s.location&&ee({lat:s.location.latitude||s.location._lat,lng:s.location.longitude||s.location._long})}}catch(r){console.error("Error fetching store location:",r)}})()},[N]);const Q=(t,r,d,s)=>{if(!t||!r||!d||!s)return null;const l=6371,w=(d-t)*Math.PI/180,A=(s-r)*Math.PI/180,x=Math.sin(w/2)*Math.sin(w/2)+Math.cos(t*Math.PI/180)*Math.cos(d*Math.PI/180)*Math.sin(A/2)*Math.sin(A/2),T=2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));return l*T};c.useEffect(()=>{if(!p||D.length===0)return;const t={};D.forEach(r=>{const d=r.orderData?.deliveryAddress?.lat||r.orderData?.deliveryAddress?.latitude,s=r.orderData?.deliveryAddress?.lng||r.orderData?.deliveryAddress?.longitude;if(d&&s){const l=Q(p.lat,p.lng,d,s);l!==null&&(t[r.orderId]={distance:Math.round(l*10)/10,estimatedTime:Math.round(l*2)})}}),V(t)},[p,D]);const P=(t,r,d,s)=>{if(!(!b||!p||!r||!d||!window.google?.maps)&&!j[t])try{const l=new window.google.maps.DirectionsService,w=new window.google.maps.LatLng(p.lat,p.lng),A=new window.google.maps.LatLng(r,d);l.route({origin:w,destination:A,travelMode:window.google.maps.TravelMode.BICYCLING},(x,T)=>{if(T==="OK"&&x){if($(M=>({...M,[t]:x})),s&&x.routes&&x.routes[0]){const M=new window.google.maps.LatLngBounds;x.routes[0].legs.forEach(oe=>{M.extend(oe.start_location),M.extend(oe.end_location)}),s.fitBounds(M)}}else console.warn("Directions request failed:",T),T==="REQUEST_DENIED"?(console.error("‚ùå Directions API is not enabled. Enable it at: https://console.cloud.google.com/apis/library/directions-backend.googleapis.com?project=stockpilotv1"),console.error("Without Directions API, the route will not follow real roads.")):T==="ZERO_RESULTS"?console.warn("No route found. This might be because the locations are too close or unreachable by bike."):console.error("Directions API error:",T)})}catch(l){console.error("Error calculating route:",l)}},H=(t,r)=>!p||!t||!r?null:`https://www.google.com/maps/dir/?api=1&origin=${p.lat},${p.lng}&destination=${t},${r}`;c.useEffect(()=>{if(!N||!v){z(!1);return}const t=v.toUpperCase().startsWith("EMP-")?v.toUpperCase():v,r=Ge(N,t,d=>{B(d),z(!1)});return()=>r()},[N,v]),c.useEffect(()=>{!N||!v||!E||Ke(N,v,20).then(t=>{O(t)}).catch(t=>{console.error("Error loading delivery history:",t)})},[N,v,E]),c.useEffect(()=>{if(!D.length)return;const t=D.map(r=>{const d=r.orderId,s=ce(X,"orderChats",d,"messages"),l=be(s,ge("senderType","==","customer"),ge("read","==",!1));return ye(l,w=>{const A=w.size;f(x=>({...x,[d]:A}))},w=>{console.error(`Error tracking unread messages for order ${d}:`,w)})});return()=>{t.forEach(r=>r())}},[D]);const me=async t=>{try{g(t),await Ve(N,t,v),g(null)}catch(r){console.error("Error marking order as picked up:",r),alert(r.message||"Failed to mark order as picked up"),g(null)}},k=async t=>{if(window.confirm("Confirm delivery of this order?"))try{g(t),await Qe(N,t,v,{notes:"",signature:null,photo:null}),g(null),F(null)}catch(r){console.error("Error marking order as delivered:",r),alert(r.message||"Failed to mark order as delivered"),g(null)}},Y=t=>{if(!t)return"No address";const r=[t.addressLine1,t.addressLine2,t.landmark,t.city,t.state,t.pincode].filter(Boolean);return r.length>0?r.join(", "):"Address not available"},h=t=>({assigned:{label:"Assigned",color:"yellow",bg:"bg-yellow-500/20",text:"text-yellow-300",border:"border-yellow-500/40"},picked_up:{label:"Picked Up",color:"cyan",bg:"bg-cyan-500/20",text:"text-cyan-300",border:"border-cyan-500/40"},out_for_delivery:{label:"Out for Delivery",color:"cyan",bg:"bg-cyan-500/20",text:"text-cyan-300",border:"border-cyan-500/40"},delivered:{label:"Delivered",color:"green",bg:"bg-emerald-500/20",text:"text-emerald-300",border:"border-emerald-500/40"}})[t]||{label:t,color:"gray",bg:"bg-gray-500/20",text:"text-gray-300",border:"border-gray-500/40"},y=t=>t?(t.toDate?t.toDate():new Date(t)).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"";return!N||!v?e.jsx("div",{className:"p-6 text-center text-white/60",children:e.jsx("p",{className:"text-sm",children:"Employee session not found. Please login again."})}):I?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx(Z,{className:"animate-spin text-emerald-400 text-2xl"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(Ie,{className:"text-emerald-400"}),"My Deliveries"]}),e.jsx("p",{className:"text-xs text-white/60 mt-0.5",children:"Manage your assigned orders"})]}),e.jsxs("button",{onClick:()=>K(!E),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition ${E?"bg-emerald-500 text-white":"bg-white/5 text-white/70 hover:bg-white/10 border border-white/10"}`,children:[e.jsx(Ne,{className:"inline mr-1.5"}),E?"Active":"History"]})]}),!E&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"p-3 rounded-xl border border-cyan-500/20 bg-cyan-500/10 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(pe,{className:"text-cyan-400 text-xs"}),e.jsx("span",{className:"text-xs text-white/60",children:"Active"})]}),e.jsx("p",{className:"text-xl font-bold text-cyan-400",children:D.length})]}),e.jsxs("div",{className:"p-3 rounded-xl border border-emerald-500/20 bg-emerald-500/10 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(le,{className:"text-emerald-400 text-xs"}),e.jsx("span",{className:"text-xs text-white/60",children:"Delivered"})]}),e.jsx("p",{className:"text-xl font-bold text-emerald-400",children:L.length})]})]}),!E&&e.jsx("div",{className:"space-y-3",children:D.length===0?e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/5 rounded-xl p-8 text-center border border-white/10",children:[e.jsx(ve,{className:"text-4xl text-white/20 mx-auto mb-3"}),e.jsx("p",{className:"text-white/60 text-sm",children:"No active deliveries assigned"}),e.jsx("p",{className:"text-white/40 text-xs mt-1",children:"New orders will appear here"})]}):D.map(t=>{const r=h(t.status),d=t.status==="assigned"?pe:t.status==="picked_up"||t.status==="out_for_delivery"?Pe:le;return e.jsxs(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white/5 rounded-xl border border-white/10 hover:border-emerald-500/50 transition-all overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs font-semibold ${r.bg} ${r.text} ${r.border} border flex items-center gap-1.5`,children:[e.jsx(d,{className:"text-xs"}),r.label]}),e.jsxs("span",{className:"text-white/40 text-xs",children:["#",t.orderData?.orderNumber||t.orderId.slice(-8)]})]}),e.jsxs("div",{className:"text-2xl font-bold text-emerald-400",children:["‚Çπ",t.orderData?.total||0]})]}),e.jsxs("button",{onClick:()=>a(t),className:"relative p-2.5 rounded-lg bg-cyan-500/20 hover:bg-cyan-500/30 border border-cyan-500/30 hover:border-cyan-500/50 transition-all flex items-center justify-center group",title:"Chat with customer",children:[e.jsx(Re,{className:"text-cyan-400 text-sm"}),i[t.orderId]>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-[10px] font-bold border-2 border-slate-900",children:i[t.orderId]>9?"9+":i[t.orderId]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 text-white/70",children:[e.jsx(ie,{className:"text-white/40 text-xs"}),e.jsx("span",{className:"truncate",children:t.orderData?.customerName||"Customer"})]}),t.orderData?.customerPhone&&e.jsxs("a",{href:`tel:${t.orderData.customerPhone}`,className:"flex items-center gap-2 text-cyan-400 hover:text-cyan-300 transition",children:[e.jsx(ke,{className:"text-xs"}),e.jsx("span",{className:"truncate",children:t.orderData.customerPhone})]}),e.jsxs("div",{className:"flex items-start gap-2 text-white/70 sm:col-span-2",children:[e.jsx(De,{className:"text-white/40 text-xs mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-2",children:Y(t.orderData?.deliveryAddress)})]})]})]}),(()=>{const s=t.orderData?.deliveryAddress?.lat||t.orderData?.deliveryAddress?.latitude,l=t.orderData?.deliveryAddress?.lng||t.orderData?.deliveryAddress?.longitude,w=_[t.orderId],A=H(s,l);return!s||!l||!p?null:e.jsxs("div",{className:"px-4 py-3 bg-white/5 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"text-emerald-400 text-sm"}),e.jsx("span",{className:"text-xs font-semibold text-white",children:"Route Information"})]}),A&&e.jsxs("a",{href:A,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-cyan-400 hover:text-cyan-300 flex items-center gap-1 transition",children:[e.jsx(he,{className:"text-xs"}),W?"Route":"Full Route"]})]}),w?e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-2",children:[e.jsx("div",{className:"text-white/60 text-xs mb-0.5",children:"Distance"}),e.jsxs("div",{className:"text-emerald-400 font-bold text-sm",children:[w.distance," km"]})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-2",children:[e.jsx("div",{className:"text-white/60 text-xs mb-0.5",children:"Est. Time"}),e.jsxs("div",{className:"text-cyan-400 font-bold text-sm",children:["~",w.estimatedTime," min"]})]})]}):e.jsxs("div",{className:"mb-3 text-xs text-white/50 flex items-center gap-2",children:[e.jsx(Z,{className:"animate-spin text-xs"}),e.jsx("span",{children:"Calculating distance..."})]}),(()=>{const x=t.orderData?.deliveryAddress?.lat||t.orderData?.deliveryAddress?.latitude,T=t.orderData?.deliveryAddress?.lng||t.orderData?.deliveryAddress?.longitude;if(!p||!x||!T)return null;const M={lat:(p.lat+parseFloat(x))/2,lng:(p.lng+parseFloat(T))/2};return e.jsxs("div",{className:"rounded-lg overflow-hidden border border-white/10",children:[C?e.jsxs("div",{className:"w-full h-48 bg-slate-800 flex flex-col items-center justify-center",children:[e.jsx(De,{className:"text-white/30 text-2xl mb-2"}),e.jsx("div",{className:"text-white/50 text-xs text-center px-4 mb-2",children:"Error loading map. Check API key."}),A&&e.jsxs("a",{href:A,target:"_blank",rel:"noopener noreferrer",className:"text-cyan-400 hover:text-cyan-300 text-xs flex items-center gap-1",children:[e.jsx(he,{className:"text-xs"}),"Open in Maps"]})]}):b?e.jsxs("div",{className:"relative",children:[e.jsxs(He,{mapContainerStyle:ct,center:M,zoom:13,onLoad:oe=>{setTimeout(()=>{P(t.orderId,x,T,oe)},500)},options:{zoomControl:!0,streetViewControl:!1,mapTypeControl:!0,fullscreenControl:!0,panControl:!0,disableDefaultUI:!1,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]},children:[e.jsx(Ee,{position:{lat:p.lat,lng:p.lng},icon:{url:"https://maps.google.com/mapfiles/ms/icons/green-dot.png",scaledSize:new window.google.maps.Size(40,40)},title:"Store Location",label:{text:"S",color:"white",fontWeight:"bold"}}),e.jsx(Ee,{position:{lat:parseFloat(x),lng:parseFloat(T)},icon:{url:"https://maps.google.com/mapfiles/ms/icons/red-dot.png",scaledSize:new window.google.maps.Size(40,40)},title:"Customer Location",label:{text:"D",color:"white",fontWeight:"bold"}}),j[t.orderId]?e.jsx(We,{directions:j[t.orderId],options:{suppressMarkers:!1,polylineOptions:{strokeColor:"#10b981",strokeWeight:5,strokeOpacity:.8},markerOptions:{visible:!1}}}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm z-10 rounded-lg",children:e.jsxs("div",{className:"bg-slate-800 rounded-lg px-3 py-2 flex items-center gap-2",children:[e.jsx(Z,{className:"animate-spin text-emerald-400 text-sm"}),e.jsx("span",{className:"text-white/80 text-xs",children:"Calculating bike route..."})]})})]}),w&&e.jsx("div",{className:"absolute top-2 right-2 bg-slate-900/90 backdrop-blur-sm rounded-lg px-2 py-1 text-xs z-10",children:e.jsxs("span",{className:"text-emerald-400 font-semibold",children:[w.distance," km"]})})]}):e.jsx("div",{className:"w-full h-48 bg-slate-800 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Z,{className:"animate-spin text-emerald-400 text-2xl mx-auto mb-2"}),e.jsx("p",{className:"text-white/60 text-xs",children:"Loading map..."})]})}),e.jsxs("div",{className:"px-2 py-1.5 bg-slate-900/70 flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsx("span",{className:"text-white/70",children:"Store"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsx("span",{className:"text-white/70",children:"Customer"})]})]}),A&&e.jsxs("a",{href:A,target:"_blank",rel:"noopener noreferrer",className:"text-cyan-400 hover:text-cyan-300 flex items-center gap-1 transition",children:[W?"Maps":"Open in Maps",e.jsx(_e,{className:"text-xs"})]})]})]})})()]})})(),t.orderData?.items&&t.orderData.items.length>0&&e.jsxs("div",{className:"px-4 py-3 bg-white/5 border-b border-white/10",children:[e.jsxs("div",{className:"text-xs text-white/60 mb-2",children:["Items (",t.orderData.items.length,"):"]}),e.jsxs("div",{className:"space-y-1.5",children:[t.orderData.items.slice(0,2).map((s,l)=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-white/80 truncate flex-1",children:[s.quantity,"x ",s.name]}),e.jsxs("span",{className:"text-white/60 ml-2",children:["‚Çπ",s.total||s.price*s.quantity]})]},l)),t.orderData.items.length>2&&e.jsxs("div",{className:"text-white/40 text-xs pt-1",children:["+",t.orderData.items.length-2," more items"]})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex gap-2",children:[t.status==="assigned"&&e.jsx("button",{onClick:()=>me(t.orderId),disabled:u===t.orderId,className:"flex-1 px-4 py-2.5 bg-cyan-500 hover:bg-cyan-600 text-white font-medium rounded-lg transition disabled:opacity-50 flex items-center justify-center gap-2 text-sm",children:u===t.orderId?e.jsx(Z,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{}),"Pick Up"]})}),(t.status==="picked_up"||t.status==="out_for_delivery")&&e.jsxs(e.Fragment,{children:[t.orderData?.deliveryAddress?.lat&&t.orderData?.deliveryAddress?.lng&&e.jsxs("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${t.orderData.deliveryAddress.lat},${t.orderData.deliveryAddress.lng}`,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2.5 bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-lg transition flex items-center justify-center gap-2 text-sm",children:[e.jsx(he,{}),W?"Route":"Directions"]}),e.jsx("button",{onClick:()=>k(t.orderId),disabled:u===t.orderId,className:"flex-1 px-4 py-2.5 bg-emerald-500 hover:bg-emerald-600 text-white font-medium rounded-lg transition disabled:opacity-50 flex items-center justify-center gap-2 text-sm",children:u===t.orderId?e.jsx(Z,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(le,{}),"Deliver"]})})]})]}),t.assignedAt&&e.jsxs("div",{className:"text-white/40 text-xs mt-3 text-center",children:["Assigned: ",y(t.assignedAt)]})]})]},t.id)})}),E&&e.jsx("div",{className:"space-y-3",children:L.length===0?e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/5 rounded-xl p-8 text-center border border-white/10",children:[e.jsx(Ne,{className:"text-4xl text-white/20 mx-auto mb-3"}),e.jsx("p",{className:"text-white/60 text-sm",children:"No delivery history"})]}):L.map(t=>e.jsx(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white/5 rounded-xl p-4 border border-white/10 hover:border-emerald-500/30 transition",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(le,{className:"text-emerald-400 text-sm"}),e.jsxs("span",{className:"text-white font-medium text-sm",children:["Order #",t.orderData?.orderNumber||t.orderId.slice(-8)]})]}),e.jsxs("div",{className:"text-lg font-bold text-emerald-400 mb-1",children:["‚Çπ",t.orderData?.total||0]}),e.jsx("div",{className:"text-white/60 text-xs line-clamp-1",children:Y(t.orderData?.deliveryAddress)})]}),t.deliveredAt&&e.jsx("div",{className:"text-white/40 text-xs text-right ml-3",children:e.jsx("div",{children:y(t.deliveredAt)})})]})},t.id))}),q&&e.jsx(lt,{order:q,employee:{name:n?.name||"Employee",flypEmployeeId:n?.flypEmployeeId||v},onClose:()=>a(null)})]})},Et=()=>{const[n,N]=c.useState(null),[v,D]=c.useState(new Date),B=J(),L=B?.retailerId||"",O=B?.employeeId||"",[I,z]=c.useState([]),[S,F]=c.useState(""),[u,g]=c.useState(!1),[E,K]=c.useState(!1),[W,re]=c.useState(!1),[p,ee]=c.useState(!1),_=Ce();c.useEffect(()=>{const a=()=>{ee(window.innerWidth<768)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),c.useEffect(()=>{if(!n?.id||!L)return;const a=G(X,"businesses",L,"employees",n.id),i=ye(a,f=>{if(f.exists()){const C=f.data().accessSections||{},Q=Object.entries(C).filter(([P,H])=>H).map(([P])=>({key:P,label:P==="delivery"?"Delivery":P.charAt(0).toUpperCase()+P.slice(1)}));z(Q)}});return()=>i()},[n,L]),c.useEffect(()=>{try{Se()&&we()}catch{}},[]),c.useEffect(()=>{const a=setTimeout(()=>{console.log("[EmployeeDashboard] üîç Checking session and starting load...");const i=J(),f=String(i?.retailerId||"").trim(),b=String(i?.employeeId||"").trim();console.log("[EmployeeDashboard] Session check:",{hasSession:!!i,retailerId:f,retailerIdType:typeof f,employeeId:b,employeeIdType:typeof b,sessionKeys:i?Object.keys(i):[],rawRetailerId:i?.retailerId,rawEmployeeId:i?.employeeId});const C=!!o?.currentUser,Q=typeof window<"u"&&window.Capacitor;if(console.log("[EmployeeDashboard] Auth check:",{hasAuth:C,currentUser:o?.currentUser?.uid||"none",isCapacitor:Q}),!i||!f||!b){console.log("[EmployeeDashboard] ‚ùå Missing session, redirecting to role selection"),U(),u||(g(!0),window.location.href="/");return}if(console.log("[EmployeeDashboard] ‚úÖ Session found, proceeding with load"),!Q&&!C){console.log("[EmployeeDashboard] Missing auth in web version, redirecting to role selection"),U(),u||(g(!0),window.location.href="/");return}let P=null,H=!1;const me=async(h,y)=>{if(H){console.log("[EmployeeDashboard] ‚ö†Ô∏è loadEmployeeData already called, skipping");return}H=!0;const t=String(h||"").trim(),r=String(y||"").trim();if(!t||!r){console.error("[EmployeeDashboard] ‚ùå Invalid parameters for loadEmployeeData:",{retId:t,empId:r,retIdType:typeof t,empIdType:typeof r,originalRetId:h,originalEmpId:y}),U(),u||(g(!0),window.location.href="/");return}if(!o||!o.currentUser){console.error("[EmployeeDashboard] ‚ùå Cannot load data: No auth available",{hasEmpAuth:!!o,hasCurrentUser:!!o?.currentUser}),U(),u||(g(!0),window.location.href="/");return}const d=String(o.currentUser.uid||"").trim();if(!d){console.error("[EmployeeDashboard] ‚ùå Auth UID is invalid:",{currentUser:o.currentUser,uid:o.currentUser?.uid,uidType:typeof o.currentUser?.uid}),U(),u||(g(!0),window.location.href="/");return}console.log("[EmployeeDashboard] üì• Starting to load employee data:",{retId:t,empId:r,retIdType:typeof t,empIdType:typeof r,hasAuth:!!o.currentUser,authUid:d,authUidType:typeof d});try{let s=r,l=G(X,"businesses",t,"employees",r);console.log("[EmployeeDashboard] üîç Attempting to fetch employee doc:",{path:`businesses/${t}/employees/${r}`,hasAuth:!!o.currentUser,authUid:d,authUidType:typeof d});let w;try{w=await fe(l)}catch(x){if(console.error("[EmployeeDashboard] ‚ùå getDoc failed:",x),console.error("[EmployeeDashboard] getDoc error details:",{code:x?.code,message:x?.message,name:x?.name}),x?.code==="permission-denied"&&!o.currentUser)if(console.log("[EmployeeDashboard] üîÑ Permission denied, attempting auth restore and retry..."),await Y())console.log("[EmployeeDashboard] üîÑ Retrying getDoc after auth restore..."),w=await fe(l);else throw x;else throw x}if(w.exists())s=y,console.log("[EmployeeDashboard] ‚úÖ Found employee by document ID");else{console.log("[EmployeeDashboard] üìã Doc not found by ID, querying by flypEmployeeId:",r.toUpperCase());const x=ce(X,"businesses",t,"employees"),T=be(x,ge("flypEmployeeId","==",r.toUpperCase()),st(1)),M=await rt(T);M.empty?console.warn("[EmployeeDashboard] ‚ùå Employee not found by ID or flypEmployeeId"):(l=M.docs[0].ref,s=M.docs[0].id,w=M.docs[0],console.log("[EmployeeDashboard] ‚úÖ Found employee by flypEmployeeId:",s))}if(!w.exists()){console.warn("[EmployeeDashboard] Employee document not found:",{retId:h,empId:y,employeeDocId:s}),U(),u||(g(!0),_("/",{replace:!0}));return}const A=w.data();console.log("[EmployeeDashboard] ‚úÖ Employee data loaded successfully:",{id:s,name:A.name}),N({id:s,...A});try{await de(l,{lastSeen:se(),online:!0},{merge:!0}),console.log("[EmployeeDashboard] ‚úÖ Presence updated")}catch(x){console.warn("Presence update failed (non-fatal):",x)}}catch(s){console.error("[EmployeeDashboard] ‚ùå Failed to load employee:",s),console.error("[EmployeeDashboard] Error details:",{code:s?.code,message:s?.message,stack:s?.stack}),U(),u||(g(!0),_("/",{replace:!0}))}};let k=!1;const Y=async()=>{if(k)return console.warn("[EmployeeDashboard] ‚ö†Ô∏è Auth restoration already in progress, skipping duplicate call"),!1;if(o.currentUser)return console.log("[EmployeeDashboard] ‚úÖ Auth already exists, skipping restore:",o.currentUser.uid),!0;if(k=!0,!i||!b||!f)return console.warn("[EmployeeDashboard] ‚ö†Ô∏è Cannot restore auth: missing session data",{hasSession:!!i,eid:b,rid:f}),k=!1,!1;console.log("[EmployeeDashboard] üîÑ Attempting to restore Firebase authentication...");try{const h=String(f||"").trim(),y=String(b||"").trim();if(!h||!y)return console.error("[EmployeeDashboard] ‚ùå Invalid retailerId or employeeId:",{retailerId:h,employeeId:y,retailerIdType:typeof h,employeeIdType:typeof y}),k=!1,!1;console.log("[EmployeeDashboard] üìû Calling restoreRetailerEmployeeAuth:",{retailerId:h,employeeId:y,retailerIdType:typeof h,employeeIdType:typeof y});const t=ot(Ae,"restoreRetailerEmployeeAuth"),r=new Promise((s,l)=>setTimeout(()=>l(new Error("Auth restore timeout after 10s")),1e4));let d;try{d=await Promise.race([t({retailerId:h,employeeId:y}),r])}catch(s){return console.error("[EmployeeDashboard] ‚ùå Promise.race failed:",s),s?.message?.includes("timeout")&&console.error("[EmployeeDashboard] ‚ùå Auth restore timed out after 10s"),k=!1,!1}if(d.data?.success&&d.data?.customToken){const s=d.data.customToken;if(typeof s!="string"||s.trim().length===0)return console.error("[EmployeeDashboard] ‚ùå Invalid custom token received:",typeof s,s?.length),k=!1,!1;console.log("[EmployeeDashboard] üîë Received custom token, signing in...",{tokenLength:s.length});try{if(!o)return console.error("[EmployeeDashboard] ‚ùå empAuth instance is null/undefined"),k=!1,!1;if(typeof o!="object"||!o.app)return console.error("[EmployeeDashboard] ‚ùå empAuth is not a valid Firebase Auth instance:",{type:typeof o,hasApp:!!o?.app,empAuthKeys:o?Object.keys(o):[]}),k=!1,!1;if(!s||typeof s!="string"||s.trim().length===0)return console.error("[EmployeeDashboard] ‚ùå Token invalid right before signIn:",{hasToken:!!s,type:typeof s,length:s?.length,isEmpty:s?.trim().length===0}),k=!1,!1;if(o.currentUser){console.log("[EmployeeDashboard] ‚ö†Ô∏è Already signed in, signing out first:",o.currentUser.uid);try{await et(o),await new Promise(l=>setTimeout(l,200))}catch(l){console.warn("[EmployeeDashboard] Sign out failed (non-fatal):",l)}}return console.log("[EmployeeDashboard] üîë About to call signInWithCustomToken...",{tokenLength:s.length,tokenPrefix:s.substring(0,20)+"...",authAppName:o.app?.name,authAppId:o.app?.options?.appId,hasCurrentUser:!!o.currentUser}),!o||!s?(console.error("[EmployeeDashboard] ‚ùå CRITICAL: Auth or token became invalid right before signIn!",{hasAuth:!!o,hasToken:!!s}),k=!1,!1):(await tt(o,s),o.currentUser?(console.log("[EmployeeDashboard] ‚úÖ Firebase authentication restored successfully:",o.currentUser.uid),k=!1,!0):(console.error("[EmployeeDashboard] ‚ùå Auth not set after signInWithCustomToken"),k=!1,!1))}catch(l){return k=!1,console.error("[EmployeeDashboard] ‚ùå signInWithCustomToken failed:",l),console.error("[EmployeeDashboard] SignIn error details:",{code:l?.code,message:l?.message,name:l?.name,stack:l?.stack}),l?.code==="auth/argument-error"&&console.error("[EmployeeDashboard] ‚ùå auth/argument-error - This means invalid auth instance or token!",{hasAuth:!!o,authType:typeof o,hasApp:!!o?.app,hasToken:!!s,tokenType:typeof s,tokenLength:s?.length}),!1}}else return console.warn("[EmployeeDashboard] ‚ö†Ô∏è Failed to restore auth:",d.data?.message||"No token received",{success:d.data?.success,hasToken:!!d.data?.customToken}),k=!1,!1}catch(h){return k=!1,console.error("[EmployeeDashboard] ‚ùå Error restoring auth:",h),console.error("[EmployeeDashboard] Error details:",{code:h?.code,message:h?.message,name:h?.name,stack:h?.stack}),!1}};if(!H&&b&&f){const h=setTimeout(()=>{H||(console.error("[EmployeeDashboard] Load timeout after 8s - redirecting to role selection"),U(),u||(g(!0),window.location.href="/"))},8e3);(async()=>{try{console.log("[EmployeeDashboard] üöÄ Starting load sequence:",{hasAuth:!!o.currentUser,retailerId:f,employeeId:b});const y=typeof window<"u"&&window.Capacitor,t=o?.currentUser&&o.currentUser.uid,r=i?.ts?Date.now()-i.ts:1/0,d=r<5e3;if(t)console.log("[EmployeeDashboard] ‚úÖ Auth already present, skipping restore:",o.currentUser.uid),await new Promise(l=>setTimeout(l,200));else{if(d){if(console.log("[EmployeeDashboard] ‚è≥ Fresh login detected, waiting for auth to propagate...",{sessionAge:r}),await new Promise(l=>setTimeout(l,500)),o?.currentUser)console.log("[EmployeeDashboard] ‚úÖ Auth appeared after wait:",o.currentUser.uid);else if(console.log("[EmployeeDashboard] üîê Auth still missing after wait, restoring..."),!await Y()){console.error("[EmployeeDashboard] ‚ùå Auth restoration failed, redirecting"),clearTimeout(h),U(),u||(g(!0),window.location.href="/");return}}else if(console.log("[EmployeeDashboard] üîê No auth found, restoring...",{isCapacitor:y,sessionAge:r}),!await Y()){console.error("[EmployeeDashboard] ‚ùå Auth restoration failed, redirecting"),clearTimeout(h),U(),u||(g(!0),window.location.href="/");return}if(console.log("[EmployeeDashboard] ‚è≥ Waiting for auth to propagate to Firestore..."),await new Promise(l=>setTimeout(l,500)),!o?.currentUser){console.error("[EmployeeDashboard] ‚ùå Auth still not set after restore, redirecting"),clearTimeout(h),U(),u||(g(!0),window.location.href="/");return}console.log("[EmployeeDashboard] ‚úÖ Auth propagated, currentUser:",o.currentUser.uid)}if(!o.currentUser){console.error("[EmployeeDashboard] ‚ùå Auth lost before loading data, redirecting"),clearTimeout(h),U(),u||(g(!0),window.location.href="/");return}const s=J();console.log("[EmployeeDashboard] üì• Loading employee data with auth:",{authUid:o.currentUser.uid,retailerId:f,employeeId:b,sessionEmployeeId:s?.employeeId,sessionRetailerId:s?.retailerId});try{await me(f,b),clearTimeout(h),console.log("[EmployeeDashboard] ‚úÖ Load sequence completed successfully")}catch(l){clearTimeout(h),console.error("[EmployeeDashboard] ‚ùå loadEmployeeData failed:",l),console.error("[EmployeeDashboard] Load error details:",{code:l?.code,message:l?.message,name:l?.name})}}catch(y){clearTimeout(h),console.error("[EmployeeDashboard] ‚ùå Error during load sequence:",y),console.error("[EmployeeDashboard] Error details:",{code:y?.code,message:y?.message,name:y?.name,stack:y?.stack}),U(),u||(g(!0),window.location.href="/")}})()}return P=Xe(o,h=>{h?console.log("[EmployeeDashboard] ‚úÖ Firebase authentication active:",h.uid):console.log("[EmployeeDashboard] ‚ö†Ô∏è Firebase auth state changed: no user")},h=>{console.error("[EmployeeDashboard] ‚ùå Auth state change error:",h),console.error("[EmployeeDashboard] Auth state error details:",{code:h?.code,message:h?.message,name:h?.name})}),()=>{P&&P()}},500);return()=>clearTimeout(a)},[u,_]),c.useEffect(()=>{const a=setInterval(()=>D(new Date),1e3);return()=>clearInterval(a)},[]);const V=async()=>{try{if(console.log("[EmployeeDashboard] üö™ Starting logout process..."),L&&O)try{await de(G(X,"businesses",L,"employees",O),{online:!1,lastSeen:se()},{merge:!0}),console.log("[EmployeeDashboard] ‚úÖ Presence updated")}catch(i){console.warn("[EmployeeDashboard] Presence clear failed (non-fatal):",i)}await at("employee"),console.log("[EmployeeDashboard] ‚úÖ Logout user called"),je(),typeof window<"u"&&window.Capacitor?(console.log("[EmployeeDashboard] üîÑ Using hard navigation for native app"),window.location.href="/"):(console.log("[EmployeeDashboard] üîÑ Using hard navigation for web"),window.location.href="/")}catch(a){console.error("[EmployeeDashboard] ‚ùå Logout error:",a),U(),je(),we(),window.location.href="/"}},ae=()=>{_("/",{replace:!0})},m=()=>{S?F(""):_("/",{replace:!0})},j=a=>{if(!a?.toDate)return"-";const i=a.toDate(),b=Math.floor((new Date-i)/1e3);return b<60?"Just now":b<3600?`${Math.floor(b/60)}m ago`:b<86400?i.toLocaleTimeString():i.toLocaleDateString()},$=a=>{switch(a){case"inventory":return ne;case"billing":return ue;case"analytics":return xe;case"delivery":return Ie;default:return ne}},q=()=>{if(!S)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("h2",{className:"text-xl font-semibold text-white mb-2",children:["Welcome, ",n.name||"Employee","!"]}),e.jsx("p",{className:"text-white/60 text-sm mb-6",children:"Select a section from above to get started"})]}),I.length>0&&e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:I.map(a=>{const i=$(a.key);return e.jsx("button",{onClick:()=>F(a.key),className:"p-4 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition-all text-left group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-500/20 rounded-lg group-hover:bg-emerald-500/30 transition",children:e.jsx(i,{className:"text-emerald-400 text-lg"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-white",children:a.label}),e.jsxs("p",{className:"text-xs text-white/60 mt-1",children:[a.key==="delivery"&&"View and manage delivery orders",a.key==="billing"&&"Create invoices and process payments",a.key==="inventory"&&"Manage stock and products",a.key==="analytics"&&"View sales and performance data"]})]})]})},a.key)})})]});if(S==="billing"){const a=J();return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-emerald-500/20 rounded-lg",children:e.jsx(ue,{className:"text-emerald-400 text-sm"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-white",children:"Billing POS"}),e.jsx("p",{className:"text-xs text-white/60",children:"Create and manage invoices"})]})]}),e.jsx("button",{onClick:()=>K(i=>!i),className:"px-3 py-1.5 text-xs rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition",children:E?"Exit":"Fullscreen"})]}),e.jsxs("div",{className:E?"fixed inset-0 z-50 bg-slate-950/95 backdrop-blur px-2 sm:px-4 py-2 sm:py-4":"rounded-xl border border-white/10 bg-white/5 p-2 sm:p-3 shadow-sm",children:[E&&e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-200 text-sm",children:[e.jsx(ue,{className:"text-sm"})," ",e.jsx("span",{className:"font-medium",children:"Billing POS"})]}),e.jsx("button",{onClick:()=>K(!1),className:"rounded-lg border border-white/10 bg-white/5 px-3 py-1.5 text-xs hover:bg-white/10",children:"Close"})]}),e.jsx("div",{className:E?"h-[calc(100vh-4.5rem)] sm:h-[calc(100vh-5.5rem)] overflow-auto rounded-xl":"rounded-xl",children:e.jsx(Te,{retailerId:a?.retailerId,employeeId:a?.employeeId,employeeName:n?.name||"Employee",role:n?.role||"Staff"})})]})]})}return S==="delivery"?e.jsx(dt,{}):S==="inventory"?e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"p-4 rounded-xl border border-white/10 bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ne,{className:"text-emerald-400 text-sm"}),e.jsx("h3",{className:"text-sm font-semibold text-white",children:"Update Stock"})]}),e.jsx("p",{className:"text-xs text-white/60",children:"Quickly adjust quantities and scan barcodes"})]}),e.jsxs("div",{className:"p-4 rounded-xl border border-white/10 bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ne,{className:"text-amber-400 text-sm"}),e.jsx("h3",{className:"text-sm font-semibold text-white",children:"Low Stock Alerts"})]}),e.jsx("p",{className:"text-xs text-white/60",children:"View items below threshold"})]})]}):S==="analytics"?e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"p-4 rounded-xl border border-white/10 bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(xe,{className:"text-cyan-400 text-sm"}),e.jsx("h3",{className:"text-sm font-semibold text-white",children:"Today's Sales"})]}),e.jsx("p",{className:"text-xs text-white/60",children:"Revenue, items sold, and average order value"})]}),e.jsxs("div",{className:"p-4 rounded-xl border border-white/10 bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(xe,{className:"text-purple-400 text-sm"}),e.jsx("h3",{className:"text-sm font-semibold text-white",children:"Top Items"})]}),e.jsx("p",{className:"text-xs text-white/60",children:"Best performers for quick restock"})]})]}):e.jsx("div",{className:"rounded-xl border border-dashed border-white/10 p-8 text-center",children:e.jsx("p",{className:"text-white/60 text-sm",children:"No sections assigned yet. Ask your manager to grant permissions."})})};return n?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-900 to-slate-950 text-white relative overflow-hidden",children:[e.jsxs("div",{className:"fixed inset-0 pointer-events-none opacity-30",children:[e.jsx("div",{className:"absolute top-0 left-0 w-96 h-96 bg-emerald-500/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-cyan-500/20 rounded-full blur-3xl"})]}),e.jsx("header",{className:"sticky top-0 z-40 border-b border-white/10 bg-gradient-to-r from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-xl shadow-lg shadow-black/20",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 via-emerald-400 to-cyan-500 flex items-center justify-center text-white font-bold text-sm shadow-lg shadow-emerald-500/30 border border-emerald-400/30",children:n.name?.charAt(0)?.toUpperCase()||"E"}),n.online&&e.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-4 h-4 bg-emerald-400 rounded-full border-2 border-slate-900 shadow-lg shadow-emerald-400/50 animate-pulse"})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-base font-bold bg-gradient-to-r from-white via-emerald-100 to-cyan-100 bg-clip-text text-transparent truncate",children:n.name||"Employee"}),e.jsxs("p",{className:"text-xs text-white/60 truncate font-mono",children:[n.flypEmployeeId||n.id||"-"," ‚Ä¢ ",e.jsx("span",{className:"text-emerald-400",children:n.role||"Employee"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[S&&e.jsx("button",{onClick:m,className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 transition-all hover:scale-105",title:"Go Back",children:e.jsx($e,{className:"text-white/70 text-sm"})}),e.jsx("button",{onClick:ae,className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 transition-all hover:scale-105",title:"Home / Main Menu",children:e.jsx(Be,{className:"text-white/70 text-sm"})}),!p&&e.jsx("div",{className:"text-xs text-white/60 hidden sm:block px-2",children:v.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}),e.jsx("button",{onClick:V,className:"p-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 transition-all hover:scale-105",title:"Logout",children:e.jsx(ze,{className:"text-red-400 text-sm"})})]})]})})}),e.jsxs("main",{className:"relative z-10 px-4 py-4 pb-24",style:{paddingBottom:p?"calc(100px + env(safe-area-inset-bottom))":"80px"},children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6",children:[e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"p-4 rounded-2xl border border-white/10 bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-md shadow-lg hover:shadow-xl transition-all hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${n.online?"bg-emerald-400 shadow-lg shadow-emerald-400/50":"bg-gray-400"}`}),e.jsx("span",{className:"text-xs text-white/60 font-medium",children:"Status"})]}),e.jsx("p",{className:"text-sm font-bold text-white",children:n.online?"Online":"Offline"})]}),e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"p-4 rounded-2xl border border-white/10 bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-md shadow-lg hover:shadow-xl transition-all hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{className:"text-cyan-400 text-xs"}),e.jsx("span",{className:"text-xs text-white/60 font-medium",children:"Last Seen"})]}),e.jsx("p",{className:"text-sm font-bold text-white truncate",children:j(n.lastSeen)})]}),e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"p-4 rounded-2xl border border-white/10 bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-md shadow-lg hover:shadow-xl transition-all hover:scale-105 sm:col-span-1 col-span-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ie,{className:"text-emerald-400 text-xs"}),e.jsx("span",{className:"text-xs text-white/60 font-medium",children:"Access"})]}),e.jsxs("p",{className:"text-sm font-bold text-white truncate",children:[I.length," ",I.length===1?"Section":"Sections"]})]})]}),I.length>0&&e.jsxs("div",{className:"mb-4",children:[!S&&e.jsx("div",{className:"mb-2",children:e.jsx("button",{onClick:()=>F(""),className:"px-4 py-2 rounded-lg bg-emerald-500 text-white text-sm font-medium",children:"Dashboard Overview"})}),p?e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:I.map(a=>{const i=$(a.key);return e.jsxs("button",{onClick:()=>F(a.key),className:`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium whitespace-nowrap transition-all ${S===a.key?"bg-gradient-to-r from-emerald-500 to-emerald-600 text-white shadow-xl shadow-emerald-500/40 border border-emerald-400/30":"bg-white/5 text-white/70 hover:bg-white/10 border border-white/10 hover:border-white/20"}`,children:[e.jsx(i,{className:"text-sm"}),e.jsx("span",{children:a.label})]},a.key)})}):e.jsx("div",{className:"flex gap-2 border-b border-white/10",children:I.map(a=>{const i=$(a.key);return e.jsxs("button",{onClick:()=>F(a.key),className:`flex items-center gap-2 px-4 py-3 rounded-t-lg text-sm font-medium transition-all relative ${S===a.key?"text-emerald-400 bg-gradient-to-b from-white/10 to-white/5 border-b-2 border-emerald-400":"text-white/60 hover:text-white/80 hover:bg-white/5"}`,children:[e.jsx(i,{className:"text-sm"}),e.jsx("span",{children:a.label}),S===a.key&&e.jsx(R.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-emerald-400"})]},a.key)})})]}),e.jsx("div",{className:"mt-4",children:q()})]}),p&&I.length>1&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-slate-900/95 backdrop-blur-xl border-t border-white/10",style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:e.jsx("div",{className:"flex items-center justify-around px-2 py-2",children:I.map(a=>{const i=$(a.key),f=S===a.key;return e.jsxs("button",{onClick:()=>F(a.key),className:`flex flex-col items-center justify-center gap-1 py-2 px-4 rounded-lg transition-all ${f?"text-emerald-400 bg-emerald-500/10":"text-white/60 hover:text-white/80"}`,children:[e.jsx(i,{className:"text-lg"}),e.jsx("span",{className:"text-xs font-medium",children:a.label})]},a.key)})})}),!p&&e.jsx("div",{className:"fixed bottom-4 left-4 right-4 max-w-6xl mx-auto px-4",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-white/40",children:[e.jsx("span",{children:"Need more access? Contact your manager"}),e.jsx("span",{children:v.toLocaleDateString()})]})})]}):e.jsxs("div",{className:"flex items-center justify-center h-screen flex-col gap-3",children:[e.jsx("div",{className:"animate-spin h-10 w-10 border-3 border-emerald-500 border-t-transparent rounded-full"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Loading your workspace..."})]})};export{Et as default};
