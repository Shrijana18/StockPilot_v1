import{j as e,y as j,d as re,r as Me,s as Le,a as Ke,u as yt,g as jt,l as $e,w as He}from"./index-DRC3F7i0.js";import{r as s}from"./router-BPBaD_i0.js";import{s as Ce,b as Nt,c as Ne,q as et,w as wt,g as vt,d as ne,e as qe,u as ve,p as Ue,a as kt}from"./firebase-DWi1MSv1.js";import{F as De,n as Ae,o as ze,p as St,q as tt,c as we,r as We,m as st,s as rt,t as at,u as lt,g as Et,v as Ge,w as it,x as Ct,y as Ie,i as nt,z as At,A as It,B as Dt,k as Je,b as Rt,C as Ft,D as Tt,f as Ye,E as Qe,G as Pt,H as Ot}from"./index-BrhajXHK.js";import{httpsCallable as Xe}from"./index.esm-Bux_mLJ0.js";import{A as Re}from"./index-DSciU07p.js";import{m as oe}from"./proxy-BgUy8BPw.js";import{f as Bt,a as Mt,b as Lt}from"./indiaLocationAPI-CppZbdop.js";import"./vendor-Ckhrjn13.js";import"./index-CprmGC-M.js";const $t=({open:c,onClose:N,distributorId:p,onCreated:E})=>{const[b,C]=s.useState({name:"",email:"",phone:"",role:"",region:"",accessSections:{addRetailers:!1,createOrders:!1,manageOrders:!1,trackOrders:!1,analytics:!1}}),[$,f]=s.useState(!1),D=async n=>{if(n.preventDefault(),!b.name.trim()){j.error("Name is required");return}if(!b.email.trim()&&!b.phone.trim()){j.error("Email or phone is required");return}if(!Object.values(b.accessSections).some(Boolean)){j.error("Select at least one access section");return}f(!0);try{const R=`FLYP-DIST-${Math.floor(1e5+Math.random()*9e5)}`,F=Math.floor(1e5+Math.random()*9e5).toString(),o={name:b.name.trim(),email:b.email.trim()||null,phone:b.phone.trim()||null,role:b.role||"Employee",region:b.region||null,accessSections:b.accessSections,status:"active",online:!1,flypEmployeeId:R,distributorId:p,pin:F,pinCreatedAt:Ce(),pinExpiresAt:new Date(Date.now()+720*60*60*1e3),createdAt:Ce(),updatedAt:Ce()};await Nt(Ne(re,"businesses",p,"distributorEmployees"),o),j.success(`Employee created! PIN: ${F} (Valid for 30 days)`),E?.({...o,initialPin:F}),T()}catch(y){console.error("Error creating employee:",y),j.error("Failed to create employee")}finally{f(!1)}},T=()=>{C({name:"",email:"",phone:"",role:"",region:"",accessSections:{addRetailers:!1,createOrders:!1,manageOrders:!1,trackOrders:!1,analytics:!1}})},h=n=>{C(y=>({...y,accessSections:{...y.accessSections,[n]:!y.accessSections[n]}}))};return e.jsx(Re,{children:c&&e.jsxs(oe.div,{className:"fixed inset-0 z-50 flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:N}),e.jsxs(oe.div,{initial:{opacity:0,y:30,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.98},transition:{duration:.2},className:"relative w-full max-w-2xl mx-4 rounded-2xl border border-white/10 bg-[#0b1220]/95 text-white shadow-[0_30px_120px_rgba(0,0,0,.6)] backdrop-blur-xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Add Distributor Employee"}),e.jsx("p",{className:"text-sm text-white/70 mt-1",children:"Create employee account with specific access permissions"})]}),e.jsx("button",{className:"rounded-full p-2 bg-white/10 hover:bg-white/15 text-white/90",onClick:N,children:"âœ•"})]}),e.jsxs("form",{onSubmit:D,className:"px-6 py-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Name *"}),e.jsx("input",{type:"text",value:b.name,onChange:n=>C(y=>({...y,name:n.target.value})),className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-500",placeholder:"Employee name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Role"}),e.jsxs("select",{value:b.role,onChange:n=>C(y=>({...y,role:n.target.value})),className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500",children:[e.jsx("option",{value:"",className:"bg-gray-900",children:"Select Role"}),e.jsx("option",{value:"Manager",className:"bg-gray-900",children:"Manager"}),e.jsx("option",{value:"Sales Executive",className:"bg-gray-900",children:"Sales Executive"}),e.jsx("option",{value:"Order Manager",className:"bg-gray-900",children:"Order Manager"}),e.jsx("option",{value:"Dispatch Manager",className:"bg-gray-900",children:"Dispatch Manager"}),e.jsx("option",{value:"Admin",className:"bg-gray-900",children:"Admin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Region (optional)"}),e.jsx("input",{type:"text",value:b.region,onChange:n=>C(y=>({...y,region:n.target.value})),className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-500",placeholder:"Zone / Area / City"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email"}),e.jsx("input",{type:"email",value:b.email,onChange:n=>C(y=>({...y,email:n.target.value})),className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-500",placeholder:"employee@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Phone"}),e.jsx("input",{type:"tel",value:b.phone,onChange:n=>C(y=>({...y,phone:n.target.value})),className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-500",placeholder:"+91 9876543210"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"Access Permissions *"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[{key:"addRetailers",label:"Add Retailers",desc:"Can add new retailers to the system"},{key:"createOrders",label:"Create Orders",desc:"Can create passive orders for retailers"},{key:"manageOrders",label:"Manage Orders",desc:"Can manage order requests and pending orders"},{key:"trackOrders",label:"Track Orders",desc:"Can track and update order status"},{key:"analytics",label:"Analytics",desc:"Can view business analytics and reports"}].map(n=>e.jsxs("label",{className:"flex items-start gap-3 p-3 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-colors cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b.accessSections[n.key],onChange:()=>h(n.key),className:"mt-1 accent-emerald-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:n.label}),e.jsx("div",{className:"text-xs text-white/60",children:n.desc})]})]},n.key))})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-white/10",children:[e.jsx("button",{type:"button",onClick:N,className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/15 border border-white/20 text-white transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:$,className:"px-6 py-2 rounded-lg bg-emerald-500 hover:bg-emerald-600 text-white font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:$?"Creating...":"Create Employee"})]})]})]})]})})},Ut=({open:c,onClose:N,employee:p,distributorId:E})=>{const[b,C]=s.useState(!1),[$,f]=s.useState([]),[D,T]=s.useState(!0),[h,n]=s.useState([]),[y,R]=s.useState([]),[F,o]=s.useState([]),[V,A]=s.useState(!1),[k,m]=s.useState(!1),[v,z]=s.useState(!1),[S,W]=s.useState({zones:[],territories:[],cities:[],assignedRetailers:[]});s.useEffect(()=>{if(!c){W({zones:[],territories:[],cities:[],assignedRetailers:[]}),n([]),R([]),o([]);return}},[c]),s.useEffect(()=>{if(!c)return;(async()=>{A(!0);try{const d=await Bt();n(d)}catch(d){console.error("Error loading states:",d),j.error("Failed to load states. Using fallback data.")}finally{A(!1)}})()},[c]),s.useEffect(()=>{if(!c||S.zones.length===0){R([]),o([]);return}(async()=>{m(!0);try{const d=await Mt(S.zones);R(d)}catch(d){console.error("Error loading districts:",d),j.error("Failed to load districts")}finally{m(!1)}})()},[c,S.zones]),s.useEffect(()=>{if(!c||S.territories.length===0||S.zones.length===0){o([]);return}(async()=>{z(!0);try{const d=await Lt(S.territories,S.zones);o(d)}catch(d){console.error("Error loading cities:",d),j.error("Failed to load cities")}finally{z(!1)}})()},[c,S.territories,S.zones]),s.useEffect(()=>{if(!c||!p?.id||!E)return;(async()=>{try{const d=ne(re,"businesses",E,"distributorEmployees",p.id),O=await qe(d);if(O.exists()){const I=O.data();W({zones:Array.isArray(I.zones)?[...I.zones]:[],territories:Array.isArray(I.territories)?[...I.territories]:[],cities:Array.isArray(I.cities)?[...I.cities]:[],assignedRetailers:Array.isArray(I.assignedRetailers)?[...I.assignedRetailers]:[]})}else W({zones:[],territories:[],cities:[],assignedRetailers:[]})}catch(d){console.error("Error loading employee data:",d),j.error("Failed to load employee data"),W({zones:[],territories:[],cities:[],assignedRetailers:[]})}})(),ye()},[c,p?.id,E]);const ye=async()=>{if(E){T(!0);try{const i=Ne(re,"businesses",E,"connectedRetailers"),d=et(i,wt("status","in",["accepted","provisioned","provisioned-local"])),I=(await vt(d)).docs.map(B=>({id:B.data().retailerId||B.id,name:B.data().retailerName||"Unnamed Retailer",city:B.data().retailerCity||B.data().city||"",state:B.data().retailerState||B.data().state||""}));f(I)}catch(i){console.error("Error loading retailers:",i),j.error("Failed to load retailers")}finally{T(!1)}}},he=async i=>{W(d=>{const O=d.zones.includes(i),I=O?d.zones.filter(Y=>Y!==i):[...d.zones,i];let B=d.territories,J=d.cities;if(O){const ae=y.filter(g=>g.stateId===i).map(g=>g.id);B=d.territories.filter(g=>!ae.includes(g));const x=J.filter(g=>ae.includes(g.districtId)).map(g=>g.id);J=d.cities.filter(g=>!x.includes(g))}return{...d,zones:I,territories:B,cities:J}})},ue=i=>{W(d=>{const O=d.territories.includes(i),I=O?d.territories.filter(J=>J!==i):[...d.territories,i];let B=d.cities;return O&&(B=d.cities.filter(J=>J.districtId!==i)),{...d,territories:I,cities:B}})},pe=i=>{W(d=>{const O=d.cities.includes(i)?d.cities.filter(I=>I!==i):[...d.cities,i];return{...d,cities:O}})},ge=i=>{W(d=>{const O=d.assignedRetailers.includes(i)?d.assignedRetailers.filter(I=>I!==i):[...d.assignedRetailers,i];return{...d,assignedRetailers:O}})},be=async()=>{if(!p?.id||!E){j.error("Employee ID or Distributor ID is missing");return}const i=p.id;if(!i){j.error("Invalid employee ID");return}C(!0);try{const d=ne(re,"businesses",E,"distributorEmployees",i);if(!(await qe(d)).exists()){j.error("Employee not found in database"),C(!1);return}const I=Array.isArray(S.zones)?S.zones:[],J=(Array.isArray(S.territories)?S.territories:[]).filter(l=>{const x=y.find(g=>g.id===l);return x&&I.includes(x.stateId)}),Y=(Array.isArray(S.cities)?S.cities:[]).filter(l=>{const x=F.find(g=>g.id===l);return x&&J.includes(x.districtId)}),ae={zones:I,territories:J,cities:Y,assignedRetailers:Array.isArray(S.assignedRetailers)?S.assignedRetailers:[],updatedAt:Ce()};console.log(`Updating employee ${i} with data:`,ae),await ve(d,ae),j.success("Zones, territories, and retailers updated successfully"),N()}catch(d){console.error("Error updating employee:",d),console.error("Employee ID:",i,"Distributor ID:",E),j.error(`Failed to update employee: ${d.message||"Unknown error"}`)}finally{C(!1)}},de=s.useMemo(()=>S.zones.length===0?[]:y.filter(i=>S.zones.includes(i.stateId)),[y,S.zones]),ce=s.useMemo(()=>S.territories.length===0?[]:F.filter(i=>S.territories.includes(i.districtId)),[F,S.territories]);return c?e.jsx(Re,{children:e.jsxs(oe.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:N}),e.jsxs(oe.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-7xl max-h-[90vh] bg-gray-900/95 backdrop-blur-xl rounded-2xl border border-white/10 shadow-2xl overflow-hidden flex flex-col",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/10",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Assign Zones & Retailers"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:p?.name||"Employee"})]}),e.jsx("button",{onClick:N,className:"p-2 rounded-lg hover:bg-white/10 text-gray-400 hover:text-white transition-colors",children:e.jsx(De,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold text-white",children:[e.jsx(Ae,{className:"w-5 h-5 text-emerald-400"}),"Zones (States)"]}),e.jsx("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10 max-h-[400px] overflow-y-auto",children:V?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ze,{className:"w-5 h-5 animate-spin text-emerald-400"}),e.jsx("span",{className:"text-sm text-gray-400 ml-2",children:"Loading states..."})]}):h.length===0?e.jsx("p",{className:"text-sm text-gray-400 text-center py-4",children:"No states available"}):h.map(i=>e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S.zones.includes(i.id),onChange:()=>he(i.id),className:"w-4 h-4 accent-emerald-500"}),e.jsx("span",{className:"text-sm text-gray-200",children:i.name})]},i.id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold text-white",children:[e.jsx(Ae,{className:"w-5 h-5 text-blue-400"}),"Territories (Districts)"]}),e.jsx("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10 max-h-[400px] overflow-y-auto",children:S.zones.length===0?e.jsx("p",{className:"text-sm text-gray-400 text-center py-4",children:"Select zones first to see districts"}):k?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ze,{className:"w-5 h-5 animate-spin text-blue-400"}),e.jsx("span",{className:"text-sm text-gray-400 ml-2",children:"Loading districts..."})]}):de.length===0?e.jsx("p",{className:"text-sm text-gray-400 text-center py-4",children:"No districts available for selected states"}):de.map(i=>e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S.territories.includes(i.id),onChange:()=>ue(i.id),className:"w-4 h-4 accent-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-white",children:i.name}),e.jsx("span",{className:"text-xs text-gray-400 block",children:i.state})]})]},i.id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold text-white",children:[e.jsx(Ae,{className:"w-5 h-5 text-purple-400"}),"Cities"]}),e.jsx("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10 max-h-[400px] overflow-y-auto",children:S.territories.length===0?e.jsx("p",{className:"text-sm text-gray-400 text-center py-4",children:"Select territories first to see cities"}):v?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ze,{className:"w-5 h-5 animate-spin text-purple-400"}),e.jsx("span",{className:"text-sm text-gray-400 ml-2",children:"Loading cities..."})]}):ce.length===0?e.jsx("p",{className:"text-sm text-gray-400 text-center py-4",children:"No cities available for selected territories"}):ce.map(i=>e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S.cities.includes(i.id),onChange:()=>pe(i.id),className:"w-4 h-4 accent-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-white",children:i.name}),e.jsx("span",{className:"text-xs text-gray-400 block",children:i.district})]})]},i.id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold text-white",children:[e.jsx(St,{className:"w-5 h-5 text-purple-400"}),"Assigned Retailers"]}),e.jsx("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10 max-h-[400px] overflow-y-auto",children:D?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-400 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Loading retailers..."})]}):$.length===0?e.jsx("p",{className:"text-sm text-gray-400 text-center py-4",children:"No retailers available"}):$.map(i=>e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S.assignedRetailers.includes(i.id),onChange:()=>ge(i.id),className:"w-4 h-4 accent-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-white",children:i.name}),(i.city||i.state)&&e.jsx("span",{className:"text-xs text-gray-400 block",children:[i.city,i.state].filter(Boolean).join(", ")})]})]},i.id))})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-4 p-6 border-t border-white/10",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/15 border border-white/20 text-white transition-colors",children:"Cancel"}),e.jsx("button",{onClick:be,disabled:b,className:"flex items-center gap-2 px-6 py-2 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"w-4 h-4"}),"Save Changes"]})})]})]})]})}):null},zt=({open:c,onClose:N,employee:p,currentUser:E})=>{const[b,C]=s.useState({name:"",email:"",phone:"",profilePictureUrl:""}),[$,f]=s.useState(!1),[D,T]=s.useState(null),[h,n]=s.useState(null),[y,R]=s.useState(!1);s.useEffect(()=>{p&&(C({name:p.name||"",email:p.email||"",phone:p.phone||"",profilePictureUrl:p.profilePictureUrl||""}),n(p.profilePictureUrl||null),T(null))},[p]);const F=A=>{const k=A.target.files[0];if(!k)return;if(!k.type.startsWith("image/")){j.error("Please select an image file");return}if(k.size>5*1024*1024){j.error("Image size should be less than 5MB");return}T(k);const m=new FileReader;m.onloadend=()=>{n(m.result)},m.readAsDataURL(k)},o=()=>{T(null),n(null),C(A=>({...A,profilePictureUrl:null}))},V=async A=>{if(A.preventDefault(),!b.name.trim()){j.error("Name is required");return}f(!0);try{let k=b.profilePictureUrl;if(D){R(!0);try{const m=`employee_photos/${E.uid}/${p.id}`,v=Me(Le,m);if(b.profilePictureUrl)try{const z=Me(Le,m);await Ke(z)}catch{console.log("Old image not found or already deleted")}await yt(v,D),k=await jt(v)}catch(m){console.error("Error uploading image:",m),j.error("Failed to upload image"),R(!1),f(!1);return}finally{R(!1)}}else if(h===null&&p.profilePictureUrl)try{const m=`employee_photos/${E.uid}/${p.id}`,v=Me(Le,m);await Ke(v),k=null}catch{console.log("Image not found in storage, clearing reference"),k=null}await ve(ne(re,"businesses",E.uid,"distributorEmployees",p.id),{name:b.name.trim(),email:b.email.trim()||null,phone:b.phone.trim()||null,profilePictureUrl:k||null,updatedAt:new Date}),j.success("Employee information updated successfully"),N()}catch(k){console.error("Error updating employee:",k),j.error("Failed to update employee information")}finally{f(!1)}};return!c||!p?null:e.jsx(Re,{children:c&&e.jsx(e.Fragment,{children:e.jsx(oe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:N,children:e.jsxs(oe.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},onClick:A=>A.stopPropagation(),className:"bg-gradient-to-br from-slate-800 to-slate-900 border border-white/20 rounded-2xl shadow-2xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/10 bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-emerald-500/20 to-blue-500/20 flex items-center justify-center border border-white/20",children:e.jsx(we,{className:"w-5 h-5 text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Edit Employee"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Update personal information"})]})]}),e.jsx("button",{onClick:N,className:"w-8 h-8 rounded-lg bg-white/10 hover:bg-white/20 flex items-center justify-center text-gray-400 hover:text-white transition-all",children:e.jsx(De,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:V,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"Profile Picture"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 rounded-full overflow-hidden border-2 border-white/20 bg-gradient-to-br from-emerald-500/20 to-blue-500/20 flex items-center justify-center",children:h?e.jsx("img",{src:h,alt:"Profile preview",className:"w-full h-full object-cover"}):e.jsx(we,{className:"w-8 h-8 text-gray-400"})}),h&&e.jsx("button",{type:"button",onClick:o,className:"absolute -top-1 -right-1 w-6 h-6 rounded-full bg-red-500 hover:bg-red-600 flex items-center justify-center text-white text-xs transition-all",title:"Remove image",children:e.jsx(st,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"block",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:F,className:"hidden"}),e.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 border border-white/20 text-white cursor-pointer transition-all",children:[e.jsx(We,{className:"w-4 h-4"}),D?"Change Picture":"Upload Picture"]})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"JPG, PNG or GIF (max 5MB)"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),"Full Name *"]}),e.jsx("input",{type:"text",value:b.name,onChange:A=>C(k=>({...k,name:A.target.value})),className:"w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all",placeholder:"Enter full name",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(rt,{className:"w-4 h-4"}),"Email Address"]}),e.jsx("input",{type:"email",value:b.email,onChange:A=>C(k=>({...k,email:A.target.value})),className:"w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all",placeholder:"employee@example.com"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(at,{className:"w-4 h-4"}),"Phone Number"]}),e.jsx("input",{type:"tel",value:b.phone,onChange:A=>C(k=>({...k,phone:A.target.value})),className:"w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all",placeholder:"+91 1234567890"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-white/10",children:[e.jsx("button",{type:"button",onClick:N,className:"flex-1 px-4 py-3 rounded-lg bg-white/5 hover:bg-white/10 border border-white/20 text-white font-medium transition-all",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:$||y,className:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white font-medium flex items-center justify-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:$||y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),y?"Uploading...":"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-4 h-4"}),"Save Changes"]})})]})]})]})})})})},_e=[{key:"addRetailers",label:"Add Retailers",description:"Add new retailers to the distributor network",icon:"ðŸ‘¥",category:"Retailers"},{key:"createOrders",label:"Create Orders",description:"Create passive orders for retailers",icon:"âž•",category:"Orders"},{key:"manageOrders",label:"Manage Orders",description:"Manage order requests and pending orders",icon:"ðŸ“‹",category:"Orders"},{key:"trackOrders",label:"Track Orders",description:"Track and update order status",icon:"ðŸ“",category:"Orders"},{key:"inventory",label:"Inventory Management",description:"View and manage inventory",icon:"ðŸ“¦",category:"Inventory"},{key:"dispatch",label:"Dispatch Tracker",description:"Track dispatches and deliveries",icon:"ðŸšš",category:"Logistics"},{key:"analytics",label:"Analytics",description:"View business analytics and reports",icon:"ðŸ“Š",category:"Analytics"},{key:"aiForecast",label:"AI Forecast",description:"Access AI-powered forecasting",icon:"ðŸ§ ",category:"Analytics"},{key:"manualBilling",label:"Manual Billing",description:"Create and manage manual bills",icon:"ðŸ’°",category:"Billing"},{key:"invoices",label:"Invoices",description:"View and manage invoices",icon:"ðŸ§¾",category:"Billing"},{key:"productOwners",label:"Product Owners",description:"Manage product owners",icon:"ðŸ­",category:"Products"},{key:"retailerRequests",label:"Retailer Requests",description:"Manage retailer connection requests",icon:"ðŸ“¨",category:"Retailers"}],_t=({open:c,onClose:N,employee:p,currentUser:E})=>{const[b,C]=s.useState({}),[$,f]=s.useState(""),[D,T]=s.useState("all"),[h,n]=s.useState(!1);s.useEffect(()=>{p?.accessSections?C({...p.accessSections}):C({})},[p]);const y=["all",...new Set(_e.map(m=>m.category))],R=_e.filter(m=>{const v=m.label.toLowerCase().includes($.toLowerCase())||m.description.toLowerCase().includes($.toLowerCase()),z=D==="all"||m.category===D;return v&&z}),F=m=>{C(v=>({...v,[m]:!v[m]}))},o=()=>{const m=R.reduce((v,z)=>(v[z.key]=!0,v),{});C(v=>({...v,...m}))},V=()=>{const m=R.reduce((v,z)=>(v[z.key]=!1,v),{});C(v=>({...v,...m}))},A=async()=>{n(!0);try{await ve(ne(re,"businesses",E.uid,"distributorEmployees",p.id),{accessSections:b,updatedAt:new Date}),j.success("Permissions updated successfully"),N()}catch(m){console.error("Error updating permissions:",m),j.error("Failed to update permissions")}finally{n(!1)}};if(!c||!p)return null;const k=Object.values(b).filter(Boolean).length;return e.jsx(Re,{children:c&&e.jsx(oe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:N,children:e.jsxs(oe.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},onClick:m=>m.stopPropagation(),className:"bg-gradient-to-br from-slate-800 to-slate-900 border border-white/20 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/10 bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500/20 to-blue-500/20 flex items-center justify-center border border-white/20",children:e.jsx(Et,{className:"w-5 h-5 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Manage Permissions"}),e.jsxs("p",{className:"text-xs text-gray-400",children:[p.name," â€¢ ",k," permission",k!==1?"s":""," selected"]})]})]}),e.jsx("button",{onClick:N,className:"w-8 h-8 rounded-lg bg-white/10 hover:bg-white/20 flex items-center justify-center text-gray-400 hover:text-white transition-all",children:e.jsx(De,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 border-b border-white/10 space-y-3 bg-white/2.5",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",value:$,onChange:m=>f(m.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all",placeholder:"Search permissions..."})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"Category:"}),y.map(m=>e.jsx("button",{onClick:()=>T(m),className:`px-3 py-1 rounded-lg text-xs font-medium transition-all ${D===m?"bg-emerald-500/20 text-emerald-300 border border-emerald-500/30":"bg-white/5 text-gray-400 border border-white/10 hover:bg-white/10"}`,children:m.charAt(0).toUpperCase()+m.slice(1)},m)),e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:o,className:"px-3 py-1 rounded-lg text-xs font-medium bg-blue-500/20 text-blue-300 border border-blue-500/30 hover:bg-blue-500/30 transition-all",children:"Select All"}),e.jsx("button",{onClick:V,className:"px-3 py-1 rounded-lg text-xs font-medium bg-red-500/20 text-red-300 border border-red-500/30 hover:bg-red-500/30 transition-all",children:"Deselect All"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:R.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-400",children:"No permissions found"})}):R.map(m=>{const v=!!b[m.key];return e.jsxs("label",{className:`flex items-start gap-3 p-4 rounded-lg border cursor-pointer transition-all hover:bg-white/5 ${v?"bg-emerald-500/10 border-emerald-500/30":"bg-white/5 border-white/10"}`,children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("input",{type:"checkbox",checked:v,onChange:()=>F(m.key),className:"accent-emerald-500 w-4 h-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:m.icon}),e.jsx("span",{className:`font-medium ${v?"text-emerald-300":"text-white"}`,children:m.label}),v&&e.jsx(tt,{className:"w-4 h-4 text-emerald-400 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-gray-400",children:m.description}),e.jsx("span",{className:"inline-block mt-2 px-2 py-0.5 text-xs rounded bg-white/5 text-gray-500",children:m.category})]})]},m.key)})}),e.jsxs("div",{className:"p-4 border-t border-white/10 bg-white/2.5 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:[e.jsx("span",{className:"text-white font-semibold",children:k})," of ",_e.length," permissions selected"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/20 text-white font-medium transition-all",children:"Cancel"}),e.jsx("button",{onClick:A,disabled:h,className:"px-4 py-2 rounded-lg bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white font-medium flex items-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-4 h-4"}),"Save Permissions"]})})]})]})]})})})},qt=({open:c,name:N,onConfirm:p,onCancel:E})=>c?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:E}),e.jsxs("div",{role:"dialog","aria-modal":"true",className:"relative w-full max-w-md mx-4 rounded-2xl border border-white/15 bg-gray-900/90 shadow-2xl p-6 text-white",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Reset PIN?"}),e.jsxs("p",{className:"text-sm text-gray-300 mb-6",children:["Are you sure you want to reset the PIN for ",e.jsxs("span",{className:"font-medium",children:['"',N,'"']}),"? The new PIN will be visible for 2 minutes."]}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:E,className:"px-3 py-2 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 text-gray-200",children:"Cancel"}),e.jsx("button",{type:"button",onClick:p,className:"px-3 py-2 rounded-lg border border-red-400/30 bg-red-500/20 hover:bg-red-500/30 text-red-200",children:"Reset PIN"})]})]})]}):null,Gt=({employee:c,currentUser:N,customRoles:p,onRoleChange:E})=>{const b=["Manager","Sales Executive","Order Manager","Dispatch Manager","Admin"],C=[...b,...p],$=c.role&&!C.includes(c.role),[f,D]=s.useState(c.role||""),[T,h]=s.useState($),[n,y]=s.useState($?c.role:"");s.useEffect(()=>{D(c.role||"");const o=["Manager","Sales Executive","Order Manager","Dispatch Manager","Admin",...p],V=c.role&&!o.includes(c.role);h(V),V&&y(c.role)},[c.role,p]);const R=o=>{o==="custom"?(h(!0),y("")):(h(!1),D(o),o&&E(o))},F=()=>{n.trim()&&(D(n.trim()),E(n.trim()),h(!1))};return T?e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1.5",children:"Role"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:n,onChange:o=>y(o.target.value),onKeyDown:o=>{o.key==="Enter"?(o.preventDefault(),F()):o.key==="Escape"&&(h(!1),y(""),D(c.role||""))},placeholder:"Enter custom role name",className:"flex-1 px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",autoFocus:!0}),e.jsx("button",{onClick:F,className:"px-3 py-2 rounded-lg bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-400/30 text-emerald-300 text-sm transition-all",children:"Save"}),e.jsx("button",{onClick:()=>{h(!1),y(""),D(c.role||"")},className:"px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 text-gray-300 text-sm transition-all",children:"Cancel"})]})]}):e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1.5",children:"Role"}),e.jsxs("select",{value:f,onChange:o=>R(o.target.value),className:"w-full px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[e.jsx("option",{value:"",className:"bg-gray-900",children:"Select Role"}),b.map(o=>e.jsx("option",{value:o,className:"bg-gray-900",children:o},o)),p.length>0&&e.jsx(e.Fragment,{children:e.jsx("optgroup",{label:"Custom Roles",className:"bg-gray-900",children:p.map(o=>e.jsx("option",{value:o,className:"bg-gray-900",children:o},o))})}),e.jsx("option",{value:"custom",className:"bg-gray-900 text-emerald-400",children:"+ Create Custom Role"})]})]})},Vt=({orderId:c,orderData:N,loading:p,onClose:E,currentUser:b,db:C})=>{const $=h=>{if(h?.proforma&&h.proforma.lines&&Array.isArray(h.proforma.lines)&&h.proforma.lines.length>0)return{grossItems:Number(h.proforma.grossItems||0),lineDiscountTotal:Number(h.proforma.lineDiscountTotal||0),itemsSubTotal:Number(h.proforma.itemsSubTotal||h.proforma.subTotal||0),orderCharges:{delivery:Number(h.proforma.orderCharges?.delivery??0),packing:Number(h.proforma.orderCharges?.packing??0),insurance:Number(h.proforma.orderCharges?.insurance??0),other:Number(h.proforma.orderCharges?.other??0)},discountTotal:Number(h.proforma.discountTotal||0),taxableBase:Number(h.proforma.taxableBase||0),taxType:h.proforma.taxType||"CGST_SGST",taxBreakup:h.proforma.taxBreakup||{},roundOff:Number(h.proforma.roundOff||0),grandTotal:Number(h.proforma.grandTotal||0),lines:h.proforma.lines||[]};const n=h?.chargesSnapshot?.breakdown;return n?{grossItems:Number(n.grossItems||0),lineDiscountTotal:Number(n.lineDiscountTotal||0),itemsSubTotal:Number(n.itemsSubTotal||n.subTotal||0),orderCharges:{delivery:Number(n.delivery||0),packing:Number(n.packing||0),insurance:Number(n.insurance||0),other:Number(n.other||0)},discountTotal:Number(n.discountTotal||0),taxableBase:Number(n.taxableBase||0),taxType:n.taxType||"CGST_SGST",taxBreakup:n.taxBreakup||{},roundOff:Number(n.roundOff||0),grandTotal:Number(n.grandTotal||0),lines:n.lines||[]}:null};if(!c)return null;const f=N?$(N):null,D=N?.items||[],T=f?.lines||D;return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:E}),e.jsxs("div",{role:"dialog","aria-modal":"true",className:"relative w-full max-w-5xl max-h-[90vh] overflow-hidden rounded-2xl border border-white/15 bg-gray-900/95 shadow-2xl flex flex-col",onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-1",children:"Order Details"}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Order ID: ",c.substring(0,20),"..."]})]}),e.jsx("button",{onClick:E,className:"p-2 rounded-lg hover:bg-white/10 text-gray-400 hover:text-white transition-colors",children:e.jsx(De,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:p?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-400"})}):N?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"backdrop-blur-sm bg-white/5 rounded-xl p-4 border border-white/10",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-400 mb-2",children:"Retailer Information"}),e.jsx("p",{className:"text-white font-medium",children:N.retailerName||"N/A"}),e.jsx("p",{className:"text-sm text-gray-300",children:N.retailerEmail||""}),e.jsx("p",{className:"text-sm text-gray-300",children:N.retailerPhone||""}),e.jsx("p",{className:"text-sm text-gray-300",children:N.retailerCity||""})]}),e.jsxs("div",{className:"backdrop-blur-sm bg-white/5 rounded-xl p-4 border border-white/10",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-400 mb-2",children:"Order Information"}),e.jsxs("p",{className:"text-white",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"})," ",N.status||"N/A"]}),e.jsxs("p",{className:"text-white",children:[e.jsx("span",{className:"text-gray-400",children:"Payment:"})," ",N.paymentModeLabel||N.paymentMode||"N/A"]}),e.jsxs("p",{className:"text-sm text-gray-300",children:[e.jsx("span",{className:"text-gray-400",children:"Created:"})," ",N.createdAt?.toDate?.().toLocaleString()||N.timestamp?.toDate?.().toLocaleString()||"N/A"]})]})]}),e.jsxs("div",{className:"backdrop-blur-sm bg-white/5 rounded-xl border border-white/10 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Order Items"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-400 uppercase",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-400 uppercase",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-400 uppercase",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-400 uppercase",children:"Discount"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-400 uppercase",children:"GST %"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-400 uppercase",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:T.map((h,n)=>{const y=Array.isArray(D)?D[n]:null,R=y?.productName||y?.name||h.productName||h.name||"Product",F=h.qty||y?.qty||y?.quantity||0,o=h.price||y?.price||y?.sellingPrice||0,V=h.itemDiscountPct||0,A=h.itemDiscountAmt||0,k=h.gstRate||y?.gstRate||0,m=F*o,v=A>0?A:m*V/100,z=m-v;return e.jsxs("tr",{className:"hover:bg-white/5",children:[e.jsx("td",{className:"px-4 py-3 text-white",children:R}),e.jsx("td",{className:"px-4 py-3 text-gray-300",children:F}),e.jsxs("td",{className:"px-4 py-3 text-gray-300",children:["â‚¹",o.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-gray-300",children:A>0?`â‚¹${A.toFixed(2)}`:V>0?`${V}%`:"-"}),e.jsxs("td",{className:"px-4 py-3 text-gray-300",children:[k,"%"]}),e.jsxs("td",{className:"px-4 py-3 text-emerald-300 font-medium",children:["â‚¹",z.toFixed(2)]})]},n)})})]})})]}),f&&e.jsxs("div",{className:"backdrop-blur-sm bg-white/5 rounded-xl p-6 border border-white/10",children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-4",children:"Financial Breakdown"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Gross Items:"}),e.jsxs("span",{className:"text-white",children:["â‚¹",f.grossItems.toFixed(2)]})]}),f.lineDiscountTotal>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Line Discounts:"}),e.jsxs("span",{className:"text-red-300",children:["-â‚¹",f.lineDiscountTotal.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Items Subtotal:"}),e.jsxs("span",{className:"text-white",children:["â‚¹",f.itemsSubTotal.toFixed(2)]})]}),f.orderCharges.delivery>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Delivery:"}),e.jsxs("span",{className:"text-white",children:["â‚¹",f.orderCharges.delivery.toFixed(2)]})]}),f.orderCharges.packing>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Packing:"}),e.jsxs("span",{className:"text-white",children:["â‚¹",f.orderCharges.packing.toFixed(2)]})]}),f.orderCharges.insurance>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Insurance:"}),e.jsxs("span",{className:"text-white",children:["â‚¹",f.orderCharges.insurance.toFixed(2)]})]}),f.orderCharges.other>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Other Charges:"}),e.jsxs("span",{className:"text-white",children:["â‚¹",f.orderCharges.other.toFixed(2)]})]}),f.discountTotal>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Order Discount:"}),e.jsxs("span",{className:"text-red-300",children:["-â‚¹",f.discountTotal.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Taxable Base:"}),e.jsxs("span",{className:"text-white",children:["â‚¹",f.taxableBase.toFixed(2)]})]}),f.taxBreakup&&e.jsxs(e.Fragment,{children:[f.taxBreakup.cgst>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"CGST:"}),e.jsxs("span",{className:"text-white",children:["â‚¹",f.taxBreakup.cgst.toFixed(2)]})]}),f.taxBreakup.sgst>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"SGST:"}),e.jsxs("span",{className:"text-white",children:["â‚¹",f.taxBreakup.sgst.toFixed(2)]})]}),f.taxBreakup.igst>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"IGST:"}),e.jsxs("span",{className:"text-white",children:["â‚¹",f.taxBreakup.igst.toFixed(2)]})]})]}),f.roundOff!==0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Round Off:"}),e.jsxs("span",{className:"text-gray-300",children:["â‚¹",f.roundOff.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t border-white/10",children:[e.jsx("span",{className:"text-white",children:"Grand Total:"}),e.jsxs("span",{className:"text-emerald-400",children:["â‚¹",f.grandTotal.toFixed(2)]})]})]})]})]}):e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Order data not available"})})]})]})},Zt=({activitiesByEmployee:c,employees:N,loadingActivity:p,currentUser:E,db:b})=>{const[C,$]=s.useState({}),[f,D]=s.useState({}),[T,h]=s.useState(""),[n,y]=s.useState("all"),[R,F]=s.useState("all"),[o,V]=s.useState({start:null,end:null}),[A,k]=s.useState(null),[m,v]=s.useState(!1),[z,S]=s.useState("date-desc"),[W,ye]=s.useState(50),[he,ue]=s.useState({}),[pe,ge]=s.useState(null),be=l=>{$(x=>({...x,[l]:!x[l]}))},de=(l,x)=>{const g=`${l}-${x}`;D(M=>({...M,[g]:!M[g]}))},ce=async l=>{if(!(!E?.uid||!l)){v(!0),k(l);try{const x=ne(b,"businesses",E.uid,"orderRequests",l),g=await qe(x);g.exists()?ge({id:g.id,...g.data()}):(j.error("Order not found"),k(null))}catch(x){console.error("Error fetching order detail:",x),j.error("Failed to load order details"),k(null)}finally{v(!1)}}},i=()=>{k(null),ge(null)},d=s.useMemo(()=>{const l={};return Object.keys(c).forEach(x=>{const g=c[x];let M=[...g.activities];if(T){const P=T.toLowerCase();M=M.filter(Z=>(Z.retailerName||"").toLowerCase().includes(P)||(Z.orderId||"").toLowerCase().includes(P)||(Z.retailerId||"").toLowerCase().includes(P))}n!=="all"&&(M=M.filter(P=>P.action===n)),(o.start||o.end)&&(M=M.filter(P=>{if(!P.orderDate)return!1;const Z=P.orderDate instanceof Date?P.orderDate:new Date(P.orderDate);if(o.start&&Z<o.start)return!1;if(o.end){const ee=new Date(o.end);if(ee.setHours(23,59,59,999),Z>ee)return!1}return!0})),M.sort((P,Z)=>{const ee=P.orderDate instanceof Date?P.orderDate:new Date(P.orderDate||0),Q=Z.orderDate instanceof Date?Z.orderDate:new Date(Z.orderDate||0);switch(z){case"date-desc":return Q-ee;case"date-asc":return ee-Q;case"revenue-desc":return(Z.grandTotal||0)-(P.grandTotal||0);case"revenue-asc":return(P.grandTotal||0)-(Z.grandTotal||0);default:return Q-ee}}),l[x]={...g,filteredActivities:M}}),l},[c,T,n,o,z]),O=l=>{const x={created:[],accepted:[],shipped:[],delivered:[],modified:[],rejected:[],added_retailer:[]};return l.forEach(g=>{x[g.action]&&x[g.action].push(g)}),x},I=l=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2,maximumFractionDigits:2}).format(l||0),B=l=>l?(l instanceof Date?l:new Date(l)).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",J=l=>{const x=d[l];if(!x||!x.filteredActivities.length){j.error("No activities to export");return}const g=[["Date","Action","Order ID","Retailer","Amount","Employee"]];x.filteredActivities.forEach(Q=>{g.push([B(Q.orderDate),Q.action.toUpperCase(),Q.orderId||"N/A",Q.retailerName||"N/A",I(Q.grandTotal),`${x.employeeName} (${x.employeeRole})`])});const M=g.map(Q=>Q.map(q=>`"${q}"`).join(",")).join(`
`),P=new Blob([M],{type:"text/csv"}),Z=URL.createObjectURL(P),ee=document.createElement("a");ee.href=Z,ee.download=`employee_activity_${x.employeeName||l}_${new Date().toISOString().split("T")[0]}.csv`,ee.click(),URL.revokeObjectURL(Z),j.success("Activity data exported successfully")},Y=s.useMemo(()=>Object.values(c||{}).reduce((x,g)=>(x.totalOrders+=g.stats?.totalOrders||0,x.totalRevenue+=g.stats?.totalRevenue||0,x.totalCreated+=g.stats?.created||0,x.totalDelivered+=g.stats?.delivered||0,x),{totalOrders:0,totalRevenue:0,totalCreated:0,totalDelivered:0}),[c]),ae=s.useMemo(()=>R==="all"?Object.values(d):Object.values(d).filter(l=>(l.flypEmployeeId||l.employeeId||"")===R),[d,R]);return p?e.jsx("div",{className:"backdrop-blur-md bg-white/10 border border-white/20 rounded-xl p-6 text-sm text-gray-200 flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-400 mx-auto mb-4"}),e.jsx("p",{children:"Loading activity data..."})]})}):Object.keys(c||{}).length===0?e.jsx("div",{className:"backdrop-blur-md bg-white/10 border border-white/20 rounded-xl p-6 text-sm text-gray-300 text-center min-h-[400px] flex items-center justify-center",children:e.jsxs("div",{children:[e.jsx(Je,{className:"w-16 h-16 mx-auto mb-4 text-gray-500"}),e.jsx("p",{children:"No employee activity found."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("style",{children:`
        .activity-scrollbar::-webkit-scrollbar {
          width: 8px;
          height: 8px;
        }
        .activity-scrollbar::-webkit-scrollbar-track {
          background: rgba(255, 255, 255, 0.05);
          border-radius: 4px;
        }
        .activity-scrollbar::-webkit-scrollbar-thumb {
          background: rgba(148, 163, 184, 0.4);
          border-radius: 4px;
        }
        .activity-scrollbar::-webkit-scrollbar-thumb:hover {
          background: rgba(148, 163, 184, 0.6);
        }
      `}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-emerald-400 via-cyan-400 to-blue-400 bg-clip-text text-transparent mb-2",children:"Employee Activity Analytics"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Comprehensive tracking and insights for employee performance"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"backdrop-blur-md bg-gradient-to-br from-emerald-500/20 to-emerald-600/10 border border-emerald-500/30 rounded-xl p-4 hover:border-emerald-400/50 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs font-medium text-emerald-300 uppercase tracking-wider",children:"Total Orders"}),e.jsx(it,{className:"w-5 h-5 text-emerald-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-emerald-400 mb-1",children:Y.totalOrders}),e.jsx("div",{className:"text-xs text-gray-400",children:"Across all employees"})]}),e.jsxs("div",{className:"backdrop-blur-md bg-gradient-to-br from-blue-500/20 to-blue-600/10 border border-blue-500/30 rounded-xl p-4 hover:border-blue-400/50 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs font-medium text-blue-300 uppercase tracking-wider",children:"Created"}),e.jsx(Je,{className:"w-5 h-5 text-blue-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-400 mb-1",children:Y.totalCreated}),e.jsx("div",{className:"text-xs text-gray-400",children:"Orders created"})]}),e.jsxs("div",{className:"backdrop-blur-md bg-gradient-to-br from-cyan-500/20 to-cyan-600/10 border border-cyan-500/30 rounded-xl p-4 hover:border-cyan-400/50 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs font-medium text-cyan-300 uppercase tracking-wider",children:"Delivered"}),e.jsx(Rt,{className:"w-5 h-5 text-cyan-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-cyan-400 mb-1",children:Y.totalDelivered}),e.jsx("div",{className:"text-xs text-gray-400",children:"Orders delivered"})]}),e.jsxs("div",{className:"backdrop-blur-md bg-gradient-to-br from-purple-500/20 to-purple-600/10 border border-purple-500/30 rounded-xl p-4 hover:border-purple-400/50 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs font-medium text-purple-300 uppercase tracking-wider",children:"Total Revenue"}),e.jsx("svg",{className:"w-5 h-5 text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})]}),e.jsxs("div",{className:"text-2xl font-bold text-purple-400 mb-1",children:["â‚¹",Y.totalRevenue.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("div",{className:"text-xs text-gray-400",children:"Total revenue generated"})]})]})]}),e.jsxs("div",{className:"backdrop-blur-md bg-white/5 border border-white/10 rounded-xl p-5 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search orders, retailers...",value:T,onChange:l=>h(l.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-lg bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-all"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4 pointer-events-none"}),e.jsxs("select",{value:R,onChange:l=>F(l.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-all appearance-none cursor-pointer",children:[e.jsx("option",{value:"all",className:"bg-gray-900",children:"All Employees"}),Object.values(c).map(l=>{const x=l.flypEmployeeId||l.employeeId||"",g=l.employeeName||"Employee";return e.jsx("option",{value:x,className:"bg-gray-900",children:g},x)})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ft,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4 pointer-events-none"}),e.jsxs("select",{value:n,onChange:l=>y(l.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-all appearance-none cursor-pointer",children:[e.jsx("option",{value:"all",className:"bg-gray-900",children:"All Actions"}),e.jsx("option",{value:"created",className:"bg-gray-900",children:"Created Orders"}),e.jsx("option",{value:"accepted",className:"bg-gray-900",children:"Accepted Orders"}),e.jsx("option",{value:"shipped",className:"bg-gray-900",children:"Shipped Orders"}),e.jsx("option",{value:"delivered",className:"bg-gray-900",children:"Delivered Orders"}),e.jsx("option",{value:"modified",className:"bg-gray-900",children:"Modified Orders"}),e.jsx("option",{value:"rejected",className:"bg-gray-900",children:"Rejected Orders"}),e.jsx("option",{value:"added_retailer",className:"bg-gray-900",children:"Retailers Added"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Tt,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4 pointer-events-none"}),e.jsxs("select",{value:z,onChange:l=>S(l.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-all appearance-none cursor-pointer",children:[e.jsx("option",{value:"date-desc",className:"bg-gray-900",children:"Date: Newest First"}),e.jsx("option",{value:"date-asc",className:"bg-gray-900",children:"Date: Oldest First"}),e.jsx("option",{value:"revenue-desc",className:"bg-gray-900",children:"Revenue: High to Low"}),e.jsx("option",{value:"revenue-asc",className:"bg-gray-900",children:"Revenue: Low to High"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-300 mb-1.5 flex items-center gap-1",children:[e.jsx(Ye,{className:"w-3.5 h-3.5"}),"Start Date"]}),e.jsx("input",{type:"date",value:o.start?o.start instanceof Date?o.start.toISOString().split("T")[0]:new Date(o.start).toISOString().split("T")[0]:"",onChange:l=>V(x=>({...x,start:l.target.value?new Date(l.target.value):null})),className:"w-full px-4 py-2.5 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-all"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-300 mb-1.5 flex items-center gap-1",children:[e.jsx(Ye,{className:"w-3.5 h-3.5"}),"End Date"]}),e.jsx("input",{type:"date",value:o.end?o.end instanceof Date?o.end.toISOString().split("T")[0]:new Date(o.end).toISOString().split("T")[0]:"",onChange:l=>V(x=>({...x,end:l.target.value?new Date(l.target.value):null})),className:"w-full px-4 py-2.5 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-all"})]}),e.jsx("div",{className:"flex gap-2",children:(o.start||o.end)&&e.jsx("button",{onClick:()=>V({start:null,end:null}),className:"flex-1 px-4 py-2.5 rounded-lg bg-red-500/20 hover:bg-red-500/30 border border-red-400/30 text-red-300 text-sm font-medium transition-all hover:border-red-400/50",children:"Clear"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-300 mb-1.5",children:"Items per page"}),e.jsxs("select",{value:W,onChange:l=>ye(Number(l.target.value)),className:"w-full px-4 py-2.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-all appearance-none cursor-pointer",children:[e.jsx("option",{value:20,className:"bg-gray-900",children:"20 per page"}),e.jsx("option",{value:50,className:"bg-gray-900",children:"50 per page"}),e.jsx("option",{value:100,className:"bg-gray-900",children:"100 per page"}),e.jsx("option",{value:200,className:"bg-gray-900",children:"200 per page"})]})]})]}),ae.length>0&&e.jsx("div",{className:"pt-2 border-t border-white/10",children:e.jsxs("p",{className:"text-sm text-gray-400",children:["Showing ",e.jsx("span",{className:"font-semibold text-white",children:ae.length})," employee",ae.length!==1?"s":"",T&&` â€¢ "${T}"`]})})]}),e.jsx("div",{className:"space-y-5",children:ae.map(l=>{const x=l.flypEmployeeId||l.employeeId||"unknown",g=C[x],M=N.find(q=>q.flypEmployeeId===l.flypEmployeeId||q.id===l.employeeId),P=l.employeeName||M?.name||"Employee",Z=l.employeeRole||M?.role||"Employee",ee=l.flypEmployeeId||M?.flypEmployeeId||l.employeeId||"N/A",Q=O(l.filteredActivities||l.activities);return l.filteredActivities?.length||l.activities.length,e.jsxs("div",{className:"backdrop-blur-md bg-white/5 border border-white/10 rounded-xl overflow-hidden transition-all hover:border-white/20 hover:shadow-lg hover:shadow-emerald-500/10",children:[e.jsxs("div",{className:"p-6 cursor-pointer hover:bg-white/5 transition-all",onClick:()=>be(x),children:[e.jsxs("div",{className:"flex items-start justify-between gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:`flex-shrink-0 transform transition-transform duration-200 ${g?"rotate-180":""}`,children:g?e.jsx(Qe,{className:"w-5 h-5 text-gray-400"}):e.jsx(Ie,{className:"w-5 h-5 text-gray-400"})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 border-white/20 bg-gradient-to-br from-emerald-500/20 to-blue-500/20 flex items-center justify-center",children:M?.profilePictureUrl?e.jsx("img",{src:M.profilePictureUrl,alt:P,className:"w-full h-full object-cover",onError:q=>{q.target.style.display="none";const te=q.target.parentElement;if(te&&!te.querySelector("span")){const fe=document.createElement("span");fe.className="text-xl font-bold text-white",fe.textContent=P.charAt(0).toUpperCase(),te.appendChild(fe)}}}):e.jsx("span",{className:"text-xl font-bold text-white",children:P.charAt(0).toUpperCase()})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-3 mb-1",children:e.jsx("h3",{className:"text-xl font-bold text-white truncate",children:P})}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-400",children:[e.jsx("span",{className:"px-2.5 py-1 rounded-md bg-emerald-500/20 text-emerald-300 font-medium text-xs",children:Z}),e.jsx("span",{className:"text-gray-500",children:"â€¢"}),e.jsx("span",{className:"font-mono text-xs",children:ee})]})]})]}),e.jsxs("div",{className:"hidden lg:grid grid-cols-4 gap-4 text-center flex-shrink-0",children:[e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-blue-500/10 border border-blue-500/20",children:[e.jsx("div",{className:"text-xl font-bold text-blue-400",children:l.stats.created}),e.jsx("div",{className:"text-xs text-gray-400 mt-0.5",children:"Created"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsx("div",{className:"text-xl font-bold text-emerald-400",children:l.stats.delivered}),e.jsx("div",{className:"text-xs text-gray-400 mt-0.5",children:"Delivered"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-cyan-500/10 border border-cyan-500/20",children:[e.jsx("div",{className:"text-xl font-bold text-cyan-400",children:l.stats.added_retailer}),e.jsx("div",{className:"text-xs text-gray-400 mt-0.5",children:"Retailers"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-purple-500/10 border border-purple-500/20",children:[e.jsxs("div",{className:"text-lg font-bold text-purple-400 truncate",children:["â‚¹",l.stats.totalRevenue.toLocaleString("en-IN",{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-0.5",children:"Revenue"})]})]}),e.jsxs("button",{onClick:q=>{q.stopPropagation(),J(x)},className:"flex-shrink-0 px-4 py-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/30 text-blue-300 text-sm font-medium flex items-center gap-2 transition-all hover:border-blue-400/50",children:[e.jsx(Pt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-7 gap-2 mt-5",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/20 to-blue-600/10 border border-blue-500/30 rounded-lg p-3 text-center hover:border-blue-400/50 transition-all",children:[e.jsx("div",{className:"text-lg font-bold text-blue-300",children:l.stats.created}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Created"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-500/20 to-emerald-600/10 border border-emerald-500/30 rounded-lg p-3 text-center hover:border-emerald-400/50 transition-all",children:[e.jsx("div",{className:"text-lg font-bold text-emerald-300",children:l.stats.accepted}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Accepted"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-yellow-500/20 to-yellow-600/10 border border-yellow-500/30 rounded-lg p-3 text-center hover:border-yellow-400/50 transition-all",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-300",children:l.stats.shipped}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Shipped"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500/20 to-green-600/10 border border-green-500/30 rounded-lg p-3 text-center hover:border-green-400/50 transition-all",children:[e.jsx("div",{className:"text-lg font-bold text-green-300",children:l.stats.delivered}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Delivered"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/20 to-purple-600/10 border border-purple-500/30 rounded-lg p-3 text-center hover:border-purple-400/50 transition-all",children:[e.jsx("div",{className:"text-lg font-bold text-purple-300",children:l.stats.modified}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Modified"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cyan-500/20 to-cyan-600/10 border border-cyan-500/30 rounded-lg p-3 text-center hover:border-cyan-400/50 transition-all",children:[e.jsx("div",{className:"text-lg font-bold text-cyan-300",children:l.stats.added_retailer}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Retailers"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-500/20 to-emerald-600/10 border border-emerald-500/30 rounded-lg p-3 text-center hover:border-emerald-400/50 transition-all col-span-3 sm:col-span-1",children:[e.jsx("div",{className:"text-lg font-bold text-emerald-300",children:l.stats.totalOrders}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Total Orders"})]})]})]}),g&&e.jsx("div",{className:"border-t border-white/10 bg-white/2.5 p-6 space-y-4 max-h-[800px] overflow-y-auto activity-scrollbar",children:Object.entries(Q).map(([q,te])=>{if(te.length===0)return null;const fe=`${x}-${q}`,ke=f[fe]!==!1,Ve={created:"Created Orders",accepted:"Accepted Orders",shipped:"Shipped Orders",delivered:"Delivered Orders",modified:"Modified Orders",rejected:"Rejected Orders",added_retailer:"Retailers Added"},Fe={created:{bg:"from-blue-500/20 to-blue-600/10",border:"border-blue-500/30",text:"text-blue-300",badge:"bg-blue-500/20 text-blue-300"},accepted:{bg:"from-emerald-500/20 to-emerald-600/10",border:"border-emerald-500/30",text:"text-emerald-300",badge:"bg-emerald-500/20 text-emerald-300"},shipped:{bg:"from-yellow-500/20 to-yellow-600/10",border:"border-yellow-500/30",text:"text-yellow-300",badge:"bg-yellow-500/20 text-yellow-300"},delivered:{bg:"from-green-500/20 to-green-600/10",border:"border-green-500/30",text:"text-green-300",badge:"bg-green-500/20 text-green-300"},modified:{bg:"from-purple-500/20 to-purple-600/10",border:"border-purple-500/30",text:"text-purple-300",badge:"bg-purple-500/20 text-purple-300"},rejected:{bg:"from-red-500/20 to-red-600/10",border:"border-red-500/30",text:"text-red-300",badge:"bg-red-500/20 text-red-300"},added_retailer:{bg:"from-cyan-500/20 to-cyan-600/10",border:"border-cyan-500/30",text:"text-cyan-300",badge:"bg-cyan-500/20 text-cyan-300"}},me=Fe[q]||Fe.created,Te=te.reduce((G,ie)=>G+(ie.grandTotal||0),0),Se=`${x}-${q}`,xe=he[Se]||1,Ee=(xe-1)*W,Pe=Ee+W,Oe=te.slice(Ee,Pe),je=Math.ceil(te.length/W);return e.jsxs("div",{className:"backdrop-blur-sm bg-gradient-to-br from-white/5 to-white/2.5 rounded-xl border border-white/10 overflow-hidden hover:border-white/20 transition-all",children:[e.jsxs("div",{className:"p-4 cursor-pointer hover:bg-white/5 transition-all flex items-center justify-between",onClick:()=>de(x,q),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`flex-shrink-0 transform transition-transform duration-200 ${ke?"rotate-180":""}`,children:ke?e.jsx(Qe,{className:"w-4 h-4 text-gray-400"}):e.jsx(Ie,{className:"w-4 h-4 text-gray-400"})}),e.jsx("span",{className:`px-3 py-1.5 rounded-lg text-sm font-semibold ${me.badge} border ${me.border}`,children:Ve[q]||q.toUpperCase()}),e.jsxs("span",{className:"text-sm text-gray-400 font-medium",children:[te.length," ",te.length===1?"item":"items"]})]}),q==="created"&&Te>0&&e.jsxs("div",{className:`text-sm ${me.text} font-semibold ml-4 flex-shrink-0`,children:["Total: â‚¹",Te.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),ke&&e.jsx("div",{className:"border-t border-white/10 p-4 space-y-3",children:Oe.length===0?e.jsx("p",{className:"text-sm text-gray-400 text-center py-8",children:"No activities in this section"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:Oe.map((G,ie)=>e.jsx("div",{className:"bg-white/5 rounded-lg p-4 hover:bg-white/10 border border-white/10 hover:border-white/20 transition-all group",children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2.5 flex-wrap mb-2.5",children:[e.jsx("span",{className:`px-2.5 py-1 rounded-md text-xs font-semibold ${me.badge} border ${me.border}`,children:G.action==="added_retailer"?"ADDED RETAILER":G.action.toUpperCase()}),G.orderId&&e.jsxs("button",{onClick:Ze=>{Ze.stopPropagation(),ce(G.orderId)},className:"text-blue-300 hover:text-blue-200 text-sm font-mono flex items-center gap-1.5 px-2 py-1 rounded-md hover:bg-blue-500/20 transition-all",children:[e.jsx(Ot,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Order:"}),e.jsxs("span",{className:"font-medium",children:[G.orderId.substring(0,12),"..."]})]}),e.jsx("span",{className:"text-gray-200 font-medium truncate",children:G.retailerName||"N/A"}),G.grandTotal>0&&e.jsxs("span",{className:`text-sm font-bold ${me.text} ml-auto flex-shrink-0`,children:["â‚¹",G.grandTotal.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx(nt,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:B(G.orderDate)})]})]})})},`${G.orderId||G.retailerId||ie}-${G.action}`))}),je>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4 mt-4 border-t border-white/10",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Showing ",e.jsx("span",{className:"font-semibold text-white",children:Ee+1})," to ",e.jsx("span",{className:"font-semibold text-white",children:Math.min(Pe,te.length)})," of ",e.jsx("span",{className:"font-semibold text-white",children:te.length})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:G=>{G.stopPropagation(),ue(ie=>({...ie,[Se]:Math.max(1,xe-1)}))},disabled:xe===1,className:"px-4 py-1.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white/20 hover:border-white/30 transition-all font-medium",children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-400 px-3",children:["Page ",xe," of ",je]}),e.jsx("button",{onClick:G=>{G.stopPropagation(),ue(ie=>({...ie,[Se]:Math.min(je,xe+1)}))},disabled:xe===je,className:"px-4 py-1.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white/20 hover:border-white/30 transition-all font-medium",children:"Next"})]})]})]})})]},q)})})]},x)})}),A&&e.jsx(Vt,{orderId:A,orderData:pe,loading:m,onClose:i,currentUser:E,db:b})]})},is=()=>{const[c,N]=s.useState([]),[p,E]=s.useState([]),[b,C]=s.useState(""),[$,f]=s.useState(!0),[D,T]=s.useState({}),[h,n]=s.useState({}),[y,R]=s.useState(0),[F,o]=s.useState({open:!1,id:null,name:""}),[V,A]=s.useState(!1),[k,m]=s.useState(!1),[v,z]=s.useState(null),[S,W]=s.useState(!1),[ye,he]=s.useState(null),[ue,pe]=s.useState(!1),[ge,be]=s.useState(null),[de,ce]=s.useState([]),[i,d]=s.useState(!1),[O,I]=s.useState("manage"),[B,J]=s.useState("all"),[Y,ae]=s.useState("all"),[l,x]=s.useState([]),[g,M]=s.useState(!0),[P,Z]=s.useState({}),[ee,Q]=s.useState({}),[q,te]=s.useState(""),[fe,ke]=s.useState("all"),[Ve,Fe]=s.useState("all"),[me,Te]=s.useState({start:null,end:null}),[Se,xe]=s.useState(null),[Ee,Pe]=s.useState(!1),[Oe,je]=s.useState("date-desc"),[G,ie]=s.useState(20),[Ze,Kt]=s.useState({}),U=$e.currentUser;s.useEffect(()=>{if(!U?.uid)return;const t=et(Ne(re,"businesses",U.uid,"distributorEmployees")),a=Ue(t,u=>{const w=u.docs.map(H=>({id:H.id,...H.data()}));N(w),E(w),f(!1);const K=new Set(w.map(H=>H.role).filter(Boolean)),se=["Manager","Sales Executive","Order Manager","Dispatch Manager","Admin"],_=Array.from(K).filter(H=>!se.includes(H));ce(_)});return()=>a()},[U]),s.useEffect(()=>{const t=setInterval(()=>R(a=>a+1),1e3);return()=>clearInterval(t)},[]),s.useEffect(()=>{if(!F.open)return;const t=a=>{a.key==="Escape"&&o({open:!1,id:null,name:""})};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[F.open]),s.useEffect(()=>{const t=b.toLowerCase();let a=c.filter(u=>{if(t){const w=(u.flypEmployeeId||u.id||"").toString().toLowerCase();if(!(u.name?.toLowerCase().includes(t)||u.email?.toLowerCase().includes(t)||u.role?.toLowerCase().includes(t)||u.phone?.toLowerCase?.().includes(t)||w.includes(t)))return!1}return!(B!=="all"&&u.status!==B||Y!=="all"&&u.role!==Y)});E(a)},[b,c,B,Y]);const ot=async t=>{window.confirm("Are you sure you want to delete this employee?")&&(await kt(ne(re,"businesses",U.uid,"distributorEmployees",t)),j.success("Employee deleted successfully"))},dt=async(t,a)=>{if(!$e.currentUser){j.error("Please sign in again.");return}try{await $e.currentUser.getIdToken(!0)}catch(u){console.warn("Failed to refresh ID token before resetPin:",u)}try{const w=await Xe(He,"resetDistributorEmployeePin")({employeeId:t,distributorId:U.uid}),K=w?.data?.success??!1,se=w?.data?.newPin;if(!K||!se)throw new Error(w?.data?.message||"Reset failed");const _=t,H=Date.now()+120*1e3;T(le=>({...le,[_]:{pin:se,expiresAt:H}})),setTimeout(()=>{T(le=>{const X={...le};return delete X[_],X})},120*1e3);try{await navigator.clipboard.writeText(se),j.success(`PIN reset for "${a}". New PIN copied to clipboard.`)}catch{j.success(`PIN reset for "${a}". (Couldn't copy automatically)`),console.log("New PIN:",se)}}catch(u){console.error("Reset PIN Error:",u.code,u.message,u.details);const w=u?.code,K=u?.details,se=u?.message,_=w==="unauthenticated"?"You are not signed in.":w==="not-found"?"Employee not found.":K||se||"Something went wrong while resetting the PIN.";j.error(_)}},ct=async t=>{const a=t.status==="active"?"inactive":"active";try{await ve(ne(re,"businesses",U.uid,"distributorEmployees",t.id),{status:a}),j.success(`Status changed to ${a}`)}catch(u){console.error("Status update error:",u),j.error("Failed to update status. Please try again.")}},mt=t=>{if(!t?.toDate)return"-";const a=t.toDate(),w=Math.floor((new Date-a)/1e3);return w<60?"Just now":w<3600?`${Math.floor(w/60)} mins ago`:w<86400?a.toLocaleTimeString():a.toLocaleDateString()},xt=t=>{const a=Math.max(0,Math.ceil(t/1e3)),u=Math.floor(a/60),w=String(a%60).padStart(2,"0");return`${u}:${w}`},ht=(t,a)=>{o({open:!0,id:t,name:a})},ut=t=>{n(a=>({...a,[t]:!a[t]}))},pt=t=>{if(!t.pinExpiresAt)return!1;const a=t.pinExpiresAt?.toDate?t.pinExpiresAt.toDate():new Date(t.pinExpiresAt);return new Date>a},gt=t=>{if(pt(t))return"expired";if(t.pinCreatedAt){const a=t.pinCreatedAt?.toDate?t.pinCreatedAt.toDate():new Date(t.pinCreatedAt);if(Math.floor((new Date-a)/(1e3*60*60*24))>=25)return"expiring"}return"valid"},bt=async()=>{if(U?.uid){d(!0);try{const a=await Xe(He,"migrateEmployeeIds")({distributorId:U.uid});a.data.success?(j.success(a.data.message),window.location.reload()):j.error(a.data.message)}catch(t){console.error("Migration error:",t),j.error("Migration failed")}finally{d(!1)}}};s.useEffect(()=>{if(!U?.uid||O!=="activity")return;M(!0);let t=[],a=!1,u=!1;const w=()=>{a&&u&&(t.sort((le,X)=>X.orderDate-le.orderDate),x([...t]),M(!1))},K=Ne(re,"businesses",U.uid,"orderRequests"),se=Ue(K,le=>{t=t.filter(X=>X.action==="added_retailer"),le.docs.forEach(X=>{const r={id:X.id,...X.data()};if(!(Array.isArray(r.employeeActivity)&&r.employeeActivity.some(L=>L.action==="created"&&(L.employeeId||L.flypEmployeeId)))&&(r.creatorDetails?.type==="employee"||r.createdBy==="employee")){const L=r.creatorDetails||{};(L.employeeId||L.flypEmployeeId)&&t.push({employeeId:L.employeeId||null,flypEmployeeId:L.flypEmployeeId||null,employeeName:L.name||"Employee",employeeRole:L.role||"Employee",action:"created",orderId:r.id,orderDate:r.createdAt?.toDate?.()||r.timestamp?.toDate?.()||new Date,retailerName:r.retailerName||r.retailerBusinessName||"N/A",grandTotal:r.chargesSnapshot?.breakdown?.grandTotal||r.chargesSnapshot?.grandTotal||0})}r.handledBy?.acceptedBy?.type==="employee"&&t.push({employeeId:r.handledBy.acceptedBy.employeeId,flypEmployeeId:r.handledBy.acceptedBy.flypEmployeeId,employeeName:r.handledBy.acceptedBy.name||"Employee",employeeRole:r.handledBy.acceptedBy.role||"Employee",action:"accepted",orderId:r.id,orderDate:r.statusTimestamps?.acceptedAt?.toDate?.()||new Date,retailerName:r.retailerName||r.retailerBusinessName||"N/A",grandTotal:r.chargesSnapshot?.breakdown?.grandTotal||0}),r.handledBy?.shippedBy?.type==="employee"&&t.push({employeeId:r.handledBy.shippedBy.employeeId,flypEmployeeId:r.handledBy.shippedBy.flypEmployeeId,employeeName:r.handledBy.shippedBy.name||"Employee",employeeRole:r.handledBy.shippedBy.role||"Employee",action:"shipped",orderId:r.id,orderDate:r.statusTimestamps?.shippedAt?.toDate?.()||new Date,retailerName:r.retailerName||r.retailerBusinessName||"N/A",grandTotal:r.chargesSnapshot?.breakdown?.grandTotal||0}),r.handledBy?.deliveredBy?.type==="employee"&&t.push({employeeId:r.handledBy.deliveredBy.employeeId,flypEmployeeId:r.handledBy.deliveredBy.flypEmployeeId,employeeName:r.handledBy.deliveredBy.name||"Employee",employeeRole:r.handledBy.deliveredBy.role||"Employee",action:"delivered",orderId:r.id,orderDate:r.statusTimestamps?.deliveredAt?.toDate?.()||r.deliveredAt?new Date(r.deliveredAt):new Date,retailerName:r.retailerName||r.retailerBusinessName||"N/A",grandTotal:r.chargesSnapshot?.breakdown?.grandTotal||0}),r.handledBy?.modifiedBy?.type==="employee"&&t.push({employeeId:r.handledBy.modifiedBy.employeeId,flypEmployeeId:r.handledBy.modifiedBy.flypEmployeeId,employeeName:r.handledBy.modifiedBy.name||"Employee",employeeRole:r.handledBy.modifiedBy.role||"Employee",action:"modified",orderId:r.id,orderDate:r.updatedAt?.toDate?.()||new Date,retailerName:r.retailerName||r.retailerBusinessName||"N/A",grandTotal:r.chargesSnapshot?.breakdown?.grandTotal||0}),r.handledBy?.rejectedBy?.type==="employee"&&t.push({employeeId:r.handledBy.rejectedBy.employeeId,flypEmployeeId:r.handledBy.rejectedBy.flypEmployeeId,employeeName:r.handledBy.rejectedBy.name||"Employee",employeeRole:r.handledBy.rejectedBy.role||"Employee",action:"rejected",orderId:r.id,orderDate:r.statusTimestamps?.rejectedAt?.toDate?.()||new Date,retailerName:r.retailerName||r.retailerBusinessName||"N/A",grandTotal:r.chargesSnapshot?.breakdown?.grandTotal||0}),Array.isArray(r.employeeActivity)&&r.employeeActivity.length>0&&r.employeeActivity.forEach(L=>{L.action==="created"&&t.some(Be=>Be.orderId===r.id&&Be.action==="created"&&Be.employeeId===L.employeeId)||t.push({employeeId:L.employeeId,flypEmployeeId:L.flypEmployeeId||L.employeeId,employeeName:L.employeeName||"Employee",employeeRole:L.employeeRole||"Employee",action:L.action,orderId:r.id,orderDate:L.timestamp?.toDate?.()||(L.at?new Date(L.at):new Date),retailerName:r.retailerName||r.retailerBusinessName||"N/A",grandTotal:r.chargesSnapshot?.breakdown?.grandTotal||r.chargesSnapshot?.grandTotal||0})})}),a=!0,w()}),_=Ne(re,"businesses",U.uid,"connectedRetailers"),H=Ue(_,le=>{t=t.filter(X=>X.action!=="added_retailer"),le.docs.forEach(X=>{const r={id:X.id,...X.data()};r.addedBy?.type==="employee"&&t.push({employeeId:r.addedBy.id,flypEmployeeId:r.addedBy.flypEmployeeId,employeeName:r.addedBy.name||"Employee",employeeRole:r.addedBy.role||"Employee",action:"added_retailer",retailerId:r.id,retailerName:r.retailerName||r.businessName||"N/A",orderDate:r.createdAt?.toDate?.()||r.addedAt?.toDate?.()||new Date,grandTotal:0})}),u=!0,w()});return()=>{se(),H()}},[U,O]);const ft=s.useMemo(()=>{const t={};return l.forEach(a=>{const u=a.flypEmployeeId||a.employeeId||"unknown";t[u]||(t[u]={employeeId:a.employeeId,flypEmployeeId:a.flypEmployeeId||a.employeeId,employeeName:a.employeeName,employeeRole:a.employeeRole,activities:[],stats:{created:0,accepted:0,shipped:0,delivered:0,modified:0,rejected:0,added_retailer:0,totalOrders:0,totalRevenue:0}}),a.employeeName&&!t[u].employeeName&&(t[u].employeeName=a.employeeName),a.employeeRole&&!t[u].employeeRole&&(t[u].employeeRole=a.employeeRole),a.flypEmployeeId&&!t[u].flypEmployeeId&&(t[u].flypEmployeeId=a.flypEmployeeId),t[u].activities.push(a),a.action==="created"&&t[u].stats.created++,a.action==="accepted"&&t[u].stats.accepted++,a.action==="shipped"&&t[u].stats.shipped++,a.action==="delivered"&&t[u].stats.delivered++,a.action==="modified"&&t[u].stats.modified++,a.action==="rejected"&&t[u].stats.rejected++,a.action==="added_retailer"&&t[u].stats.added_retailer++;const w=new Set(t[u].activities.filter(K=>K.orderId).map(K=>K.orderId));t[u].stats.totalOrders=w.size,a.action==="delivered"&&(t[u].stats.totalRevenue+=a.grandTotal||0)}),c.forEach(a=>{a.flypEmployeeId||a.id,Object.keys(t).forEach(u=>{const w=t[u];(w.flypEmployeeId===a.flypEmployeeId||w.employeeId===a.id)&&(!w.employeeName&&a.name&&(w.employeeName=a.name),!w.employeeRole&&a.role&&(w.employeeRole=a.role),!w.flypEmployeeId&&a.flypEmployeeId&&(w.flypEmployeeId=a.flypEmployeeId),!w.employeeId&&a.id&&(w.employeeId=a.id))})}),t},[l,c]);return e.jsxs("div",{className:"w-full text-white",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex gap-6 mb-8 border-b border-white/10",children:[e.jsx("button",{onClick:()=>I("manage"),className:`pb-3 px-1 font-semibold text-sm transition-colors ${O==="manage"?"text-emerald-400 border-b-2 border-emerald-400":"text-slate-400 hover:text-slate-200"}`,children:"Manage Employees"}),e.jsx("button",{onClick:()=>I("activity"),className:`pb-3 px-1 font-semibold text-sm transition-colors ${O==="activity"?"text-emerald-400 border-b-2 border-emerald-400":"text-slate-400 hover:text-slate-200"}`,children:"Employee Activity Analytics"})]}),O==="manage"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Employee Management"}),e.jsx("p",{className:"text-slate-400",children:"Manage your team members, permissions, and access controls"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:bt,disabled:i,className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-slate-800/80 border border-slate-700/50 text-slate-200 hover:bg-slate-700/80 disabled:opacity-50 transition-all",children:[e.jsx(it,{className:"w-4 h-4"}),i?"Migrating...":"Migrate IDs"]}),e.jsxs("button",{onClick:()=>A(!0),className:"flex items-center gap-2 px-5 py-2.5 rounded-xl bg-emerald-500 text-white font-semibold hover:bg-emerald-600 transition-all shadow-lg shadow-emerald-500/20",children:[e.jsx(Ct,{className:"w-5 h-5"}),"Add Employee"]})]})]}),e.jsx("div",{className:"rounded-2xl border border-white/10 bg-white/5 backdrop-blur-sm p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative md:col-span-2",children:[e.jsx(Ge,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search by name, email, role, or ID...",value:b,onChange:t=>C(t.target.value),className:"w-full pl-12 pr-4 py-3 rounded-xl bg-slate-900/50 border border-slate-700/50 text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 transition-all"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:B,onChange:t=>J(t.target.value),className:"w-full pl-4 pr-10 py-3 rounded-xl bg-slate-900/50 border border-slate-700/50 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 appearance-none cursor-pointer",children:[e.jsx("option",{value:"all",className:"bg-slate-900",children:"All Statuses"}),e.jsx("option",{value:"active",className:"bg-slate-900",children:"Active"}),e.jsx("option",{value:"inactive",className:"bg-slate-900",children:"Inactive"})]}),e.jsx(Ie,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500 pointer-events-none"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:Y,onChange:t=>ae(t.target.value),className:"w-full pl-4 pr-10 py-3 rounded-xl bg-slate-900/50 border border-slate-700/50 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50 appearance-none cursor-pointer",children:[e.jsx("option",{value:"all",className:"bg-slate-900",children:"All Roles"}),e.jsx("option",{value:"Manager",className:"bg-slate-900",children:"Manager"}),e.jsx("option",{value:"Sales Executive",className:"bg-slate-900",children:"Sales Executive"}),e.jsx("option",{value:"Order Manager",className:"bg-slate-900",children:"Order Manager"}),e.jsx("option",{value:"Dispatch Manager",className:"bg-slate-900",children:"Dispatch Manager"}),e.jsx("option",{value:"Admin",className:"bg-slate-900",children:"Admin"})]}),e.jsx(Ie,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500 pointer-events-none"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"rounded-xl border border-white/10 bg-gradient-to-br from-slate-800/50 to-slate-900/50 p-5 backdrop-blur-sm",children:[e.jsx("div",{className:"text-xs font-medium text-slate-400 uppercase tracking-wider mb-2",children:"Total"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:c.length}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Employees"})]}),e.jsxs("div",{className:"rounded-xl border border-emerald-500/30 bg-gradient-to-br from-emerald-500/10 to-emerald-600/5 p-5 backdrop-blur-sm",children:[e.jsx("div",{className:"text-xs font-medium text-emerald-300 uppercase tracking-wider mb-2",children:"Active"}),e.jsx("div",{className:"text-3xl font-bold text-emerald-200",children:c.filter(t=>t.status==="active").length}),e.jsx("div",{className:"text-xs text-emerald-400/70 mt-1",children:"Currently active"})]}),e.jsxs("div",{className:"rounded-xl border border-sky-500/30 bg-gradient-to-br from-sky-500/10 to-sky-600/5 p-5 backdrop-blur-sm",children:[e.jsx("div",{className:"text-xs font-medium text-sky-300 uppercase tracking-wider mb-2",children:"Online"}),e.jsx("div",{className:"text-3xl font-bold text-sky-200",children:c.filter(t=>t.online).length}),e.jsx("div",{className:"text-xs text-sky-400/70 mt-1",children:"Currently online"})]}),e.jsxs("div",{className:"rounded-xl border border-purple-500/30 bg-gradient-to-br from-purple-500/10 to-purple-600/5 p-5 backdrop-blur-sm",children:[e.jsx("div",{className:"text-xs font-medium text-purple-300 uppercase tracking-wider mb-2",children:"Assigned"}),e.jsx("div",{className:"text-3xl font-bold text-purple-200",children:c.filter(t=>t.zones?.length>0||t.assignedRetailers?.length>0).length}),e.jsx("div",{className:"text-xs text-purple-400/70 mt-1",children:"With assignments"})]})]})]}),$?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-400 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading employees..."})]})}):p.length===0?e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 backdrop-blur-sm p-12 text-center",children:[e.jsx(we,{className:"w-16 h-16 mx-auto mb-4 text-slate-600"}),e.jsx("p",{className:"text-slate-300 text-lg mb-2",children:"No employees found"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Try adjusting your search or filters"})]}):e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 backdrop-blur-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-900/50 border-b border-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider",children:"Employee"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider",children:"Assignments"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider",children:"PIN"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-slate-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:p.map(t=>{const a=gt(t),u=h[t.flypEmployeeId||t.id],w=t.flypEmployeeId||t.id,K=D[w],se=t.accessSections?Object.entries(t.accessSections).filter(([_,H])=>H).length:0;return e.jsxs("tr",{className:"hover:bg-white/5 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"relative h-10 w-10 rounded-full overflow-hidden border-2 border-white/20 bg-gradient-to-br from-emerald-500/20 to-blue-500/20 flex items-center justify-center flex-shrink-0",children:t.profilePictureUrl?e.jsx("img",{src:t.profilePictureUrl,alt:t.name||"Employee",className:"h-full w-full object-cover",onError:_=>{_.target.style.display="none",_.target.parentElement.innerHTML=`<span class="text-sm font-bold text-white">${(t.name||"E").charAt(0).toUpperCase()}</span>`}}):e.jsx("span",{className:"text-sm font-bold text-white",children:(t.name||"E").charAt(0).toUpperCase()})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-white truncate",children:t.name||"Unnamed Employee"}),t.online&&e.jsx("div",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-pulse flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-slate-400 font-mono truncate",children:t.flypEmployeeId||t.id||"No ID"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[t.email&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-300",children:[e.jsx(rt,{className:"w-3.5 h-3.5 text-slate-500 flex-shrink-0"}),e.jsx("span",{className:"truncate max-w-[200px]",children:t.email})]}),t.phone&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-300",children:[e.jsx(at,{className:"w-3.5 h-3.5 text-slate-500 flex-shrink-0"}),e.jsx("span",{children:t.phone})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(Gt,{employee:t,currentUser:U,customRoles:de,onRoleChange:async _=>{_&&!["Manager","Sales Executive","Order Manager","Dispatch Manager","Admin",...de].includes(_)&&ce(H=>[...H,_]),await ve(ne(re,"businesses",U.uid,"distributorEmployees",t.id),{role:_}),j.success(`Role updated to ${_}`)}})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>ct(t),className:`w-fit px-3 py-1.5 rounded-lg text-xs font-medium border transition-all ${t.status==="active"?"bg-emerald-500/10 text-emerald-200 border-emerald-400/30 hover:bg-emerald-500/20":"bg-slate-700/40 text-slate-300 border-slate-600/50 hover:bg-slate-700/60"}`,children:t.status==="active"?"Active":"Inactive"}),!t.online&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-500",children:[e.jsx(nt,{className:"w-3 h-3"}),e.jsx("span",{children:mt(t.lastSeen)})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>{z(t),m(!0)},className:"px-2.5 py-1 rounded-md bg-purple-500/20 hover:bg-purple-500/30 border border-purple-400/30 text-purple-300 text-xs transition-all",children:[e.jsx(Ae,{className:"w-3.5 h-3.5 inline mr-1"}),"Assign"]})}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[t.zones?.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-md bg-purple-500/10 border border-purple-400/20 text-purple-300 text-xs",children:[t.zones.length," zone",t.zones.length>1?"s":""]}),t.assignedRetailers?.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-md bg-emerald-500/10 border border-emerald-400/20 text-emerald-300 text-xs",children:[t.assignedRetailers.length," retailer",t.assignedRetailers.length>1?"s":""]}),!t.zones?.length&&!t.assignedRetailers?.length&&e.jsx("span",{className:"text-xs text-slate-500 italic",children:"None"})]}),e.jsxs("button",{onClick:()=>{be(t),pe(!0)},className:"text-xs text-slate-400 hover:text-slate-200 transition-colors",children:[se," permission",se!==1?"s":""]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"space-y-2",children:K&&K.expiresAt>Date.now()?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-amber-200",children:"New PIN:"}),e.jsx("div",{className:"font-mono text-sm font-bold text-amber-300",children:K.pin}),e.jsxs("div",{className:"text-xs text-amber-400",children:["Expires in ",xt(K.expiresAt-Date.now())]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full border ${a==="expired"?"bg-rose-500/10 text-rose-300 border-rose-500/30":a==="expiring"?"bg-amber-500/10 text-amber-300 border-amber-500/30":"bg-emerald-500/10 text-emerald-300 border-emerald-500/30"}`,children:a}),e.jsx("button",{onClick:()=>ht(w,t.name),className:"text-xs text-amber-300 hover:text-amber-200 underline",children:"Reset"})]}),e.jsx("button",{onClick:()=>ut(w),className:`w-full px-2 py-1.5 rounded-md border text-xs font-mono transition-all ${a==="expired"?"border-red-400/30 bg-red-500/10 text-red-200":a==="expiring"?"border-yellow-400/30 bg-yellow-500/10 text-yellow-200":"border-emerald-400/30 bg-emerald-500/10 text-emerald-200"}`,children:u?t.pin||"No PIN":"â€¢â€¢â€¢â€¢â€¢â€¢"})]})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("a",{href:`${typeof window<"u"&&window.location?window.location.origin:"https://flypnow.com"}/distributor-employee-login?distributorId=${encodeURIComponent(U?.uid)}&empId=${encodeURIComponent(t.flypEmployeeId||t.id)}`,target:"_blank",rel:"noopener noreferrer",className:"w-8 h-8 rounded-lg bg-sky-500/20 hover:bg-sky-500/30 border border-sky-400/30 text-sky-200 flex items-center justify-center transition-all",title:"Open Login Link",children:e.jsx(At,{className:"w-4 h-4"})}),e.jsx("button",{onClick:async()=>{try{const H=`${typeof window<"u"&&window.location?window.location.origin:"https://flypnow.com"}/distributor-employee-login?distributorId=${encodeURIComponent(U?.uid)}&empId=${encodeURIComponent(t.flypEmployeeId||t.id)}`;if(navigator.share)try{await navigator.share({title:"Employee Login Link",text:`Login link for ${t.name}`,url:H}),j.success("Link shared!");return}catch(le){if(le.name!=="AbortError")console.log("Share failed:",le);else return}await navigator.clipboard.writeText(H),j.success("Link copied to clipboard!")}catch{j.error("Failed to copy link")}},className:"w-8 h-8 rounded-lg bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-400/30 text-emerald-200 flex items-center justify-center transition-all",title:"Share or Copy Login Link",children:e.jsx(It,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{he(t),W(!0)},className:"w-8 h-8 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/30 text-blue-200 flex items-center justify-center transition-all",title:"Edit",children:e.jsx(Dt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ot(t.id),className:"w-8 h-8 rounded-lg bg-rose-500/20 hover:bg-rose-500/30 border border-rose-400/30 text-rose-200 flex items-center justify-center transition-all",title:"Delete",children:e.jsx(st,{className:"w-4 h-4"})})]})})]},t.id)})})]})}),e.jsx("div",{className:"px-6 py-4 border-t border-white/10 bg-slate-900/30",children:e.jsxs("div",{className:"text-sm text-slate-400",children:["Showing ",e.jsx("span",{className:"text-white font-semibold",children:p.length})," of"," ",e.jsx("span",{className:"text-white font-semibold",children:c.length})," employees"]})})]})]}):e.jsx(Zt,{activitiesByEmployee:ft,employees:c,loadingActivity:g,currentUser:U,db:re})]}),e.jsx(qt,{open:F.open,name:F.name,onCancel:()=>o({open:!1,id:null,name:""}),onConfirm:async()=>{const{id:t,name:a}=F;o({open:!1,id:null,name:""}),await dt(t,a)}}),e.jsx($t,{open:V,onClose:()=>A(!1),distributorId:U?.uid,onCreated:()=>{A(!1),j.success("Employee created successfully!")}}),e.jsx(Ut,{open:k,onClose:()=>{m(!1),z(null)},employee:v,distributorId:U?.uid},v?.id||"modal"),e.jsx(zt,{open:S,onClose:()=>{W(!1),he(null)},employee:ye,currentUser:U}),e.jsx(_t,{open:ue,onClose:()=>{pe(!1),be(null)},employee:ge,currentUser:U})]})};export{is as default};
