import{d as f,j as e}from"./index-DRC3F7i0.js";import{r as N}from"./router-BPBaD_i0.js";import{i as ye,t as je,c as T,p as ve,d as g,e as y,g as Z,u as we,s as Ie,l as De}from"./firebase-DWi1MSv1.js";import{s as B}from"./pricing-SUVGnFgL.js";import{p as Re,F as Oe}from"./FileSaver.min-DVuNBBJs.js";import{D as Pe}from"./DistributorInvoicePdf-o0mROIQ5.js";import{a0 as Te,a1 as Se,a2 as Ee,r as Ae}from"./index-CprmGC-M.js";import{O as ee}from"./orderStatus-BwkCpksU.js";import"./vendor-Ckhrjn13.js";import"./index.esm-Bux_mLJ0.js";import"./index-CbpqHhv-.js";import"./bidi-DLACMwmw.js";const n={RETAILER:"retailer",MANUAL:"manual",PRODUCT_OWNER:"productOwner"},Ve=()=>{const se=ye(),[x,_]=N.useState(null),[R,te]=N.useState([]),[W,I]=N.useState(!0),[t,G]=N.useState(null),[b,S]=N.useState(null),[E,A]=N.useState(!1),[C,z]=N.useState(!1),[p,re]=N.useState(n.RETAILER),[v,ae]=N.useState({}),[ie,V]=N.useState(!1),q=async(s,r,i)=>{try{const d=T(f,"businesses",i,"invoices"),u=g(d,s);if(!(await y(u)).exists()){console.log("[DistributorInvoices] Creating invoice for product owner order:",s);const l=await y(g(f,"businesses",i)),a=l.exists()?l.data():{},o=r.productOwnerId;let m={};if(o)try{const P=await y(g(f,"businesses",o));m=P.exists()?P.data():{}}catch(P){console.warn("[DistributorInvoices] Could not fetch product owner profile:",P)}const j={businessId:o||null,businessName:m.businessName||r.productOwnerName||"Product Owner",email:m.email||r.productOwnerEmail||null,phone:m.phone||r.productOwnerPhone||null,city:m.city||r.productOwnerCity||null,state:m.state||r.productOwnerState||null},F={businessId:i,businessName:a.businessName||a.ownerName||a.name||null,email:a.email||null,phone:a.phone||null,city:a.city||null,state:a.state||null,gstNumber:a.gstNumber||a.gstin||null},h=r?.chargesSnapshot?.breakdown||r?.proforma;let O={grandTotal:h?.grandTotal?Number(h.grandTotal):r.grandTotal||r.itemsSubTotal||0};h&&(O={grossItems:Number(h.grossItems||0),lineDiscountTotal:Number(h.lineDiscountTotal||0),itemsSubTotal:Number(h.itemsSubTotal||h.subTotal||0),delivery:Number(h.delivery||0),packing:Number(h.packing||0),insurance:Number(h.insurance||0),other:Number(h.other||0),discountTotal:Number(h.discountTotal||0),taxableBase:Number(h.taxableBase||0),taxType:h.taxType||"CGST_SGST",taxBreakup:h.taxBreakup||{},roundOff:Number(h.roundOff||0),grandTotal:Number(h.grandTotal||0)});const X=r.invoiceNumber||`INV-${(s||"").slice(-6).toUpperCase()}`,D=r?.isPaid===!0||r?.paymentStatus==="Paid"||r?.payment?.isPaid===!0,Y=r?.paymentMode||r?.payment?.mode||r?.paymentNormalized?.code||"COD",J=r?.paymentModeLabel||r?.payment?.normalized?.label||Y,ge={orderId:s,invoiceNumber:X,distributorId:i,productOwnerId:o||null,retailerId:null,buyer:j,seller:F,totals:O,payment:{mode:J,normalized:r?.paymentNormalized||{code:Y,label:J},isPaid:D,status:D?"Paid":r?.paymentMode?.toLowerCase()==="credit"?"Payment Due":"Pending"},deliveryDetails:r.deliveryDetails||null,deliveryMode:r.deliveryMode||null,expectedDeliveryDate:r.expectedDeliveryDate||null,issuedAt:new Date().toISOString(),createdAt:Ie(),status:D?"Paid":"Issued",paymentStatus:D?"Paid":"Pending",isPaid:D,source:"product-owner-order"};return await De(u,ge,{merge:!0}),console.log("[DistributorInvoices] Invoice created for product owner order:",s),!0}return!1}catch(d){return console.error("[DistributorInvoices] Failed to create invoice for product owner order:",s,d),!1}},ne=async()=>{if(!(!x||ie))try{console.log("[DistributorInvoices] Starting backfill for product owner invoices..."),V(!0);const s=T(f,`businesses/${x}/productOwnerOrders`),r=await Z(s);let i=0;for(const c of r.docs){const l={id:c.id,...c.data()},a=l.statusCode||l.status;if(a===ee.DELIVERED||a==="Delivered"||a==="DELIVERED"){const o=g(f,`businesses/${x}/invoices`,l.id);(await y(o)).exists()||await q(l.id,l,x)&&i++}}const d=T(f,`businesses/${x}/sentOrdersToProductOwners`),u=await Z(d);for(const c of u.docs){const l={id:c.id,...c.data()},a=l.statusCode||l.status;if(a===ee.DELIVERED||a==="Delivered"||a==="DELIVERED"){const o=g(f,`businesses/${x}/invoices`,l.id);(await y(o)).exists()||await q(l.id,l,x)&&i++}}i>0?console.log(`[DistributorInvoices] Backfill complete: Created ${i} invoices for delivered product owner orders`):console.log("[DistributorInvoices] Backfill complete: No new invoices needed")}catch(s){console.error("[DistributorInvoices] Error during backfill:",s),V(!1)}},L=N.useMemo(()=>{if(!t)return{label:"Pending",isPaid:!1};if(b&&(b.isPaid===!0||b.paymentStatus==="Paid"||b.payment?.isPaid===!0))return{label:"Paid",isPaid:!0};const s=t.payment||{};if(typeof s.isPaid=="boolean")return{label:s.isPaid?"Paid":"Pending",isPaid:s.isPaid};const i=(s.status||t.paymentStatus||t.payment?.paymentStatus||t.isPaid!==void 0?t.isPaid?"Paid":"Pending":"").toString().trim().toLowerCase();return["paid","complete","completed","success","successful"].includes(i)?{label:"Paid",isPaid:!0}:["pending","unpaid","due","awaiting"].includes(i)?{label:"Pending",isPaid:!1}:{label:i?i.charAt(0).toUpperCase()+i.slice(1):"Pending",isPaid:!1}},[t,b]);N.useEffect(()=>{const s=je(se,r=>{r?_(r.uid):(_(null),I(!1))});return()=>s()},[]),N.useEffect(()=>{if(!x){I(!1);return}ne(),console.log("[DistributorInvoices] Fetching invoices for distributorId:",x);const s=T(f,`businesses/${x}/invoices`),r=ve(s,async i=>{try{console.log("[DistributorInvoices] Snapshot received, size:",i.size);const d=[],u={};i.forEach(a=>{try{const o={id:a.id,...a.data()};console.log("[DistributorInvoices] Invoice found:",a.id,o),d.push(o)}catch(o){console.error("[DistributorInvoices] Error parsing invoice:",a.id,o)}});const c=async(a,o)=>{if(!a.orderId)return n.MANUAL;if(a.retailerId||a.source==="distributor-track-orders")return n.RETAILER;try{if(o){const m=g(f,`businesses/${o}/productOwnerOrders/${a.orderId}`);if((await y(m)).exists())return n.PRODUCT_OWNER;const F=g(f,`businesses/${o}/sentOrdersToProductOwners/${a.orderId}`);if((await y(F)).exists())return n.PRODUCT_OWNER;const O=g(f,`businesses/${o}/orderRequests/${a.orderId}`);if((await y(O)).exists())return n.RETAILER}}catch(m){console.error("[DistributorInvoices] Error checking order type:",a.orderId,m)}return n.PRODUCT_OWNER},l=d.filter(a=>a.orderId).map(async a=>{try{const o=await c(a,x);return{orderId:a.orderId,category:o}}catch(o){return console.error("[DistributorInvoices] Error categorizing invoice:",a.id,o),{orderId:a.orderId,category:n.PRODUCT_OWNER}}});l.length>0&&(await Promise.all(l)).forEach(({orderId:o,category:m})=>{o&&(u[o]=m)}),ae(u),d.sort((a,o)=>{const m=a.issuedAt?new Date(a.issuedAt).getTime():0;return(o.issuedAt?new Date(o.issuedAt).getTime():0)-m}),console.log("[DistributorInvoices] Setting invoices, count:",d.length),te(d),I(!1)}catch(d){console.error("[DistributorInvoices] Error processing invoices:",d),I(!1)}},i=>{console.error("[DistributorInvoices] Error loading invoices:",i),I(!1)});return()=>r()},[x]);const w=N.useMemo(()=>{const s={[n.RETAILER]:[],[n.MANUAL]:[],[n.PRODUCT_OWNER]:[]};return!R||R.length===0||R.forEach(r=>{try{!r||!r.orderId?s[n.MANUAL].push(r):r.retailerId||r.source==="distributor-track-orders"?s[n.RETAILER].push(r):r.source==="product-owner-order"||r.productOwnerId?s[n.PRODUCT_OWNER].push(r):v&&v[r.orderId]?s[v[r.orderId]].push(r):s[n.PRODUCT_OWNER].push(r)}catch(i){console.error("[DistributorInvoices] Error categorizing invoice:",r?.id,i),s[n.MANUAL].push(r)}}),s},[R,v]),H=N.useMemo(()=>w[p]||[],[w,p]),le=N.useMemo(()=>({[n.RETAILER]:w[n.RETAILER].length,[n.MANUAL]:w[n.MANUAL].length,[n.PRODUCT_OWNER]:w[n.PRODUCT_OWNER].length}),[w]),k=s=>{switch(s){case n.RETAILER:return"Retailer Orders";case n.MANUAL:return"Manual Billing";case n.PRODUCT_OWNER:return"Product Owner Orders";default:return"All"}},M=s=>{switch(s){case n.RETAILER:return e.jsx(Ae,{className:"text-lg"});case n.MANUAL:return e.jsx(Ee,{className:"text-lg"});case n.PRODUCT_OWNER:return e.jsx(Se,{className:"text-lg"});default:return e.jsx(Te,{className:"text-lg"})}},oe=s=>s.buyer?.businessName?s.buyer.businessName:p===n.RETAILER?s.buyer?.businessName||"Retailer":p===n.PRODUCT_OWNER?"Product Owner":s.buyer?.businessName||s.customer?.businessName||"Customer",de=async s=>{if(!s){console.error("[DistributorInvoices] handleViewInvoice: invoice is null/undefined");return}if(G(s),A(!0),S(null),s.orderId&&x)try{let r=null;const i=s.orderId?s.retailerId||s.source==="distributor-track-orders"?n.RETAILER:v&&v[s.orderId]||n.PRODUCT_OWNER:n.MANUAL;if(i===n.RETAILER)r=g(f,`businesses/${x}/orderRequests`,s.orderId);else if(i===n.PRODUCT_OWNER){const d=g(f,`businesses/${x}/productOwnerOrders`,s.orderId);if((await y(d)).exists())r=d;else{const c=g(f,`businesses/${x}/sentOrdersToProductOwners`,s.orderId);(await y(c)).exists()&&(r=c)}}else r=g(f,`businesses/${x}/orderRequests`,s.orderId);if(r){const d=await y(r);if(d.exists()){const u={id:d.id,...d.data()};if(S(u),u.deliveryDetails&&Object.keys(u.deliveryDetails).length>0&&(!s.deliveryDetails||Object.keys(s.deliveryDetails).length===0)){const c=g(f,`businesses/${x}/invoices`,s.id);we(c,{deliveryDetails:u.deliveryDetails,deliveryMode:u.deliveryMode||s.deliveryMode,expectedDeliveryDate:u.expectedDeliveryDate||s.expectedDeliveryDate}).catch(l=>{console.error("[DistributorInvoices] Error updating invoice deliveryDetails:",l)})}}}}catch(r){console.error("[DistributorInvoices] Error fetching order data:",r)}finally{A(!1)}else A(!1)},ce=()=>{G(null),S(null)},K=s=>{if(!s)return null;if(s instanceof Date)return s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){const r=new Date(s);return Number.isNaN(r.getTime())?null:r}return s?.seconds?new Date(s.seconds*1e3):s?.toDate?s.toDate():null},$=(s,r={day:"2-digit",month:"short",year:"numeric"})=>{const i=K(s);return i?i.toLocaleDateString("en-IN",r):"N/A"},Q=s=>{const r=K(s);return r?r.toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"},U=s=>`â‚¹${Number(s||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,ue=s=>{const r=s?.invoiceNumber||s?.id||"invoice",i=$(s?.issuedAt).replace(/\s+/g,"-");return`${r}-${i}.pdf`},me=async()=>{if(t)try{z(!0);const r=await Re(e.jsx(Pe,{invoice:t,order:b})).toBlob();Oe.saveAs(r,ue(t))}catch(s){console.error("[DistributorInvoices] Failed to generate PDF",s)}finally{z(!1)}},xe=()=>{if(!t||!x)return null;const s=t.id;return`${window.location.origin}/invoice/${x}/${s}`},pe=()=>{if(!t)return null;const s=t.buyer?.phone,r=s?s.toString().replace(/\D/g,""):"",i=t.invoiceNumber||t.id,d=U(t.totals?.grandTotal||0),u=Q(t.issuedAt),c=t.seller?.businessName||t.seller?.name||"our team",l=xe(),a=[`Invoice ${i}`,`Amount: ${d}`,`Issued: ${u}`,"","View and download your digital invoice:",l||"Link unavailable","",`Thank you for ordering from ${c}.`].join(`
`).trim(),o=encodeURIComponent(a);return`${r?`https://wa.me/${r}`:"https://wa.me/"}?text=${o}`},he=()=>{const s=pe();s&&window.open(s,"_blank","noopener,noreferrer")},be=()=>{if(!t)return;const s=t.invoiceNumber||t.id,r=t.seller?.businessName||t.seller?.name||"our team",i=U(t.totals?.grandTotal||0),d=Q(t.issuedAt),u=L.label,c=t.buyer?.email||"",l=`Invoice ${s} from ${r}`,a=`Hello ${t.buyer?.businessName||""},

Please find your invoice details below:
Invoice: ${s}
Amount: ${i}
Issued: ${d}
Status: ${u}

We have attached the invoice PDF for your reference.

Regards,
${r}`,o=`mailto:${c}?subject=${encodeURIComponent(l)}&body=${encodeURIComponent(a)}`;window.open(o,"_blank")},fe=s=>{if(!s)return"N/A";const r=s.payment||{};return r.mode||r.normalized?.label||r.normalized?.mode||s.paymentMode||s.paymentUi||"N/A"},Ne=(s,r,i)=>{const d=i.pricingMode||"LEGACY",u=Number(i.basePrice||0),c=Number(i.mrp||0),l=Number(i.sellingPrice||i.price||i.unitPrice||0),a=Number(i.gstRate||i.taxRate||0),o=Array.isArray(s?.proforma?.lines)?s.proforma.lines[r]:void 0,m=o?.gstRate!==void 0?Number(o.gstRate):a;return d==="MRP_INCLUSIVE"?c>0&&m>0?B(c,m).base:c||l:d==="SELLING_PRICE"?l>0&&m>0?B(l,m).base:l:d==="BASE_PLUS_TAX"?u>0?u:l>0&&m>0?B(l,m).base:l:u||l};return W?e.jsx("div",{className:"p-6 text-white/70 text-lg font-medium text-center py-12",children:"Loading invoices..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-white via-white to-emerald-200",children:"Distributor Invoices"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Organized by source for easy accounting and tracking"})]}),e.jsx("div",{className:"mb-6 flex flex-wrap gap-3 border-b border-white/10 pb-4",children:Object.values(n).map(s=>e.jsxs("button",{onClick:()=>re(s),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all ${p===s?"bg-emerald-500/20 text-emerald-300 border border-emerald-400/30 shadow-lg shadow-emerald-500/10":"bg-white/5 text-white/70 hover:bg-white/10 border border-white/10"}`,children:[M(s),e.jsx("span",{children:k(s)}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${p===s?"bg-emerald-500/30 text-emerald-200":"bg-white/10 text-white/60"}`,children:le[s]})]},s))}),e.jsx("div",{className:"mb-4 p-4 bg-white/5 rounded-lg border border-white/10",children:e.jsxs("div",{className:"flex items-start gap-3",children:[M(p),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white mb-1",children:k(p)}),e.jsxs("p",{className:"text-sm text-white/60",children:[p===n.RETAILER&&"Automated invoices generated from retailer order requests. These invoices are created automatically when orders are marked as delivered.",p===n.MANUAL&&"Manually created invoices for direct sales or custom billing. These are created through the manual billing interface.",p===n.PRODUCT_OWNER&&"Invoices for orders received from product owners. These represent purchases made by the distributor from product owners."]})]})]})}),W?e.jsx("div",{className:"text-white/70 text-lg font-medium text-center py-12",children:"Loading invoices..."}):H.length===0?e.jsxs("div",{className:"text-center py-12 bg-white/5 rounded-lg border border-white/10",children:[e.jsx("div",{className:"text-6xl mb-4 opacity-50",children:M(p)}),e.jsxs("p",{className:"text-white/70 text-lg mb-2",children:["No ",k(p).toLowerCase()," found"]}),e.jsxs("p",{className:"text-white/50 text-sm",children:[p===n.RETAILER&&"Invoices will appear here when retailer orders are marked as delivered.",p===n.MANUAL&&"Create invoices manually through the Manual Billing section.",p===n.PRODUCT_OWNER&&"Invoices from product owner orders will appear here."]})]}):e.jsx("div",{className:"overflow-x-auto mt-4 border border-white/10 rounded-lg shadow-lg bg-white/5",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-white/10 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Invoice No"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:p===n.RETAILER?"Retailer":p===n.PRODUCT_OWNER?"Product Owner":"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Issued At"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Payment Status"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:H.map(s=>{const r=s.payment?.isPaid||s.isPaid?"Paid":"Pending";return e.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-white font-medium",children:s.invoiceNumber||s.id}),e.jsx("td",{className:"px-4 py-3 text-white/80",children:oe(s)}),e.jsxs("td",{className:"px-4 py-3 text-emerald-400 font-semibold",children:["â‚¹",(s.totals?.grandTotal||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{className:"px-4 py-3 text-white/70",children:s.issuedAt?new Date(s.issuedAt).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"--"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r==="Paid"?"bg-emerald-500/20 text-emerald-300 border border-emerald-400/30":"bg-amber-500/20 text-amber-300 border border-amber-400/30"}`,children:r})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{className:"px-4 py-1.5 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/30 text-blue-300 rounded-lg font-medium transition-all hover:scale-105",onClick:()=>de(s),children:"View"})})]},s.id)})})]})}),t&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white text-slate-900 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-slate-200",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-slate-200 px-6 py-4 flex flex-wrap gap-3 items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-400",children:"Invoice"}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:t.invoiceNumber||t.id})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 ml-auto",children:[e.jsx("button",{onClick:me,disabled:C||E,className:`px-4 py-2 rounded-lg text-sm font-semibold transition ${C||E?"bg-slate-400 text-white cursor-not-allowed":"bg-slate-900 text-white hover:bg-slate-800"}`,children:C?"Preparing PDF...":"Download PDF"}),e.jsx("button",{onClick:he,className:"px-4 py-2 rounded-lg bg-emerald-500 text-slate-900 text-sm font-semibold hover:bg-emerald-400 transition",children:"Share on WhatsApp"}),e.jsx("button",{onClick:be,className:"px-4 py-2 rounded-lg bg-cyan-500 text-slate-900 text-sm font-semibold hover:bg-cyan-400 transition",children:"Send via Email"}),e.jsx("button",{onClick:ce,className:"ml-auto text-slate-400 hover:text-slate-600 text-2xl leading-none px-2",children:"Ã—"})]})]}),e.jsxs("div",{className:"p-6 space-y-6 bg-white",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 border border-slate-200 rounded-lg bg-slate-50",children:[e.jsx("p",{className:"text-xs uppercase text-slate-500",children:"Invoice Number"}),e.jsx("p",{className:"font-semibold text-xl",children:t.invoiceNumber||t.id})]}),e.jsxs("div",{className:"p-4 border border-slate-200 rounded-lg bg-slate-50",children:[e.jsx("p",{className:"text-xs uppercase text-slate-500",children:"Issued Date"}),e.jsx("p",{className:"font-semibold text-lg",children:$(t.issuedAt)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl border border-emerald-100 bg-emerald-50",children:[e.jsx("p",{className:"text-xs uppercase text-emerald-700",children:"Grand Total"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-900",children:U(t.totals?.grandTotal||0)})]}),e.jsxs("div",{className:"p-4 rounded-xl border border-slate-200 bg-slate-50",children:[e.jsx("p",{className:"text-xs uppercase text-slate-500",children:"Payment Status"}),e.jsx("p",{className:`text-xl font-semibold ${L.isPaid?"text-emerald-700":"text-amber-600"}`,children:L.label})]}),e.jsxs("div",{className:"p-4 rounded-xl border border-slate-200 bg-slate-50",children:[e.jsx("p",{className:"text-xs uppercase text-slate-500",children:"Payment Method"}),e.jsx("p",{className:"text-lg font-semibold",children:fe(t)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 border-t border-slate-200 pt-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 mb-2",children:"Bill To (Buyer)"}),e.jsxs("div",{className:"text-sm text-slate-600 space-y-1",children:[e.jsx("p",{className:"font-medium text-slate-900",children:t.buyer?.businessName||"N/A"}),t.buyer?.email&&e.jsxs("p",{children:["Email: ",t.buyer.email]}),t.buyer?.phone&&e.jsxs("p",{children:["Phone: ",t.buyer.phone]}),(t.buyer?.city||t.buyer?.state)&&e.jsx("p",{children:[t.buyer.city,t.buyer.state].filter(Boolean).join(", ")})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 mb-2",children:"Sold By (Seller)"}),e.jsxs("div",{className:"text-sm text-slate-600 space-y-1",children:[e.jsx("p",{className:"font-medium text-slate-900",children:t.seller?.businessName||"N/A"}),t.seller?.email&&e.jsxs("p",{children:["Email: ",t.seller.email]}),t.seller?.phone&&e.jsxs("p",{children:["Phone: ",t.seller.phone]}),t.seller?.gstNumber&&e.jsxs("p",{children:["GST: ",t.seller.gstNumber]}),(t.seller?.city||t.seller?.state)&&e.jsx("p",{children:[t.seller.city,t.seller.state].filter(Boolean).join(", ")})]})]})]}),E?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"Loading order items..."})}):b?e.jsxs("div",{className:"border-t border-slate-200 pt-6",children:[e.jsx("h3",{className:"font-semibold text-slate-900 mb-4",children:"Order Items"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-slate-600",children:"Product Details"}),e.jsx("th",{className:"px-4 py-2 text-left text-slate-600",children:"SKU"}),e.jsx("th",{className:"px-4 py-2 text-left text-slate-600",children:"Brand"}),e.jsx("th",{className:"px-4 py-2 text-left text-slate-600",children:"Category"}),e.jsx("th",{className:"px-4 py-2 text-right text-slate-600",children:"Unit"}),e.jsx("th",{className:"px-4 py-2 text-right text-slate-600",children:"Base Price"}),e.jsx("th",{className:"px-4 py-2 text-right text-slate-600",children:"MRP"}),e.jsx("th",{className:"px-4 py-2 text-right text-slate-600",children:"GST %"}),e.jsx("th",{className:"px-4 py-2 text-right text-slate-600",children:"Selling Price"}),e.jsx("th",{className:"px-4 py-2 text-center text-slate-600",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right text-slate-600",children:"Total"})]})}),e.jsx("tbody",{children:(b.items||[]).map((s,r)=>{const i=Number(s.quantity||s.qty||0),d=Number(s.sellingPrice||s.price||s.unitPrice||0),u=i*d;return e.jsxs("tr",{className:"border-b",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-slate-900",children:s.productName||s.name||"N/A"}),s.hsnCode&&e.jsxs("div",{className:"text-xs text-slate-500 mt-0.5",children:["HSN: ",s.hsnCode]})]}),e.jsx("td",{className:"px-4 py-2",children:s.sku||"â€”"}),e.jsx("td",{className:"px-4 py-2",children:s.brand||"â€”"}),e.jsx("td",{className:"px-4 py-2",children:s.category||"â€”"}),e.jsx("td",{className:"px-4 py-2 text-right",children:s.unit||"â€”"}),e.jsx("td",{className:"px-4 py-2 text-right",children:(()=>{const c=Ne(b,r,s);return c>0?`â‚¹${c.toFixed(2)}`:"â€”"})()}),e.jsx("td",{className:"px-4 py-2 text-right",children:s.mrp>0?`â‚¹${s.mrp.toFixed(2)}`:"â€”"}),e.jsx("td",{className:"px-4 py-2 text-right",children:(()=>{const c=Number(s.gstRate||s.taxRate||0),l=Array.isArray(b?.proforma?.lines)?b.proforma.lines[r]:void 0,a=l?.gstRate!==void 0?Number(l.gstRate):c;return a>0?`${a}%`:"â€”"})()}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsxs("span",{className:"font-semibold text-emerald-600",children:["â‚¹",d.toFixed(2)]})}),e.jsx("td",{className:"px-4 py-2 text-center",children:i}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsxs("span",{className:"font-semibold text-slate-900",children:["â‚¹",u.toFixed(2)]})})]},r)})})]})})]}):e.jsx("div",{className:"border-t pt-4",children:e.jsx("p",{className:"text-slate-300 text-sm",children:t.orderId?"Order data not available":"No order ID associated with this invoice"})}),e.jsxs("div",{className:"border-t border-slate-200 pt-6 space-y-4",children:[t.totals&&e.jsxs("div",{className:"pt-2",children:[e.jsx("h4",{className:"font-semibold mb-3 text-slate-900",children:"Invoice Breakdown"}),e.jsxs("div",{className:"space-y-1 text-sm text-slate-600",children:[t.totals.grossItems!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Unit Price Total"}),e.jsxs("span",{children:["â‚¹",Number(t.totals.grossItems||0).toFixed(2)]})]}),t.totals.lineDiscountTotal!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"âˆ’ Line Discounts"}),e.jsxs("span",{children:["â‚¹",Number(t.totals.lineDiscountTotal||0).toFixed(2)]})]}),t.totals.itemsSubTotal!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Items Subâ€‘Total"}),e.jsxs("span",{children:["â‚¹",Number(t.totals.itemsSubTotal||0).toFixed(2)]})]}),t.totals.delivery>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"+ Delivery"}),e.jsxs("span",{children:["â‚¹",Number(t.totals.delivery||0).toFixed(2)]})]}),t.totals.packing>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"+ Packing"}),e.jsxs("span",{children:["â‚¹",Number(t.totals.packing||0).toFixed(2)]})]}),t.totals.insurance>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"+ Insurance"}),e.jsxs("span",{children:["â‚¹",Number(t.totals.insurance||0).toFixed(2)]})]}),t.totals.other>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"+ Other"}),e.jsxs("span",{children:["â‚¹",Number(t.totals.other||0).toFixed(2)]})]}),t.totals.discountTotal>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"âˆ’ Order Discount"}),e.jsxs("span",{children:["â‚¹",Number(t.totals.discountTotal||0).toFixed(2)]})]}),t.totals.taxableBase!==void 0&&e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Taxable Base"}),e.jsxs("span",{children:["â‚¹",Number(t.totals.taxableBase||0).toFixed(2)]})]}),t.totals.taxType&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tax Type"}),e.jsx("span",{className:"text-xs",children:t.totals.taxType==="IGST"?"IGST (Interstate)":"CGST + SGST (Intrastate)"})]}),t.totals.taxType==="IGST"&&t.totals.taxBreakup?.igst!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"IGST"}),e.jsxs("span",{children:["â‚¹",Number(t.totals.taxBreakup.igst||0).toFixed(2)]})]}),t.totals.taxType!=="IGST"&&e.jsxs(e.Fragment,{children:[t.totals.taxBreakup?.cgst!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"CGST"}),e.jsxs("span",{children:["â‚¹",Number(t.totals.taxBreakup.cgst||0).toFixed(2)]})]}),t.totals.taxBreakup?.sgst!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"SGST"}),e.jsxs("span",{children:["â‚¹",Number(t.totals.taxBreakup.sgst||0).toFixed(2)]})]})]}),t.totals.roundOff!==void 0&&t.totals.roundOff!==0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Round Off"}),e.jsxs("span",{children:["â‚¹",Number(t.totals.roundOff||0).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsx("span",{className:"text-lg font-semibold text-slate-900",children:"Grand Total:"}),e.jsxs("span",{className:"text-2xl font-bold text-slate-900",children:["â‚¹",Number(t.totals?.grandTotal||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),(t.deliveryDetails||t.deliveryMode||t.expectedDeliveryDate||b?.deliveryDetails)&&e.jsxs("div",{className:"border-t border-slate-200 pt-6",children:[e.jsx("h4",{className:"font-semibold mb-3 text-slate-900",children:"ðŸšš Delivery Information"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-slate-600",children:(()=>{const s=t.deliveryDetails||b?.deliveryDetails||{};return e.jsxs(e.Fragment,{children:[t.deliveryMode||b?.deliveryMode?e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-900",children:"Delivery Mode: "}),e.jsx("span",{children:t.deliveryMode||b?.deliveryMode})]}):null,t.expectedDeliveryDate||b?.expectedDeliveryDate?e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-900",children:"Expected Delivery Date: "}),e.jsx("span",{children:$(t.expectedDeliveryDate||b?.expectedDeliveryDate)})]}):null,s.personName&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-900",children:"Delivery Person: "}),e.jsxs("span",{children:[s.personName,s.personDesignation&&` (${s.personDesignation})`]})]}),s.personPhone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-900",children:"Contact: "}),e.jsx("span",{children:s.personPhone})]}),s.vehicleType&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-900",children:"Vehicle Type: "}),e.jsx("span",{children:s.vehicleType})]}),s.vehicleNumber&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-900",children:"Vehicle Number: "}),e.jsx("span",{children:s.vehicleNumber})]}),s.transportMethod&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-900",children:"Transport Method: "}),e.jsx("span",{children:s.transportMethod.replace(/-/g," ")})]}),s.awbNumber&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-900",children:"AWB/Tracking Number: "}),e.jsx("span",{children:s.awbNumber})]}),s.transportServiceName&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-900",children:"Transport Service: "}),e.jsx("span",{children:s.transportServiceName})]}),s.courierName&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-900",children:"Courier: "}),e.jsx("span",{children:s.courierName})]}),s.deliveryNotes&&e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("span",{className:"font-medium text-slate-900",children:"Delivery Notes: "}),e.jsx("p",{className:"mt-1 text-slate-600 whitespace-pre-wrap",children:s.deliveryNotes})]})]})})()})]}),t.orderId&&e.jsx("div",{className:"border-t border-slate-200 pt-4",children:e.jsxs("p",{className:"text-sm text-slate-600",children:[e.jsx("span",{className:"font-medium",children:"Order ID:"})," ",t.orderId]})})]})]})})]})};export{Ve as default};
