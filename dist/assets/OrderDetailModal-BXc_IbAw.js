import{j as e,l as z,d as j,y as D}from"./index-DRC3F7i0.js";import{r as y}from"./router-BPBaD_i0.js";import{d as v,e as U,c as we,s as R,T as Se,y as Fe,u as Z,q as st,w as _e,g as rt,l as De}from"./firebase-DWi1MSv1.js";import{C as ce,_ as at,p as ee,R as Qe,q as it,ad as Ce,T as Ee,F as qe,K as Te,o as nt,s as ot,I as lt}from"./index-CprmGC-M.js";import{O as P,n as dt,c as ct}from"./orderStatus-BwkCpksU.js";import{c as ut}from"./calcProforma-Ep9qGXtN.js";import{P as w}from"./pricing-SUVGnFgL.js";import{m as te}from"./proxy-BgUy8BPw.js";import{A as ke}from"./index-DSciU07p.js";const yt=({order:C,onClose:Oe,onUpdate:K,readOnly:T=!1,isDistributorOrderRequest:_=!1})=>{const[Ne,Ie]=y.useState(!1),[ue,Q]=y.useState(null),[me,q]=y.useState(""),[Ge,xe]=y.useState(!1),[se,he]=y.useState(!1),X=t=>{if(!t)return null;let r=[];return t.statusHistory&&(Array.isArray(t.statusHistory)?r=t.statusHistory.map(s=>({...s,updatedAt:s.updatedAt||s.at||s.timestamp||s.createdAt})):typeof t.statusHistory=="object"&&(r=Object.values(t.statusHistory).filter(s=>s!=null).map(s=>({...s,updatedAt:s.updatedAt||s.at||s.timestamp||s.createdAt})))),{...t,items:Array.isArray(t.items)?t.items:t.items?[t.items]:[],statusHistory:r}},[a,re]=y.useState(()=>X(C)),[ae,Ae]=y.useState([]),[c,pe]=y.useState({delivery:0,packing:0,insurance:0,other:0,discountPct:0,discountAmt:0,discountChangedBy:"pct"}),[ie,He]=y.useState(!1),[ne,Ve]=y.useState("NEAREST"),[Y,ze]=y.useState(!1),[oe,Ke]=y.useState(null),[Me,Ue]=y.useState(!1),[k,Re]=y.useState(!1),[Xe,le]=y.useState(!1),[G,ye]=y.useState([]),Ye=async()=>{console.log("[OrderDetailModal] handleAddToInventoryClick called",{currentOrder:a,hasItems:a?.items,itemsLength:a?.items?.length,items:a?.items,hasProforma:!!a?.proforma,proformaLines:a?.proforma?.lines});let t=[];if(Array.isArray(a?.items)&&a.items.length>0?t=a.items:a?.items&&typeof a.items=="object"?t=[a.items]:Array.isArray(a?.proforma?.lines)&&a.proforma.lines.length>0&&(t=a.proforma.lines.map(s=>({productName:s.name||s.productName,name:s.name||s.productName,quantity:s.qty||s.quantity,price:s.price,unitPrice:s.price,basePrice:s.basePrice||s.price,sellingPrice:s.sellingPrice||s.price,mrp:s.mrp,brand:s.brand||"",category:s.category||"",sku:s.sku||"",unit:s.uom||s.unit||"unit",hsn:s.hsn||"",gstRate:s.gstRate||0}))),console.log("[OrderDetailModal] Extracted items array:",t),!a||t.length===0){console.error("[OrderDetailModal] No items found in order:",{currentOrder:a,items:a?.items,proformaLines:a?.proforma?.lines,itemsArray:t}),D.error("No items found in order. Please check if the order has any items.");return}const r=a.distributorId||z.currentUser?.uid;if(!r){D.error("Distributor ID not found");return}try{const s=we(j,"businesses",r,"products"),d=await Promise.all(t.map(async(i,o)=>{console.log(`[OrderDetailModal] Processing item ${o}:`,i);const u=i.productName||i.name||i.product?.name||"Unnamed Product",m=i.brand||i.product?.brand||"",N=Number(i.quantity||i.qty||0),b=Number(i.basePrice||i.price||i.unitPrice||i.costPrice||0),A=Number(i.sellingPrice||i.mrp||i.price||b||0),O=i.sku||i.product?.sku||`SKU-${Date.now()}-${Math.random().toString(36).slice(2,7).toUpperCase()}`,h=i.unit||i.uom||i.product?.unit||"unit",M=i.hsn||i.hsnCode||i.product?.hsn||"",g=i.category||i.product?.category||"";(!u||u==="Unnamed Product")&&console.warn(`[OrderDetailModal] Item ${o} has invalid product name:`,i),N<=0&&console.warn(`[OrderDetailModal] Item ${o} has invalid quantity:`,N,i);const f=st(s,_e("name","==",u),_e("brand","==",m)),I=await rt(f),B=I.empty?null:{id:I.docs[0].id,...I.docs[0].data()};return{...i,productName:u,brand:m,category:g,quantity:N,basePrice:b,costPrice:b||i.price||0,sellingPrice:A,sku:O,unit:h,hsn:M,existingProduct:B,action:B?"update":"new",finalQuantity:N,finalCostPrice:b||i.price||0,finalSellingPrice:A,finalSku:O,finalUnit:h,finalCategory:g,finalBrand:m}}));if(console.log("[OrderDetailModal] Items with existing checked:",d),!d||d.length===0){console.error("[OrderDetailModal] No items processed:",{itemsArray:t,itemsWithExisting:d}),D.error("Failed to process items. Please check console for details.");return}ye(d),le(!0),console.log("[OrderDetailModal] Inventory modal opened with",d.length,"items")}catch(s){console.error("[OrderDetailModal] Error checking existing products:",s),D.error(`Failed to check existing products: ${s.message||"Unknown error"}`)}},$=(t,r,s)=>{const d=[...G];d[t][r]=s,r==="finalQuantity"&&d[t].action,ye(d)},Je=async()=>{if(!G||G.length===0){D.error("No items to add");return}const t=a?.distributorId||z.currentUser?.uid;if(!t){D.error("Distributor ID not found");return}Re(!0);try{const r=we(j,"businesses",t,"products");let s=0,d=0;for(const i of G)try{const o=i.productName,u=i.finalBrand||i.brand,m=Number(i.finalQuantity||i.quantity||0),N=Number(i.finalCostPrice||i.costPrice||0),b=Number(i.finalSellingPrice||i.sellingPrice||0),A=i.finalSku||i.sku,O=i.finalUnit||i.unit,h=i.finalCategory||i.category||"",M=i.hsn||"";if(i.action==="update"&&i.existingProduct){const g=v(r,i.existingProduct.id),f=i.existingProduct,I=Number(f.quantity||0)+m;await Z(g,{quantity:I,costPrice:N,sellingPrice:b,category:h||f.category||"",lastUpdatedFromOrder:a.id,lastUpdatedAt:R()}),d++,console.log(`[OrderDetailModal] Updated existing product: ${o}`)}else{const g={name:o,productName:o,sku:A,quantity:m,unit:O,costPrice:N,sellingPrice:b,brand:u,category:h,hsn:M,imageUrl:i.imageUrl||"",distributorPrice:N,sourceOrderId:a.id,sourceType:"product_owner_order",createdAt:R()};await De(v(r),g),s++,console.log(`[OrderDetailModal] Created new product: ${o}`)}}catch(o){console.error("[OrderDetailModal] Error adding item to inventory:",o),D.error(`Failed to add item: ${i.productName||"Unknown"}`)}try{let i;_||T&&a.productOwnerId?i=v(j,`businesses/${t}/sentOrdersToProductOwners/${a.id}`):T&&(i=v(j,`businesses/${t}/productOwnerOrders/${a.id}`)),i&&await Z(i,{inventorySynced:!0,inventorySyncedAt:R(),"statusTimestamps.inventorySyncedAt":R()})}catch(i){console.warn("[OrderDetailModal] Could not mark order as inventory synced:",i)}D.success(`✅ Added ${s} new product(s) and updated ${d} existing product(s) to inventory!`),le(!1),ye([]),K&&K()}catch(r){console.error("[OrderDetailModal] Error adding items to inventory:",r),D.error("Failed to add items to inventory. Please try again.")}finally{Re(!1)}};y.useEffect(()=>{(async()=>{const r=z.currentUser?.uid;if(r)try{const s=v(j,"businesses",r),d=await U(s);d.exists()&&Ke(d.data())}catch(s){console.error("Error fetching user data:",s)}})()},[]),y.useEffect(()=>{(async()=>{if(!(!C||!C.id))try{const r=z.currentUser?.uid;if(!r)return;let s;T?C.productOwnerId?s=v(j,`businesses/${r}/sentOrdersToProductOwners/${C.id}`):s=v(j,`businesses/${r}/productOwnerOrders/${C.id}`):_?s=v(j,`businesses/${r}/distributorOrderRequests/${C.id}`):s=v(j,`businesses/${r}/assignedOrdersToDistributors/${C.id}`);const d=await U(s);if(d.exists()){let i={id:d.id,...d.data()};if(Array.isArray(i.items)||(i.items=i.items?[i.items]:[]),Array.isArray(i.statusHistory)?i.statusHistory=i.statusHistory.map(m=>({...m,updatedAt:m.updatedAt||m.at||m.timestamp||m.createdAt})):i.statusHistory&&typeof i.statusHistory=="object"?i.statusHistory=Object.values(i.statusHistory).filter(m=>m!=null).map(m=>({...m,updatedAt:m.updatedAt||m.at||m.timestamp||m.createdAt})):i.statusHistory=[],T&&i.productOwnerId)try{const m=v(j,"businesses",i.productOwnerId),N=await U(m);if(N.exists()){const b=N.data();i={...i,productOwnerName:b.businessName||b.ownerName||i.productOwnerName||"Product Owner",productOwnerEmail:b.email||i.productOwnerEmail||"",productOwnerPhone:b.phone||i.productOwnerPhone||""},console.log("Enhanced Product Owner info:",{businessName:b.businessName,ownerName:b.ownerName,email:b.email,phone:b.phone,finalName:i.productOwnerName})}}catch(m){console.error("Error fetching product owner business info:",m)}const o=X(i);re(o);const u=i.statusCode||i.status||P.ASSIGNED;if(Q(u),T&&o.status===P.DELIVERED&&o.distributorId){const m=o.distributorId;if(!o.retailerId&&o.productOwnerId)try{const b=we(j,"businesses",m,"invoices"),A=v(b,o.id);(await U(A)).exists()||(console.log("[OrderDetailModal] Order is DELIVERED but no invoice found, creating invoice..."),await $e(m,o.id,o))}catch(b){console.error("[OrderDetailModal] Error checking/creating invoice for delivered order:",b)}}}else{re(X(C));const i=C.statusCode||C.status||(_?P.REQUESTED:P.ASSIGNED);Q(i)}}catch(r){console.error("Error fetching latest order data:",r),re(X(C));const s=C?.statusCode||C?.status||(_?P.REQUESTED:P.ASSIGNED);Q(s)}})()},[C,T,_]),y.useEffect(()=>{if(se&&a&&Array.isArray(a.items)&&a.items.length>0){const t=a.items.map(r=>{const s=r.pricingMode||w.LEGACY,d=Number(r.gstRate||0);let i=0;return s===w.MRP_INCLUSIVE&&r.mrp?i=Number(r.mrp):s===w.BASE_PLUS_TAX&&r.basePrice?i=Number(r.basePrice):i=Number(r.unitPrice||r.price||r.sellingPrice||0),{name:r.productName||r.name||"Item",sku:r.sku||"",hsn:r.hsn||r.hsnCode||"",uom:r.uom||r.unit||"",qty:Number(r.quantity||r.qty||0),price:i,pricingMode:s,mrp:Number(r.mrp||0),basePrice:Number(r.basePrice||0),itemDiscountPct:Number(r.itemDiscountPct||0),itemDiscountAmt:Number(r.itemDiscountAmt||0),itemDiscountChangedBy:r.itemDiscountChangedBy||"pct",gstRate:d}});if(Ae(t),a.chargesSnapshot?.breakdown){const r=a.chargesSnapshot.breakdown;pe({delivery:Number(r.delivery||0),packing:Number(r.packing||0),insurance:Number(r.insurance||0),other:Number(r.other||0),discountPct:Number(r.discountPct||0),discountAmt:Number(r.discountAmt||0),discountChangedBy:r.discountChangedBy||"pct"})}}},[se,a]);const x=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(t||0)),We=t=>{if(!t)return"N/A";try{let r;if(t&&typeof t=="object"&&t.toDate)r=t.toDate();else if(t&&typeof t=="object"&&(t.seconds||t._seconds))r=new Date((t.seconds||t._seconds)*1e3);else if(typeof t=="string"||typeof t=="number")r=new Date(t);else if(t instanceof Date)r=t;else return"N/A";return isNaN(r.getTime())?"N/A":r.toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(r){return console.error("Error formatting date:",r,t),"N/A"}},je=t=>{switch((t||"").toUpperCase()){case"REQUESTED":return"bg-yellow-500/20 text-yellow-300 border-yellow-400/30";case"QUOTED":return"bg-blue-500/20 text-blue-300 border-blue-400/30";case"ACCEPTED":return"bg-emerald-500/20 text-emerald-300 border-emerald-400/30";case"REJECTED":return"bg-red-500/20 text-red-300 border-red-400/30";case"DIRECT":return"bg-purple-500/20 text-purple-300 border-purple-400/30";case"ASSIGNED":return"bg-blue-500/20 text-blue-300 border-blue-400/30";case"PACKED":return"bg-purple-500/20 text-purple-300 border-purple-400/30";case"SHIPPED":return"bg-indigo-500/20 text-indigo-300 border-indigo-400/30";case"OUT_FOR_DELIVERY":return"bg-orange-500/20 text-orange-300 border-orange-400/30";case"DELIVERED":return"bg-emerald-500/20 text-emerald-300 border-emerald-400/30";case"INVOICED":return"bg-green-500/20 text-green-300 border-green-400/30";default:return"bg-gray-500/20 text-gray-300 border-gray-400/30"}},ve=t=>{switch((t||"").toUpperCase()){case"REQUESTED":return e.jsx(Te,{className:"text-sm"});case"QUOTED":return e.jsx(Ce,{className:"text-sm"});case"ACCEPTED":return e.jsx(ee,{className:"text-sm"});case"REJECTED":return e.jsx(ce,{className:"text-sm"});case"DIRECT":return e.jsx(ee,{className:"text-sm"});case"ASSIGNED":return e.jsx(Ee,{className:"text-sm"});case"PACKED":return e.jsx(Ee,{className:"text-sm"});case"SHIPPED":return e.jsx(lt,{className:"text-sm"});case"OUT_FOR_DELIVERY":return e.jsx(ot,{className:"text-sm"});case"DELIVERED":return e.jsx(ee,{className:"text-sm"});case"INVOICED":return e.jsx(ee,{className:"text-sm"});default:return e.jsx(Te,{className:"text-sm"})}},J=t=>{const r=(t||"").toUpperCase();return{REQUESTED:"Requested",QUOTED:"Quoted",ACCEPTED:"Accepted",REJECTED:"Rejected",DIRECT:"Direct (Proforma Skipped)",ASSIGNED:"Assigned",PACKED:"Packed",SHIPPED:"Shipped",OUT_FOR_DELIVERY:"Out for Delivery",DELIVERED:"Delivered",INVOICED:"Invoiced"}[r]||r.replace(/_/g," ")},L=a?.statusCode||a?.status||P.ASSIGNED,Be=dt(L),de=oe?.state||a?.productOwnerState||"Maharashtra",be=a?.distributorState||a?.state||de,l=y.useMemo(()=>{if(!se||ae.length===0)return null;try{return ut({lines:ae,orderCharges:c,distributorState:de,retailerState:be,roundingEnabled:ie,rounding:ne})||{grossItems:0,lineDiscountTotal:0,itemsSubTotal:0,discountTotal:0,taxableBase:0,taxType:"CGST_SGST",taxBreakup:{cgst:0,sgst:0,igst:0},roundOff:0,grandTotal:0,orderCharges:{delivery:0,packing:0,insurance:0,other:0}}}catch(t){return console.error("Quote preview calculation failed:",t),null}},[ae,c,de,be,ie,ne,se]),Ze=y.useMemo(()=>{if(!l)return 0;const t=(l.itemsSubTotal||0)+(c.delivery||0)+(c.packing||0)+(c.insurance||0)+(c.other||0);return c.discountChangedBy==="pct"?Math.round(t*(c.discountPct||0)/100*100)/100:c.discountAmt||0},[l,c]),Le=async t=>{if(!a||!a.id||!a.distributorId){D.error("Order information missing");return}const r=a.statusCode||a.status||P.ASSIGNED;if(!ct(r,t)){D.error(`Cannot transition from ${J(r)} to ${J(t)}`);return}Ie(!0);try{const s=z.currentUser?.uid,d=a.distributorId,i=a.productOwnerId||(T?a.productOwnerId:s),o=T&&d===s,u={...a.statusTimestamps||{}},m=t.toLowerCase().split("_").map((g,f)=>f===0?g:g.charAt(0).toUpperCase()+g.slice(1)).join("")+"At";u[m]=R();const N=o?a.distributorName||"Distributor":oe?.businessName||oe?.ownerName||"Product Owner",b={status:t,updatedAt:Se.now(),updatedBy:s,updatedByName:N,notes:me.trim()||null},A={status:t,statusCode:t,statusTimestamps:u,statusHistory:Fe(b),lastUpdated:R()};let O,h;if(_||T&&a.productOwnerId){const g=a.productOwnerId||i;O=v(j,`businesses/${g}/distributorOrderRequests/${a.id}`),h=v(j,`businesses/${d}/sentOrdersToProductOwners/${a.id}`)}else O=v(j,`businesses/${i}/assignedOrdersToDistributors/${a.id}`),h=v(j,`businesses/${d}/productOwnerOrders/${a.id}`);try{await Z(O,A)}catch(g){throw console.error("Error updating Product Owner collection:",g),new Error(`Failed to update Product Owner order: ${g.message}`)}try{await Z(h,A)}catch(g){console.error("Error updating Distributor collection:",g),console.warn("Note: Distributor mirror update failed, but PO update succeeded")}const M=await U(O);if(M.exists()){const g=X({id:M.id,...M.data()});re(g)}if(t===P.DELIVERED&&o&&h)try{if(!a.retailerId&&a.productOwnerId&&(h.path.includes("productOwnerOrders")||h.path.includes("sentOrdersToProductOwners"))){const f=await U(h),I=f.exists()?{id:f.id,...f.data()}:a;await $e(d,a.id,I),console.log("[OrderDetailModal] Invoice creation triggered for product owner order:",a.id)}}catch(g){console.error("[OrderDetailModal] Error creating invoice for product owner order:",g)}D.success(`Order status updated to ${J(t)}`),xe(!1),q(""),K&&K()}catch(s){console.error("Error updating order status:",s),console.error("Error details:",{message:s.message,code:s.code,orderId:a?.id,distributorId:a?.distributorId,productOwnerId:z.currentUser?.uid}),D.error(`Failed to update order status: ${s.message||"Please try again."}`)}finally{Ie(!1)}},H=(t,r,s)=>{Ae(d=>{const i=[...d],o={...i[t]};if(["qty","price","mrp","basePrice","itemDiscountPct","itemDiscountAmt","gstRate"].includes(r)){let u=Number(s||0);if(Number.isFinite(u)||(u=0),["qty","price","mrp","basePrice"].includes(r)&&(u=Math.max(0,u)),r==="itemDiscountPct"){u=Math.min(100,Math.max(0,u));const m=(o.qty||0)*(o.price||0);o.itemDiscountAmt=Math.round(m*u/100*100)/100,o.itemDiscountChangedBy="pct"}if(r==="itemDiscountAmt"){u=Math.max(0,u);const m=(o.qty||0)*(o.price||0);m>0&&(o.itemDiscountPct=Math.round(u/m*100*100)/100),o.itemDiscountChangedBy="amt"}r==="gstRate"&&(u=Math.min(28,Math.max(0,u))),r==="pricingMode"&&(o.pricingMode=s,s===w.MRP_INCLUSIVE&&o.mrp?o.price=o.mrp:s===w.BASE_PLUS_TAX&&o.basePrice&&(o.price=o.basePrice)),r==="mrp"&&o.pricingMode===w.MRP_INCLUSIVE&&(o.price=u),r==="basePrice"&&o.pricingMode===w.BASE_PLUS_TAX&&(o.price=u),o[r]=u}else o[r]=s;return i[t]=o,i})},W=(t,r)=>{let s=Number(r||0);if(Number.isFinite(s)||(s=0),s=Math.max(0,s),t==="discountPct"){s=Math.min(100,s);const d=(l?.itemsSubTotal||0)+(c.delivery||0)+(c.packing||0)+(c.insurance||0)+(c.other||0),i=Math.round(d*s/100*100)/100;pe(o=>({...o,discountPct:s,discountAmt:i,discountChangedBy:"pct"}))}else if(t==="discountAmt"){const d=(l?.itemsSubTotal||0)+(c.delivery||0)+(c.packing||0)+(c.insurance||0)+(c.other||0),i=d>0?Math.round(s/d*100*100)/100:0;pe(o=>({...o,discountAmt:s,discountPct:i,discountChangedBy:"amt"}))}else pe(d=>({...d,[t]:s}))},et=async()=>{if(!a||!a.id||!a.distributorId){D.error("Order information missing");return}if(!l){D.error("Please review the quote before submitting");return}Ue(!0);try{const t=z.currentUser?.uid,r=a.distributorId,s=Y?P.DIRECT:P.QUOTED,d=n=>{if(n==null)return null;if(n instanceof Se||typeof n=="object"&&n!==null&&(n.toDate||n.toMillis))return n;if(Array.isArray(n))return n.map(S=>d(S)).filter(S=>S!=null);if(typeof n=="object"){const S={};for(const p in n)if(n.hasOwnProperty(p)&&n[p]!==void 0){const E=d(n[p]);E!=null&&(S[p]=E)}return S}return n},i=ae.map((n,S)=>{const p=a.items[S]||{},E=l.lines?.[S]||{},V={productName:n.name||p.productName||"",quantity:n.qty||p.quantity||0,unitPrice:n.price||p.unitPrice||0,sellingPrice:n.price||p.sellingPrice||p.unitPrice||0,pricingMode:n.pricingMode||p.pricingMode||w.LEGACY,itemDiscountPct:n.itemDiscountPct!==void 0?n.itemDiscountPct:p.itemDiscountPct||0,itemDiscountAmt:n.itemDiscountAmt!==void 0?n.itemDiscountAmt:E.discountAmount||p.itemDiscountAmt||0,itemDiscountChangedBy:n.itemDiscountChangedBy||p.itemDiscountChangedBy||"pct",gstRate:n.gstRate!==void 0?n.gstRate:p.gstRate||0,sku:n.sku||p.sku||"",hsn:n.hsn||n.hsnCode||p.hsn||p.hsnCode||"",uom:n.uom||p.uom||p.unit||"",subtotal:E.taxable||n.qty*n.price*(1-(n.itemDiscountPct||0)/100)||p.subtotal||0,gross:E.gross||n.qty*n.price||p.gross||0};return n.pricingMode===w.MRP_INCLUSIVE?V.mrp=n.mrp||n.price||p.mrp||0:n.mrp!==void 0?V.mrp=n.mrp:p.mrp!==void 0&&(V.mrp=p.mrp),n.pricingMode===w.BASE_PLUS_TAX?V.basePrice=n.basePrice||n.price||p.basePrice||0:n.basePrice!==void 0?V.basePrice=n.basePrice:p.basePrice!==void 0&&(V.basePrice=p.basePrice),d(V)}),o={breakdown:{grossItems:l.grossItems||0,lineDiscountTotal:l.lineDiscountTotal||0,itemsSubTotal:l.itemsSubTotal||0,subTotal:l.subTotal||l.itemsSubTotal||0,delivery:c.delivery,packing:c.packing,insurance:c.insurance,other:c.other,discountPct:c.discountPct,discountAmt:c.discountAmt,discountChangedBy:c.discountChangedBy,roundOff:l.roundOff||0,taxableBase:l.taxableBase||0,taxType:l.taxType||"CGST_SGST",taxBreakup:l.taxBreakup||{cgst:0,sgst:0,igst:0},grandTotal:l.grandTotal||0},defaultsUsed:{enabled:!0,skipProforma:Y,autodetectTaxType:!0,deliveryFee:c.delivery,packingFee:c.packing,insuranceFee:c.insurance,otherFee:c.other,discountPct:c.discountPct,discountAmt:c.discountAmt,roundEnabled:ie,roundRule:ne.toLowerCase()},version:1},u={...a.statusTimestamps||{}},m=s.toLowerCase().split("_").map((n,S)=>S===0?n:n.charAt(0).toUpperCase()+n.slice(1)).join("")+"At";u[m]=R();const N={status:s,updatedAt:Se.now(),updatedBy:t,updatedByName:oe?.businessName||oe?.ownerName||"Product Owner",notes:me.trim()||(Y?"Proforma skipped - defaults applied":"Quote sent to distributor")},b={lines:l.lines||[],orderCharges:l.orderCharges||{},grossItems:l.grossItems||0,lineDiscountTotal:l.lineDiscountTotal||0,itemsSubTotal:l.itemsSubTotal||0,subTotal:l.subTotal||l.itemsSubTotal||0,discountTotal:l.discountTotal||0,taxableBase:l.taxableBase||0,taxType:l.taxType||"CGST_SGST",taxBreakup:l.taxBreakup||{cgst:0,sgst:0,igst:0},roundOff:l.roundOff||0,grandTotal:l.grandTotal||0},A=d(o),O=d(b),h=d(u),M=d({items:i,itemsSubTotal:l.itemsSubTotal||0,grandTotal:l.grandTotal||0,status:s,statusCode:s,statusTimestamps:h,statusHistory:Fe(N),chargesSnapshot:A,proforma:O,lastUpdated:R(),quotedAt:R(),quotedBy:t}),g=(n,S="")=>{if(n===null)return null;if(n===void 0)return console.warn(`[OrderDetailModal] Found undefined at path: ${S}`),null;if(typeof n=="function"||typeof n=="object"&&n!==null&&(n.toDate||n.toMillis||n.type||n._methodName))return n;if(Array.isArray(n))return n.map((p,E)=>g(p,`${S}[${E}]`));if(typeof n=="object"){const p={};for(const E in n)if(n.hasOwnProperty(E)){if(n[E]===void 0){console.warn(`[OrderDetailModal] Skipping undefined value at: ${S}.${E}`);continue}p[E]=g(n[E],`${S}.${E}`)}return p}return n},f=g(M);console.log("[OrderDetailModal] Submitting quote - final updateData keys:",Object.keys(f)),console.log("[OrderDetailModal] Items count:",f.items?.length||0);const I=v(j,`businesses/${t}/distributorOrderRequests/${a.id}`);console.log("[OrderDetailModal] Updating PO order document:",I.path),await Z(I,f);const B=v(j,`businesses/${r}/sentOrdersToProductOwners/${a.id}`),fe=await U(B);if(console.log("[OrderDetailModal] Updating distributor order document:",B.path,"exists:",fe.exists()),fe.exists())await Z(B,f);else{const n=g({...f,distributorId:r,productOwnerId:t,createdAt:R()});await De(B,n)}const F=await U(I);if(F.exists()){const n=X({id:F.id,...F.data()});re(n)}D.success(`Quote ${Y?"sent (Proforma skipped)":"sent"} successfully!`),he(!1),q(""),K&&K()}catch(t){console.error("Error submitting quote:",t),D.error(`Failed to submit quote: ${t.message||"Please try again."}`)}finally{Ue(!1)}},$e=async(t,r,s)=>{try{const d=we(j,"businesses",t,"invoices"),i=v(d,r);if((await U(i)).exists())console.log("[OrderDetailModal] Invoice already exists for order:",r);else{console.log("[OrderDetailModal] Creating invoice for product owner order:",r);const u=await U(v(j,"businesses",t)),m=u.exists()?u.data():{},N=s.productOwnerId;let b={};if(N)try{const F=await U(v(j,"businesses",N));b=F.exists()?F.data():{}}catch(F){console.warn("[OrderDetailModal] Could not fetch product owner profile:",F)}const A={businessId:N||null,businessName:b.businessName||s.productOwnerName||"Product Owner",email:b.email||s.productOwnerEmail||null,phone:b.phone||s.productOwnerPhone||null,city:b.city||s.productOwnerCity||null,state:b.state||s.productOwnerState||null},O={businessId:t,businessName:m.businessName||m.ownerName||m.name||null,email:m.email||null,phone:m.phone||null,city:m.city||null,state:m.state||null,gstNumber:m.gstNumber||m.gstin||null},h=s?.chargesSnapshot?.breakdown||s?.proforma;let M={grandTotal:h?.grandTotal?Number(h.grandTotal):s.grandTotal||s.itemsSubTotal||0};h&&(M={grossItems:Number(h.grossItems||0),lineDiscountTotal:Number(h.lineDiscountTotal||0),itemsSubTotal:Number(h.itemsSubTotal||h.subTotal||0),delivery:Number(h.delivery||0),packing:Number(h.packing||0),insurance:Number(h.insurance||0),other:Number(h.other||0),discountTotal:Number(h.discountTotal||0),taxableBase:Number(h.taxableBase||0),taxType:h.taxType||"CGST_SGST",taxBreakup:h.taxBreakup||{},roundOff:Number(h.roundOff||0),grandTotal:Number(h.grandTotal||0)});const g=s.invoiceNumber||`INV-${(r||"").slice(-6).toUpperCase()}`,f=s?.isPaid===!0||s?.paymentStatus==="Paid"||s?.payment?.isPaid===!0,I=s?.paymentMode||s?.payment?.mode||s?.paymentNormalized?.code||"COD",B=s?.paymentModeLabel||s?.payment?.normalized?.label||I,fe={orderId:r,invoiceNumber:g,distributorId:t,productOwnerId:N||null,retailerId:null,buyer:A,seller:O,totals:M,payment:{mode:B,normalized:s?.paymentNormalized||{code:I,label:B},isPaid:f,status:f?"Paid":s?.paymentMode?.toLowerCase()==="credit"?"Payment Due":"Pending"},deliveryDetails:s.deliveryDetails||null,deliveryMode:s.deliveryMode||null,expectedDeliveryDate:s.expectedDeliveryDate||null,issuedAt:new Date().toISOString(),createdAt:R(),status:f?"Paid":"Issued",paymentStatus:f?"Paid":"Pending",isPaid:f,source:"product-owner-order"};await De(i,fe,{merge:!0}),console.log("[OrderDetailModal] Invoice created for product owner order:",r)}}catch(d){throw console.error("[OrderDetailModal] Failed to create invoice for product owner order:",r,d),d}};if(!C)return null;const tt=Array.isArray(a?.items)?a.items:[];let ge=[];a?.statusHistory&&(Array.isArray(a.statusHistory)?ge=a.statusHistory:typeof a.statusHistory=="object"&&a.statusHistory!==null&&(ge=Object.values(a.statusHistory).filter(t=>t!=null)));const Pe=Array.isArray(ge)?[...ge].reverse():[];return e.jsxs(te.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:Oe,children:[e.jsxs(te.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:t=>t.stopPropagation(),className:"bg-slate-900 rounded-xl border border-white/10 w-full max-w-4xl max-h-[90vh] overflow-hidden shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-slate-900/98 via-slate-800/95 to-slate-900/98 backdrop-blur-xl border-b border-white/10 p-6 flex items-center justify-between z-10",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-emerald-300",children:"Order Details"}),e.jsxs("p",{className:"text-white/60 text-sm mt-1",children:["Order ID: #",a.id?.slice(0,12)]})]}),e.jsx("button",{onClick:Oe,className:"p-2 rounded-lg hover:bg-white/10 text-white/70 hover:text-white transition-all",children:e.jsx(ce,{className:"text-lg"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-500/10 to-cyan-500/10 border border-emerald-400/20 rounded-xl p-5",children:e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-1",children:"Current Status"}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("span",{className:`px-4 py-2 rounded-lg text-sm font-semibold border flex items-center gap-2 ${je(L)}`,children:[ve(L),J(L)]}),!T&&e.jsxs(e.Fragment,{children:[_&&L===P.REQUESTED&&e.jsxs("button",{onClick:()=>he(!0),className:"px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/30 rounded-lg text-blue-300 text-sm font-medium transition-all hover:scale-105 flex items-center gap-2",children:[e.jsx(at,{})," Create Quote"]}),Be.length>0&&e.jsx("button",{onClick:()=>xe(!0),className:"px-4 py-2 bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-400/30 rounded-lg text-emerald-300 text-sm font-medium transition-all hover:scale-105",children:"Update Status"})]}),T&&L===P.QUOTED&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{Q(P.ACCEPTED),Le(P.ACCEPTED)},disabled:Ne,className:"px-4 py-2 bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-400/30 rounded-lg text-emerald-300 text-sm font-medium transition-all hover:scale-105 flex items-center gap-2",children:[e.jsx(ee,{})," Accept Quote"]}),e.jsxs("button",{onClick:()=>{Q(P.REJECTED),xe(!0)},className:"px-4 py-2 bg-red-500/20 hover:bg-red-500/30 border border-red-400/30 rounded-lg text-red-300 text-sm font-medium transition-all hover:scale-105 flex items-center gap-2",children:[e.jsx(ce,{})," Reject Quote"]})]}),T&&L===P.DELIVERED&&!a.inventorySynced&&e.jsxs("button",{onClick:Ye,disabled:k||(!a.items||a.items.length===0)&&(!a.proforma?.lines||a.proforma.lines.length===0),className:"px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/30 rounded-lg text-blue-300 text-sm font-medium transition-all hover:scale-105 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Qe,{})," Add to Inventory"]}),T&&L===P.DELIVERED&&a.inventorySynced&&e.jsxs("span",{className:"px-4 py-2 bg-emerald-500/20 border border-emerald-400/30 rounded-lg text-emerald-300 text-sm font-medium flex items-center gap-2",children:[e.jsx(ee,{})," Added to Inventory"]})]})]})})}),e.jsx(ke,{children:Ge&&e.jsxs(te.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-white/5 border border-white/10 rounded-xl p-5 space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Update Order Status"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:"Select New Status"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Be.map(t=>e.jsx("button",{onClick:()=>Q(t),className:`p-3 rounded-lg border-2 transition-all ${ue===t?"border-emerald-400 bg-emerald-500/20":"border-white/10 hover:border-white/20 bg-white/5"}`,children:e.jsxs("div",{className:"flex items-center gap-2 text-white",children:[ve(t),e.jsx("span",{className:"text-sm font-medium",children:J(t)})]})},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{value:me,onChange:t=>q(t.target.value),rows:3,className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"Add any notes about this status update..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{xe(!1),Q(null),q("")},className:"flex-1 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",children:"Cancel"}),e.jsx("button",{onClick:()=>ue&&Le(ue),disabled:!ue||Ne,className:"flex-1 px-4 py-2 bg-emerald-500 hover:bg-emerald-600 disabled:bg-emerald-500/50 disabled:cursor-not-allowed rounded-lg text-white font-semibold transition",children:Ne?"Updating...":"Update Status"})]})]})}),e.jsx(ke,{children:se&&e.jsxs(te.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-white/5 border border-white/10 rounded-xl p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-xl font-semibold text-white",children:"Create Quote / Quotation"}),e.jsx("button",{onClick:()=>{he(!1),q("")},className:"text-white/70 hover:text-white transition",children:e.jsx(ce,{})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-medium text-white mb-4",children:"Order Items"}),e.jsx("div",{className:"space-y-3",children:ae.map((t,r)=>{const s=(t.qty||0)*(t.price||0),d=t.itemDiscountChangedBy==="amt"?t.itemDiscountAmt||0:Math.round(s*(t.itemDiscountPct||0)/100*100)/100,i=s-d;return e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg border border-white/10 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-3 items-start",children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"text-xs text-white/50 mb-1 block",children:"Product Name"}),e.jsx("input",{type:"text",value:t.name,onChange:o=>H(r,"name",o.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm"}),t.sku&&e.jsxs("p",{className:"text-xs text-white/40 mt-1",children:["SKU: ",t.sku]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-xs text-white/50 mb-1 block",children:"Quantity"}),e.jsx("input",{type:"number",value:t.qty,onChange:o=>H(r,"qty",o.target.value),min:"0",step:"1",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm"})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"text-xs text-white/50 mb-1 block",children:"Price Type"}),e.jsxs("select",{value:t.pricingMode||w.LEGACY,onChange:o=>H(r,"pricingMode",o.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm",children:[e.jsx("option",{value:w.LEGACY,children:"Selling Price"}),e.jsx("option",{value:w.MRP_INCLUSIVE,children:"MRP (GST Inclusive)"}),e.jsx("option",{value:w.BASE_PLUS_TAX,children:"Base Price (GST Exclusive)"})]})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"text-xs text-white/50 mb-1 block",children:t.pricingMode===w.MRP_INCLUSIVE?"MRP":t.pricingMode===w.BASE_PLUS_TAX?"Base Price":"Selling Price"}),e.jsx("input",{type:"number",value:t.pricingMode===w.MRP_INCLUSIVE?t.mrp||t.price:t.pricingMode===w.BASE_PLUS_TAX&&t.basePrice||t.price,onChange:o=>{const u=t.pricingMode===w.MRP_INCLUSIVE?"mrp":t.pricingMode===w.BASE_PLUS_TAX?"basePrice":"price";H(r,u,o.target.value)},min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm"})]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 items-start",children:[e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"text-xs text-white/50 mb-1 block",children:"Discount %"}),e.jsx("input",{type:"number",value:t.itemDiscountPct,onChange:o=>H(r,"itemDiscountPct",o.target.value),min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm"}),e.jsxs("p",{className:"text-xs text-emerald-400 mt-1",children:["= ",x(d)]})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"text-xs text-white/50 mb-1 block",children:"Discount Amount (₹)"}),e.jsx("input",{type:"number",value:t.itemDiscountAmt||0,onChange:o=>H(r,"itemDiscountAmt",o.target.value),min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm"}),e.jsxs("p",{className:"text-xs text-emerald-400 mt-1",children:["= ",t.itemDiscountPct.toFixed(2),"%"]})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"text-xs text-white/50 mb-1 block",children:"GST Rate %"}),e.jsx("input",{type:"number",value:t.gstRate,onChange:o=>H(r,"gstRate",o.target.value),min:"0",max:"28",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm"})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"text-xs text-white/50 mb-1 block",children:"Line Total"}),e.jsxs("div",{className:"px-3 py-2 bg-emerald-500/10 border border-emerald-400/20 rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-emerald-400",children:x(i)}),e.jsxs("p",{className:"text-xs text-white/50",children:["Gross: ",x(s)," | Disc: ",x(d)]})]})]})]})]},r)})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-white/50 mb-1 block",children:"Delivery Fee"}),e.jsx("input",{type:"number",value:c.delivery,onChange:t=>W("delivery",t.target.value),min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-white/50 mb-1 block",children:"Packing Fee"}),e.jsx("input",{type:"number",value:c.packing,onChange:t=>W("packing",t.target.value),min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-white/50 mb-1 block",children:"Insurance"}),e.jsx("input",{type:"number",value:c.insurance,onChange:t=>W("insurance",t.target.value),min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-white/50 mb-1 block",children:"Other Charges"}),e.jsx("input",{type:"number",value:c.other,onChange:t=>W("other",t.target.value),min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm"})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsx("h6",{className:"text-sm font-semibold text-white mb-3",children:"Order-Level Discount"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-white/50 mb-1 block",children:"Discount %"}),e.jsx("input",{type:"number",value:c.discountPct,onChange:t=>W("discountPct",t.target.value),min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm"}),e.jsxs("p",{className:"text-xs text-emerald-400 mt-1",children:["Amount: ",x(Ze)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-white/50 mb-1 block",children:"Discount Amount (₹)"}),e.jsx("input",{type:"number",value:c.discountAmt,onChange:t=>W("discountAmt",t.target.value),min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm"}),e.jsxs("p",{className:"text-xs text-emerald-400 mt-1",children:["Percentage: ",c.discountPct.toFixed(2),"%"]})]})]})]}),l&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-500/10 to-emerald-500/10 border border-blue-400/20 rounded-xl p-5",children:[e.jsx("h5",{className:"text-lg font-medium text-white mb-4",children:"Quote Preview (Accounting Breakdown)"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/10",children:[e.jsx("span",{className:"text-white/70 font-medium",children:"Gross Items Value:"}),e.jsx("span",{className:"text-white font-semibold",children:x(l.grossItems||0)})]}),l.lineDiscountTotal>0&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/10",children:[e.jsx("span",{className:"text-white/70",children:"Less: Line Item Discounts:"}),e.jsxs("span",{className:"text-red-400 font-semibold",children:["-",x(l.lineDiscountTotal||0)]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/10",children:[e.jsx("span",{className:"text-white/70 font-medium",children:"Items Subtotal (After Line Discounts):"}),e.jsx("span",{className:"text-white font-semibold",children:x(l.itemsSubTotal||0)})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"text-xs text-white/50 mb-2",children:"Add: Order Charges"}),c.delivery>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-white/60",children:"Delivery Fee:"}),e.jsx("span",{className:"text-white",children:x(c.delivery)})]}),c.packing>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-white/60",children:"Packing Fee:"}),e.jsx("span",{className:"text-white",children:x(c.packing)})]}),c.insurance>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-white/60",children:"Insurance:"}),e.jsx("span",{className:"text-white",children:x(c.insurance)})]}),c.other>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-white/60",children:"Other Charges:"}),e.jsx("span",{className:"text-white",children:x(c.other)})]}),e.jsxs("div",{className:"flex justify-between pt-1 border-t border-white/10 mt-1",children:[e.jsx("span",{className:"text-white/70 font-medium",children:"Total Charges:"}),e.jsx("span",{className:"text-white font-semibold",children:x(c.delivery+c.packing+c.insurance+c.other||0)})]})]}),l.discountTotal>0&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/10",children:[e.jsxs("span",{className:"text-white/70",children:["Less: Order Discount (",c.discountPct.toFixed(2),"%):"]}),e.jsxs("span",{className:"text-red-400 font-semibold",children:["-",x(l.discountTotal||0)]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/10 bg-white/5 px-3 rounded",children:[e.jsx("span",{className:"text-white font-medium",children:"Taxable Base (Before GST):"}),e.jsx("span",{className:"text-white font-semibold",children:x(l.taxableBase||0)})]}),l.taxBreakup&&(l.taxBreakup.cgst>0||l.taxBreakup.sgst>0||l.taxBreakup.igst>0)&&e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 space-y-1",children:[e.jsxs("div",{className:"text-xs text-white/50 mb-2",children:["Add: GST (",l.taxType==="IGST"?"Interstate":"Intrastate"," - ",de," → ",be,")"]}),l.taxBreakup.cgst>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-white/60",children:"CGST:"}),e.jsx("span",{className:"text-white",children:x(l.taxBreakup.cgst)})]}),l.taxBreakup.sgst>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-white/60",children:"SGST:"}),e.jsx("span",{className:"text-white",children:x(l.taxBreakup.sgst)})]}),l.taxBreakup.igst>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-white/60",children:"IGST:"}),e.jsx("span",{className:"text-white",children:x(l.taxBreakup.igst)})]}),e.jsxs("div",{className:"flex justify-between pt-1 border-t border-white/10 mt-1",children:[e.jsx("span",{className:"text-white/70 font-medium",children:"Total GST:"}),e.jsx("span",{className:"text-white font-semibold",children:x((l.taxBreakup.cgst||0)+(l.taxBreakup.sgst||0)+(l.taxBreakup.igst||0))})]})]}),l.roundOff!==0&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/10",children:[e.jsxs("span",{className:"text-white/70",children:["Round Off (",ne,"):"]}),e.jsxs("span",{className:l.roundOff>0?"text-emerald-400":"text-red-400",children:[l.roundOff>0?"+":"",x(l.roundOff)]})]}),e.jsxs("div",{className:"flex justify-between items-center py-3 pt-4 border-t-2 border-emerald-400/30 bg-emerald-500/10 px-4 rounded-lg",children:[e.jsx("span",{className:"text-white font-bold text-lg",children:"Grand Total (Payable):"}),e.jsx("span",{className:"text-emerald-400 font-bold text-xl",children:x(l.grandTotal||0)})]})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("input",{type:"checkbox",id:"roundingEnabled",checked:ie,onChange:t=>He(t.target.checked),className:"w-4 h-4 rounded border-white/20 bg-white/10 text-emerald-500 focus:ring-emerald-400"}),e.jsx("label",{htmlFor:"roundingEnabled",className:"text-white/70 text-sm font-medium",children:"Enable Rounding"})]}),ie&&e.jsxs("div",{className:"ml-7",children:[e.jsx("label",{className:"text-xs text-white/50 mb-2 block",children:"Rounding Method"}),e.jsx("div",{className:"flex gap-3",children:["NEAREST","UP","DOWN"].map(t=>e.jsx("button",{onClick:()=>Ve(t),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition ${ne===t?"bg-emerald-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20"}`,children:t==="NEAREST"?"Nearest":t==="UP"?"Round Up":"Round Down"},t))})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"skipProforma",checked:Y,onChange:t=>ze(t.target.checked),className:"w-4 h-4 rounded border-white/20 bg-white/10 text-emerald-500 focus:ring-emerald-400"}),e.jsx("label",{htmlFor:"skipProforma",className:"text-white/70 text-sm",children:"Skip Proforma (Apply defaults and move directly to ACCEPTED)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{value:me,onChange:t=>q(t.target.value),rows:3,className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"Add any notes about this quote..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{he(!1),q("")},className:"flex-1 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",children:"Cancel"}),e.jsxs("button",{onClick:et,disabled:!l||Me,className:"flex-1 px-4 py-2 bg-emerald-500 hover:bg-emerald-600 disabled:bg-emerald-500/50 disabled:cursor-not-allowed rounded-lg text-white font-semibold transition flex items-center justify-center gap-2",children:[e.jsx(it,{})," ",Me?"Saving...":Y?"Skip Proforma & Accept":"Send Quote"]})]})]})}),(L===P.QUOTED||a.chargesSnapshot)&&a.chargesSnapshot?.breakdown&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-500/10 to-emerald-500/10 border border-blue-400/20 rounded-xl p-5",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(Ce,{})," Quote Breakdown (Accounting View)"]}),(()=>{const t=a.chargesSnapshot.breakdown,r=a.proforma||{},s=r.taxBreakup||a.chargesSnapshot.breakdown.taxBreakup||{},d=a.chargesSnapshot.defaultsUsed||{};return e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/10",children:[e.jsx("span",{className:"text-white/70 font-medium",children:"Gross Items Value:"}),e.jsx("span",{className:"text-white font-semibold",children:x(t.grossItems||0)})]}),t.lineDiscountTotal>0&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/10",children:[e.jsx("span",{className:"text-white/70",children:"Less: Line Item Discounts:"}),e.jsxs("span",{className:"text-red-400 font-semibold",children:["-",x(t.lineDiscountTotal||0)]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/10",children:[e.jsx("span",{className:"text-white/70 font-medium",children:"Items Subtotal (After Line Discounts):"}),e.jsx("span",{className:"text-white font-semibold",children:x(t.itemsSubTotal||t.subTotal||0)})]}),(t.delivery>0||t.packing>0||t.insurance>0||t.other>0)&&e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"text-xs text-white/50 mb-2",children:"Add: Order Charges"}),t.delivery>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-white/60",children:"Delivery Fee:"}),e.jsx("span",{className:"text-white",children:x(t.delivery)})]}),t.packing>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-white/60",children:"Packing Fee:"}),e.jsx("span",{className:"text-white",children:x(t.packing)})]}),t.insurance>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-white/60",children:"Insurance:"}),e.jsx("span",{className:"text-white",children:x(t.insurance)})]}),t.other>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-white/60",children:"Other Charges:"}),e.jsx("span",{className:"text-white",children:x(t.other)})]}),e.jsxs("div",{className:"flex justify-between pt-1 border-t border-white/10 mt-1",children:[e.jsx("span",{className:"text-white/70 font-medium",children:"Total Charges:"}),e.jsx("span",{className:"text-white font-semibold",children:x((t.delivery||0)+(t.packing||0)+(t.insurance||0)+(t.other||0))})]})]}),t.discountTotal>0&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/10",children:[e.jsxs("span",{className:"text-white/70",children:["Less: Order Discount (",t.discountPct?.toFixed(2)||0,"%):"]}),e.jsxs("span",{className:"text-red-400 font-semibold",children:["-",x(t.discountTotal||0)]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/10 bg-white/5 px-3 rounded",children:[e.jsx("span",{className:"text-white font-medium",children:"Taxable Base (Before GST):"}),e.jsx("span",{className:"text-white font-semibold",children:x(t.taxableBase||r.taxableBase||0)})]}),(s.cgst>0||s.sgst>0||s.igst>0)&&e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 space-y-1",children:[e.jsxs("div",{className:"text-xs text-white/50 mb-2",children:["Add: GST (",r.taxType==="IGST"?"Interstate":"Intrastate"," - ",de," → ",be,")"]}),s.cgst>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-white/60",children:"CGST:"}),e.jsx("span",{className:"text-white",children:x(s.cgst)})]}),s.sgst>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-white/60",children:"SGST:"}),e.jsx("span",{className:"text-white",children:x(s.sgst)})]}),s.igst>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-white/60",children:"IGST:"}),e.jsx("span",{className:"text-white",children:x(s.igst)})]}),e.jsxs("div",{className:"flex justify-between pt-1 border-t border-white/10 mt-1",children:[e.jsx("span",{className:"text-white/70 font-medium",children:"Total GST:"}),e.jsx("span",{className:"text-white font-semibold",children:x((s.cgst||0)+(s.sgst||0)+(s.igst||0))})]})]}),r.roundOff!==0&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/10",children:[e.jsxs("span",{className:"text-white/70",children:["Round Off (",d.roundRule?.toUpperCase()||"NEAREST","):"]}),e.jsxs("span",{className:r.roundOff>0?"text-emerald-400":"text-red-400",children:[r.roundOff>0?"+":"",x(r.roundOff)]})]}),e.jsxs("div",{className:"flex justify-between items-center py-3 pt-4 border-t-2 border-emerald-400/30 bg-emerald-500/10 px-4 rounded-lg",children:[e.jsx("span",{className:"text-white font-bold text-lg",children:"Grand Total (Payable):"}),e.jsx("span",{className:"text-emerald-400 font-bold text-xl",children:x(a.grandTotal||r.grandTotal||0)})]})]})})()]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-5",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(Ee,{})," Order Items"]}),e.jsx("div",{className:"space-y-3",children:tt.map((t,r)=>e.jsxs("div",{className:"p-3 bg-white/5 rounded-lg border border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:t.productName||"Unnamed Product"}),t.sku&&e.jsxs("p",{className:"text-xs text-white/50 mt-1",children:["SKU: ",t.sku]}),t.pricingMode&&e.jsx("p",{className:"text-xs text-emerald-400/70 mt-1",children:t.pricingMode===w.MRP_INCLUSIVE?"MRP":t.pricingMode===w.BASE_PLUS_TAX?"Base Price":"Selling Price"})]}),e.jsx("span",{className:"text-emerald-400 font-semibold",children:x(t.subtotal||t.quantity*t.unitPrice)})]}),e.jsxs("div",{className:"flex justify-between text-sm text-white/70",children:[e.jsxs("span",{children:["Qty: ",t.quantity]}),e.jsxs("span",{children:["Price: ",x(t.unitPrice)]}),t.itemDiscountPct>0&&e.jsxs("span",{className:"text-red-400",children:["Disc: ",t.itemDiscountPct.toFixed(2),"%"]})]})]},r))}),!a.chargesSnapshot&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 flex justify-between items-center",children:[e.jsx("span",{className:"text-white font-semibold",children:"Subtotal:"}),e.jsx("span",{className:"text-xl font-bold text-emerald-400",children:x(a.itemsSubTotal||a.grandTotal||0)})]})]}),e.jsxs("div",{className:"space-y-4",children:[T?e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-5",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(qe,{})," Product Owner Information"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Name:"}),e.jsx("span",{className:"text-white ml-2",children:a.productOwnerName||"N/A"})]}),a.productOwnerEmail&&e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Email:"}),e.jsx("span",{className:"text-white ml-2",children:a.productOwnerEmail})]}),a.productOwnerPhone&&e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Phone:"}),e.jsx("span",{className:"text-white ml-2",children:a.productOwnerPhone})]}),a.productOwnerId&&e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"FLYP ID:"}),e.jsxs("span",{className:"text-white ml-2 font-mono text-xs",children:[a.productOwnerId.slice(0,12),"..."]})]})]})]}):e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-5",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(qe,{})," Distributor Information"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Name:"}),e.jsx("span",{className:"text-white ml-2",children:a.distributorName||"N/A"})]}),a.distributorEmail&&e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Email:"}),e.jsx("span",{className:"text-white ml-2",children:a.distributorEmail})]}),a.distributorPhone&&e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Phone:"}),e.jsx("span",{className:"text-white ml-2",children:a.distributorPhone})]}),a.distributorId&&e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"FLYP ID:"}),e.jsxs("span",{className:"text-white ml-2 font-mono text-xs",children:[a.distributorId.slice(0,12),"..."]})]})]})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-5",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(Ce,{})," Payment Information"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/50",children:"Payment Mode:"}),e.jsx("span",{className:"text-white font-medium",children:a.paymentModeLabel||a.paymentMode||"COD"})]}),a.creditDays&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/50",children:"Credit Days:"}),e.jsxs("span",{className:"text-white",children:[a.creditDays," days"]})]}),a.advancePaid>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/50",children:"Advance Paid:"}),e.jsx("span",{className:"text-white",children:x(a.advancePaid)})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-white/10",children:[e.jsx("span",{className:"text-white font-semibold",children:"Total Amount:"}),e.jsx("span",{className:"text-emerald-400 font-bold",children:x(a.grandTotal||a.itemsSubTotal||0)})]})]})]})]})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-5",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(Te,{})," Status Timeline"]}),Pe.length>0?e.jsx("div",{className:"space-y-4",children:Pe.map((t,r)=>{const s=t.status||t.statusCode||"";return e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${je(s).split(" ")[0]}`}),r<Pe.length-1&&e.jsx("div",{className:"w-0.5 h-full bg-white/10 mt-1"})]}),e.jsxs("div",{className:"flex-1 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("span",{className:`px-3 py-1 rounded-lg text-sm font-medium border inline-flex items-center gap-2 ${je(s)}`,children:[ve(s),J(s)]}),(t.updatedByName||t.updatedBy)&&e.jsxs("p",{className:"text-xs text-white/50 mt-1",children:["Updated by ",t.updatedByName||t.updatedBy||"System"]})]}),e.jsx("span",{className:"text-xs text-white/50",children:We(t.updatedAt||t.at||t.createdAt||t.timestamp)})]}),t.notes&&e.jsxs("p",{className:"text-sm text-white/70 mt-2 bg-white/5 p-2 rounded border border-white/10",children:[e.jsx(nt,{className:"inline mr-1 text-xs"}),t.notes]})]})]},r)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-white/50 text-sm mb-2",children:"No status history available"}),e.jsx("p",{className:"text-white/30 text-xs",children:"Status updates will appear here as the order progresses"})]})]}),a.notes&&e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-5",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Order Notes"}),e.jsx("p",{className:"text-white/70 text-sm",children:a.notes})]})]}),e.jsx(ke,{children:Xe&&e.jsx(te.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/90 backdrop-blur-sm z-[60] flex items-center justify-center p-4",onClick:()=>!k&&le(!1),children:e.jsxs(te.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:t=>t.stopPropagation(),className:"bg-slate-900 rounded-xl border border-white/10 w-full max-w-4xl max-h-[90vh] overflow-hidden shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-slate-900/98 via-slate-800/95 to-slate-900/98 backdrop-blur-xl border-b border-white/10 p-6 flex items-center justify-between z-10",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Add Items to Inventory"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Review and edit items before adding to inventory"})]}),e.jsx("button",{onClick:()=>le(!1),disabled:k,className:"p-2 rounded-lg hover:bg-white/10 text-white/70 hover:text-white transition-all disabled:opacity-50",children:e.jsx(ce,{className:"text-lg"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar",children:G.map((t,r)=>{const s=t.existingProduct,d=s?t.existingProduct.quantity:0,i=Number(t.finalQuantity||t.quantity||0),o=t.action==="update"?d+i:i;return e.jsxs("div",{className:`bg-white/5 border rounded-xl p-5 ${s&&t.action==="update"?"border-emerald-400/30 bg-emerald-500/5":"border-white/10"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-1",children:t.productName}),s&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"px-2 py-1 bg-emerald-500/20 text-emerald-300 text-xs rounded border border-emerald-400/30",children:"Exists in Inventory"}),e.jsxs("span",{className:"text-white/50 text-xs",children:["Current Qty: ",d," ",t.unit]})]})]}),e.jsx("div",{className:"flex gap-2",children:s&&e.jsx("button",{onClick:()=>$(r,"action",t.action==="update"?"new":"update"),disabled:k,className:`px-3 py-1.5 rounded-lg text-xs font-medium transition ${t.action==="update"?"bg-emerald-500/20 text-emerald-300 border border-emerald-400/30":"bg-blue-500/20 text-blue-300 border border-blue-400/30"} disabled:opacity-50`,children:t.action==="update"?"Update Existing":"Add as New"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-white/50 mb-1",children:["Quantity ",t.action==="update"&&`(Will add to ${d})`]}),e.jsx("input",{type:"number",value:t.finalQuantity||t.quantity||0,onChange:u=>$(r,"finalQuantity",u.target.value),disabled:k,min:"0",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm disabled:opacity-50"}),t.action==="update"&&e.jsxs("p",{className:"text-xs text-emerald-400 mt-1",children:["Total: ",o," ",t.unit]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/50 mb-1",children:"Cost Price (₹)"}),e.jsx("input",{type:"number",value:t.finalCostPrice||t.costPrice||0,onChange:u=>$(r,"finalCostPrice",u.target.value),disabled:k,min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm disabled:opacity-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/50 mb-1",children:"Selling Price (₹)"}),e.jsx("input",{type:"number",value:t.finalSellingPrice||t.sellingPrice||0,onChange:u=>$(r,"finalSellingPrice",u.target.value),disabled:k,min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm disabled:opacity-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/50 mb-1",children:"SKU"}),e.jsx("input",{type:"text",value:t.finalSku||t.sku||"",onChange:u=>$(r,"finalSku",u.target.value),disabled:k||t.action==="update",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm disabled:opacity-50",placeholder:"Auto-generated"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/50 mb-1",children:"Brand"}),e.jsx("input",{type:"text",value:t.finalBrand||t.brand||"",onChange:u=>$(r,"finalBrand",u.target.value),disabled:k,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm disabled:opacity-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/50 mb-1",children:"Category"}),e.jsx("input",{type:"text",value:t.finalCategory||t.category||"",onChange:u=>$(r,"finalCategory",u.target.value),disabled:k,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm disabled:opacity-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-white/50 mb-1",children:"Unit"}),e.jsx("input",{type:"text",value:t.finalUnit||t.unit||"",onChange:u=>$(r,"finalUnit",u.target.value),disabled:k,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm disabled:opacity-50"})]})]})]},r)})}),e.jsxs("div",{className:"sticky bottom-0 bg-gradient-to-r from-slate-900/98 via-slate-800/95 to-slate-900/98 backdrop-blur-xl border-t border-white/10 p-6 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>le(!1),disabled:k,className:"px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{onClick:Je,disabled:k||!G||G.length===0,className:"px-6 py-2 bg-emerald-500 hover:bg-emerald-600 disabled:bg-emerald-500/50 disabled:cursor-not-allowed rounded-lg text-white font-semibold transition flex items-center gap-2",children:[e.jsx(Qe,{})," ",k?"Adding...":"Add to Inventory"]})]})]})})})]}),e.jsx("style",{children:`
        .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: rgba(255, 255, 255, 0.05);
          border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: rgba(16, 185, 129, 0.3);
          border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: rgba(16, 185, 129, 0.5);
        }
      `})]})};export{yt as O};
