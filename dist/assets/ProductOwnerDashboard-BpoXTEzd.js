import{j as e,l as Y,d as U,y as p,v as ss,r as Gt,u as Kt,g as Ht,s as as}from"./index-DRC3F7i0.js";import{r as i,R as wt,u as rs}from"./router-BPBaD_i0.js";import{e as Te,d as de,c as Pe,g as $e,p as Ye,T as zt,s as je,l as it,u as qe,b as pt,a as _t,m as Dt,q as At,w as is,o as ns,n as ls,f as os}from"./firebase-DWi1MSv1.js";import{aG as ds,p as ze,I as xt,k as Vt,T as Me,K as Je,C as Ge,R as st,S as nt,X as _e,u as at,aN as cs,Z as yt,s as rt,aO as ms,o as Jt,aP as bt,q as Nt,a as dt,F as It,L as us,aQ as Yt,aR as hs,_ as ct,aS as jt,U as xs,l as vt,x as ps,n as Mt,v as Tt,aT as Lt,am as ft,m as gs,aU as bs,aV as fs,aW as Rt,ah as Et,aX as ws,aY as ys,B as ht,A as tt,aZ as Ns,a_ as js,a$ as vs,b0 as Ss,P as ks,aJ as Ot,b1 as Cs,aD as Ps,aK as Ds,b2 as As,g as Ut,b3 as Is,b4 as Ms}from"./index-CprmGC-M.js";import{u as Wt}from"./useTranslation-C_4YkXWs.js";import{m as y}from"./proxy-BgUy8BPw.js";import"./orderStatus-BwkCpksU.js";import{A as De}from"./index-DSciU07p.js";import{O as Qt}from"./OrderDetailModal-BXc_IbAw.js";import{u as Ts,G as Ls,P as Rs,I as $t,M as Es}from"./esm-LCaBFwtY.js";import{f as Ft,c as Os}from"./indiaLocationAPI-CppZbdop.js";import{A as Us}from"./AddRetailerModal-ksR6C5rK.js";import $s from"./ProfileSettings-b0gwSSn1.js";import"./vendor-Ckhrjn13.js";import"./index.esm-Bux_mLJ0.js";import"./calcProforma-Ep9qGXtN.js";import"./pricing-SUVGnFgL.js";import"./WhatsAppConnection-C8P9Ymrj.js";import"./whatsappConfig-B767RKqS.js";import"./LanguageSwitcher-BHE27wEu.js";const Fs=()=>{const{t:b}=Wt(),[T,L]=i.useState({productsInMaking:0,productsBuilt:0,productsDispatched:0,totalProducts:0,totalDistributors:0,activeOrders:0,totalRevenue:0,pendingDeliveries:0}),[q,g]=i.useState({inMaking:[],built:[],dispatched:[]}),[ce,B]=i.useState({ownerName:"",businessName:""}),[xe,me]=i.useState(!0);i.useEffect(()=>{(async()=>{const E=Y.currentUser?.uid;if(E)try{const P=await Te(de(U,"businesses",E));if(P.exists()){const d=P.data();B({ownerName:d.ownerName||d.name||d.userName||"",businessName:d.businessName||d.name||""})}}catch(P){console.error("Failed to load product owner profile",P)}})()},[]),i.useEffect(()=>{(async()=>{const E=Y.currentUser?.uid;if(E){me(!0);try{const P=Pe(U,`businesses/${E}/products`),d=await $e(P),ae=[],re=[],O=[];let _=0,m=0,k=0,V=0;d.forEach(r=>{const N={id:r.id,...r.data()};_++;const Q=N.productionStatus||N.status||"inMaking";Q==="inMaking"||Q==="in_production"?(m++,ae.push(N)):Q==="built"||Q==="completed"||Q==="ready"?(k++,re.push(N)):(Q==="dispatched"||Q==="shipped")&&(V++,O.push(N))});const we=Pe(U,`businesses/${E}/connectedDistributors`),pe=(await $e(we)).size,oe=Pe(U,`businesses/${E}/orders`),u=await $e(oe);let f=0,W=0,K=0;u.forEach(r=>{const N=r.data();(N.status==="pending"||N.status==="processing"||N.status==="accepted")&&f++,(N.status==="dispatched"||N.status==="in_transit")&&K++,N.status==="delivered"&&N.totalAmount&&(W+=Number(N.totalAmount)||0)}),L({productsInMaking:m,productsBuilt:k,productsDispatched:V,totalProducts:_,totalDistributors:pe,activeOrders:f,totalRevenue:W,pendingDeliveries:K}),g({inMaking:ae.slice(0,5),built:re.slice(0,5),dispatched:O.slice(0,5)})}catch(P){console.error("Error loading product owner dashboard:",P)}finally{me(!1)}}})()},[]);const G=({label:te,value:E,icon:P,tone:d="default",subtitle:ae})=>{const re={default:"text-white",yellow:"text-amber-300",green:"text-emerald-300",blue:"text-cyan-300",purple:"text-fuchsia-300",orange:"text-orange-300"};return e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-4 hover:scale-[1.02] transition duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-white/70",children:te}),e.jsx("div",{className:"text-white/40",children:P})]}),e.jsx("div",{className:`text-2xl font-semibold ${re[d]||re.default}`,children:xe?"...":E}),ae&&e.jsx("p",{className:"text-xs text-white/60 mt-1",children:ae})]})},ee=({product:te,status:E})=>{const P={inMaking:"border-orange-400/30 bg-orange-400/10",built:"border-emerald-400/30 bg-emerald-400/10",dispatched:"border-blue-400/30 bg-blue-400/10"},d={inMaking:e.jsx(Je,{className:"text-orange-400"}),built:e.jsx(ze,{className:"text-emerald-400"}),dispatched:e.jsx(xt,{className:"text-blue-400"})};return e.jsx(y.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:`rounded-lg border ${P[E]} p-3 mb-2`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-white text-sm",children:te.name||"Unnamed Product"}),e.jsxs("p",{className:"text-xs text-white/70 mt-1",children:[te.sku&&`SKU: ${te.sku}`,te.quantity&&` • Qty: ${te.quantity}`]})]}),e.jsx("div",{className:"ml-2",children:d[E]})]})})};return e.jsxs(y.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-6 text-white p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm text-white/60",children:new Date().toLocaleDateString("en-IN",{weekday:"long",day:"2-digit",month:"long",year:"numeric"})}),e.jsxs("h2",{className:"mt-2 text-3xl md:text-4xl font-extrabold tracking-tight",children:["Welcome back, ",e.jsx("span",{className:"text-emerald-300",children:ce.ownerName||"Product Owner"})," ✦"]}),e.jsx("p",{className:"mt-2 text-white/70",children:ce.businessName||"Production Dashboard"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(G,{label:"Products in Making",value:T.productsInMaking,icon:e.jsx(ds,{}),tone:"orange",subtitle:`Out of ${T.totalProducts} total`}),e.jsx(G,{label:"Products Built",value:T.productsBuilt,icon:e.jsx(ze,{}),tone:"green",subtitle:"Ready for dispatch"}),e.jsx(G,{label:"Products Dispatched",value:T.productsDispatched,icon:e.jsx(xt,{}),tone:"blue",subtitle:`${T.pendingDeliveries} in transit`}),e.jsx(G,{label:"Total Revenue",value:`₹${T.totalRevenue.toLocaleString()}`,icon:e.jsx(Vt,{}),tone:"purple",subtitle:"From delivered orders"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(G,{label:"Connected Distributors",value:T.totalDistributors,icon:e.jsx(Me,{}),tone:"default"}),e.jsx(G,{label:"Active Orders",value:T.activeOrders,icon:e.jsx(Je,{}),tone:"yellow"}),e.jsx(G,{label:"Total Products",value:T.totalProducts,icon:e.jsx(Me,{}),tone:"default"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6",children:[e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Je,{className:"text-orange-400"}),e.jsx("h3",{className:"font-semibold text-lg",children:"Products in Making"}),e.jsx("span",{className:"ml-auto px-2 py-1 rounded-full bg-orange-400/20 text-orange-300 text-xs",children:q.inMaking.length})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:q.inMaking.length>0?q.inMaking.map(te=>e.jsx(ee,{product:te,status:"inMaking"},te.id)):e.jsx("p",{className:"text-white/50 text-sm text-center py-4",children:"No products in production"})})]}),e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ze,{className:"text-emerald-400"}),e.jsx("h3",{className:"font-semibold text-lg",children:"Products Built"}),e.jsx("span",{className:"ml-auto px-2 py-1 rounded-full bg-emerald-400/20 text-emerald-300 text-xs",children:q.built.length})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:q.built.length>0?q.built.map(te=>e.jsx(ee,{product:te,status:"built"},te.id)):e.jsx("p",{className:"text-white/50 text-sm text-center py-4",children:"No products ready yet"})})]}),e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(xt,{className:"text-blue-400"}),e.jsx("h3",{className:"font-semibold text-lg",children:"Products Dispatched"}),e.jsx("span",{className:"ml-auto px-2 py-1 rounded-full bg-blue-400/20 text-blue-300 text-xs",children:q.dispatched.length})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:q.dispatched.length>0?q.dispatched.map(te=>e.jsx(ee,{product:te,status:"dispatched"},te.id)):e.jsx("p",{className:"text-white/50 text-sm text-center py-4",children:"No products dispatched yet"})})]})]}),e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-5",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx("button",{className:"px-4 py-3 rounded-lg bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-400/30 text-emerald-300 transition",children:"Create Product"}),e.jsx("button",{className:"px-4 py-3 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/30 text-blue-300 transition",children:"Assign Distributor"}),e.jsx("button",{className:"px-4 py-3 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 border border-purple-400/30 text-purple-300 transition",children:"Track Orders"}),e.jsx("button",{className:"px-4 py-3 rounded-lg bg-orange-500/20 hover:bg-orange-500/30 border border-orange-400/30 text-orange-300 transition",children:"View Reports"})]})]})]})},Bs=({distributor:b,onClose:T,onSuccess:L})=>{const[q,g]=i.useState([{productName:"",quantity:1,unitPrice:0,notes:"",productId:null}]),[ce,B]=i.useState("COD"),[xe,me]=i.useState(15),[G,ee]=i.useState({cash:0,upi:0,card:0}),[te,E]=i.useState(0),[P,d]=i.useState("normal"),[ae,re]=i.useState(""),[O,_]=i.useState(!1),[m,k]=i.useState(!1),[V,we]=i.useState(!1),[Ce,pe]=i.useState([]),[oe,u]=i.useState(!1),[f,W]=i.useState(""),[K,r]=i.useState(null),N=a=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(a||0));i.useEffect(()=>{const a=Y.currentUser?.uid;if(!a)return;const h=Pe(U,`businesses/${a}/products`),t=Ye(h,l=>{const x=l.docs.map(v=>({id:v.id,...v.data()}));pe(x)});return()=>t()},[]);const Q=()=>q.reduce((a,h)=>a+parseFloat(h.quantity||0)*parseFloat(h.unitPrice||0),0),ie=Ce.filter(a=>{const h=f.toLowerCase(),t=(a.name||a.productName||"").toLowerCase(),l=(a.sku||"").toLowerCase(),x=(a.brand||"").toLowerCase(),v=(a.category||"").toLowerCase();return t.includes(h)||l.includes(h)||x.includes(h)||v.includes(h)}),o=a=>{const h=a.sellingPrice||a.mrp||a.costPrice||0,t={productName:a.name||a.productName||"",quantity:1,unitPrice:parseFloat(h),notes:a.description||"",productId:a.id,sku:a.sku||"",productData:a};g([...q,t]),u(!1),W(""),p.success(`${a.name||a.productName} added to order`)},M=a=>{r(a),u(!0)},C=a=>{const h=a.sellingPrice||a.mrp||a.costPrice||0,t=[...q];t[K]={productName:a.name||a.productName||"",quantity:t[K].quantity||1,unitPrice:parseFloat(h),notes:a.description||"",productId:a.id,sku:a.sku||"",productData:a},g(t),u(!1),r(null),W(""),p.success(`${a.name||a.productName} added to order`)},F=()=>{g([...q,{productName:"",quantity:1,unitPrice:0,notes:"",productId:null}])},ne=a=>{q.length>1&&g(q.filter((h,t)=>t!==a))},ve=(a,h,t)=>{const l=[...q];l[a]={...l[a],[h]:t},g(l)},Fe=a=>({code:a.toUpperCase(),label:a,isCredit:/credit/i.test(a),isSplit:a.toLowerCase()==="split",isAdvance:/advance/i.test(a),creditDays:/credit/i.test(a)?Number(xe||0):null,splitPayment:a.toLowerCase()==="split"?{...G}:null,advancePaid:/advance/i.test(a)?Number(te||0):null}),Le=async a=>{if(a.preventDefault(),!b?.distributorId){p.error("Distributor information missing");return}const h=Y.currentUser?.uid;if(!h){p.error("Please log in again");return}const t=q.filter(l=>l.productName.trim()&&l.quantity>0&&l.unitPrice>=0);if(t.length===0){p.error("Please add at least one valid item");return}if(ce.toLowerCase()==="split"){const l=G.cash+G.upi+G.card,x=Q();if(Math.abs(l-x)>.01){p.error("Split payment amounts must equal the order total");return}}if(ce.toLowerCase()==="credit"&&(!xe||xe<0)){p.error("Please specify credit days");return}_(!0);try{const l=de(U,"businesses",h),x=await Te(l),v=x.exists()?x.data():{};console.log("Product Owner Business Data:",{businessName:v.businessName,ownerName:v.ownerName,email:v.email,phone:v.phone});const J=Q(),w=de(Pe(U,`businesses/${b.distributorId}/productOwnerOrders`)).id,X=Fe(ce),A={orderId:w,productOwnerId:h,distributorId:b.distributorId,createdBy:"productOwner",creatorUid:h,items:t.map(ye=>({productName:ye.productName.trim(),quantity:Number(ye.quantity),unitPrice:Number(ye.unitPrice),subtotal:Number(ye.quantity)*Number(ye.unitPrice),notes:ye.notes?.trim()||"",productId:ye.productId||null,sku:ye.sku||null})),itemsSubTotal:J,grandTotal:J,paymentMode:X.code,paymentModeLabel:X.label,paymentNormalized:X,creditDays:X.creditDays,splitPayment:X.splitPayment,advancePaid:X.advancePaid,paymentFlags:{isCredit:!!X.isCredit,isSplit:!!X.isSplit,isAdvance:!!X.isAdvance},priority:P||"normal",notes:ae.trim()||"",status:"ASSIGNED",statusCode:"ASSIGNED",productOwnerName:v.businessName||v.ownerName||Y.currentUser?.displayName||"Product Owner",productOwnerEmail:v.email||Y.currentUser?.email||"",productOwnerPhone:v.phone||Y.currentUser?.phoneNumber||"",productOwnerId:h,distributorName:b.businessName||b.distributorName||"",distributorEmail:b.email||b.distributorEmail||"",distributorPhone:b.phone||b.distributorPhone||"",createdAt:je(),timestamp:je(),statusTimestamps:{assignedAt:je()},statusHistory:[{status:"ASSIGNED",updatedAt:zt.now(),updatedBy:h,updatedByName:v.businessName||v.ownerName||Y.currentUser?.displayName||"Product Owner",notes:"Order assigned to distributor"}]};await it(de(U,`businesses/${b.distributorId}/productOwnerOrders/${w}`),A),await it(de(U,`businesses/${h}/assignedOrdersToDistributors/${w}`),{...A}),p.success("Order assigned successfully!"),L&&L(),T&&T()}catch(l){console.error("Error assigning order:",l),p.error("Failed to assign order. Please try again.")}finally{_(!1)}},S=Q();return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        /* Custom scrollbar for inventory modal */
        .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: rgba(255, 255, 255, 0.05);
          border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: rgba(16, 185, 129, 0.3);
          border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: rgba(16, 185, 129, 0.5);
        }
      `}),e.jsxs(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:T,children:[e.jsxs(y.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:a=>a.stopPropagation(),className:"bg-slate-900 rounded-xl border border-white/10 w-full max-w-3xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"sticky top-0 bg-slate-900/95 backdrop-blur-md border-b border-white/10 p-6 flex items-center justify-between z-10",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Assign Order to ",b?.businessName||"Distributor"]}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Create a new order assignment"})]}),e.jsx("button",{onClick:T,className:"p-2 rounded-lg hover:bg-white/10 text-white/70 hover:text-white transition",children:e.jsx(Ge,{})})]}),e.jsxs("form",{onSubmit:Le,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:"Order Items"}),e.jsx("p",{className:"text-sm text-white/60",children:"Add products from inventory or enter manually"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{r(null),u(!0)},className:"px-4 py-2.5 bg-gradient-to-r from-blue-500/20 to-blue-400/20 hover:from-blue-500/30 hover:to-blue-400/30 border border-blue-400/30 rounded-lg text-blue-300 text-sm font-medium transition-all hover:scale-105 hover:shadow-lg hover:shadow-blue-500/20 flex items-center gap-2",children:[e.jsx(Me,{className:"text-sm"})," Select from Inventory"]}),e.jsxs("button",{type:"button",onClick:F,className:"px-4 py-2.5 bg-gradient-to-r from-emerald-500/20 to-emerald-400/20 hover:from-emerald-500/30 hover:to-emerald-400/30 border border-emerald-400/30 rounded-lg text-emerald-300 text-sm font-medium transition-all hover:scale-105 hover:shadow-lg hover:shadow-emerald-500/20 flex items-center gap-2",children:[e.jsx(st,{className:"text-sm"})," Add Manual Item"]})]})]}),e.jsx("div",{className:"space-y-3",children:q.map((a,h)=>e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},className:"group relative p-4 bg-gradient-to-br from-white/5 to-white/[0.02] rounded-xl border border-white/10 hover:border-emerald-400/30 transition-all duration-300 shadow-lg hover:shadow-emerald-500/10",children:[a.productId&&e.jsxs("div",{className:"absolute top-3 right-3 px-2.5 py-1 bg-gradient-to-r from-emerald-500/20 to-emerald-400/20 border border-emerald-400/40 rounded-lg text-xs text-emerald-300 flex items-center gap-1.5 font-medium shadow-lg shadow-emerald-500/20",children:[e.jsx(Me,{className:"text-[10px]"})," From Inventory"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-3",children:[e.jsxs("div",{className:"col-span-12 md:col-span-5",children:[e.jsx("label",{className:"block text-xs font-medium text-white/60 mb-1.5",children:"Product Name *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Enter product name",value:a.productName,onChange:t=>ve(h,"productName",t.target.value),className:"flex-1 px-4 py-2.5 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all",required:!0}),!a.productId&&e.jsx("button",{type:"button",onClick:()=>M(h),className:"px-4 py-2.5 bg-gradient-to-r from-blue-500/20 to-blue-400/20 hover:from-blue-500/30 hover:to-blue-400/30 border border-blue-400/30 rounded-lg text-blue-300 text-sm transition-all hover:scale-105 hover:shadow-lg hover:shadow-blue-500/20",title:"Select from Inventory",children:e.jsx(Me,{})})]}),a.sku&&e.jsxs("p",{className:"text-xs text-emerald-400/80 mt-1.5 flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"SKU:"})," ",a.sku]})]}),e.jsxs("div",{className:"col-span-6 md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-white/60 mb-1.5",children:"Quantity *"}),e.jsx("input",{type:"number",placeholder:"1",value:a.quantity,onChange:t=>ve(h,"quantity",t.target.value),min:"1",className:"w-full px-4 py-2.5 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all",required:!0})]}),e.jsxs("div",{className:"col-span-6 md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-white/60 mb-1.5",children:"Unit Price (₹) *"}),e.jsx("input",{type:"number",placeholder:"0.00",value:a.unitPrice,onChange:t=>ve(h,"unitPrice",t.target.value),min:"0",step:"0.01",className:"w-full px-4 py-2.5 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all",required:!0})]}),e.jsxs("div",{className:"col-span-6 md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-white/60 mb-1.5",children:"Subtotal"}),e.jsx("div",{className:"px-4 py-2.5 bg-gradient-to-r from-emerald-500/10 to-emerald-400/10 border border-emerald-400/20 rounded-lg text-emerald-300 font-semibold text-center",children:N(a.quantity*a.unitPrice)})]}),e.jsx("div",{className:"col-span-6 md:col-span-1 flex items-end",children:q.length>1&&e.jsx("button",{type:"button",onClick:()=>ne(h),className:"w-full px-4 py-2.5 bg-red-500/10 hover:bg-red-500/20 border border-red-400/30 rounded-lg text-red-300 transition-all hover:scale-105 hover:shadow-lg hover:shadow-red-500/20",title:"Remove item",children:e.jsx(nt,{})})})]})]},h))}),e.jsxs(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"mt-6 p-5 bg-gradient-to-r from-emerald-500/10 via-emerald-400/10 to-emerald-500/10 border border-emerald-400/30 rounded-xl shadow-lg shadow-emerald-500/10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-white/80 font-semibold text-lg",children:"Order Total:"}),e.jsx("span",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-300 to-emerald-400",children:N(S)})]}),e.jsxs("p",{className:"text-xs text-white/50 mt-2",children:[q.length," item",q.length!==1?"s":""," in order"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Payment Mode *"}),e.jsxs("select",{value:ce,onChange:a=>{B(a.target.value),a.target.value.toLowerCase()==="split"?k(!0):a.target.value.toLowerCase()==="credit"&&we(!0)},className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",required:!0,children:[e.jsx("option",{value:"COD",children:"Cash on Delivery (COD)"}),e.jsx("option",{value:"PREPAID",children:"Prepaid"}),e.jsx("option",{value:"CREDIT",children:"Credit"}),e.jsx("option",{value:"SPLIT",children:"Split Payment"}),e.jsx("option",{value:"ADVANCE",children:"Advance Payment"})]})]}),ce.toLowerCase()==="credit"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Credit Days *"}),e.jsx("input",{type:"number",value:xe,onChange:a=>me(a.target.value),min:"0",className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",required:!0})]}),e.jsx(De,{children:m&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] flex items-center justify-center p-4",onClick:()=>k(!1),children:e.jsxs(y.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},onClick:a=>a.stopPropagation(),className:"bg-slate-800 rounded-xl border border-white/10 p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Split Payment"}),e.jsxs("p",{className:"text-white/70 text-sm mb-4",children:["Total: ",N(S)]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Cash (₹)"}),e.jsx("input",{type:"number",value:G.cash,onChange:a=>ee({...G,cash:a.target.value}),min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"UPI (₹)"}),e.jsx("input",{type:"number",value:G.upi,onChange:a=>ee({...G,upi:a.target.value}),min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Card (₹)"}),e.jsx("input",{type:"number",value:G.card,onChange:a=>ee({...G,card:a.target.value}),min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white"})]})]}),e.jsx("div",{className:"flex gap-3 mt-6",children:e.jsx("button",{type:"button",onClick:()=>k(!1),className:"flex-1 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",children:"Done"})})]})})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Priority"}),e.jsxs("select",{value:P,onChange:a=>d(a.target.value),className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Notes"}),e.jsx("textarea",{value:ae,onChange:a=>re(a.target.value),rows:3,className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"Additional notes or instructions..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-white/10",children:[e.jsx("button",{type:"button",onClick:T,className:"flex-1 px-4 py-3 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:O,className:"flex-1 px-4 py-3 bg-emerald-500 hover:bg-emerald-600 disabled:bg-emerald-500/50 disabled:cursor-not-allowed rounded-lg text-white font-semibold transition",children:O?"Assigning...":"Assign Order"})]})]})]}),e.jsx(De,{children:oe&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] flex items-center justify-center p-4",onClick:()=>{u(!1),r(null),W("")},children:e.jsxs(y.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:a=>a.stopPropagation(),className:"bg-slate-900 rounded-xl border border-white/10 w-full max-w-4xl max-h-[80vh] overflow-hidden shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-slate-900/98 via-slate-800/95 to-slate-900/98 backdrop-blur-xl border-b border-white/10 p-5 flex items-center justify-between z-10 shadow-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-emerald-300",children:"Select from Inventory"}),e.jsx("p",{className:"text-white/60 text-sm mt-1.5",children:K!==null?"Select a product to replace this item":"Browse and select products to add to your order"})]}),e.jsx("button",{onClick:()=>{u(!1),r(null),W("")},className:"p-2.5 rounded-lg hover:bg-white/10 text-white/70 hover:text-white transition-all hover:scale-110",children:e.jsx(Ge,{className:"text-lg"})})]}),e.jsxs("div",{className:"p-4 border-b border-white/10 bg-gradient-to-r from-white/5 to-transparent",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/50 text-lg"}),e.jsx("input",{type:"text",placeholder:"Search products by name, SKU, brand, or category...",value:f,onChange:a=>W(a.target.value),className:"w-full pl-12 pr-4 py-3 bg-white/10 border-2 border-white/20 rounded-xl text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all shadow-lg",autoFocus:!0}),f&&e.jsx("button",{onClick:()=>W(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 hover:bg-white/10 rounded-lg text-white/50 hover:text-white transition",children:e.jsx(Ge,{className:"text-sm"})})]}),ie.length>0&&e.jsxs("p",{className:"text-xs text-white/50 mt-2 ml-1",children:[ie.length," product",ie.length!==1?"s":""," found"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:ie.length===0?e.jsxs(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center py-16 text-white/60",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-white/5 mb-4",children:e.jsx(Me,{className:"text-4xl opacity-50"})}),e.jsx("p",{className:"text-xl font-semibold mb-2 text-white/80",children:f?"No products found":"No products in inventory"}),e.jsx("p",{className:"text-sm text-white/50",children:f?"Try a different search term":"Add products to your inventory first"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ie.map((a,h)=>{const t=a.sellingPrice||a.mrp||a.costPrice||0,l=a.quantity||0,x=l<=0;return e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:h*.05},className:`group relative p-5 rounded-xl border-2 cursor-pointer transition-all duration-300 ${x?"bg-gradient-to-br from-red-500/10 to-red-500/5 border-red-400/30 opacity-60 cursor-not-allowed":"bg-gradient-to-br from-white/5 to-white/[0.02] border-white/10 hover:border-emerald-400/50 hover:bg-gradient-to-br hover:from-emerald-500/10 hover:to-emerald-400/5 hover:shadow-xl hover:shadow-emerald-500/20 hover:scale-[1.02]"}`,onClick:()=>{x||(K!==null?C(a):o(a))},children:[a.images&&a.images[0]?e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-white/5",children:e.jsx("img",{src:a.images[0],alt:a.name||a.productName,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg bg-gradient-to-br from-white/10 to-white/5 flex items-center justify-center",children:e.jsx(Me,{className:"text-3xl text-white/30"})}),x?e.jsx("div",{className:"absolute top-3 right-3 px-2.5 py-1 bg-red-500/20 border border-red-400/40 rounded-lg text-xs text-red-300 font-medium shadow-lg",children:"Out of Stock"}):l<10&&e.jsx("div",{className:"absolute top-3 right-3 px-2.5 py-1 bg-yellow-500/20 border border-yellow-400/40 rounded-lg text-xs text-yellow-300 font-medium shadow-lg",children:"Low Stock"}),e.jsx("h4",{className:"font-bold text-white text-lg mb-2 line-clamp-2 group-hover:text-emerald-300 transition-colors",children:a.name||a.productName||"Unnamed Product"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[a.sku&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white/50 font-medium",children:"SKU:"}),e.jsx("span",{className:"text-white/80",children:a.sku})]}),a.brand&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white/50 font-medium",children:"Brand:"}),e.jsx("span",{className:"text-white/80",children:a.brand})]}),a.category&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white/50 font-medium",children:"Category:"}),e.jsx("span",{className:"text-white/80",children:a.category})]}),e.jsxs("div",{className:"pt-3 mt-3 border-t border-white/10 flex justify-between items-end",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/50 mb-1",children:"Available Stock"}),e.jsxs("p",{className:"text-sm font-semibold text-white/90",children:[l," ",e.jsx("span",{className:"text-xs text-white/60",children:a.unit||"units"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-white/50 mb-1",children:"Price"}),e.jsx("p",{className:"text-lg font-bold text-emerald-400",children:N(t)}),a.mrp&&a.mrp!==t&&e.jsx("p",{className:"text-xs text-white/50 line-through",children:N(a.mrp)})]})]})]}),!x&&e.jsx("div",{className:"absolute inset-0 bg-emerald-500/0 group-hover:bg-emerald-500/10 rounded-xl flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300",children:e.jsx("div",{className:"px-4 py-2 bg-emerald-500/90 hover:bg-emerald-500 rounded-lg text-white font-semibold text-sm shadow-lg transform scale-90 group-hover:scale-100 transition-transform",children:K!==null?"Replace Item":"Add to Order"})})]},a.id)})})})]})})})]})]})},qs=({distributorOrderRequests:b,orders:T,onOrderUpdate:L,fetchDistributors:q})=>{const[g,ce]=i.useState("incomingRequests"),[B,xe]=i.useState(null),[me,G]=i.useState(!1),ee=d=>{switch(d){case"assigned":return"bg-blue-400/20 text-blue-300";case"accepted":return"bg-emerald-400/20 text-emerald-300";case"in_transit":return"bg-orange-400/20 text-orange-300";case"delivered":return"bg-green-400/20 text-green-300";case"cancelled":return"bg-red-400/20 text-red-300";default:return"bg-gray-400/20 text-gray-300"}},te=[{id:"incomingRequests",label:"Incoming Order Requests",icon:e.jsx(Me,{}),badge:b.length>0?b.filter(d=>d.status==="REQUESTED"||d.statusCode==="REQUESTED").length:0},{id:"orders",label:"Assigned Orders",icon:e.jsx(Me,{})},{id:"tracking",label:"Track Orders",icon:e.jsx(xt,{})}],E=d=>{xe(d),G(!0)},P=()=>{L&&L(),q&&q()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 border-b border-white/10",children:te.map(d=>e.jsxs("button",{onClick:()=>ce(d.id),className:`px-4 py-2 flex items-center gap-2 transition ${g===d.id?"border-b-2 border-emerald-400 text-emerald-300":"text-white/70 hover:text-white"}`,children:[d.icon," ",d.label,d.badge!==void 0&&d.badge>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-red-500 text-white text-xs rounded-full",children:d.badge})]},d.id))}),e.jsxs(De,{mode:"wait",children:[g==="incomingRequests"&&e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"p-3 text-left text-sm font-semibold text-white/70",children:"Order ID"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold text-white/70",children:"Distributor"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold text-white/70",children:"Items"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold text-white/70",children:"Total"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold text-white/70",children:"Payment"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold text-white/70",children:"Priority"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold text-white/70",children:"Status"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold text-white/70",children:"Requested"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold text-white/70",children:"Actions"})]})}),e.jsx("tbody",{children:b.length>0?b.map(d=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition",children:[e.jsxs("td",{className:"p-3 text-sm font-mono",children:["#",d.id.slice(0,8)]}),e.jsx("td",{className:"p-3 text-sm",children:d.distributorName||"N/A"}),e.jsx("td",{className:"p-3 text-sm",children:d.items&&d.items.length>0?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("span",{className:"font-medium",children:[d.items.length," item(s)"]}),e.jsxs("div",{className:"text-xs text-white/60",children:[d.items.slice(0,2).map((ae,re)=>e.jsxs("div",{children:[ae.productName||"Unnamed Product"," (×",ae.quantity||1,")"]},re)),d.items.length>2&&e.jsxs("div",{children:["+",d.items.length-2," more..."]})]})]}):e.jsx("span",{className:"text-white/50",children:"No items"})}),e.jsxs("td",{className:"p-3 text-sm font-semibold text-emerald-400",children:["₹",(d.grandTotal||d.itemsSubTotal||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{className:"p-3 text-sm",children:d.paymentModeLabel||d.paymentMode||"N/A"}),e.jsx("td",{className:"p-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${d.priority==="urgent"?"bg-red-500/20 text-red-300":d.priority==="high"?"bg-orange-500/20 text-orange-300":d.priority==="low"?"bg-gray-500/20 text-gray-300":"bg-blue-500/20 text-blue-300"}`,children:d.priority||"normal"})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${d.status==="REQUESTED"||d.status==="requested"?"bg-yellow-400/20 text-yellow-300":d.status==="ACCEPTED"||d.status==="accepted"?"bg-emerald-400/20 text-emerald-300":d.status==="REJECTED"||d.status==="rejected"?"bg-red-400/20 text-red-300":"bg-blue-400/20 text-blue-300"}`,children:d.status||d.statusCode||"REQUESTED"})}),e.jsx("td",{className:"p-3 text-sm text-white/70",children:d.createdAt?d.createdAt.toDate?d.createdAt.toDate().toLocaleDateString():new Date(d.createdAt).toLocaleDateString():"N/A"}),e.jsx("td",{className:"p-3",children:e.jsx("button",{onClick:()=>E(d),className:"px-3 py-1.5 bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-400/30 rounded-lg text-emerald-300 text-sm font-medium transition-all hover:scale-105",children:"View"})})]},d.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-8 text-center text-white/50",children:"No incoming order requests yet"})})})]})})},"incomingRequests"),g==="orders"&&e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-white/80",children:"Order ID"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-white/80",children:"Items"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-white/80",children:"Distributor"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-white/80",children:"Total Amount"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-white/80",children:"Payment"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-white/80",children:"Priority"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-white/80",children:"Status"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-white/80",children:"Assigned Date"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-white/80",children:"Actions"})]})}),e.jsx("tbody",{children:T.length>0?T.map(d=>{const ae=d.items||[],re=ae.length,O=d.grandTotal||d.itemsSubTotal||0,_=k=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(k||0)),m=d.statusCode||d.status||"ASSIGNED";return e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition",children:[e.jsxs("td",{className:"p-3 text-sm font-mono",children:["#",d.id.slice(0,8)]}),e.jsx("td",{className:"p-3 text-sm",children:re>0?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("span",{className:"font-medium",children:[re," item(s)"]}),e.jsxs("div",{className:"text-xs text-white/60",children:[ae.slice(0,2).map((k,V)=>e.jsxs("div",{children:[k.productName," (×",k.quantity,")"]},V)),re>2&&e.jsxs("div",{children:["+",re-2," more..."]})]})]}):e.jsx("span",{className:"text-white/50",children:"No items"})}),e.jsx("td",{className:"p-3 text-sm",children:d.distributorName||"N/A"}),e.jsx("td",{className:"p-3 text-sm font-semibold",children:_(O)}),e.jsxs("td",{className:"p-3 text-sm",children:[e.jsx("span",{className:"text-white/70",children:d.paymentModeLabel||d.paymentMode||"COD"}),d.creditDays&&e.jsxs("div",{className:"text-xs text-white/50",children:[d.creditDays," days"]})]}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${d.priority==="urgent"?"bg-red-500/20 text-red-300":d.priority==="high"?"bg-orange-500/20 text-orange-300":d.priority==="low"?"bg-gray-500/20 text-gray-300":"bg-blue-500/20 text-blue-300"}`,children:d.priority||"normal"})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${ee(m)}`,children:m})}),e.jsx("td",{className:"p-3 text-sm text-white/70",children:d.createdAt?.toDate?d.createdAt.toDate().toLocaleDateString():d.timestamp?.toDate?d.timestamp.toDate().toLocaleDateString():d.createdAt?new Date(d.createdAt).toLocaleDateString():"N/A"}),e.jsx("td",{className:"p-3",children:e.jsx("button",{onClick:()=>E(d),className:"px-3 py-1.5 bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-400/30 rounded-lg text-emerald-300 text-sm font-medium transition-all hover:scale-105",children:"View Details"})})]},d.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-8 text-center text-white/50",children:"No orders assigned yet. Assign an order to a distributor to get started."})})})]})})},"orders"),g==="tracking"&&e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:T.map(d=>e.jsxs(y.div,{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-semibold",children:["Order #",d.id.slice(0,8)]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${ee(d.status)}`,children:d.status})]}),e.jsxs("div",{className:"space-y-2 text-sm text-white/70",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Product:"})," ",d.productName]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Distributor:"})," ",d.distributorName]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Quantity:"})," ",d.quantity]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-white/10",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/50",children:[e.jsx(Je,{})," ",d.assignedAt?new Date(d.assignedAt).toLocaleString():"N/A"]})})]},d.id))})},"tracking")]}),e.jsx(De,{children:me&&B&&e.jsx(Qt,{order:B,isDistributorOrderRequest:g==="incomingRequests",onClose:()=>{G(!1),xe(null)},onUpdate:P})})]})},Bt=[{id:"MH",name:"Maharashtra",code:"MH"},{id:"GJ",name:"Gujarat",code:"GJ"},{id:"KA",name:"Karnataka",code:"KA"},{id:"TN",name:"Tamil Nadu",code:"TN"},{id:"UP",name:"Uttar Pradesh",code:"UP"},{id:"MP",name:"Madhya Pradesh",code:"MP"},{id:"RJ",name:"Rajasthan",code:"RJ"},{id:"WB",name:"West Bengal",code:"WB"},{id:"BR",name:"Bihar",code:"BR"},{id:"AP",name:"Andhra Pradesh",code:"AP"},{id:"TG",name:"Telangana",code:"TG"},{id:"OR",name:"Odisha",code:"OR"},{id:"KL",name:"Kerala",code:"KL"},{id:"JH",name:"Jharkhand",code:"JH"},{id:"AS",name:"Assam",code:"AS"},{id:"PB",name:"Punjab",code:"PB"},{id:"HR",name:"Haryana",code:"HR"},{id:"DL",name:"Delhi",code:"DL"},{id:"JK",name:"Jammu and Kashmir",code:"JK"},{id:"UT",name:"Uttarakhand",code:"UT"},{id:"HP",name:"Himachal Pradesh",code:"HP"},{id:"TR",name:"Tripura",code:"TR"},{id:"MN",name:"Manipur",code:"MN"},{id:"ML",name:"Meghalaya",code:"ML"},{id:"NL",name:"Nagaland",code:"NL"},{id:"MZ",name:"Mizoram",code:"MZ"},{id:"AR",name:"Arunachal Pradesh",code:"AR"},{id:"SK",name:"Sikkim",code:"SK"},{id:"GA",name:"Goa",code:"GA"},{id:"CH",name:"Chhattisgarh",code:"CH"}],Xt={MH:[{id:"MUM",name:"Mumbai",state:"Maharashtra"},{id:"PUN",name:"Pune",state:"Maharashtra"},{id:"NAS",name:"Nashik",state:"Maharashtra"},{id:"NAG",name:"Nagpur",state:"Maharashtra"},{id:"AUR",name:"Aurangabad",state:"Maharashtra"},{id:"THA",name:"Thane",state:"Maharashtra"},{id:"SOL",name:"Solapur",state:"Maharashtra"},{id:"KOL",name:"Kolhapur",state:"Maharashtra"},{id:"SAG",name:"Sangli",state:"Maharashtra"},{id:"AHM",name:"Ahmednagar",state:"Maharashtra"},{id:"JAL",name:"Jalgaon",state:"Maharashtra"},{id:"DHU",name:"Dhule",state:"Maharashtra"},{id:"NAN",name:"Nanded",state:"Maharashtra"},{id:"LAT",name:"Latur",state:"Maharashtra"},{id:"OSM",name:"Osmanabad",state:"Maharashtra"},{id:"BEED",name:"Beed",state:"Maharashtra"},{id:"PAR",name:"Parbhani",state:"Maharashtra"},{id:"HIN",name:"Hingoli",state:"Maharashtra"},{id:"WAS",name:"Washim",state:"Maharashtra"},{id:"BUL",name:"Buldhana",state:"Maharashtra"},{id:"AKO",name:"Akola",state:"Maharashtra"},{id:"AMR",name:"Amravati",state:"Maharashtra"},{id:"YAV",name:"Yavatmal",state:"Maharashtra"},{id:"WAR",name:"Wardha",state:"Maharashtra"},{id:"CHAN",name:"Chandrapur",state:"Maharashtra"},{id:"GAD",name:"Gadchiroli",state:"Maharashtra"},{id:"GON",name:"Gondia",state:"Maharashtra"},{id:"BHAN",name:"Bhandara",state:"Maharashtra"},{id:"RAI",name:"Raigad",state:"Maharashtra"},{id:"RAT",name:"Ratnagiri",state:"Maharashtra"},{id:"SIN",name:"Sindhudurg",state:"Maharashtra"},{id:"SAT",name:"Satara",state:"Maharashtra"},{id:"SAN",name:"Sangli",state:"Maharashtra"}],GJ:[{id:"AHM_GJ",name:"Ahmedabad",state:"Gujarat"},{id:"SUR",name:"Surat",state:"Gujarat"},{id:"VAD",name:"Vadodara",state:"Gujarat"},{id:"RAJ",name:"Rajkot",state:"Gujarat"},{id:"BHA",name:"Bhavnagar",state:"Gujarat"},{id:"JAM",name:"Jamnagar",state:"Gujarat"},{id:"GAND",name:"Gandhinagar",state:"Gujarat"},{id:"ANAND",name:"Anand",state:"Gujarat"},{id:"KACH",name:"Kachchh",state:"Gujarat"},{id:"BAN",name:"Banaskantha",state:"Gujarat"},{id:"PAT",name:"Patan",state:"Gujarat"},{id:"MEH",name:"Mehsana",state:"Gujarat"},{id:"SAB",name:"Sabarkantha",state:"Gujarat"},{id:"ARA",name:"Aravalli",state:"Gujarat"},{id:"MAH",name:"Mahisagar",state:"Gujarat"},{id:"PAN",name:"Panchmahal",state:"Gujarat"},{id:"DAH",name:"Dahod",state:"Gujarat"},{id:"VALS",name:"Valsad",state:"Gujarat"},{id:"NAVS",name:"Navsari",state:"Gujarat"},{id:"DAN",name:"Dang",state:"Gujarat"},{id:"TAP",name:"Tapi",state:"Gujarat"},{id:"NAR",name:"Narmada",state:"Gujarat"},{id:"CHH",name:"Chhota Udaipur",state:"Gujarat"},{id:"BOT",name:"Botad",state:"Gujarat"},{id:"AMR_GJ",name:"Amreli",state:"Gujarat"},{id:"JUN",name:"Junagadh",state:"Gujarat"},{id:"GIR",name:"Gir Somnath",state:"Gujarat"},{id:"POR",name:"Porbandar",state:"Gujarat"},{id:"DEV",name:"Devbhumi Dwarka",state:"Gujarat"},{id:"MOR",name:"Morbi",state:"Gujarat"},{id:"SURE",name:"Surendranagar",state:"Gujarat"}],MP:[{id:"IND",name:"Indore",state:"Madhya Pradesh"},{id:"BHO",name:"Bhopal",state:"Madhya Pradesh"},{id:"JAB",name:"Jabalpur",state:"Madhya Pradesh"},{id:"GWAL",name:"Gwalior",state:"Madhya Pradesh"},{id:"UJJ",name:"Ujjain",state:"Madhya Pradesh"},{id:"SAG_MP",name:"Sagar",state:"Madhya Pradesh"},{id:"RAT_MP",name:"Ratlam",state:"Madhya Pradesh"},{id:"REW",name:"Rewa",state:"Madhya Pradesh"},{id:"SAT_MP",name:"Satna",state:"Madhya Pradesh"},{id:"SID",name:"Sidhi",state:"Madhya Pradesh"},{id:"SIN_MP",name:"Singrauli",state:"Madhya Pradesh"},{id:"SHA",name:"Shahdol",state:"Madhya Pradesh"},{id:"ANU",name:"Anuppur",state:"Madhya Pradesh"},{id:"UMR",name:"Umaria",state:"Madhya Pradesh"},{id:"KAT",name:"Katni",state:"Madhya Pradesh"},{id:"DAM",name:"Damoh",state:"Madhya Pradesh"},{id:"PAN_MP",name:"Panna",state:"Madhya Pradesh"},{id:"CHH_MP",name:"Chhatarpur",state:"Madhya Pradesh"},{id:"TIK",name:"Tikamgarh",state:"Madhya Pradesh"},{id:"NIW",name:"Niwari",state:"Madhya Pradesh"},{id:"DAT",name:"Datia",state:"Madhya Pradesh"},{id:"SHE",name:"Sheopur",state:"Madhya Pradesh"},{id:"MOR_MP",name:"Morena",state:"Madhya Pradesh"},{id:"BHI",name:"Bhind",state:"Madhya Pradesh"},{id:"ASH",name:"Ashoknagar",state:"Madhya Pradesh"},{id:"SHI",name:"Shivpuri",state:"Madhya Pradesh"},{id:"GUN",name:"Guna",state:"Madhya Pradesh"},{id:"RAJ_MP",name:"Rajgarh",state:"Madhya Pradesh"},{id:"VID",name:"Vidisha",state:"Madhya Pradesh"},{id:"SEH",name:"Sehore",state:"Madhya Pradesh"},{id:"RAI_MP",name:"Raisen",state:"Madhya Pradesh"},{id:"HOS",name:"Hoshangabad",state:"Madhya Pradesh"},{id:"HAR",name:"Harda",state:"Madhya Pradesh"},{id:"BET",name:"Betul",state:"Madhya Pradesh"},{id:"BUR",name:"Burhanpur",state:"Madhya Pradesh"},{id:"KHA",name:"Khandwa",state:"Madhya Pradesh"},{id:"KHA_MP",name:"Khargone",state:"Madhya Pradesh"},{id:"BAR",name:"Barwani",state:"Madhya Pradesh"},{id:"ALI",name:"Alirajpur",state:"Madhya Pradesh"},{id:"JHA",name:"Jhabua",state:"Madhya Pradesh"},{id:"DHAR",name:"Dhar",state:"Madhya Pradesh"},{id:"IND_MP",name:"Indore",state:"Madhya Pradesh"},{id:"DEW",name:"Dewas",state:"Madhya Pradesh"},{id:"SHA_MP",name:"Shajapur",state:"Madhya Pradesh"},{id:"MAN",name:"Mandsaur",state:"Madhya Pradesh"},{id:"NEE",name:"Neemuch",state:"Madhya Pradesh"},{id:"MAL",name:"Mandsaur",state:"Madhya Pradesh"}],KA:[{id:"BAN_KA",name:"Bangalore Urban",state:"Karnataka"},{id:"MYS",name:"Mysore",state:"Karnataka"},{id:"HUB",name:"Hubli",state:"Karnataka"},{id:"MAN_KA",name:"Mangalore",state:"Karnataka"},{id:"BEL",name:"Belagavi",state:"Karnataka"},{id:"GUL",name:"Gulbarga",state:"Karnataka"},{id:"DAV",name:"Davangere",state:"Karnataka"},{id:"SHI_KA",name:"Shimoga",state:"Karnataka"},{id:"TUM",name:"Tumkur",state:"Karnataka"},{id:"RAI_KA",name:"Raichur",state:"Karnataka"},{id:"BID",name:"Bidar",state:"Karnataka"},{id:"KOP",name:"Koppal",state:"Karnataka"},{id:"GAD_KA",name:"Gadag",state:"Karnataka"},{id:"BAG",name:"Bagalkot",state:"Karnataka"},{id:"BIJ",name:"Bijapur",state:"Karnataka"},{id:"KAL",name:"Kalaburagi",state:"Karnataka"},{id:"YAD",name:"Yadgir",state:"Karnataka"},{id:"BEL_KA",name:"Bellary",state:"Karnataka"},{id:"KOP_KA",name:"Koppal",state:"Karnataka"},{id:"RAI_KA2",name:"Raichur",state:"Karnataka"},{id:"CHI",name:"Chitradurga",state:"Karnataka"},{id:"DAV_KA",name:"Davangere",state:"Karnataka"},{id:"CHI_KA",name:"Chikkamagaluru",state:"Karnataka"},{id:"UDU",name:"Udupi",state:"Karnataka"},{id:"DKS",name:"Dakshina Kannada",state:"Karnataka"},{id:"UTT",name:"Uttara Kannada",state:"Karnataka"},{id:"HAS",name:"Hassan",state:"Karnataka"},{id:"CHAM",name:"Chamarajanagar",state:"Karnataka"},{id:"MAN_KA2",name:"Mandya",state:"Karnataka"},{id:"MYS_KA",name:"Mysore",state:"Karnataka"},{id:"KOD",name:"Kodagu",state:"Karnataka"}]},Zt=b=>!b||b.length===0?[]:b.flatMap(T=>Xt[T]||[]),Gs=b=>{if(!b)return Bt;const T=b.toLowerCase();return Bt.filter(L=>L.name.toLowerCase().includes(T)||L.code.toLowerCase().includes(T))},Ks=(b,T=[])=>{const L=T.length>0?Zt(T):Object.values(Xt).flat();if(!b)return L;const q=b.toLowerCase();return L.filter(g=>g.name.toLowerCase().includes(q)||g.state.toLowerCase().includes(q))},Hs=({onAreaSelect:b,map:T,isLoaded:L,googleMapsApiKey:q})=>{const[g,ce]=i.useState(1),[B,xe]=i.useState([]),[me,G]=i.useState([]),[ee,te]=i.useState([]),[E,P]=i.useState([]),[d,ae]=i.useState(""),[re,O]=i.useState(!1),[_,m]=i.useState([]),k=i.useRef(null),V=i.useRef(null);i.useEffect(()=>{L&&window.google?.maps&&T&&(V.current=new window.google.maps.Geocoder,window.google.maps.Data&&(k.current=new window.google.maps.Data,k.current.setMap(T)))},[L,T]);const we=i.useCallback(async(o,M)=>!T||!V.current?null:new Promise(C=>{try{const F=V.current,ne=`${o}, India`;F.geocode({address:ne},(ve,Fe)=>{if(Fe==="OK"&&ve[0]){const Le=ve[0],S=Le.geometry.viewport||Le.geometry.bounds;if(S){const a=S.getNorthEast(),h=S.getSouthWest(),t=a.lat()-h.lat(),l=a.lng()-h.lng(),x=[],v=50;for(let J=0;J<=v;J++){const w=J/v,X=h.lng()+l*w,A=Math.sin(w*Math.PI)*(t*.05);x.push({lat:h.lat()+A,lng:X})}for(let J=1;J<=v;J++){const w=J/v,X=h.lat()+t*w,A=Math.sin(w*Math.PI)*(l*.05);x.push({lat:X,lng:a.lng()-A})}for(let J=v-1;J>=0;J--){const w=J/v,X=h.lng()+l*w,A=Math.sin(w*Math.PI)*(t*.05);x.push({lat:a.lat()-A,lng:X})}for(let J=v-1;J>0;J--){const w=J/v,X=h.lat()+t*w,A=Math.sin(w*Math.PI)*(l*.05);x.push({lat:X,lng:h.lng()+A})}x.length>0&&x.push(x[0]),C({coordinates:x,bounds:{northeast:{lat:a.lat(),lng:a.lng()},southwest:{lat:h.lat(),lng:h.lng()}}})}else C(null)}else console.warn("Geocoding failed for:",ne,Fe),C(null)})}catch(F){console.error("Error getting boundaries:",F),C(null)}}),[T]),Ce=i.useCallback(o=>{if(!o||o.length<3)return null;const M=[...o],C=M[0],F=M[M.length-1],ne=1e-4;return Math.abs(C.lat-F.lat)<ne&&Math.abs(C.lng-F.lng)<ne||M.push({lat:C.lat,lng:C.lng}),M},[]),pe=i.useCallback(async o=>{O(!0);try{if(B.some(ne=>ne.id===o.id)){p.info("State already selected"),O(!1);return}const C=await we(o.name,"ADMINISTRATIVE_AREA_LEVEL_1"),F={id:o.id,name:o.name,code:o.code,level:"state",state:o.name,location:C?.bounds?{lat:(C.bounds.southwest.lat+C.bounds.northeast.lat)/2,lng:(C.bounds.southwest.lng+C.bounds.northeast.lng)/2}:null,bounds:C?.bounds||null,coordinates:C?.coordinates?Ce(C.coordinates):null};if(xe([...B,F]),p.success(`${o.name} added`),T&&F.bounds)try{const ne=new window.google.maps.LatLngBounds(new window.google.maps.LatLng(F.bounds.southwest.lat,F.bounds.southwest.lng),new window.google.maps.LatLng(F.bounds.northeast.lat,F.bounds.northeast.lng));T.fitBounds(ne)}catch(ne){console.warn("Error fitting bounds:",ne)}}catch(M){console.error("Error selecting state:",M),p.error("Failed to add state")}finally{O(!1)}},[B,we,Ce,T]),oe=i.useCallback(async o=>{O(!0);try{if(me.some(ne=>ne.id===o.id)){p.info("District already selected"),O(!1);return}const C=await we(`${o.name}, ${o.state}`,"ADMINISTRATIVE_AREA_LEVEL_2"),F={id:o.id,name:o.name,level:"district",state:o.state,district:o.name,location:C?.bounds?{lat:(C.bounds.southwest.lat+C.bounds.northeast.lat)/2,lng:(C.bounds.southwest.lng+C.bounds.northeast.lng)/2}:null,bounds:C?.bounds||null,coordinates:C?.coordinates?Ce(C.coordinates):null};if(G([...me,F]),p.success(`${o.name} added`),T&&F.bounds)try{const ne=new window.google.maps.LatLngBounds(new window.google.maps.LatLng(F.bounds.southwest.lat,F.bounds.southwest.lng),new window.google.maps.LatLng(F.bounds.northeast.lat,F.bounds.northeast.lng));T.fitBounds(ne)}catch(ne){console.warn("Error fitting bounds:",ne)}}catch(M){console.error("Error selecting district:",M),p.error("Failed to add district")}finally{O(!1)}},[me,we,Ce,T]),u=i.useCallback(()=>{if(!d.trim()){m([]);return}if(g===1){const o=Gs(d);m(o)}else if(g===2){const o=B.map(C=>C.code||C.id),M=Ks(d,o);m(M)}else m([])},[d,g,B]);i.useEffect(()=>{const o=setTimeout(()=>{u()},300);return()=>clearTimeout(o)},[d,u]);const f=i.useCallback((o,M)=>{if(o==="state"){const C=B.filter((ne,ve)=>ve!==M);xe(C);const F=B[M];F&&G(me.filter(ne=>ne.state!==F.name))}else o==="district"&&G(me.filter((C,F)=>F!==M))},[B,me]);i.useEffect(()=>{const o=[...B.map(M=>({...M,level:"state"})),...me.map(M=>({...M,level:"district"})),...ee.map(M=>({...M,level:"taluka"})),...E.map(M=>({...M,level:"village"}))];b&&b(null,o)},[B,me,ee,E,b]);const W=()=>{switch(g){case 1:return"Select States";case 2:return"Select Districts";case 3:return"Select Talukas";case 4:return"Select Villages";default:return""}},K=()=>{switch(g){case 1:return B;case 2:return me;case 3:return ee;case 4:return E;default:return[]}},r=(o,M)=>{switch(M){case"state":return o.name||o.state;case"district":return`${o.name||o.district}${o.state?`, ${o.state}`:""}`;case"taluka":return`${o.name||o.taluka}${o.district?`, ${o.district}`:""}`;case"village":return`${o.name||o.village}${o.taluka?`, ${o.taluka}`:""}`;default:return o.name||"Unknown"}};if(!L)return e.jsxs("div",{className:"text-center py-8 text-white/50",children:[e.jsx(at,{className:"animate-spin mx-auto mb-2 text-2xl"}),e.jsx("p",{children:"Loading map services..."})]});const N=K(),Q=["State","District","Taluka","Village"],ie=g===2&&B.length>0?Zt(B.map(o=>o.code||o.id)):[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Hierarchical Territory Selection"}),e.jsx("p",{className:"text-sm text-white/60 mt-1",children:"Follow the steps to select areas hierarchically. You can select multiple at each level."})]}),e.jsx("div",{className:"flex items-center gap-2 bg-white/5 rounded-lg p-3 border border-white/10",children:[1,2,3,4].map(o=>e.jsxs(wt.Fragment,{children:[e.jsxs("button",{onClick:()=>{if(o===2&&B.length===0){p.warning("Please select at least one state first");return}if(o===3&&me.length===0){p.warning("Please select at least one district first");return}if(o===4&&ee.length===0){p.warning("Please select at least one taluka first");return}ce(o),ae(""),m([])},className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition ${g===o?"bg-emerald-500 text-white":o<g?"bg-emerald-500/30 text-emerald-300":"bg-white/10 text-white/50"}`,children:[o,". ",Q[o-1]]}),o<4&&e.jsx(cs,{className:"text-white/30 text-xs"})]},o))}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Current Step:"}),e.jsx("span",{className:"text-sm font-semibold text-emerald-400",children:W()})]}),g===2&&B.length>0&&e.jsxs("div",{className:"text-xs text-white/60 mt-2",children:["Showing districts from: ",B.map(o=>o.name).join(", "),ie.length>0&&` (${ie.length} available)`]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-white/70 mb-2",children:["Search and Add ",Q[g-1]]}),e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-white/50 z-10"}),e.jsx("input",{type:"text",placeholder:`Type ${Q[g-1].toLowerCase()} name...`,value:d,onChange:o=>ae(o.target.value),className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 disabled:opacity-50",disabled:re}),re&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(at,{className:"animate-spin text-emerald-400"})})]}),d&&_.length>0&&e.jsx("div",{className:"mt-2 max-h-48 overflow-y-auto bg-white/5 rounded-lg border border-white/10",children:_.map((o,M)=>e.jsx("button",{onClick:()=>{g===1?pe(o):g===2&&oe(o),ae(""),m([])},className:"w-full text-left px-4 py-2 hover:bg-white/10 transition text-white text-sm",children:g===1?o.name:`${o.name}, ${o.state}`},o.id||M))})]}),N.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-semibold text-white",children:["Selected ",Q[g-1],"s (",N.length,")"]}),N.length>0&&e.jsx("button",{onClick:()=>{g===1?xe([]):g===2?G([]):g===3?te([]):g===4&&P([])},className:"text-xs text-red-400 hover:text-red-300 transition",children:"Clear All"})]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:N.map((o,M)=>e.jsxs(y.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(yt,{className:"text-emerald-400 text-xs"}),o.coordinates&&o.coordinates.length>=3&&e.jsx("span",{className:"text-xs text-blue-400",children:"✓ Real Boundary"})]}),e.jsx("div",{className:"text-sm font-medium text-white",children:r(o,g===1?"state":g===2?"district":g===3?"taluka":"village")})]}),e.jsx("button",{onClick:()=>f(g===1?"state":g===2?"district":g===3?"taluka":"village",M),className:"ml-3 p-2 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded transition",title:"Remove",children:e.jsx(Ge,{})})]},`${o.id||o.name}-${M}`))})]}),(B.length>0||me.length>0||ee.length>0||E.length>0)&&e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-300 mb-2",children:"Selection Summary"}),e.jsxs("div",{className:"text-xs text-blue-200 space-y-1",children:[B.length>0&&e.jsxs("div",{children:["States: ",B.length]}),me.length>0&&e.jsxs("div",{children:["Districts: ",me.length]}),ee.length>0&&e.jsxs("div",{children:["Talukas: ",ee.length]}),E.length>0&&e.jsxs("div",{children:["Villages: ",E.length]}),e.jsx("div",{className:"mt-2 pt-2 border-t border-blue-500/30",children:e.jsxs("strong",{children:["Total Areas: ",B.length+me.length+ee.length+E.length]})})]})]}),N.length===0&&e.jsxs("div",{className:"text-center py-8 text-white/40 text-sm",children:[e.jsx(rt,{className:"mx-auto mb-2 text-2xl opacity-50"}),e.jsxs("p",{children:["No ",Q[g-1].toLowerCase(),"s selected yet"]}),e.jsxs("p",{className:"text-xs mt-1",children:["Search and add ",Q[g-1].toLowerCase(),"s above"]})]})]})},zs={width:"100%",height:"600px"},qt=b=>{const T=b.map(g=>g.location?.latitude&&g.location?.longitude?{lat:parseFloat(g.location.latitude),lng:parseFloat(g.location.longitude)}:null).filter(Boolean);if(T.length===0)return{lat:20.5937,lng:78.9629};const L=T.reduce((g,ce)=>g+ce.lat,0)/T.length,q=T.reduce((g,ce)=>g+ce.lng,0)/T.length;return{lat:L,lng:q}},_s=["drawing","places"],Vs=({distributors:b})=>{const T="AIzaSyBPkkXZWll0VifG5kb0DDSsoV5UB-n5pFE",{isLoaded:L,loadError:q}=Ts({id:"google-map-script",googleMapsApiKey:T,libraries:_s}),[g,ce]=i.useState(null),[B,xe]=i.useState([]),[me,G]=i.useState(null),[ee,te]=i.useState(null),[E,P]=i.useState(!1),[d,ae]=i.useState(null),[re,O]=i.useState([]),[_,m]=i.useState(!1),[k,V]=i.useState({name:"",assignedDistributorId:"",description:"",color:"#10b981"}),[we,Ce]=i.useState(null),pe=i.useRef({}),[oe,u]=i.useState([]),[f,W]=i.useState("draw"),[K,r]=i.useState(!1),N=i.useRef(null),[Q,ie]=i.useState(null),[o,M]=i.useState(null),[C,F]=i.useState("view"),[ne,ve]=i.useState(null),[Fe,Le]=i.useState([]),[S,a]=i.useState(-1),h=Y.currentUser?.uid;i.useEffect(()=>{if(!h)return;const n=Pe(U,`businesses/${h}/territories`),j=Ye(n,I=>{const H=I.docs.map(se=>({id:se.id,...se.data()}));xe(H)},I=>{console.error("Error fetching territories:",I),I.code==="permission-denied"?(p.error("Permission denied. Please check Firestore rules are deployed."),console.error("Firestore rules need to be deployed. Run: firebase deploy --only firestore:rules")):p.error("Failed to load territories: "+(I.message||"Unknown error"))});return()=>j()},[h]),i.useEffect(()=>{if(!g||!E||!L||!window.google?.maps?.drawing)return;const n=new window.google.maps.drawing.DrawingManager({drawingMode:window.google.maps.drawing.OverlayType.POLYGON,drawingControl:!1,polygonOptions:{fillColor:"#10b981",fillOpacity:.3,strokeColor:"#10b981",strokeWeight:2,clickable:!0,editable:!0,zIndex:1}});n.setMap(g);const j=I=>{const se=I.getPath().getArray().map(Z=>({lat:Z.lat(),lng:Z.lng()}));O(se),P(!1),n.setDrawingMode(null),m(!0),pe.current[`temp-${Date.now()}`]=I};return window.google.maps.event.addListener(n,"polygoncomplete",j),ae(n),()=>{n&&(window.google.maps.event.clearInstanceListeners(n),n.setMap(null))}},[g,E,L]);const t=i.useCallback(n=>{ce(n),window.google?.maps?.Geocoder&&(N.current=new window.google.maps.Geocoder)},[]),l=()=>{P(!0),O([]),m(!1)},x=()=>{P(!1),O([]),d&&d.setDrawingMode(null),Object.values(pe.current).forEach(n=>{n&&typeof n.setMap=="function"&&n.setMap(null)}),pe.current={}},v=i.useCallback(n=>{if(!n||n.length<3)return n;const j=n.map(Ae=>({lat:Number(Ae.lat),lng:Number(Ae.lng)})),I=j[0],H=j[j.length-1],se=1e-4;return Math.abs(I.lat-H.lat)<se&&Math.abs(I.lng-H.lng)<se||j.push({lat:I.lat,lng:I.lng}),j},[]),J=async()=>{if(!k.name.trim()){p.error("Please enter a territory name");return}if(re.length<3){p.error("Territory must have at least 3 points");return}if(!h){p.error("User not authenticated");return}try{const j=v(re).map(Z=>({lat:Number(Z.lat),lng:Number(Z.lng)})).filter(Z=>!isNaN(Z.lat)&&!isNaN(Z.lng));if(j.length<3){p.error("Invalid coordinates. Please redraw the territory.");return}const I={name:k.name,description:k.description||"",assignedDistributorId:k.assignedDistributorId||null,assignedDistributorName:b.find(Z=>Z.distributorId===k.assignedDistributorId)?.businessName||null,coordinates:j,color:k.color,createdAt:je(),createdBy:h,updatedAt:je()},H=Pe(U,`businesses/${h}/territories`),se=await pt(H,I);if(k.assignedDistributorId){const Z=de(U,`businesses/${h}/connectedDistributors/${k.assignedDistributorId}`);await qe(Z,{territory:k.name,territoryId:se.id,territoryCoordinates:re,updatedAt:je()})}p.success("Territory saved successfully!"),O([]),m(!1),P(!1),V({name:"",assignedDistributorId:"",description:"",color:"#10b981"}),Object.values(pe.current).forEach(Z=>{Z&&typeof Z.setMap=="function"&&Z.setMap(null)}),pe.current={}}catch(n){console.error("Error saving territory:",n),n.code==="permission-denied"?p.error("Permission denied. Please check Firestore rules are deployed."):p.error("Failed to save territory: "+(n.message||"Unknown error"))}},w=async n=>{if(window.confirm("Are you sure you want to delete this territory?"))try{const j=de(U,`businesses/${h}/territories/${n}`);await _t(j);const I=B.find(H=>H.id===n);if(I?.assignedDistributorId){const H=de(U,`businesses/${h}/connectedDistributors/${I.assignedDistributorId}`);await qe(H,{territory:null,territoryId:null,territoryCoordinates:null,updatedAt:je()})}p.success("Territory deleted successfully!")}catch(j){console.error("Error deleting territory:",j),j.code==="permission-denied"?p.error("Permission denied. Please check Firestore rules are deployed."):p.error("Failed to delete territory: "+(j.message||"Unknown error"))}},X=i.useCallback((n,j)=>{u(j)},[]),A=i.useCallback(n=>{if(!n||n.length<3)return null;const j=n.map(Ae=>({lat:Number(Ae.lat),lng:Number(Ae.lng)})),I=j[0],H=j[j.length-1],se=1e-4;return Math.abs(I.lat-H.lat)<se&&Math.abs(I.lng-H.lng)<se||j.push({lat:I.lat,lng:I.lng}),j},[]),ye=i.useCallback(n=>{if(!n||n.length===0)return null;const j=[];let I=1/0,H=-1/0,se=1/0,Z=-1/0;if(n.forEach(Se=>{let Ne=[];if(Se.coordinates&&Array.isArray(Se.coordinates)&&Se.coordinates.length>=3)Ne=Se.coordinates.map(ge=>({lat:Number(ge.lat),lng:Number(ge.lng)})).filter(ge=>!isNaN(ge.lat)&&!isNaN(ge.lng)),Ne.length>=3&&(j.push(Ne),Ne.forEach(ge=>{I=Math.min(I,ge.lat),H=Math.max(H,ge.lat),se=Math.min(se,ge.lng),Z=Math.max(Z,ge.lng)}));else if(Se.bounds){const ge=Se.bounds.southwest,Oe=Se.bounds.northeast;Ne=[{lat:Number(ge.lat),lng:Number(ge.lng)},{lat:Number(Oe.lat),lng:Number(ge.lng)},{lat:Number(Oe.lat),lng:Number(Oe.lng)},{lat:Number(ge.lat),lng:Number(Oe.lng)}],j.push(Ne),I=Math.min(I,Number(ge.lat)),H=Math.max(H,Number(Oe.lat)),se=Math.min(se,Number(ge.lng)),Z=Math.max(Z,Number(Oe.lng))}else Se.location&&(Ne=[{lat:Number(Se.location.lat)-.01,lng:Number(Se.location.lng)-.01},{lat:Number(Se.location.lat)+.01,lng:Number(Se.location.lng)-.01},{lat:Number(Se.location.lat)+.01,lng:Number(Se.location.lng)+.01},{lat:Number(Se.location.lat)-.01,lng:Number(Se.location.lng)+.01}],j.push(Ne))}),j.length===0)return null;let Ae=[];if(j.length===1)Ae=j[0];else{const Se=j.filter(Ne=>Ne.length>=3);if(Se.length>0){const Ne=Se.flat(),ge=[],Oe=1e-4;if(Ne.forEach(Ke=>{ge.some(Ze=>Math.abs(Ze.lat-Ke.lat)<Oe&&Math.abs(Ze.lng-Ke.lng)<Oe)||ge.push(Ke)}),ge.length>=3){const Ke=ge.reduce((He,z)=>He+z.lat,0)/ge.length,Xe=ge.reduce((He,z)=>He+z.lng,0)/ge.length;Ae=ge.sort((He,z)=>{const Ue=Math.atan2(He.lat-Ke,He.lng-Xe),ut=Math.atan2(z.lat-Ke,z.lng-Xe);return Ue-ut})}else Ae=[{lat:I,lng:se},{lat:H,lng:se},{lat:H,lng:Z},{lat:I,lng:Z},{lat:I,lng:se}]}else Ae=[{lat:I,lng:se},{lat:H,lng:se},{lat:H,lng:Z},{lat:I,lng:Z},{lat:I,lng:se}]}const Re={southwest:{lat:I,lng:se},northeast:{lat:H,lng:Z}};return{coordinates:A(Ae),bounds:Re}},[A]),Ee=async()=>{if(oe.length===0){p.error("Please select at least one area");return}if(!h){p.error("User not authenticated");return}try{const n=oe.filter(z=>z.level==="state"),j=oe.filter(z=>z.level==="district"),I=oe.filter(z=>z.level==="taluka"),H=oe.filter(z=>z.level==="village");let se="";n.length>0?(se=n.map(z=>z.state||z.name).join(", "),j.length>0&&(se+=` - ${j.length} District${j.length>1?"s":""}`),I.length>0&&(se+=` - ${I.length} Taluka${I.length>1?"s":""}`),H.length>0&&(se+=` - ${H.length} Village${H.length>1?"s":""}`)):j.length>0?se=j.map(z=>z.district||z.name).join(", "):I.length>0?se=I.map(z=>z.taluka||z.name).join(", "):H.length>0?se=H.map(z=>z.village||z.name).join(", "):se="Custom Territory";const Z=ye(oe);if(!Z||!Z.coordinates||Z.coordinates.length<3){p.error("Could not create valid boundary from selected areas. Please ensure areas have valid boundaries.");return}const Ae=[...new Set(oe.map(z=>z.state).filter(Boolean))],Re=[...new Set(oe.map(z=>z.district).filter(Boolean))],Se=[...new Set(oe.map(z=>z.taluka).filter(Boolean))],Ne=[...new Set(oe.map(z=>z.village).filter(Boolean))],ge=[];n.length>0&&ge.push(`${n.length} State${n.length>1?"s":""}`),j.length>0&&ge.push(`${j.length} District${j.length>1?"s":""}`),I.length>0&&ge.push(`${I.length} Taluka${I.length>1?"s":""}`),H.length>0&&ge.push(`${H.length} Village${H.length>1?"s":""}`);const Oe=`Territory covering: ${ge.join(", ")}`,Ke=(Z.bounds.southwest.lat+Z.bounds.northeast.lat)/2,Xe=(Z.bounds.southwest.lng+Z.bounds.northeast.lng)/2,Ze={name:se,description:Oe,assignedDistributorId:null,administrativeLevel:n.length>0?"state":j.length>0?"district":I.length>0?"taluka":"village",administrativeArea:{states:Ae.length>0?Ae:null,districts:Re.length>0?Re:null,talukas:Se.length>0?Se:null,villages:Ne.length>0?Ne:null},selectedAreas:oe.map(z=>{const Ue={level:z.level||null};return z.name&&(Ue.name=z.name),z.state&&(Ue.state=z.state),z.district&&(Ue.district=z.district),z.taluka&&(Ue.taluka=z.taluka),z.village&&(Ue.village=z.village),z.placeId&&(Ue.placeId=z.placeId),z.id&&(Ue.id=z.id),z.code&&(Ue.code=z.code),Ue}),location:{lat:Ke,lng:Xe},bounds:Z.bounds,coordinates:Z.coordinates,color:"#10b981",createdAt:je(),createdBy:h,updatedAt:je()},He=Pe(U,`businesses/${h}/territories`);await pt(He,Ze),p.success(`Successfully created territory: ${se}!`),u([]),r(!1)}catch(n){console.error("Error creating territory from areas:",n),n.code==="permission-denied"?p.error("Permission denied. Please check Firestore rules are deployed."):p.error("Failed to create territory: "+(n.message||"Unknown error"))}},We=async(n,j)=>{try{const I=de(U,`businesses/${h}/territories/${n}`),H=b.find(se=>se.distributorId===j);if(await qe(I,{assignedDistributorId:j||null,assignedDistributorName:H?.businessName||null,updatedAt:je()}),j){const se=de(U,`businesses/${h}/connectedDistributors/${j}`),Z=B.find(Ae=>Ae.id===n);await qe(se,{territory:Z?.name||null,territoryId:n,territoryCoordinates:Z?.coordinates||null,updatedAt:je()})}p.success("Territory assignment updated!")}catch(I){console.error("Error updating territory assignment:",I),I.code==="permission-denied"?p.error("Permission denied. Please check Firestore rules are deployed."):p.error("Failed to update territory assignment: "+(I.message||"Unknown error"))}},Be=n=>{const I=n.coordinates&&Array.isArray(n.coordinates)&&n.coordinates.length>=3?n.coordinates.filter(H=>H&&typeof H.lat=="number"&&typeof H.lng=="number"&&!isNaN(H.lat)&&!isNaN(H.lng)):[];return{fillColor:n.color||"#10b981",fillOpacity:.4,strokeColor:n.color||"#10b981",strokeOpacity:.9,strokeWeight:2,clickable:!0,draggable:!1,editable:!1,geodesic:!1,zIndex:1,visible:I.length>=3}},St=n=>{G(n),Ce(n.id)},Qe=i.useCallback((n,j)=>{pe.current[j]=n},[]),gt=n=>n.location?.latitude&&n.location?.longitude?{lat:parseFloat(n.location.latitude),lng:parseFloat(n.location.longitude)}:null,lt=n=>{if(!L||!window.google?.maps)return{url:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"};const I=(n.businessName||n.distributorName||"D").split(" ").map(Z=>Z[0]).join("").toUpperCase().substring(0,2),H=n.territoryId?"#10b981":"#3b82f6",se=`
      <svg width="40" height="50" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <filter id="shadow-${n.distributorId||n.id}" x="-50%" y="-50%" width="200%" height="200%">
            <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.3"/>
          </filter>
        </defs>
        <path d="M20 0 C30 0, 40 8, 40 18 C40 28, 30 36, 20 36 C10 36, 0 28, 0 18 C0 8, 10 0, 20 0 Z" 
              fill="${H}" 
              stroke="white" 
              stroke-width="2"
              filter="url(#shadow-${n.distributorId||n.id})"/>
        <text x="20" y="24" 
              font-family="Arial, sans-serif" 
              font-size="12" 
              font-weight="bold" 
              fill="white" 
              text-anchor="middle" 
              dominant-baseline="middle">${I}</text>
        <circle cx="20" cy="40" r="4" fill="${H}" stroke="white" stroke-width="1.5"/>
      </svg>
    `;return{url:`data:image/svg+xml;base64,${btoa(se)}`,scaledSize:new window.google.maps.Size(40,50),anchor:new window.google.maps.Point(20,50)}},mt=n=>{ve(n),ie(n.id),F("edit"),O(n.coordinates||[]),V({name:n.name,assignedDistributorId:n.assignedDistributorId||"",description:n.description||"",color:n.color||"#10b981"})},Ve=()=>{ie(null),ve(null),F("view"),O([]),P(!1)},ot=async()=>{if(!ne||re.length<3){p.error("Invalid territory or path");return}try{const j=v(re).map(H=>({lat:Number(H.lat),lng:Number(H.lng)})).filter(H=>!isNaN(H.lat)&&!isNaN(H.lng));if(j.length<3){p.error("Invalid coordinates");return}const I=de(U,`businesses/${h}/territories/${ne.id}`);await qe(I,{coordinates:j,updatedAt:je()}),p.success("Territory updated successfully!"),Ve()}catch(n){console.error("Error updating territory:",n),p.error("Failed to update territory")}};return e.jsxs("div",{className:"space-y-4 text-white",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-500/10 via-blue-500/10 to-purple-500/10 rounded-xl border border-white/10 p-6",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-500/20 rounded-lg",children:e.jsx(ms,{className:"text-emerald-400 text-2xl"})}),"Territory Management"]}),e.jsxs("p",{className:"text-white/70 text-sm mt-2 flex items-center gap-2",children:[e.jsx(Jt,{className:"text-blue-400"}),"Map, assign, and manage territories for your distributor network"]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex bg-white/10 rounded-lg p-1 border border-white/20 backdrop-blur-sm",children:[e.jsxs("button",{onClick:()=>{W("draw"),r(!1),P(!1),F("draw"),Ve()},className:`px-4 py-2 rounded-md text-sm font-medium transition-all flex items-center gap-2 ${f==="draw"?"bg-emerald-500 text-white shadow-lg shadow-emerald-500/30":"text-white/70 hover:text-white hover:bg-white/5"}`,children:[e.jsx(bt,{})," Draw Boundary"]}),e.jsxs("button",{onClick:()=>{W("search"),r(!0),P(!1),F("view"),Ve()},className:`px-4 py-2 rounded-md text-sm font-medium transition-all flex items-center gap-2 ${f==="search"?"bg-blue-500 text-white shadow-lg shadow-blue-500/30":"text-white/70 hover:text-white hover:bg-white/5"}`,children:[e.jsx(_e,{})," Search & Select"]})]}),f==="draw"&&!Q&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:l,disabled:E,className:"px-4 py-2 bg-emerald-500 hover:bg-emerald-600 disabled:bg-emerald-500/50 disabled:cursor-not-allowed rounded-lg flex items-center gap-2 transition shadow-lg shadow-emerald-500/30 font-medium",children:[e.jsx(bt,{})," ",E?"Drawing...":"Draw Territory"]}),E&&e.jsxs("button",{onClick:x,className:"px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg flex items-center gap-2 transition font-medium",children:[e.jsx(Ge,{})," Cancel"]})]}),Q&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:ot,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg flex items-center gap-2 transition shadow-lg shadow-blue-500/30 font-medium",children:[e.jsx(Nt,{})," Save Changes"]}),e.jsxs("button",{onClick:Ve,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 rounded-lg flex items-center gap-2 transition font-medium",children:[e.jsx(Ge,{})," Cancel Edit"]})]}),f==="search"&&oe.length>0&&e.jsxs("button",{onClick:Ee,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg flex items-center gap-2 transition",children:[e.jsx(st,{})," Create Territory (",oe.length," area",oe.length>1?"s":""," selected)"]})]})]})}),f==="search"&&e.jsx(y.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-white/5 rounded-xl border border-white/10 p-6",children:e.jsx(Hs,{onAreaSelect:X,map:g,isLoaded:L,googleMapsApiKey:T})}),e.jsx(De,{children:_&&re.length>0&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>m(!1),children:e.jsxs(y.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:n=>n.stopPropagation(),className:"bg-slate-900 rounded-xl border border-white/10 p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Save Territory"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Territory Name *"}),e.jsx("input",{type:"text",value:k.name,onChange:n=>V({...k,name:n.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"e.g., North Zone, Mumbai Region"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Assign to Distributor"}),e.jsxs("select",{value:k.assignedDistributorId,onChange:n=>V({...k,assignedDistributorId:n.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:[e.jsx("option",{value:"",children:"Select Distributor (Optional)"}),b.map(n=>e.jsx("option",{value:n.distributorId||n.id,children:n.businessName||n.distributorName||"Unnamed"},n.distributorId||n.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Description"}),e.jsx("textarea",{value:k.description,onChange:n=>V({...k,description:n.target.value}),rows:3,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"Optional description..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Color"}),e.jsx("input",{type:"color",value:k.color,onChange:n=>V({...k,color:n.target.value}),className:"w-full h-10 bg-white/10 border border-white/20 rounded-lg cursor-pointer"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>m(!1),className:"flex-1 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition",children:"Cancel"}),e.jsxs("button",{onClick:J,className:"flex-1 px-4 py-2 bg-emerald-500 hover:bg-emerald-600 rounded-lg transition flex items-center justify-center gap-2",children:[e.jsx(Nt,{})," Save Territory"]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"lg:col-span-2",children:q?e.jsx("div",{className:"h-[600px] bg-white/5 rounded-xl flex items-center justify-center text-red-400",children:"Error loading Google Maps. Please check your API key."}):L?e.jsxs(Ls,{mapContainerStyle:zs,center:qt(b),zoom:b.length>0?6:5,onLoad:t,options:{zoomControl:!0,streetViewControl:!1,mapTypeControl:!1,fullscreenControl:!0,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]},children:[B.map(n=>{if(!n.coordinates||!Array.isArray(n.coordinates)||n.coordinates.length<3)return null;const j=n.coordinates.map(Re=>{if(!Re)return null;const Se=typeof Re.lat=="function"?Re.lat():Re.lat,Ne=typeof Re.lng=="function"?Re.lng():Re.lng;return typeof Se!="number"||typeof Ne!="number"||isNaN(Se)||isNaN(Ne)?null:{lat:Number(Se),lng:Number(Ne)}}).filter(Boolean);if(j.length<3)return console.warn(`Territory ${n.id} has invalid coordinates, skipping render`),null;const I=j[0],H=j[j.length-1],se=1e-4,Ae=Math.abs(I.lat-H.lat)<se&&Math.abs(I.lng-H.lng)<se?j:[...j,{lat:I.lat,lng:I.lng}];return e.jsxs(wt.Fragment,{children:[e.jsx(Rs,{paths:Ae,options:Be(n),onLoad:Re=>Qe(Re,n.id),onClick:()=>St(n)}),we===n.id&&e.jsx($t,{position:Ae[0]||qt(b),onCloseClick:()=>Ce(null),children:e.jsxs("div",{className:"text-black p-2",children:[e.jsx("h4",{className:"font-bold mb-1",children:n.name}),n.assignedDistributorName&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Assigned to: ",n.assignedDistributorName]})]})})]},n.id)}),b.map(n=>{const j=gt(n);if(!j||!L)return null;const I=lt(n);return e.jsxs(wt.Fragment,{children:[e.jsx(Es,{position:j,title:n.businessName||n.distributorName,icon:I,onClick:()=>M(n.distributorId||n.id)}),o===(n.distributorId||n.id)&&e.jsx($t,{position:j,onCloseClick:()=>M(null),children:e.jsxs("div",{className:"text-black p-3 min-w-[200px]",children:[e.jsxs("h4",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx(dt,{className:"text-blue-500"}),n.businessName||n.distributorName]}),n.ownerName&&e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:[e.jsx(It,{className:"inline mr-1"}),n.ownerName]}),n.city&&e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:[e.jsx(rt,{className:"inline mr-1"}),n.city,n.state&&`, ${n.state}`]}),n.territory&&e.jsxs("p",{className:"text-sm text-emerald-600 mt-2 font-medium",children:[e.jsx(us,{className:"inline mr-1"}),"Territory: ",n.territory]}),n.phone&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["📞 ",n.phone]})]})})]},n.distributorId||n.id)})]}):e.jsx("div",{className:"h-[600px] bg-white/5 rounded-xl flex items-center justify-center",children:"Loading map..."})}),e.jsxs("div",{className:"space-y-3 bg-white/5 rounded-xl border border-white/10 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Yt,{className:"text-emerald-400"}),"Territories (",B.length,")"]}),B.length>0&&e.jsxs("div",{className:"text-xs text-white/50",children:[B.filter(n=>n.assignedDistributorId).length," assigned"]})]}),B.length===0?e.jsx("div",{className:"text-center py-8 text-white/50",children:'No territories created yet. Click "Draw Territory" to create one.'}):B.map(n=>e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`rounded-xl border p-4 transition-all ${Q===n.id?"border-blue-400 bg-blue-500/10 shadow-lg shadow-blue-500/20":"border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-4 h-4 rounded flex-shrink-0 shadow-sm",style:{backgroundColor:n.color||"#10b981"}}),e.jsx("span",{className:"truncate",children:n.name}),Q===n.id&&e.jsx("span",{className:"text-xs bg-blue-500/20 text-blue-300 px-2 py-0.5 rounded-full",children:"Editing"})]}),n.administrativeArea?.state&&e.jsxs("p",{className:"text-xs text-white/50 truncate mt-1 flex items-center gap-1",children:[e.jsx(rt,{className:"text-xs"}),[n.administrativeArea.state,n.administrativeArea.district,n.administrativeArea.taluka].filter(Boolean).join(" > ")]}),n.assignedDistributorName&&e.jsxs("p",{className:"text-sm text-emerald-300 mt-2 flex items-center gap-1 font-medium",children:[e.jsx(It,{className:"text-xs"}),n.assignedDistributorName]}),n.coordinates&&e.jsxs("p",{className:"text-xs text-white/40 mt-1 flex items-center gap-1",children:[e.jsx(hs,{className:"text-xs"}),n.coordinates.length," boundary points"]})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[Q!==n.id&&e.jsx("button",{onClick:()=>mt(n),className:"p-2 text-blue-400 hover:text-blue-300 hover:bg-blue-500/10 rounded transition flex-shrink-0",title:"Edit territory",children:e.jsx(ct,{className:"text-sm"})}),e.jsx("button",{onClick:()=>w(n.id),className:"p-2 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded transition flex-shrink-0",title:"Delete territory",children:e.jsx(nt,{className:"text-sm"})})]})]}),n.description&&e.jsx("p",{className:"text-sm text-white/60 mb-3 line-clamp-2",children:n.description}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:n.assignedDistributorId||"",onChange:j=>We(n.id,j.target.value),className:"w-full px-3 py-2 text-sm bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50 transition",children:[e.jsx("option",{value:"",children:"Assign to distributor..."}),b.map(j=>e.jsx("option",{value:j.distributorId||j.id,children:j.businessName||j.distributorName||"Unnamed"},j.distributorId||j.id))]}),Q===n.id&&e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:l,className:"flex-1 px-3 py-2 text-xs bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/30 rounded-lg text-blue-300 transition flex items-center justify-center gap-1",children:[e.jsx(bt,{})," Redraw Boundary"]})})]})]},n.id))]})]})]})},Js=()=>{const[b,T]=i.useState("connected"),[L,q]=i.useState([]),[g,ce]=i.useState(""),[B,xe]=i.useState(!1),[me,G]=i.useState(!1),[ee,te]=i.useState(!1),[E,P]=i.useState(null),[d,ae]=i.useState(!1),[re,O]=i.useState(null),[_,m]=i.useState([]),[k,V]=i.useState([]),[we,Ce]=i.useState(!0),[pe,oe]=i.useState(!1),[u,f]=i.useState([]),[W,K]=i.useState(""),[r,N]=i.useState(null),[Q,ie]=i.useState([]),[o,M]=i.useState(!1),[C,F]=i.useState(null),[ne,ve]=i.useState(!1),[Fe,Le]=i.useState(!1),[S,a]=i.useState(null),[h,t]=i.useState(!1),[l,x]=i.useState({}),[v,J]=i.useState([]);i.useEffect(()=>{(async()=>{const c=Y.currentUser?.uid;if(c)try{const D=de(U,"businesses",c),$=await Te(D);$.exists()&&N($.data())}catch(D){console.error("Error fetching user data:",D)}})()},[]);const[w,X]=i.useState({businessName:"",ownerName:"",email:"",phone:"",address:"",city:"",state:"",stateId:"",district:"",districtId:"",pincode:"",gstin:"",territory:"",location:{latitude:"",longitude:"",address:""}}),[A,ye]=i.useState({}),[Ee,We]=i.useState(!1),[Be,St]=i.useState(!1),[Qe,gt]=i.useState([]),[lt,mt]=i.useState([]),[Ve,ot]=i.useState({checking:!1,found:!1});i.useEffect(()=>{B&&(async()=>{try{const c=await Ft();gt(c)}catch(c){console.error("Error loading states:",c)}})()},[B]),i.useEffect(()=>{(async()=>{if(!w.stateId){mt([]);return}try{const c=await Os(w.stateId);mt(c)}catch(c){console.error("Error loading districts:",c)}})()},[w.stateId]);const n=s=>{const c=s.replace(/\D/g,"");return c.length!==10?!1:/^[6-9]\d{9}$/.test(c)},j=s=>{const c=s.replace(/\D/g,"");return c.length===10?c:s},I=s=>{if(!s)return{valid:!0,error:null};const c=s.toUpperCase().replace(/\s/g,"");return c.length!==15?{valid:!1,error:"GSTIN must be 15 characters"}:/^[0-9A-Z]{15}$/.test(c)?{valid:!0,error:null,cleaned:c}:{valid:!1,error:"GSTIN must be alphanumeric"}},H=s=>{if(!s||s.length<2)return null;const c=s.substring(0,2);return{"01":"JAMMU AND KASHMIR","02":"HIMACHAL PRADESH","03":"PUNJAB","04":"CHANDIGARH","05":"UTTARAKHAND","06":"HARYANA","07":"DELHI","08":"RAJASTHAN","09":"UTTAR PRADESH",10:"BIHAR",11:"SIKKIM",12:"ARUNACHAL PRADESH",13:"NAGALAND",14:"MANIPUR",15:"MIZORAM",16:"TRIPURA",17:"MEGHALAYA",18:"ASSAM",19:"WEST BENGAL",20:"JHARKHAND",21:"ODISHA",22:"CHHATTISGARH",23:"MADHYA PRADESH",24:"GUJARAT",25:"DAMAN AND DIU",26:"DADRA AND NAGAR HAVELI",27:"MAHARASHTRA",28:"ANDHRA PRADESH",29:"KARNATAKA",30:"GOA",31:"LAKSHADWEEP",32:"KERALA",33:"TAMIL NADU",34:"PUDUCHERRY",35:"ANDAMAN AND NICOBAR ISLANDS",36:"TELANGANA",37:"ANDHRA PRADESH",38:"LADAKH"}[c]||null},se=async s=>{if(!s||s.length!==6)return null;We(!0);try{const D=await(await fetch(`https://api.postalpincode.in/pincode/${s}`)).json();if(D&&D[0]&&D[0].Status==="Success"&&D[0].PostOffice&&D[0].PostOffice.length>0){const $=D[0].PostOffice[0];return{city:$.District||$.Name,state:$.State,district:$.District}}return null}catch(c){return console.error("Error looking up pincode:",c),null}finally{We(!1)}},Z=async(s,c)=>{if(!s&&!c)return!1;ot({checking:!0,found:!1});try{const D=Y.currentUser?.uid;if(!D)return!1;const $=Pe(U,`businesses/${D}/connectedDistributors`),be=(await $e($)).docs.some(R=>{const le=R.data();return s&&(le.email===s||le.distributorEmail===s)||c&&(le.phone===c||le.distributorPhone===c)});return ot({checking:!1,found:be}),be}catch(D){return console.error("Error checking duplicate:",D),ot({checking:!1,found:!1}),!1}},[Ae,Re]=i.useState({productId:"",productName:"",quantity:"",priority:"normal",notes:""}),Se=ss(),Ne=async()=>{const s=Y.currentUser?.uid;if(s){Ce(!0);try{const c=Pe(U,`businesses/${s}/connectedDistributors`),D=await $e(c),$=[],fe=D.docs.map(async ke=>{const ue=ke.data(),he=ue.distributorId||ke.id;try{const Ie=de(U,"businesses",he),et=await Te(Ie);return et.exists()?{id:ke.id,distributorId:he,...et.data(),...ue,connectionStatus:ue.status||"connected",connectedAt:ue.connectedAt,manualNotes:ue.manualNotes||"",additionalInfo:ue.additionalInfo||"",contractDetails:ue.contractDetails||"",paymentTerms:ue.paymentTerms||"",specialInstructions:ue.specialInstructions||""}:{id:ke.id,distributorId:he,...ue,connectionStatus:ue.status||"connected",manualNotes:ue.manualNotes||"",additionalInfo:ue.additionalInfo||"",contractDetails:ue.contractDetails||"",paymentTerms:ue.paymentTerms||"",specialInstructions:ue.specialInstructions||""}}catch(Ie){return console.error("Error fetching distributor details:",Ie),{id:ke.id,distributorId:he,...ue,manualNotes:ue.manualNotes||"",additionalInfo:ue.additionalInfo||"",contractDetails:ue.contractDetails||"",paymentTerms:ue.paymentTerms||"",specialInstructions:ue.specialInstructions||""}}});$.push(...await Promise.all(fe)),q($);const be=Pe(U,`businesses/${s}/assignedOrdersToDistributors`),le=(await $e(be)).docs.map(ke=>({id:ke.id,...ke.data()}));le.sort((ke,ue)=>{const he=ke.createdAt?.toDate?ke.createdAt.toDate().getTime():ke.timestamp?.toDate?ke.timestamp.toDate().getTime():0;return(ue.createdAt?.toDate?ue.createdAt.toDate().getTime():ue.timestamp?.toDate?ue.timestamp.toDate().getTime():0)-he}),m(le)}catch(c){console.error("Error fetching distributors:",c),p.error("Failed to refresh distributors list")}finally{Ce(!1)}}};i.useEffect(()=>{const s=Y.currentUser?.uid;if(!s)return;console.log("[DistributorConnection] Setting up real-time listener for distributor order requests");const c=Pe(U,`businesses/${s}/distributorOrderRequests`),D=Ye(c,$=>{console.log(`[DistributorConnection] Received ${$.docs.length} distributor order requests`);const fe=$.docs.map(be=>({id:be.id,...be.data()}));if(fe.sort((be,R)=>{const le=be.createdAt?.toDate?be.createdAt.toDate().getTime():be.timestamp?.toDate?be.timestamp.toDate().getTime():0;return(R.createdAt?.toDate?R.createdAt.toDate().getTime():R.timestamp?.toDate?R.timestamp.toDate().getTime():0)-le}),V(fe),fe.length>0){const be=fe[0];console.log("[DistributorConnection] Latest order:",be)}},$=>{console.error("[DistributorConnection] Error listening to distributor order requests:",$),p.error("Failed to load order requests. Please refresh.")});return()=>{console.log("[DistributorConnection] Cleaning up distributor order requests listener"),D()}},[]),i.useEffect(()=>{Ne()},[]),i.useEffect(()=>{const s=Y.currentUser?.uid;if(!s||L.length===0)return;const c=[];return L.map($=>$.distributorId||$.id).filter(Boolean).forEach($=>{const fe=de(U,"businesses",$),be=Ye(fe,async R=>{if(!R.exists())return;const le=R.data();try{const ke=de(U,`businesses/${s}/connectedDistributors/${$}`),ue=await Te(ke),he=ue.exists()?ue.data():{},Ie={businessName:le.businessName||he.businessName,distributorName:le.businessName||le.distributorName||he.distributorName,ownerName:le.ownerName||le.name||he.ownerName,email:le.email||he.email,distributorEmail:le.email||he.distributorEmail,phone:le.phone||he.phone,distributorPhone:le.phone||he.distributorPhone,address:le.address||he.address,distributorAddress:le.address||he.distributorAddress,city:le.city||he.city,distributorCity:le.city||he.distributorCity,state:le.state||he.state,distributorState:le.state||he.distributorState,pincode:le.pincode||he.pincode,gstin:le.gstin||le.gstNumber||he.gstin,profileSyncedAt:je()};(Ie.businessName!==he.businessName||Ie.ownerName!==he.ownerName||Ie.email!==he.email||Ie.phone!==he.phone||Ie.address!==he.address||Ie.city!==he.city||Ie.state!==he.state||Ie.pincode!==he.pincode||Ie.gstin!==he.gstin)&&(await qe(ke,Ie),await Ne())}catch(ke){console.error(`Error syncing distributor ${$} profile:`,ke)}},R=>{console.error(`Error listening to distributor ${$} profile:`,R)});c.push(be)}),()=>{c.forEach($=>$())}},[L.map(s=>s.distributorId||s.id).filter(Boolean).join(",")]);const ge=async()=>{if(!W.trim()){p.error("Please enter a FLYP ID");return}oe(!0),f([]);try{const s=W.trim(),c=de(U,"businesses",s),D=await Te(c);if(!D.exists()){p.error("Distributor not found with this FLYP ID"),oe(!1);return}const $=D.data();if($.role?.toLowerCase()!=="distributor"){p.error("This FLYP ID belongs to a non-distributor account"),oe(!1);return}const fe=Y.currentUser?.uid,be=de(U,`businesses/${fe}/connectedDistributors/${s}`);if((await Te(be)).exists()){p.warning("This distributor is already connected"),oe(!1);return}f([{id:s,distributorId:s,...$,flypId:s}]),p.success("Distributor found!")}catch(s){console.error("Error searching distributor:",s),p.error("Failed to search distributor. Please try again.")}finally{oe(!1)}},Oe=async(s,c,D)=>{if(!s||s.length===0)return[];const $=[],fe=[];for(const be of s)try{if(be.size>10485760){fe.push(`${be.name}: File size exceeds 10MB limit`);continue}if(!["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(be.type)){fe.push(`${be.name}: Invalid file type. Allowed: PDF, DOC, DOCX, JPG, PNG`);continue}const ke=Date.now(),ue=be.name.replace(/[^a-zA-Z0-9.-]/g,"_"),he=`connections/${c}/${D}/${ke}-${ue}`,Ie=Gt(Se,he);await Kt(Ie,be);const et=await Ht(Ie);$.push({name:be.name,type:be.type,size:be.size,url:et,uploadedAt:je(),uploadedBy:c,path:he})}catch(R){console.error(`Error uploading file ${be.name}:`,R),fe.push(`${be.name}: ${R.message||"Upload failed"}`)}if(fe.length>0)throw new Error(`Some files failed to upload:
${fe.join(`
`)}`);return $},Ke=async s=>{const c=Y.currentUser?.uid;if(!c||!s.distributorId){p.error("Missing required information. Please try again.");return}if(!o){p.error("Please accept the policy before connecting.");return}try{const D=de(U,"businesses",s.distributorId),$=await Te(D);if(!$.exists()){p.error("Distributor not found. Please verify the FLYP ID.");return}const fe=$.data();if(fe.role?.toLowerCase()!=="distributor"){p.error("The provided ID does not belong to a distributor.");return}const R=de(U,"businesses",c),le=await Te(R),ke=le.exists()?le.data():{};let ue=[];if(Q&&Q.length>0)try{ue=await Oe(Array.from(Q),c,s.distributorId),ue.length>0&&p.success(`${ue.length} file(s) uploaded successfully`)}catch(Pt){console.error("Error uploading attachments:",Pt),p.error(Pt.message||"Failed to upload some files. Connection will proceed without attachments.")}const he=Dt(U),Ie=de(U,`businesses/${c}/connectedDistributors/${s.distributorId}`);he.set(Ie,{distributorId:s.distributorId,distributorName:s.businessName||s.distributorName||fe.businessName||"",distributorEmail:s.email||fe.email||"",distributorPhone:s.phone||fe.phone||"",distributorCity:s.city||fe.city||"",distributorState:s.state||fe.state||"",distributorAddress:s.address||fe.address||"",territory:s.territory||"",location:s.location||{},status:"connected",connectedAt:je(),connectedBy:c,flypId:s.distributorId,attachments:ue,policiesAccepted:!0,policyVersion:"v1",policyAcceptedAt:je(),policyAcceptedBy:c},{merge:!0});const et=de(U,`businesses/${s.distributorId}/connectedProductOwners/${c}`);he.set(et,{productOwnerId:c,productOwnerName:ke.businessName||Y.currentUser?.displayName||"Product Owner",productOwnerEmail:Y.currentUser?.email||ke.email||"",productOwnerPhone:ke.phone||"",productOwnerAddress:ke.address||"",productOwnerCity:ke.city||"",productOwnerState:ke.state||"",connectedAt:je(),status:"connected",attachments:ue,policiesAccepted:!0,policyVersion:"v1",policyAcceptedAt:je(),policyAcceptedBy:c},{merge:!0}),await he.commit(),console.log("✅ Connection created successfully:",{productOwnerId:c,distributorId:s.distributorId,productOwnerConnection:`businesses/${c}/connectedDistributors/${s.distributorId}`,distributorConnection:`businesses/${s.distributorId}/connectedProductOwners/${c}`}),p.success("Distributor connected successfully!"),G(!1),K(""),f([]),ie([]),M(!1),await Ne()}catch(D){console.error("Error connecting distributor:",D),console.error("Error details:",{code:D.code,message:D.message,productOwnerId:c,distributorId:s.distributorId,stack:D.stack});let $="Failed to connect distributor. ";D.code==="permission-denied"?$+="Permission denied. Please check Firebase rules.":D.code==="not-found"?$+="Distributor not found.":$+=D.message||"Please check console for details.",p.error($)}},Xe=()=>{const s={};if(w.businessName.trim()||(s.businessName="Business name is required"),w.ownerName.trim()||(s.ownerName="Owner name is required"),w.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(w.email)||(s.email="Invalid email format"):s.email="Email is required",w.phone.trim()?n(w.phone)||(s.phone="Invalid phone number (must be 10 digits starting with 6-9)"):s.phone="Phone is required",w.address.trim()||(s.address="Address is required"),w.city.trim()||(s.city="City is required"),w.state.trim()||(s.state="State is required"),w.pincode&&w.pincode.length!==6&&(s.pincode="Pincode must be 6 digits"),w.gstin){const c=I(w.gstin);c.valid||(s.gstin=c.error)}return ye(s),Object.keys(s).length===0},Ze=async s=>{s.preventDefault();const c=Y.currentUser?.uid;if(!c)return;if(!Xe()){p.error("Please fix the errors in the form");return}if(await Z(w.email,j(w.phone))){p.error("A distributor with this email or phone already exists");return}try{const $=j(w.phone),fe=w.gstin?I(w.gstin).cleaned||w.gstin.toUpperCase():"",be={businessName:w.businessName.trim(),ownerName:w.ownerName.trim(),email:w.email.trim().toLowerCase(),phone:$,address:w.address.trim(),city:w.city.trim(),state:w.state.trim(),stateId:w.stateId||"",district:w.district||"",districtId:w.districtId||"",pincode:w.pincode||"",gstin:fe,territory:w.territory?.trim()||"",location:w.location,role:"distributor",createdAt:je(),createdBy:c,status:"connected",connectedAt:je(),isProvisional:!0},R=de(Pe(U,`businesses/${c}/connectedDistributors`));await it(R,be),p.success("Distributor created and connected successfully!"),xe(!1),ye({}),X({businessName:"",ownerName:"",email:"",phone:"",address:"",city:"",state:"",stateId:"",district:"",districtId:"",pincode:"",gstin:"",territory:"",location:{latitude:"",longitude:"",address:""}}),await Ne()}catch($){console.error("Error creating distributor:",$),p.error("Failed to create distributor. Please try again.")}},He=s=>{if(!Y.currentUser?.uid||!s.distributorId){p.error("Missing required information.");return}F(s),ve(!0)},z=async()=>{if(!C)return;const s=C,c=Y.currentUser?.uid;try{const D=Dt(U),$=de(U,`businesses/${c}/connectedDistributors/${s.distributorId}`);D.delete($);const fe=de(U,`businesses/${s.distributorId}/connectedProductOwners/${c}`);D.delete(fe),await D.commit(),p.success("Distributor disconnected successfully!"),ve(!1),F(null),await Ne()}catch(D){console.error("Error disconnecting distributor:",D),console.error("Error details:",{code:D.code,message:D.message,productOwnerId:c,distributorId:s.distributorId});let $="Failed to disconnect distributor. ";D.code==="permission-denied"?$+="Permission denied.":$+=D.message||"Please check console for details.",p.error($)}},Ue=async s=>{a(s),x({businessName:s.businessName||s.distributorName||"",ownerName:s.ownerName||"",email:s.email||s.distributorEmail||"",phone:s.phone||s.distributorPhone||"",address:s.address||s.distributorAddress||"",city:s.city||s.distributorCity||"",state:s.state||s.distributorState||"",stateId:s.stateId||"",district:s.district||"",districtId:s.districtId||"",pincode:s.pincode||"",gstin:s.gstin||"",territory:s.territory||"",manualNotes:s.manualNotes||"",additionalInfo:s.additionalInfo||"",contractDetails:s.contractDetails||"",paymentTerms:s.paymentTerms||"",specialInstructions:s.specialInstructions||""}),t(!1),Le(!0);try{const c=await Ft();J(c)}catch(c){console.error("Error loading states:",c)}},ut=()=>{Le(!1),a(null),t(!1),x({})},es=async()=>{const s=Y.currentUser?.uid;if(!s||!S)return;const c=S.distributorId||S.id;if(!l.businessName?.trim()){p.error("Business name is required");return}if(!l.email?.trim()){p.error("Email is required");return}if(!l.phone?.trim()){p.error("Phone is required");return}if(!n(l.phone)){p.error("Invalid phone number");return}try{const D=de(U,`businesses/${s}/connectedDistributors/${c}`),$=j(l.phone),fe=l.gstin?I(l.gstin).cleaned||l.gstin.toUpperCase():"";await qe(D,{businessName:l.businessName.trim(),distributorName:l.businessName.trim(),ownerName:l.ownerName.trim(),email:l.email.trim().toLowerCase(),distributorEmail:l.email.trim().toLowerCase(),phone:$,distributorPhone:$,address:l.address.trim(),distributorAddress:l.address.trim(),city:l.city.trim(),distributorCity:l.city.trim(),state:l.state.trim(),distributorState:l.state.trim(),stateId:l.stateId||"",district:l.district||"",districtId:l.districtId||"",pincode:l.pincode||"",gstin:fe,territory:l.territory?.trim()||"",manualNotes:l.manualNotes||"",additionalInfo:l.additionalInfo||"",contractDetails:l.contractDetails||"",paymentTerms:l.paymentTerms||"",specialInstructions:l.specialInstructions||"",lastUpdated:je(),updatedBy:s}),p.success("Distributor information saved successfully!"),t(!1),await Ne();const be=await Te(D);if(be.exists()){const R=be.data();a(le=>({...le,...R,businessName:R.businessName||R.distributorName||le.businessName,ownerName:R.ownerName||le.ownerName,email:R.email||R.distributorEmail||le.email,phone:R.phone||R.distributorPhone||le.phone,address:R.address||R.distributorAddress||le.address,city:R.city||R.distributorCity||le.city,state:R.state||R.distributorState||le.state,pincode:R.pincode||le.pincode,gstin:R.gstin||le.gstin,territory:R.territory||le.territory,manualNotes:R.manualNotes||"",additionalInfo:R.additionalInfo||"",contractDetails:R.contractDetails||"",paymentTerms:R.paymentTerms||"",specialInstructions:R.specialInstructions||""})),x({businessName:R.businessName||R.distributorName||"",ownerName:R.ownerName||"",email:R.email||R.distributorEmail||"",phone:R.phone||R.distributorPhone||"",address:R.address||R.distributorAddress||"",city:R.city||R.distributorCity||"",state:R.state||R.distributorState||"",stateId:R.stateId||"",district:R.district||"",districtId:R.districtId||"",pincode:R.pincode||"",gstin:R.gstin||"",territory:R.territory||"",manualNotes:R.manualNotes||"",additionalInfo:R.additionalInfo||"",contractDetails:R.contractDetails||"",paymentTerms:R.paymentTerms||"",specialInstructions:R.specialInstructions||""})}}catch(D){console.error("Error saving distributor details:",D),p.error("Failed to save information. Please try again.")}},ts=()=>{te(!1),P(null),Ne()},kt=L.filter(s=>{const c=g.toLowerCase();return s.businessName?.toLowerCase().includes(c)||s.ownerName?.toLowerCase().includes(c)||s.email?.toLowerCase().includes(c)||s.territory?.toLowerCase().includes(c)}),Ct=s=>{switch(s){case"connected":return"bg-emerald-400/20 text-emerald-300 border-emerald-400/30";case"pending":return"bg-yellow-400/20 text-yellow-300 border-yellow-400/30";case"inactive":return"bg-gray-400/20 text-gray-300 border-gray-400/30";default:return"bg-blue-400/20 text-blue-300 border-blue-400/30"}};return e.jsxs(y.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-6 text-white p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Distributor Connections"}),e.jsx("p",{className:"text-white/70 text-sm mt-1",children:"Manage your distributor network and assign orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>G(!0),className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg flex items-center gap-2 transition",children:[e.jsx(_e,{})," Search by FLYP ID"]}),e.jsxs("button",{onClick:()=>xe(!0),className:"px-4 py-2 bg-emerald-500 hover:bg-emerald-600 rounded-lg flex items-center gap-2 transition",children:[e.jsx(st,{})," Create Distributor"]})]})]}),e.jsx("div",{className:"flex gap-2 border-b border-white/10",children:[{id:"connected",label:"Connected Distributors",icon:e.jsx(jt,{})},{id:"orderFlow",label:"Order Flow",icon:e.jsx(Me,{}),badge:k.length>0?k.filter(s=>s.status==="REQUESTED"||s.statusCode==="REQUESTED").length:0},{id:"territory",label:"Territory",icon:e.jsx(rt,{})}].map(s=>e.jsxs("button",{onClick:()=>T(s.id),className:`px-4 py-2 flex items-center gap-2 transition ${b===s.id?"border-b-2 border-emerald-400 text-emerald-300":"text-white/70 hover:text-white"}`,children:[s.icon," ",s.label,s.badge!==void 0&&s.badge>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-red-500 text-white text-xs rounded-full",children:s.badge})]},s.id))}),b==="connected"&&e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-white/50"}),e.jsx("input",{type:"text",placeholder:"Search distributors...",value:g,onChange:s=>ce(s.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}),we?e.jsx("div",{className:"text-center py-12 text-white/50",children:"Loading distributors..."}):kt.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:kt.map(s=>e.jsxs(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-4 hover:bg-white/10 transition",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.businessName||"Unnamed"}),e.jsx("p",{className:"text-sm text-white/70",children:s.ownerName})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs border ${Ct(s.connectionStatus)}`,children:s.connectionStatus})]}),e.jsxs("div",{className:"space-y-2 text-sm text-white/70 mb-4",children:[s.email&&e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Email:"})," ",s.email]}),s.phone&&e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Phone:"})," ",s.phone]}),s.territory&&e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Territory:"})," ",s.territory]}),s.city&&e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Location:"})," ",s.city,s.state&&`, ${s.state}`]}),s.flypId&&e.jsxs("p",{className:"text-xs text-emerald-400 font-mono",children:[e.jsx("span",{className:"text-white/50",children:"FLYP ID:"})," ",s.flypId]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>Ue(s),className:"flex-1 px-3 py-2 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/30 rounded-lg text-blue-300 text-sm transition flex items-center justify-center gap-2",children:[e.jsx(xs,{})," View Details"]}),e.jsx("button",{onClick:()=>{P(s),te(!0)},className:"flex-1 px-3 py-2 bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-400/30 rounded-lg text-emerald-300 text-sm transition",children:"Assign Order"}),e.jsx("button",{onClick:()=>He(s),className:"px-3 py-2 bg-red-500/20 hover:bg-red-500/30 border border-red-400/30 rounded-lg text-red-300 text-sm transition",title:"Disconnect",children:e.jsx(nt,{})})]})]},s.id))}):e.jsx("div",{className:"text-center py-12 text-white/50",children:"No distributors found. Create your first distributor to get started."})]}),b==="orderFlow"&&e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:e.jsx(qs,{distributorOrderRequests:k,orders:_,onOrderUpdate:()=>{Ne()},fetchDistributors:Ne})}),b==="territory"&&e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:e.jsx(Vs,{distributors:L})}),e.jsx(De,{children:B&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>{xe(!1),ye({}),X({businessName:"",ownerName:"",email:"",phone:"",address:"",city:"",state:"",stateId:"",district:"",districtId:"",pincode:"",gstin:"",territory:"",location:{latitude:"",longitude:"",address:""}})},children:e.jsxs(y.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:s=>s.stopPropagation(),className:"bg-slate-900 rounded-xl border border-white/10 p-6 max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(jt,{className:"text-emerald-400"}),"Create New Distributor"]}),e.jsx("p",{className:"text-sm text-white/60 mt-1",children:"Add a new distributor to your network"})]}),e.jsx("button",{onClick:()=>{xe(!1),ye({})},className:"text-white/60 hover:text-white transition",children:e.jsx(Ge,{className:"text-xl"})})]}),e.jsxs("form",{onSubmit:Ze,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white/5 rounded-lg p-5 border border-white/10",children:[e.jsxs("h4",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(dt,{className:"text-emerald-400"}),"Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-white/80 mb-2",children:["Business Name ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:w.businessName,onChange:s=>{X({...w,businessName:s.target.value}),A.businessName&&ye({...A,businessName:""})},className:`w-full px-4 py-2.5 bg-white/10 border rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 transition ${A.businessName?"border-red-400/50 focus:ring-red-400/50":"border-white/20 focus:ring-emerald-400/50"}`,placeholder:"e.g., ABC Traders"}),A.businessName&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:A.businessName})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-white/80 mb-2",children:["Owner Name ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:w.ownerName,onChange:s=>{X({...w,ownerName:s.target.value}),A.ownerName&&ye({...A,ownerName:""})},className:`w-full px-4 py-2.5 bg-white/10 border rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 transition ${A.ownerName?"border-red-400/50 focus:ring-red-400/50":"border-white/20 focus:ring-emerald-400/50"}`,placeholder:"e.g., John Doe"}),A.ownerName&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:A.ownerName})]})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-5 border border-white/10",children:[e.jsxs("h4",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(vt,{className:"text-blue-400"}),"Contact Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-white/80 mb-2",children:["Email ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",value:w.email,onChange:async s=>{const c=s.target.value;X({...w,email:c}),A.email&&ye({...A,email:""}),c&&c.includes("@")&&await Z(c,"")&&!Ve.found&&ye({...A,email:"Email already exists"})},className:`w-full px-4 py-2.5 bg-white/10 border rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 transition ${A.email?"border-red-400/50 focus:ring-red-400/50":"border-white/20 focus:ring-emerald-400/50"}`,placeholder:"owner@business.com"}),Ve.checking&&e.jsx(at,{className:"absolute right-3 top-1/2 -translate-y-1/2 animate-spin text-white/50"})]}),A.email&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:A.email})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-white/80 mb-2",children:["Phone ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"inline-flex items-center px-3 rounded-l-lg bg-white/10 border border-r-0 border-white/20 text-white/70 select-none",children:"+91"}),e.jsx("input",{type:"tel",maxLength:10,value:w.phone,onChange:async s=>{const c=s.target.value.replace(/\D/g,"");X({...w,phone:c}),A.phone&&ye({...A,phone:""}),c.length===10&&await Z("",c)&&!Ve.found&&ye({...A,phone:"Phone already exists"})},className:`flex-1 px-4 py-2.5 bg-white/10 border rounded-r-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 transition ${A.phone?"border-red-400/50 focus:ring-red-400/50":"border-white/20 focus:ring-emerald-400/50"}`,placeholder:"10-digit number"})]}),A.phone&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:A.phone}),w.phone&&n(w.phone)&&e.jsxs("p",{className:"text-emerald-400 text-xs mt-1 flex items-center gap-1",children:[e.jsx(yt,{})," Valid phone number"]})]})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-5 border border-white/10",children:[e.jsxs("h4",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(rt,{className:"text-purple-400"}),"Location Details"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-white/80 mb-2",children:["Address ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("textarea",{value:w.address,onChange:s=>{X({...w,address:s.target.value}),A.address&&ye({...A,address:""})},rows:3,className:`w-full px-4 py-2.5 bg-white/10 border rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 transition ${A.address?"border-red-400/50 focus:ring-red-400/50":"border-white/20 focus:ring-emerald-400/50"}`,placeholder:"Street address, building, area"}),A.address&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:A.address})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:"Pincode"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",maxLength:6,value:w.pincode,onChange:async s=>{const c=s.target.value.replace(/\D/g,"");if(X({...w,pincode:c}),A.pincode&&ye({...A,pincode:""}),c.length===6){const D=await se(c);D&&(X($=>({...$,pincode:c,city:$.city||D.city,state:$.state||D.state,district:$.district||D.district})),p.success("Location auto-filled from pincode!"))}},className:`w-full px-4 py-2.5 bg-white/10 border rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 transition ${A.pincode?"border-red-400/50 focus:ring-red-400/50":"border-white/20 focus:ring-emerald-400/50"}`,placeholder:"6-digit pincode"}),Ee&&e.jsx(at,{className:"absolute right-3 top-1/2 -translate-y-1/2 animate-spin text-white/50"})]}),A.pincode&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:A.pincode}),w.pincode.length===6&&!Ee&&e.jsx("p",{className:"text-xs text-white/50 mt-1",children:"Press Tab to auto-fill location"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-white/80 mb-2",children:["City ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:w.city,onChange:s=>{X({...w,city:s.target.value}),A.city&&ye({...A,city:""})},className:`w-full px-4 py-2.5 bg-white/10 border rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 transition ${A.city?"border-red-400/50 focus:ring-red-400/50":"border-white/20 focus:ring-emerald-400/50"}`,placeholder:"City name"}),A.city&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:A.city})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-white/80 mb-2",children:["State ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("select",{value:w.stateId,onChange:s=>{const c=Qe.find(D=>D.id===s.target.value);X({...w,stateId:s.target.value,state:c?c.name:"",district:"",districtId:""}),A.state&&ye({...A,state:""})},className:`w-full px-4 py-2.5 bg-white/10 border rounded-lg text-white focus:outline-none focus:ring-2 transition ${A.state?"border-red-400/50 focus:ring-red-400/50":"border-white/20 focus:ring-emerald-400/50"}`,children:[e.jsx("option",{value:"",children:"Select State"}),Qe.map(s=>e.jsx("option",{value:s.id,className:"bg-slate-800",children:s.name},s.id))]}),A.state&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:A.state})]})]}),w.stateId&&lt.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:"District (Optional)"}),e.jsxs("select",{value:w.districtId,onChange:s=>{const c=lt.find(D=>D.id===s.target.value);X({...w,districtId:s.target.value,district:c?c.name:""})},className:"w-full px-4 py-2.5 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:[e.jsx("option",{value:"",children:"Select District"}),lt.map(s=>e.jsx("option",{value:s.id,className:"bg-slate-800",children:s.name},s.id))]})]})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-5 border border-white/10",children:[e.jsxs("h4",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(ps,{className:"text-orange-400"}),"Business Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:"GSTIN"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",maxLength:15,value:w.gstin,onChange:async s=>{let c=s.target.value.toUpperCase().replace(/[^0-9A-Z]/g,"");if(X({...w,gstin:c}),A.gstin&&ye({...A,gstin:""}),c.length>=2){const D=H(c);if(D&&!w.state){const $=Qe.find(fe=>fe.name.toUpperCase()===D.toUpperCase());$&&(X(fe=>({...fe,gstin:c,stateId:$.id,state:$.name})),p.info("State auto-detected from GSTIN"))}}if(c.length===15){const D=I(c);D.valid||ye({...A,gstin:D.error})}},className:`w-full px-4 py-2.5 bg-white/10 border rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 transition uppercase ${A.gstin?"border-red-400/50 focus:ring-red-400/50":"border-white/20 focus:ring-emerald-400/50"}`,placeholder:"15-character GSTIN"}),Be&&e.jsx(at,{className:"absolute right-3 top-1/2 -translate-y-1/2 animate-spin text-white/50"})]}),A.gstin&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:A.gstin}),w.gstin.length===15&&I(w.gstin).valid&&e.jsxs("p",{className:"text-emerald-400 text-xs mt-1 flex items-center gap-1",children:[e.jsx(yt,{})," Valid GSTIN format"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:"Territory / Region"}),e.jsx("input",{type:"text",value:w.territory,onChange:s=>{X({...w,territory:s.target.value}),A.territory&&ye({...A,territory:""})},className:`w-full px-4 py-2.5 bg-white/10 border rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 transition ${A.territory?"border-red-400/50 focus:ring-red-400/50":"border-white/20 focus:ring-emerald-400/50"}`,placeholder:"e.g., North Zone, Mumbai Region"}),A.territory&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:A.territory})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-white/10",children:[e.jsx("button",{type:"button",onClick:()=>{xe(!1),ye({}),X({businessName:"",ownerName:"",email:"",phone:"",address:"",city:"",state:"",stateId:"",district:"",districtId:"",pincode:"",gstin:"",territory:"",location:{latitude:"",longitude:"",address:""}})},className:"flex-1 px-4 py-3 bg-white/10 hover:bg-white/20 rounded-lg transition text-white font-medium",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"flex-1 px-4 py-3 bg-emerald-500 hover:bg-emerald-600 rounded-lg transition text-white font-medium flex items-center justify-center gap-2",children:[e.jsx(st,{})," Create Distributor"]})]})]})]})})}),e.jsx(De,{children:me&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>{G(!1),K(""),f([]),ie([]),M(!1)},children:e.jsxs(y.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:s=>s.stopPropagation(),className:"bg-slate-900 rounded-xl border border-white/10 p-6 max-w-lg w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Mt,{className:"text-2xl text-blue-400"}),e.jsx("h3",{className:"text-xl font-bold",children:"Search Distributor by FLYP ID"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-2",children:"Enter FLYP ID (Business ID)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:W,onChange:s=>K(s.target.value),onKeyPress:s=>s.key==="Enter"&&ge(),placeholder:"Enter distributor's FLYP ID",className:"flex-1 px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-400/50"}),e.jsx("button",{onClick:ge,disabled:pe||!W.trim(),className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-blue-500/50 disabled:cursor-not-allowed rounded-lg transition flex items-center gap-2",children:pe?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"⏳"})," Searching..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{})," Search"]})})]}),e.jsx("p",{className:"text-xs text-white/50 mt-2",children:"💡 FLYP ID is the unique business identifier assigned to each distributor on the platform"})]}),u.length>0&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-white/80",children:"Search Results"}),u.map(s=>e.jsxs("div",{className:"p-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-semibold text-white mb-1",children:s.businessName||s.distributorName||"Unnamed"}),e.jsx("p",{className:"text-sm text-white/70",children:s.ownerName})]}),e.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-emerald-500/20 text-emerald-300 border border-emerald-400/30",children:"Found"})]}),e.jsxs("div",{className:"space-y-1 text-sm text-white/70 mb-4",children:[s.email&&e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Email:"})," ",s.email]}),s.phone&&e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Phone:"})," ",s.phone]}),s.city&&e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Location:"})," ",s.city,s.state&&`, ${s.state}`]}),e.jsxs("p",{className:"text-xs text-emerald-400 font-mono",children:["FLYP ID: ",s.flypId||s.id]})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/80 mb-1",children:"Attach documents (agreements, onboarding PDFs)"}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf,.doc,.docx,.png,.jpg,.jpeg",onChange:c=>ie(c.target.files),className:"w-full text-sm text-white/70 file:mr-3 file:px-3 file:py-2 file:rounded-lg file:border-0 file:bg-white/10 file:text-white hover:file:bg-white/20"}),e.jsx("p",{className:"text-xs text-white/50 mt-1",children:"Uploaded files will be shared with the distributor for records."})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:c=>M(c.target.checked),className:"mt-1"}),e.jsx("div",{className:"text-xs text-white/70",children:"I confirm that this distributor agrees to the connection policy and terms. By proceeding, both parties accept the shared documents/agreements."})]})]}),e.jsxs("button",{onClick:()=>Ke(s),className:"w-full px-4 py-2 bg-emerald-500 hover:bg-emerald-600 rounded-lg text-white font-medium transition flex items-center justify-center gap-2",children:[e.jsx(Tt,{})," Connect Distributor"]})]},s.id))]})]}),e.jsx("div",{className:"flex gap-3 pt-4 mt-4 border-t border-white/10",children:e.jsx("button",{onClick:()=>{G(!1),K(""),f([]),ie([]),M(!1)},className:"flex-1 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition",children:"Close"})})]})})}),e.jsx(De,{children:ne&&C&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>ve(!1),children:e.jsxs(y.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:s=>s.stopPropagation(),className:"bg-slate-900 rounded-xl border border-white/10 p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"Disconnect Distributor"}),e.jsxs("p",{className:"text-sm text-white/70 mb-4",children:["You are about to disconnect ",e.jsx("span",{className:"text-white font-semibold",children:C.businessName||C.distributorName}),". Orders and history remain in your records, but no new actions can be taken until reconnected."]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>ve(!1),className:"flex-1 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition",children:"Cancel"}),e.jsx("button",{onClick:z,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg transition text-white",children:"Confirm Disconnect"})]})]})})}),e.jsx(De,{children:ee&&E&&e.jsx(Bs,{distributor:E,onClose:()=>{te(!1),P(null)},onSuccess:ts})}),b!=="orderFlow"&&e.jsx(De,{children:d&&re&&e.jsx(Qt,{order:re,isDistributorOrderRequest:!1,onClose:()=>{ae(!1),O(null)},onUpdate:()=>{Ne()}})}),e.jsx(De,{children:Fe&&S&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:ut,children:e.jsxs(y.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:s=>s.stopPropagation(),className:"bg-slate-900 rounded-xl border border-white/10 w-full max-w-5xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"sticky top-0 bg-slate-900/95 backdrop-blur-md border-b border-white/10 p-6 flex items-center justify-between z-10",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:S.businessName||"Distributor Details"}),e.jsx("p",{className:"text-white/60 text-sm",children:S.ownerName||"Owner Name"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[h?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{t(!1),x({businessName:S.businessName||S.distributorName||"",ownerName:S.ownerName||"",email:S.email||S.distributorEmail||"",phone:S.phone||S.distributorPhone||"",address:S.address||S.distributorAddress||"",city:S.city||S.distributorCity||"",state:S.state||S.distributorState||"",stateId:S.stateId||"",district:S.district||"",districtId:S.districtId||"",pincode:S.pincode||"",gstin:S.gstin||"",territory:S.territory||"",manualNotes:S.manualNotes||"",additionalInfo:S.additionalInfo||"",contractDetails:S.contractDetails||"",paymentTerms:S.paymentTerms||"",specialInstructions:S.specialInstructions||""})},className:"px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white text-sm transition",children:"Cancel"}),e.jsxs("button",{onClick:es,className:"px-4 py-2 bg-emerald-500 hover:bg-emerald-600 rounded-lg text-white text-sm transition flex items-center gap-2",children:[e.jsx(Nt,{})," Save Changes"]})]}):e.jsxs("button",{onClick:()=>t(!0),className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg text-white text-sm transition flex items-center gap-2",children:[e.jsx(ct,{})," Edit Information"]}),e.jsx("button",{onClick:ut,className:"px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white text-sm transition",children:"Close"})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/5 rounded-xl p-5 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(Mt,{})," Basic Information"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Business Name:"}),h?e.jsx("input",{type:"text",value:l.businessName||"",onChange:s=>x({...l,businessName:s.target.value}),className:"w-full mt-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}):e.jsx("p",{className:"text-white font-medium",children:S.businessName||S.distributorName||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Owner Name:"}),h?e.jsx("input",{type:"text",value:l.ownerName||"",onChange:s=>x({...l,ownerName:s.target.value}),className:"w-full mt-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}):e.jsx("p",{className:"text-white font-medium",children:S.ownerName||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Email:"}),h?e.jsx("input",{type:"email",value:l.email||"",onChange:s=>x({...l,email:s.target.value}),className:"w-full mt-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}):e.jsx("p",{className:"text-white",children:S.email||S.distributorEmail||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Phone:"}),h?e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("span",{className:"inline-flex items-center px-3 rounded-l-lg bg-white/10 border border-r-0 border-white/20 text-white/70 select-none",children:"+91"}),e.jsx("input",{type:"tel",maxLength:10,value:l.phone||"",onChange:s=>x({...l,phone:s.target.value.replace(/\D/g,"")}),className:"flex-1 px-3 py-2 rounded-r-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}):e.jsx("p",{className:"text-white",children:S.phone||S.distributorPhone||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"FLYP ID:"}),e.jsx("p",{className:"text-emerald-400 font-mono text-xs",children:S.flypId||S.distributorId||S.id||"N/A"})]})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-5 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(rt,{})," Location Details"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Address:"}),h?e.jsx("textarea",{value:l.address||"",onChange:s=>x({...l,address:s.target.value}),rows:2,className:"w-full mt-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}):e.jsx("p",{className:"text-white",children:S.address||S.distributorAddress||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"City:"}),h?e.jsx("input",{type:"text",value:l.city||"",onChange:s=>x({...l,city:s.target.value}),className:"w-full mt-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}):e.jsx("p",{className:"text-white",children:S.city||S.distributorCity||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"State:"}),h?e.jsxs("select",{value:l.stateId||"",onChange:s=>{const c=Qe.find(D=>D.id===s.target.value);x({...l,stateId:s.target.value,state:c?c.name:l.state})},className:"w-full mt-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:[e.jsx("option",{value:"",children:"Select State"}),(v.length>0?v:Qe).map(s=>e.jsx("option",{value:s.id,className:"bg-slate-800",children:s.name},s.id))]}):e.jsx("p",{className:"text-white",children:S.state||S.distributorState||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Pincode:"}),h?e.jsx("input",{type:"text",maxLength:6,value:l.pincode||"",onChange:s=>x({...l,pincode:s.target.value.replace(/\D/g,"")}),className:"w-full mt-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}):e.jsx("p",{className:"text-white",children:S.pincode||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Territory:"}),h?e.jsx("input",{type:"text",value:l.territory||"",onChange:s=>x({...l,territory:s.target.value}),className:"w-full mt-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}):e.jsx("p",{className:"text-white",children:S.territory||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"GSTIN:"}),h?e.jsx("input",{type:"text",maxLength:15,value:l.gstin||"",onChange:s=>{let c=s.target.value.toUpperCase().replace(/[^0-9A-Z]/g,"");x({...l,gstin:c})},className:"w-full mt-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50 uppercase"}):e.jsx("p",{className:"text-white",children:S.gstin||"N/A"})]})]})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-5 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(Tt,{})," Connection Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Status:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs ${Ct(S.connectionStatus||"connected")}`,children:S.connectionStatus||"connected"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Connected:"}),e.jsx("p",{className:"text-white",children:S.connectedAt?.toDate?S.connectedAt.toDate().toLocaleDateString():S.connectedAt?new Date(S.connectedAt).toLocaleDateString():"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/50",children:"Connected By:"}),e.jsx("p",{className:"text-white",children:S.connectedBy||"N/A"})]})]})]}),S.attachments&&S.attachments.length>0&&e.jsxs("div",{className:"bg-white/5 rounded-xl p-5 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(Lt,{})," Attachments (",S.attachments.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:S.attachments.map((s,c)=>e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-3 bg-white/5 hover:bg-white/10 rounded-lg transition border border-white/10",children:[e.jsx(Lt,{className:"text-blue-400 text-xl"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium truncate",children:s.name}),e.jsxs("p",{className:"text-white/50 text-xs",children:[(s.size/1024/1024).toFixed(2)," MB"]})]})]},c))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white/5 rounded-xl p-5 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(ct,{})," Manual Notes"]}),h?e.jsx("textarea",{value:l.manualNotes||"",onChange:s=>x(c=>({...c,manualNotes:s.target.value})),placeholder:"Add any manual notes, agreements, or additional information about this distributor...",rows:6,className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}):e.jsx("div",{className:"p-4 bg-white/5 rounded-lg text-white/70 min-h-[120px] whitespace-pre-wrap",children:S.manualNotes||e.jsx("span",{className:"text-white/40 italic",children:"No notes added. Click Edit to add manual notes."})})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-5 border border-white/10",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:"Additional Information"}),h?e.jsx("textarea",{value:l.additionalInfo||"",onChange:s=>x(c=>({...c,additionalInfo:s.target.value})),placeholder:"Add any additional information about this distributor...",rows:4,className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}):e.jsx("div",{className:"p-4 bg-white/5 rounded-lg text-white/70 min-h-[100px] whitespace-pre-wrap",children:S.additionalInfo||e.jsx("span",{className:"text-white/40 italic",children:"No additional information added."})})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-5 border border-white/10",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Contract Details"}),h?e.jsx("textarea",{value:l.contractDetails||"",onChange:s=>x(c=>({...c,contractDetails:s.target.value})),placeholder:"Add contract details, terms, agreement information...",rows:4,className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}):e.jsx("div",{className:"p-4 bg-white/5 rounded-lg text-white/70 min-h-[100px] whitespace-pre-wrap",children:S.contractDetails||e.jsx("span",{className:"text-white/40 italic",children:"No contract details added."})})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-5 border border-white/10",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Payment Terms"}),h?e.jsx("textarea",{value:l.paymentTerms||"",onChange:s=>x(c=>({...c,paymentTerms:s.target.value})),placeholder:"Add payment terms, conditions, credit terms...",rows:4,className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}):e.jsx("div",{className:"p-4 bg-white/5 rounded-lg text-white/70 min-h-[100px] whitespace-pre-wrap",children:S.paymentTerms||e.jsx("span",{className:"text-white/40 italic",children:"No payment terms added."})})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-5 border border-white/10",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Special Instructions"}),h?e.jsx("textarea",{value:l.specialInstructions||"",onChange:s=>x(c=>({...c,specialInstructions:s.target.value})),placeholder:"Add special instructions, notes, or reminders about this distributor...",rows:4,className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}):e.jsx("div",{className:"p-4 bg-white/5 rounded-lg text-white/70 min-h-[100px] whitespace-pre-wrap",children:S.specialInstructions||e.jsx("span",{className:"text-white/40 italic",children:"No special instructions added."})})]})]})]})]})})})]})},Ys=({retailer:b,onClose:T,onSuccess:L})=>{const[q,g]=i.useState([{productName:"",quantity:1,unitPrice:0,notes:"",productId:null}]),[ce,B]=i.useState("COD"),[xe,me]=i.useState(15),[G,ee]=i.useState({cash:0,upi:0,card:0}),[te,E]=i.useState(0),[P,d]=i.useState("normal"),[ae,re]=i.useState(""),[O,_]=i.useState(!1),[m,k]=i.useState(!1),[V,we]=i.useState(!1),[Ce,pe]=i.useState([]),[oe,u]=i.useState(!1),[f,W]=i.useState(""),[K,r]=i.useState(null),N=a=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(a||0));i.useEffect(()=>{const a=Y.currentUser?.uid;if(!a)return;const h=Pe(U,`businesses/${a}/products`),t=Ye(h,l=>{const x=l.docs.map(v=>({id:v.id,...v.data()}));pe(x)});return()=>t()},[]);const Q=()=>q.reduce((a,h)=>a+parseFloat(h.quantity||0)*parseFloat(h.unitPrice||0),0),ie=Ce.filter(a=>{const h=f.toLowerCase(),t=(a.name||a.productName||"").toLowerCase(),l=(a.sku||"").toLowerCase(),x=(a.brand||"").toLowerCase(),v=(a.category||"").toLowerCase();return t.includes(h)||l.includes(h)||x.includes(h)||v.includes(h)}),o=a=>{const h=a.sellingPrice||a.mrp||a.costPrice||0,t={productName:a.name||a.productName||"",quantity:1,unitPrice:parseFloat(h),notes:a.description||"",productId:a.id,sku:a.sku||"",productData:a};g([...q,t]),u(!1),W(""),p.success(`${a.name||a.productName} added to order`)},M=a=>{r(a),u(!0)},C=a=>{const h=a.sellingPrice||a.mrp||a.costPrice||0,t=[...q];t[K]={productName:a.name||a.productName||"",quantity:t[K].quantity||1,unitPrice:parseFloat(h),notes:a.description||"",productId:a.id,sku:a.sku||"",productData:a},g(t),u(!1),r(null),W(""),p.success(`${a.name||a.productName} added to order`)},F=()=>{g([...q,{productName:"",quantity:1,unitPrice:0,notes:"",productId:null}])},ne=a=>{q.length>1&&g(q.filter((h,t)=>t!==a))},ve=(a,h,t)=>{const l=[...q];l[a]={...l[a],[h]:t},g(l)},Fe=a=>({code:a.toUpperCase(),label:a,isCredit:/credit/i.test(a),isSplit:a.toLowerCase()==="split",isAdvance:/advance/i.test(a),creditDays:/credit/i.test(a)?Number(xe||0):null,splitPayment:a.toLowerCase()==="split"?{...G}:null,advancePaid:/advance/i.test(a)?Number(te||0):null}),Le=async a=>{if(a.preventDefault(),!b?.retailerId){p.error("Retailer information missing");return}const h=Y.currentUser?.uid;if(!h){p.error("Please log in again");return}const t=q.filter(l=>l.productName.trim()&&l.quantity>0&&l.unitPrice>=0);if(t.length===0){p.error("Please add at least one valid item");return}if(ce.toLowerCase()==="split"){const l=G.cash+G.upi+G.card,x=Q();if(Math.abs(l-x)>.01){p.error("Split payment amounts must equal the order total");return}}if(ce.toLowerCase()==="credit"&&(!xe||xe<0)){p.error("Please specify credit days");return}_(!0);try{const l=de(U,"businesses",h),x=await Te(l),v=x.exists()?x.data():{},J=de(U,"businesses",b.retailerId),w=await Te(J),X=w.exists()?w.data():{},A=Q(),ye=de(Pe(U,`businesses/${b.retailerId}/productOwnerOrders`)).id,Ee=Fe(ce),We={orderId:ye,productOwnerId:h,retailerId:b.retailerId,createdBy:"productOwner",creatorUid:h,items:t.map(Be=>({productName:Be.productName.trim(),quantity:Number(Be.quantity),unitPrice:Number(Be.unitPrice),subtotal:Number(Be.quantity)*Number(Be.unitPrice),notes:Be.notes?.trim()||"",productId:Be.productId||null,sku:Be.sku||null})),itemsSubTotal:A,grandTotal:A,paymentMode:Ee.code,paymentModeLabel:Ee.label,paymentNormalized:Ee,creditDays:Ee.creditDays,splitPayment:Ee.splitPayment,advancePaid:Ee.advancePaid,paymentFlags:{isCredit:!!Ee.isCredit,isSplit:!!Ee.isSplit,isAdvance:!!Ee.isAdvance},priority:P||"normal",notes:ae.trim()||"",status:"ASSIGNED",statusCode:"ASSIGNED",productOwnerName:v.businessName||v.ownerName||Y.currentUser?.displayName||"Product Owner",productOwnerEmail:v.email||Y.currentUser?.email||"",productOwnerPhone:v.phone||Y.currentUser?.phoneNumber||"",productOwnerId:h,retailerName:b.businessName||b.retailerName||X.businessName||"",retailerEmail:b.retailerEmail||b.email||X.email||"",retailerPhone:b.retailerPhone||b.phone||X.phone||"",retailerCity:b.retailerCity||b.city||X.city||"",retailerState:b.retailerState||b.state||X.state||"",retailerAddress:b.retailerAddress||b.address||X.address||"",createdAt:je(),timestamp:je(),statusTimestamps:{assignedAt:je()},statusHistory:[{status:"ASSIGNED",updatedAt:zt.now(),updatedBy:h,updatedByName:v.businessName||v.ownerName||Y.currentUser?.displayName||"Product Owner",notes:"Order assigned to retailer by product owner"}]};await it(de(U,`businesses/${b.retailerId}/productOwnerOrders/${ye}`),We),await it(de(U,`businesses/${h}/assignedOrdersToRetailers/${ye}`),{...We}),p.success("Order assigned to retailer successfully!"),L&&L(),T&&T()}catch(l){console.error("Error assigning order:",l),p.error("Failed to assign order. Please try again.")}finally{_(!1)}},S=Q();return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: rgba(255, 255, 255, 0.05);
          border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: rgba(16, 185, 129, 0.3);
          border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: rgba(16, 185, 129, 0.5);
        }
      `}),e.jsxs(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:T,children:[e.jsxs(y.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:a=>a.stopPropagation(),className:"bg-slate-900 rounded-xl border border-white/10 w-full max-w-3xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"sticky top-0 bg-slate-900/95 backdrop-blur-md border-b border-white/10 p-6 flex items-center justify-between z-10",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Assign Order to ",b?.businessName||b?.retailerName||"Retailer"]}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Create a new order assignment"})]}),e.jsx("button",{onClick:T,className:"p-2 rounded-lg hover:bg-white/10 text-white/70 hover:text-white transition",children:e.jsx(Ge,{})})]}),e.jsxs("form",{onSubmit:Le,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:"Order Items"}),e.jsx("p",{className:"text-sm text-white/60",children:"Add products from inventory or enter manually"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{r(null),u(!0)},className:"px-4 py-2.5 bg-gradient-to-r from-blue-500/20 to-blue-400/20 hover:from-blue-500/30 hover:to-blue-400/30 border border-blue-400/30 rounded-lg text-blue-300 text-sm font-medium transition-all hover:scale-105 hover:shadow-lg hover:shadow-blue-500/20 flex items-center gap-2",children:[e.jsx(Me,{className:"text-sm"})," Select from Inventory"]}),e.jsxs("button",{type:"button",onClick:F,className:"px-4 py-2.5 bg-gradient-to-r from-emerald-500/20 to-emerald-400/20 hover:from-emerald-500/30 hover:to-emerald-400/30 border border-emerald-400/30 rounded-lg text-emerald-300 text-sm font-medium transition-all hover:scale-105 hover:shadow-lg hover:shadow-emerald-500/20 flex items-center gap-2",children:[e.jsx(st,{className:"text-sm"})," Add Manual Item"]})]})]}),e.jsx("div",{className:"space-y-3",children:q.map((a,h)=>e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},className:"group relative p-4 bg-gradient-to-br from-white/5 to-white/[0.02] rounded-xl border border-white/10 hover:border-emerald-400/30 transition-all duration-300 shadow-lg hover:shadow-emerald-500/10",children:[a.productId&&e.jsxs("div",{className:"absolute top-3 right-3 px-2.5 py-1 bg-gradient-to-r from-emerald-500/20 to-emerald-400/20 border border-emerald-400/40 rounded-lg text-xs text-emerald-300 flex items-center gap-1.5 font-medium shadow-lg shadow-emerald-500/20",children:[e.jsx(Me,{className:"text-[10px]"})," From Inventory"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-3",children:[e.jsxs("div",{className:"col-span-12 md:col-span-5",children:[e.jsx("label",{className:"block text-xs font-medium text-white/60 mb-1.5",children:"Product Name *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Enter product name",value:a.productName,onChange:t=>ve(h,"productName",t.target.value),className:"flex-1 px-4 py-2.5 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all",required:!0}),!a.productId&&e.jsx("button",{type:"button",onClick:()=>M(h),className:"px-4 py-2.5 bg-gradient-to-r from-blue-500/20 to-blue-400/20 hover:from-blue-500/30 hover:to-blue-400/30 border border-blue-400/30 rounded-lg text-blue-300 text-sm transition-all hover:scale-105 hover:shadow-lg hover:shadow-blue-500/20",title:"Select from Inventory",children:e.jsx(Me,{})})]}),a.sku&&e.jsxs("p",{className:"text-xs text-emerald-400/80 mt-1.5 flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"SKU:"})," ",a.sku]})]}),e.jsxs("div",{className:"col-span-6 md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-white/60 mb-1.5",children:"Quantity *"}),e.jsx("input",{type:"number",placeholder:"1",value:a.quantity,onChange:t=>ve(h,"quantity",t.target.value),min:"1",className:"w-full px-4 py-2.5 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all",required:!0})]}),e.jsxs("div",{className:"col-span-6 md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-white/60 mb-1.5",children:"Unit Price (₹) *"}),e.jsx("input",{type:"number",placeholder:"0.00",value:a.unitPrice,onChange:t=>ve(h,"unitPrice",t.target.value),min:"0",step:"0.01",className:"w-full px-4 py-2.5 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all",required:!0})]}),e.jsxs("div",{className:"col-span-6 md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-white/60 mb-1.5",children:"Subtotal"}),e.jsx("div",{className:"px-4 py-2.5 bg-gradient-to-r from-emerald-500/10 to-emerald-400/10 border border-emerald-400/20 rounded-lg text-emerald-300 font-semibold text-center",children:N(a.quantity*a.unitPrice)})]}),e.jsx("div",{className:"col-span-6 md:col-span-1 flex items-end",children:q.length>1&&e.jsx("button",{type:"button",onClick:()=>ne(h),className:"w-full px-4 py-2.5 bg-red-500/10 hover:bg-red-500/20 border border-red-400/30 rounded-lg text-red-300 transition-all hover:scale-105 hover:shadow-lg hover:shadow-red-500/20",title:"Remove item",children:e.jsx(nt,{})})})]})]},h))}),e.jsxs(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"mt-6 p-5 bg-gradient-to-r from-emerald-500/10 via-emerald-400/10 to-emerald-500/10 border border-emerald-400/30 rounded-xl shadow-lg shadow-emerald-500/10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-white/80 font-semibold text-lg",children:"Order Total:"}),e.jsx("span",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-300 to-emerald-400",children:N(S)})]}),e.jsxs("p",{className:"text-xs text-white/50 mt-2",children:[q.length," item",q.length!==1?"s":""," in order"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Payment Mode *"}),e.jsxs("select",{value:ce,onChange:a=>{B(a.target.value),a.target.value.toLowerCase()==="split"?k(!0):a.target.value.toLowerCase()==="credit"&&we(!0)},className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",required:!0,children:[e.jsx("option",{value:"COD",children:"Cash on Delivery (COD)"}),e.jsx("option",{value:"PREPAID",children:"Prepaid"}),e.jsx("option",{value:"CREDIT",children:"Credit"}),e.jsx("option",{value:"SPLIT",children:"Split Payment"}),e.jsx("option",{value:"ADVANCE",children:"Advance Payment"})]})]}),ce.toLowerCase()==="credit"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Credit Days *"}),e.jsx("input",{type:"number",value:xe,onChange:a=>me(a.target.value),min:"0",className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",required:!0})]}),e.jsx(De,{children:m&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] flex items-center justify-center p-4",onClick:()=>k(!1),children:e.jsxs(y.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},onClick:a=>a.stopPropagation(),className:"bg-slate-800 rounded-xl border border-white/10 p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Split Payment"}),e.jsxs("p",{className:"text-white/70 text-sm mb-4",children:["Total: ",N(S)]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Cash (₹)"}),e.jsx("input",{type:"number",value:G.cash,onChange:a=>ee({...G,cash:a.target.value}),min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"UPI (₹)"}),e.jsx("input",{type:"number",value:G.upi,onChange:a=>ee({...G,upi:a.target.value}),min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Card (₹)"}),e.jsx("input",{type:"number",value:G.card,onChange:a=>ee({...G,card:a.target.value}),min:"0",step:"0.01",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white"})]})]}),e.jsx("div",{className:"flex gap-3 mt-6",children:e.jsx("button",{type:"button",onClick:()=>k(!1),className:"flex-1 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",children:"Done"})})]})})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Priority"}),e.jsxs("select",{value:P,onChange:a=>d(a.target.value),className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Notes"}),e.jsx("textarea",{value:ae,onChange:a=>re(a.target.value),rows:3,className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"Additional notes or instructions..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-white/10",children:[e.jsx("button",{type:"button",onClick:T,className:"flex-1 px-4 py-3 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:O,className:"flex-1 px-4 py-3 bg-emerald-500 hover:bg-emerald-600 disabled:bg-emerald-500/50 disabled:cursor-not-allowed rounded-lg text-white font-semibold transition",children:O?"Assigning...":"Assign Order"})]})]})]}),e.jsx(De,{children:oe&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] flex items-center justify-center p-4",onClick:()=>{u(!1),r(null),W("")},children:e.jsxs(y.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:a=>a.stopPropagation(),className:"bg-slate-900 rounded-xl border border-white/10 w-full max-w-4xl max-h-[80vh] overflow-hidden shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-slate-900/98 via-slate-800/95 to-slate-900/98 backdrop-blur-xl border-b border-white/10 p-5 flex items-center justify-between z-10 shadow-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-emerald-300",children:"Select from Inventory"}),e.jsx("p",{className:"text-white/60 text-sm mt-1.5",children:K!==null?"Select a product to replace this item":"Browse and select products to add to your order"})]}),e.jsx("button",{onClick:()=>{u(!1),r(null),W("")},className:"p-2.5 rounded-lg hover:bg-white/10 text-white/70 hover:text-white transition-all hover:scale-110",children:e.jsx(Ge,{className:"text-lg"})})]}),e.jsxs("div",{className:"p-4 border-b border-white/10 bg-gradient-to-r from-white/5 to-transparent",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/50 text-lg"}),e.jsx("input",{type:"text",placeholder:"Search products by name, SKU, brand, or category...",value:f,onChange:a=>W(a.target.value),className:"w-full pl-12 pr-4 py-3 bg-white/10 border-2 border-white/20 rounded-xl text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all shadow-lg",autoFocus:!0}),f&&e.jsx("button",{onClick:()=>W(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 hover:bg-white/10 rounded-lg text-white/50 hover:text-white transition",children:e.jsx(Ge,{className:"text-sm"})})]}),ie.length>0&&e.jsxs("p",{className:"text-xs text-white/50 mt-2 ml-1",children:[ie.length," product",ie.length!==1?"s":""," found"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:ie.length===0?e.jsxs(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center py-16 text-white/60",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-white/5 mb-4",children:e.jsx(Me,{className:"text-4xl opacity-50"})}),e.jsx("p",{className:"text-xl font-semibold mb-2 text-white/80",children:f?"No products found":"No products in inventory"}),e.jsx("p",{className:"text-sm text-white/50",children:f?"Try a different search term":"Add products to your inventory first"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ie.map((a,h)=>{const t=a.sellingPrice||a.mrp||a.costPrice||0,l=a.quantity||0,x=l<=0;return e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:h*.05},className:`group relative p-5 rounded-xl border-2 cursor-pointer transition-all duration-300 ${x?"bg-gradient-to-br from-red-500/10 to-red-500/5 border-red-400/30 opacity-60 cursor-not-allowed":"bg-gradient-to-br from-white/5 to-white/[0.02] border-white/10 hover:border-emerald-400/50 hover:bg-gradient-to-br hover:from-emerald-500/10 hover:to-emerald-400/5 hover:shadow-xl hover:shadow-emerald-500/20 hover:scale-[1.02]"}`,onClick:()=>{x||(K!==null?C(a):o(a))},children:[a.images&&a.images[0]?e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-white/5",children:e.jsx("img",{src:a.images[0],alt:a.name||a.productName,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg bg-gradient-to-br from-white/10 to-white/5 flex items-center justify-center",children:e.jsx(Me,{className:"text-3xl text-white/30"})}),x?e.jsx("div",{className:"absolute top-3 right-3 px-2.5 py-1 bg-red-500/20 border border-red-400/40 rounded-lg text-xs text-red-300 font-medium shadow-lg",children:"Out of Stock"}):l<10&&e.jsx("div",{className:"absolute top-3 right-3 px-2.5 py-1 bg-yellow-500/20 border border-yellow-400/40 rounded-lg text-xs text-yellow-300 font-medium shadow-lg",children:"Low Stock"}),e.jsx("h4",{className:"font-bold text-white text-lg mb-2 line-clamp-2 group-hover:text-emerald-300 transition-colors",children:a.name||a.productName||"Unnamed Product"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[a.sku&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white/50 font-medium",children:"SKU:"}),e.jsx("span",{className:"text-white/80",children:a.sku})]}),a.brand&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white/50 font-medium",children:"Brand:"}),e.jsx("span",{className:"text-white/80",children:a.brand})]}),a.category&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white/50 font-medium",children:"Category:"}),e.jsx("span",{className:"text-white/80",children:a.category})]}),e.jsxs("div",{className:"pt-3 mt-3 border-t border-white/10 flex justify-between items-end",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/50 mb-1",children:"Available Stock"}),e.jsxs("p",{className:"text-sm font-semibold text-white/90",children:[l," ",e.jsx("span",{className:"text-xs text-white/60",children:a.unit||"units"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-white/50 mb-1",children:"Price"}),e.jsx("p",{className:"text-lg font-bold text-emerald-400",children:N(t)}),a.mrp&&a.mrp!==t&&e.jsx("p",{className:"text-xs text-white/50 line-through",children:N(a.mrp)})]})]})]}),!x&&e.jsx("div",{className:"absolute inset-0 bg-emerald-500/0 group-hover:bg-emerald-500/10 rounded-xl flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300",children:e.jsx("div",{className:"px-4 py-2 bg-emerald-500/90 hover:bg-emerald-500 rounded-lg text-white font-semibold text-sm shadow-lg transform scale-90 group-hover:scale-100 transition-transform",children:K!==null?"Replace Item":"Add to Order"})})]},a.id)})})})]})})})]})]})},Ws=()=>{const[b,T]=i.useState("connected"),[L,q]=i.useState([]),[g,ce]=i.useState(""),[B,xe]=i.useState(!1),[me,G]=i.useState(!1),[ee,te]=i.useState(null),[E,P]=i.useState([]),[d,ae]=i.useState(!0),[re,O]=i.useState(null);i.useEffect(()=>{(async()=>{const f=Y.currentUser?.uid;if(f)try{const W=de(U,"businesses",f),K=await Te(W);K.exists()&&O(K.data())}catch(W){console.error("Error fetching user data:",W)}})()},[]);const _=async()=>{const u=Y.currentUser?.uid;if(u){ae(!0);try{const f=Pe(U,`businesses/${u}/connectedRetailers`),W=await $e(f),K=[],r=W.docs.map(async o=>{const M=o.data(),C=M.retailerId||o.id;try{const F=de(U,"businesses",C),ne=await Te(F);return ne.exists()?{id:o.id,retailerId:C,...ne.data(),...M,connectionStatus:M.status||"connected",connectedAt:M.connectedAt}:{id:o.id,retailerId:C,...M,connectionStatus:M.status||"connected"}}catch(F){return console.error("Error fetching retailer details:",F),{id:o.id,retailerId:C,...M}}});K.push(...await Promise.all(r)),q(K);const N=Pe(U,`businesses/${u}/assignedOrdersToRetailers`),ie=(await $e(N)).docs.map(o=>({id:o.id,...o.data()}));ie.sort((o,M)=>{const C=o.createdAt?.toDate?o.createdAt.toDate().getTime():o.timestamp?.toDate?o.timestamp.toDate().getTime():0;return(M.createdAt?.toDate?M.createdAt.toDate().getTime():M.timestamp?.toDate?M.timestamp.toDate().getTime():0)-C}),P(ie)}catch(f){console.error("Error fetching retailers:",f),p.error("Failed to refresh retailers list")}finally{ae(!1)}}};i.useEffect(()=>{_()},[]),i.useEffect(()=>{const u=Y.currentUser?.uid;if(!u)return;const f=Pe(U,`businesses/${u}/assignedOrdersToRetailers`),W=Ye(f,K=>{const r=K.docs.map(N=>({id:N.id,...N.data()}));r.sort((N,Q)=>{const ie=N.createdAt?.toDate?N.createdAt.toDate().getTime():N.timestamp?.toDate?N.timestamp.toDate().getTime():0;return(Q.createdAt?.toDate?Q.createdAt.toDate().getTime():Q.timestamp?.toDate?Q.timestamp.toDate().getTime():0)-ie}),P(r)},K=>{console.error("Error listening to orders:",K),p.error("Failed to load orders. Please refresh.")});return()=>W()},[]),i.useEffect(()=>{const u=Y.currentUser?.uid;if(!u||L.length===0)return;const f=[];return L.map(K=>K.retailerId||K.id).filter(Boolean).forEach(K=>{const r=de(U,"businesses",K),N=Ye(r,async Q=>{if(!Q.exists())return;const ie=Q.data();try{const o=de(U,`businesses/${u}/connectedRetailers/${K}`),M=await Te(o),C=M.exists()?M.data():{},F={profileSyncedAt:je()};(ie.businessName||C.retailerName)&&(F.retailerName=ie.businessName||C.retailerName),(ie.email||C.retailerEmail)&&(F.retailerEmail=ie.email||C.retailerEmail),(ie.phone||C.retailerPhone)&&(F.retailerPhone=ie.phone||C.retailerPhone),(ie.address||C.retailerAddress)&&(F.retailerAddress=ie.address||C.retailerAddress),(ie.city||C.retailerCity)&&(F.retailerCity=ie.city||C.retailerCity),(ie.state||C.retailerState)&&(F.retailerState=ie.state||C.retailerState),(F.retailerName!==C.retailerName||F.retailerEmail!==C.retailerEmail||F.retailerPhone!==C.retailerPhone||F.retailerAddress!==C.retailerAddress||F.retailerCity!==C.retailerCity||F.retailerState!==C.retailerState)&&(await qe(o,F),await _())}catch(o){console.error(`Error syncing retailer ${K} profile:`,o)}},Q=>{console.error(`Error listening to retailer ${K} profile:`,Q)});f.push(N)}),()=>{f.forEach(K=>K())}},[L.map(u=>u.retailerId||u.id).filter(Boolean).join(",")]);const m=i.useMemo(()=>{if(!g.trim())return L;const u=g.toLowerCase();return L.filter(f=>(f.businessName||f.retailerName||"").toLowerCase().includes(u)||(f.ownerName||"").toLowerCase().includes(u)||(f.email||f.retailerEmail||"").toLowerCase().includes(u)||(f.phone||f.retailerPhone||"").toLowerCase().includes(u)||(f.city||f.retailerCity||"").toLowerCase().includes(u)||(f.state||f.retailerState||"").toLowerCase().includes(u))},[L,g]),k=i.useMemo(()=>{if(!g.trim())return E;const u=g.toLowerCase();return E.filter(f=>(f.orderId||f.id||"").toLowerCase().includes(u)||(f.retailerName||"").toLowerCase().includes(u)||(f.retailerEmail||"").toLowerCase().includes(u)||(f.status||"").toLowerCase().includes(u))},[E,g]),V=async u=>{const f=Y.currentUser?.uid;if(f)try{if(u?.retailerId){const W=de(U,`businesses/${f}/connectedRetailers/${u.retailerId}`),K={createdBy:"productowner",productOwnerId:f,updatedAt:je()};await it(W,K,{merge:!0})}else u?.payload&&console.log("Retailer created with payload:",u.payload);await _(),p.success("Retailer created successfully!")}catch(W){console.error("Error creating retailer:",W);const K=W.message||"Failed to create retailer";p.error(K)}},we=u=>{te(u),G(!0)},Ce=()=>{_(),G(!1),te(null)},pe=u=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(u||0)),oe=u=>{const f=(u||"").toLowerCase();return f.includes("assigned")||f.includes("pending")?"text-yellow-400 bg-yellow-400/20 border-yellow-400/30":f.includes("accepted")||f.includes("processing")?"text-blue-400 bg-blue-400/20 border-blue-400/30":f.includes("dispatched")||f.includes("shipped")?"text-purple-400 bg-purple-400/20 border-purple-400/30":f.includes("delivered")||f.includes("completed")?"text-emerald-400 bg-emerald-400/20 border-emerald-400/30":f.includes("cancelled")||f.includes("rejected")?"text-red-400 bg-red-400/20 border-red-400/30":"text-white/60 bg-white/5 border-white/10"};return e.jsxs("div",{className:"space-y-6 text-white",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-300 to-cyan-300",children:"Retailer Management"}),e.jsx("p",{className:"text-white/60 mt-1",children:"Manage retailers and assign orders directly"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:()=>xe(!0),className:"px-4 py-2.5 bg-gradient-to-r from-emerald-500 to-cyan-500 hover:from-emerald-400 hover:to-cyan-400 text-white rounded-lg font-semibold transition-all hover:scale-105 hover:shadow-lg hover:shadow-emerald-500/20 flex items-center gap-2",children:[e.jsx(jt,{})," Add Retailer"]})})]}),e.jsxs("div",{className:"flex gap-2 border-b border-white/10",children:[e.jsxs("button",{onClick:()=>T("connected"),className:`px-6 py-3 font-medium transition-all relative ${b==="connected"?"text-emerald-300 border-b-2 border-emerald-400":"text-white/60 hover:text-white/80"}`,children:[e.jsx(dt,{className:"inline mr-2"}),"Connected Retailers (",L.length,")"]}),e.jsxs("button",{onClick:()=>T("orders"),className:`px-6 py-3 font-medium transition-all relative ${b==="orders"?"text-emerald-300 border-b-2 border-emerald-400":"text-white/60 hover:text-white/80"}`,children:[e.jsx(ft,{className:"inline mr-2"}),"Orders (",E.length,")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/50"}),e.jsx("input",{type:"text",placeholder:`Search ${b==="connected"?"retailers":"orders"}...`,value:g,onChange:u=>ce(u.target.value),className:"w-full pl-12 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 focus:border-emerald-400/50 transition-all"})]}),d?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(at,{className:"text-4xl text-emerald-400 animate-spin"})}):b==="connected"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.length===0?e.jsxs("div",{className:"col-span-full text-center py-20",children:[e.jsx(dt,{className:"text-6xl text-white/20 mx-auto mb-4"}),e.jsx("p",{className:"text-white/60 text-lg",children:"No retailers found"}),e.jsx("p",{className:"text-white/40 text-sm mt-2",children:g?"Try a different search term":"Create your first retailer to get started"})]}):m.map(u=>e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-5 rounded-xl border border-white/10 bg-gradient-to-br from-white/5 to-white/[0.02] hover:border-emerald-400/30 transition-all duration-300 shadow-lg hover:shadow-emerald-500/10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:u.businessName||u.retailerName||"Unnamed Retailer"}),u.ownerName&&e.jsx("p",{className:"text-sm text-white/60",children:u.ownerName})]}),e.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs font-medium ${u.connectionStatus==="connected"||u.connectionStatus==="active"?"bg-emerald-400/20 text-emerald-300 border border-emerald-400/30":"bg-yellow-400/20 text-yellow-300 border border-yellow-400/30"}`,children:u.connectionStatus||"connected"})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[u.retailerEmail&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/70",children:[e.jsx(vt,{className:"text-xs"}),e.jsx("span",{className:"truncate",children:u.retailerEmail})]}),u.retailerPhone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/70",children:[e.jsx(gs,{className:"text-xs"}),e.jsx("span",{children:u.retailerPhone})]}),(u.retailerCity||u.retailerState)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/70",children:[e.jsx(bs,{className:"text-xs"}),e.jsx("span",{children:[u.retailerCity,u.retailerState].filter(Boolean).join(", ")})]})]}),e.jsx("div",{className:"flex gap-2 pt-4 border-t border-white/10",children:e.jsxs("button",{onClick:()=>we(u),className:"flex-1 px-4 py-2 bg-gradient-to-r from-emerald-500/20 to-cyan-500/20 hover:from-emerald-500/30 hover:to-cyan-500/30 border border-emerald-400/30 rounded-lg text-emerald-300 text-sm font-medium transition-all hover:scale-105",children:[e.jsx(ft,{className:"inline mr-2"}),"Assign Order"]})})]},u.id))}):e.jsx("div",{className:"space-y-4",children:k.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx(ft,{className:"text-6xl text-white/20 mx-auto mb-4"}),e.jsx("p",{className:"text-white/60 text-lg",children:"No orders found"}),e.jsx("p",{className:"text-white/40 text-sm mt-2",children:g?"Try a different search term":"Assign your first order to a retailer"})]}):k.map(u=>e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-5 rounded-xl border border-white/10 bg-gradient-to-br from-white/5 to-white/[0.02] hover:border-emerald-400/30 transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h3",{className:"text-lg font-bold text-white",children:["Order #",u.orderId||u.id?.slice(0,8)||"N/A"]}),e.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs font-medium border ${oe(u.status)}`,children:u.status||"ASSIGNED"})]}),e.jsxs("p",{className:"text-sm text-white/60 mb-1",children:[e.jsx(dt,{className:"inline mr-2"}),u.retailerName||"Unknown Retailer"]}),u.retailerEmail&&e.jsxs("p",{className:"text-xs text-white/50",children:[e.jsx(vt,{className:"inline mr-2"}),u.retailerEmail]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xl font-bold text-emerald-300",children:pe(u.grandTotal||u.itemsSubTotal||0)}),e.jsxs("p",{className:"text-xs text-white/50 mt-1",children:[u.items?.length||0," item",(u.items?.length||0)!==1?"s":""]})]})]}),u.items&&u.items.length>0&&e.jsxs("div",{className:"mb-4 p-3 bg-white/5 rounded-lg border border-white/10",children:[e.jsx("p",{className:"text-xs text-white/60 mb-2 font-medium",children:"Order Items:"}),e.jsxs("div",{className:"space-y-1",children:[u.items.slice(0,3).map((f,W)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-white/80",children:[f.productName," × ",f.quantity]}),e.jsx("span",{className:"text-white/60",children:pe(f.subtotal||f.quantity*f.unitPrice)})]},W)),u.items.length>3&&e.jsxs("p",{className:"text-xs text-white/50 mt-1",children:["+",u.items.length-3," more item",u.items.length-3!==1?"s":""]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-white/10",children:[e.jsx("div",{className:"text-xs text-white/50",children:u.createdAt?.toDate?e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"inline mr-1"}),u.createdAt.toDate().toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})]}):"Date not available"}),e.jsxs("div",{className:"text-xs text-white/60",children:["Payment: ",u.paymentModeLabel||u.paymentMode||"N/A"]})]})]},u.id))}),e.jsx(Us,{open:B,onClose:()=>xe(!1),distributorId:Y.currentUser?.uid,createdBy:{type:"productowner",id:Y.currentUser?.uid,name:re?.businessName||re?.ownerName||"Product Owner"},onCreated:V,toast:({type:u,message:f})=>{u==="success"?p.success(f):u==="error"?p.error(f):p.info(f)},uiVariant:"centered"}),e.jsx(De,{children:me&&ee&&e.jsx(Ys,{retailer:ee,onClose:()=>{G(!1),te(null)},onSuccess:Ce})})]})},Qs=()=>{const[b,T]=i.useState("view"),[L,q]=i.useState([]),[g,ce]=i.useState([]),[B,xe]=i.useState(""),[me,G]=i.useState("all"),[ee,te]=i.useState("all"),[E,P]=i.useState(!1),[d,ae]=i.useState(null),[re,O]=i.useState(!0),[_,m]=i.useState("grid"),[k,V]=i.useState("name"),[we,Ce]=i.useState("asc"),[pe,oe]=i.useState(!1),[u,f]=i.useState([]),[W,K]=i.useState(!1),[r,N]=i.useState({name:"",sku:"",category:"",quantity:"",unit:"units",costPrice:"",sellingPrice:"",mrp:"",productionStatus:"inMaking",description:"",brand:"",hsn:"",gst:"",barcode:"",weight:"",weightUnit:"kg",dimensions:{length:"",width:"",height:"",unit:"cm"},supplier:"",supplierCode:"",expiryDate:"",batchNumber:"",location:"",minStockLevel:"",maxStockLevel:"",tags:"",color:"",size:"",material:""});i.useEffect(()=>{(async()=>{const l=Y.currentUser?.uid;if(l){O(!0);try{const x=Pe(U,`businesses/${l}/products`),v=Ye(x,J=>{const w=J.docs.map(X=>({id:X.id,...X.data()}));q(w),ce(w),O(!1)});return()=>v()}catch(x){console.error("Error fetching products:",x),p.error("Failed to load products"),O(!1)}}})()},[]),i.useEffect(()=>{let t=[...L];if(B){const l=B.toLowerCase();t=t.filter(x=>(x.name||x.productName||"").toLowerCase().includes(l)||(x.sku||"").toLowerCase().includes(l)||(x.brand||"").toLowerCase().includes(l)||(x.category||"").toLowerCase().includes(l)||(x.barcode||"").toLowerCase().includes(l))}me!=="all"&&(t=t.filter(l=>(l.productionStatus||l.status||"inMaking")===me)),ee!=="all"&&(t=t.filter(l=>(l.category||"")===ee)),t.sort((l,x)=>{let v,J;switch(k){case"name":v=(l.name||l.productName||"").toLowerCase(),J=(x.name||x.productName||"").toLowerCase();break;case"quantity":v=Number(l.quantity||0),J=Number(x.quantity||0);break;case"costPrice":v=Number(l.costPrice||l.cost||0),J=Number(x.costPrice||x.cost||0);break;case"sellingPrice":v=Number(l.sellingPrice||l.price||0),J=Number(x.sellingPrice||x.price||0);break;case"createdAt":v=l.createdAt?.toDate?.()?.getTime()||0,J=x.createdAt?.toDate?.()?.getTime()||0;break;default:return 0}return typeof v=="string"?we==="asc"?v.localeCompare(J):J.localeCompare(v):we==="asc"?v-J:J-v}),ce(t)},[B,me,ee,L,k,we]);const Q=async t=>{if(!t||t.length===0)return;oe(!0);const l=Y.currentUser?.uid;if(!l){p.error("User not authenticated"),oe(!1);return}try{const x=[];for(let v=0;v<Math.min(t.length,5);v++){const J=t[v];if(J.size>5*1024*1024){p.warning(`Image ${J.name} is too large (max 5MB)`);continue}const w=Gt(as,`products/${l}/${Date.now()}_${J.name}`);await Kt(w,J);const X=await Ht(w);x.push(X)}f([...u,...x]),p.success(`${x.length} image(s) uploaded successfully`)}catch(x){console.error("Error uploading images:",x),p.error("Failed to upload images")}finally{oe(!1)}},ie=t=>{f(u.filter((l,x)=>x!==t))},o=t=>Object.fromEntries(Object.entries(t).filter(([l,x])=>x!==void 0)),M=async t=>{t.preventDefault();const l=Y.currentUser?.uid;if(!l){p.error("User not authenticated");return}if(!r.name.trim()){p.error("Product name is required");return}try{oe(!0);const x={name:r.name,productName:r.name,sku:r.sku||`SKU-${Date.now()}`,category:r.category,quantity:Number(r.quantity)||0,unit:r.unit,costPrice:Number(r.costPrice)||0,cost:Number(r.costPrice)||0,sellingPrice:Number(r.sellingPrice)||0,price:Number(r.sellingPrice)||0,mrp:r.mrp?Number(r.mrp):void 0,productionStatus:r.productionStatus,status:r.productionStatus,description:r.description,brand:r.brand,hsn:r.hsn||void 0,hsnCode:r.hsn||void 0,gst:r.gst?Number(r.gst):void 0,taxRate:r.gst?Number(r.gst):void 0,imageUrl:u[0]||void 0,imageUrls:u.length>0?u:void 0,barcode:r.barcode||void 0,weight:r.weight?Number(r.weight):void 0,weightUnit:r.weightUnit,dimensions:r.dimensions?.length||r.dimensions?.width||r.dimensions?.height?r.dimensions:void 0,supplier:r.supplier||void 0,supplierCode:r.supplierCode||void 0,expiryDate:r.expiryDate||void 0,batchNumber:r.batchNumber||void 0,location:r.location||void 0,minStockLevel:r.minStockLevel?Number(r.minStockLevel):void 0,maxStockLevel:r.maxStockLevel?Number(r.maxStockLevel):void 0,tags:r.tags?r.tags.split(",").map(J=>J.trim()):void 0,color:r.color||void 0,size:r.size||void 0,material:r.material||void 0,createdAt:je(),updatedAt:je()},v=o(x);await pt(Pe(U,`businesses/${l}/products`),v),p.success("Product added successfully!"),P(!1),ve()}catch(x){console.error("Error adding product:",x),p.error("Failed to add product. Please try again.")}finally{oe(!1)}},C=async t=>{if(t.preventDefault(),!d)return;const l=Y.currentUser?.uid;if(l)try{oe(!0);const x=de(U,`businesses/${l}/products`,d.id),v={name:r.name,productName:r.name,sku:r.sku,category:r.category,quantity:Number(r.quantity)||0,unit:r.unit,costPrice:Number(r.costPrice)||0,cost:Number(r.costPrice)||0,sellingPrice:Number(r.sellingPrice)||0,price:Number(r.sellingPrice)||0,mrp:r.mrp?Number(r.mrp):void 0,productionStatus:r.productionStatus,status:r.productionStatus,description:r.description,brand:r.brand,hsn:r.hsn||void 0,hsnCode:r.hsn||void 0,gst:r.gst?Number(r.gst):void 0,taxRate:r.gst?Number(r.gst):void 0,imageUrl:u[0]||d.imageUrl||void 0,imageUrls:u.length>0?u:d.imageUrls||void 0,barcode:r.barcode||void 0,weight:r.weight?Number(r.weight):void 0,weightUnit:r.weightUnit,dimensions:r.dimensions?.length||r.dimensions?.width||r.dimensions?.height?r.dimensions:void 0,supplier:r.supplier||void 0,supplierCode:r.supplierCode||void 0,expiryDate:r.expiryDate||void 0,batchNumber:r.batchNumber||void 0,location:r.location||void 0,minStockLevel:r.minStockLevel?Number(r.minStockLevel):void 0,maxStockLevel:r.maxStockLevel?Number(r.maxStockLevel):void 0,tags:r.tags?r.tags.split(",").map(w=>w.trim()):void 0,color:r.color||void 0,size:r.size||void 0,material:r.material||void 0,updatedAt:je()},J=o(v);await qe(x,J),p.success("Product updated successfully!"),ae(null),P(!1),ve()}catch(x){console.error("Error updating product:",x),p.error("Failed to update product. Please try again.")}finally{oe(!1)}},F=async(t,l)=>{if(!window.confirm(`Are you sure you want to delete "${l}"? This action cannot be undone.`))return;const x=Y.currentUser?.uid;if(x)try{await _t(de(U,`businesses/${x}/products`,t)),p.success("Product deleted successfully!")}catch(v){console.error("Error deleting product:",v),p.error("Failed to delete product. Please try again.")}},ne=t=>{ae(t);const l=t.imageUrls||(t.imageUrl?[t.imageUrl]:[]);f(l),N({name:t.name||t.productName||"",sku:t.sku||"",category:t.category||"",quantity:t.quantity||"",unit:t.unit||"units",costPrice:t.costPrice||t.cost||"",sellingPrice:t.sellingPrice||t.price||"",mrp:t.mrp||"",productionStatus:t.productionStatus||t.status||"inMaking",description:t.description||"",brand:t.brand||"",hsn:t.hsn||t.hsnCode||"",gst:t.gst||t.taxRate||"",barcode:t.barcode||"",weight:t.weight||"",weightUnit:t.weightUnit||"kg",dimensions:t.dimensions||{length:"",width:"",height:"",unit:"cm"},supplier:t.supplier||"",supplierCode:t.supplierCode||"",expiryDate:t.expiryDate||"",batchNumber:t.batchNumber||"",location:t.location||"",minStockLevel:t.minStockLevel||"",maxStockLevel:t.maxStockLevel||"",tags:t.tags?t.tags.join(", "):"",color:t.color||"",size:t.size||"",material:t.material||""}),P(!0)},ve=()=>{N({name:"",sku:"",category:"",quantity:"",unit:"units",costPrice:"",sellingPrice:"",mrp:"",productionStatus:"inMaking",description:"",brand:"",hsn:"",gst:"",barcode:"",weight:"",weightUnit:"kg",dimensions:{length:"",width:"",height:"",unit:"cm"},supplier:"",supplierCode:"",expiryDate:"",batchNumber:"",location:"",minStockLevel:"",maxStockLevel:"",tags:"",color:"",size:"",material:""}),f([]),K(!1)},Fe=async(t,l)=>{const x=Y.currentUser?.uid;if(x)try{const v=de(U,`businesses/${x}/products`,t);await qe(v,{productionStatus:l,status:l,updatedAt:je()}),p.success("Status updated successfully!")}catch(v){console.error("Error updating status:",v),p.error("Failed to update status.")}},Le=[...new Set(L.map(t=>t.category).filter(Boolean))],S=t=>{switch(t){case"inMaking":case"in_production":return"bg-orange-400/20 text-orange-300 border-orange-400/30";case"built":case"completed":case"ready":return"bg-emerald-400/20 text-emerald-300 border-emerald-400/30";case"dispatched":case"shipped":return"bg-blue-400/20 text-blue-300 border-blue-400/30";default:return"bg-gray-400/20 text-gray-300 border-gray-400/30"}},a=t=>{switch(t){case"inMaking":case"in_production":return e.jsx(Je,{className:"text-orange-400"});case"built":case"completed":case"ready":return e.jsx(ze,{className:"text-emerald-400"});case"dispatched":case"shipped":return e.jsx(Me,{className:"text-blue-400"});default:return e.jsx(tt,{className:"text-gray-400"})}},h=()=>{ae(null),ve(),P(!0)};return e.jsxs(y.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-6 text-white p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold",children:"Product Inventory"}),e.jsx("p",{className:"text-white/70 text-sm mt-1",children:"Manage your product catalog and production status"})]}),e.jsxs("button",{onClick:h,className:"px-4 py-2 bg-emerald-500 hover:bg-emerald-600 rounded-lg flex items-center gap-2 transition shadow-lg hover:shadow-emerald-500/50",children:[e.jsx(st,{})," Add Product"]})]}),e.jsx("div",{className:"flex gap-2 border-b border-white/10",children:[{id:"view",label:"View Inventory"},{id:"categories",label:"Categories"},{id:"lowstock",label:"Low Stock Alerts"}].map(t=>e.jsxs("button",{onClick:()=>T(t.id),className:`px-4 py-2 transition relative ${b===t.id?"text-emerald-300 font-semibold":"text-white/70 hover:text-white"}`,children:[t.label,b===t.id&&e.jsx(y.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-emerald-400"})]},t.id))}),b==="view"&&e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center flex-1",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-white/50"}),e.jsx("input",{type:"text",placeholder:"Search products by name, SKU, brand, category, or barcode...",value:B,onChange:t=>xe(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}),e.jsxs("select",{value:me,onChange:t=>G(t.target.value),className:"px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"inMaking",children:"In Making"}),e.jsx("option",{value:"built",children:"Built"}),e.jsx("option",{value:"dispatched",children:"Dispatched"})]}),e.jsxs("select",{value:ee,onChange:t=>te(t.target.value),className:"px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:[e.jsx("option",{value:"all",children:"All Categories"}),Le.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{className:"text-white/50"}),e.jsxs("select",{value:k,onChange:t=>V(t.target.value),className:"px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"quantity",children:"Sort by Quantity"}),e.jsx("option",{value:"costPrice",children:"Sort by Cost"}),e.jsx("option",{value:"sellingPrice",children:"Sort by Price"}),e.jsx("option",{value:"createdAt",children:"Sort by Date"})]}),e.jsx("button",{onClick:()=>Ce(we==="asc"?"desc":"asc"),className:"p-2 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg transition",children:we==="asc"?e.jsx(Rt,{}):e.jsx(Et,{})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m("grid"),className:`p-2 rounded-lg transition ${_==="grid"?"bg-emerald-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20"}`,children:e.jsx(ws,{})}),e.jsx("button",{onClick:()=>m("list"),className:`p-2 rounded-lg transition ${_==="list"?"bg-emerald-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20"}`,children:e.jsx(ys,{})})]})]}),b==="view"&&e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:re?e.jsxs("div",{className:"text-center py-12 text-white/50",children:[e.jsx(Me,{className:"inline-block text-4xl mb-4 animate-pulse"}),e.jsx("p",{children:"Loading products..."})]}):g.length>0?_==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:g.map(t=>{const l=t.productionStatus||t.status||"inMaking",x=t.name||t.productName||"Unnamed Product",v=t.imageUrl||t.imageUrls?.[0]||null,J=t.minStockLevel?(t.quantity||0)<t.minStockLevel:!1;return e.jsxs(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"rounded-xl border border-white/10 bg-gradient-to-br from-white/5 to-white/0 backdrop-blur-xl p-4 hover:bg-white/10 hover:border-emerald-400/30 transition-all shadow-lg hover:shadow-xl",children:[e.jsxs("div",{className:"relative mb-3 aspect-square rounded-lg overflow-hidden bg-white/5",children:[v?e.jsx("img",{src:v,alt:x,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(ht,{className:"text-4xl text-white/20"})}),J&&e.jsxs("div",{className:"absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(tt,{})," Low Stock"]}),e.jsx("div",{className:"absolute top-2 left-2",children:a(l)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg line-clamp-1",children:x}),t.brand&&e.jsx("p",{className:"text-sm text-white/70",children:t.brand}),t.sku&&e.jsxs("p",{className:"text-xs text-white/50 mt-1",children:["SKU: ",t.sku]}),t.barcode&&e.jsxs("p",{className:"text-xs text-white/50 flex items-center gap-1",children:[e.jsx(Ns,{})," ",t.barcode]})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/50",children:"Category:"}),e.jsx("span",{children:t.category||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/50",children:"Stock:"}),e.jsxs("span",{className:J?"text-red-400 font-semibold":"",children:[t.quantity||0," ",t.unit||"units"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/50",children:"Cost:"}),e.jsxs("span",{children:["₹",t.costPrice||t.cost||0]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/50",children:"Price:"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:["₹",t.sellingPrice||t.price||0]})]}),t.mrp&&t.mrp!==t.sellingPrice&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/50",children:"MRP:"}),e.jsxs("span",{className:"line-through text-white/50",children:["₹",t.mrp]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs border ${S(l)}`,children:l})}),e.jsx("div",{className:"flex gap-2 mb-3",children:e.jsxs("select",{value:l,onChange:w=>Fe(t.id,w.target.value),className:"flex-1 px-2 py-1 bg-white/10 border border-white/20 rounded text-white text-xs focus:outline-none focus:ring-1 focus:ring-emerald-400/50",children:[e.jsx("option",{value:"inMaking",children:"In Making"}),e.jsx("option",{value:"built",children:"Built"}),e.jsx("option",{value:"dispatched",children:"Dispatched"})]})}),e.jsxs("div",{className:"flex gap-2 pt-3 border-t border-white/10",children:[e.jsxs("button",{onClick:()=>ne(t),className:"flex-1 px-3 py-2 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/30 rounded-lg text-blue-300 text-sm transition flex items-center justify-center gap-1",children:[e.jsx(ct,{})," Edit"]}),e.jsx("button",{onClick:()=>F(t.id,x),className:"px-3 py-2 bg-red-500/20 hover:bg-red-500/30 border border-red-400/30 rounded-lg text-red-300 text-sm transition",children:e.jsx(nt,{})})]})]})]},t.id)})}):e.jsx("div",{className:"space-y-3",children:g.map(t=>{const l=t.productionStatus||t.status||"inMaking",x=t.name||t.productName||"Unnamed Product",v=t.imageUrl||t.imageUrls?.[0]||null;return e.jsx(y.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"rounded-xl border border-white/10 bg-gradient-to-br from-white/5 to-white/0 backdrop-blur-xl p-4 hover:bg-white/10 transition-all",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-lg overflow-hidden bg-white/5 flex-shrink-0",children:v?e.jsx("img",{src:v,alt:x,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(ht,{className:"text-2xl text-white/20"})})}),e.jsxs("div",{className:"flex-1 grid grid-cols-2 md:grid-cols-6 gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:x}),e.jsx("p",{className:"text-sm text-white/70",children:t.brand||"No brand"}),t.sku&&e.jsxs("p",{className:"text-xs text-white/50",children:["SKU: ",t.sku]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-white/50",children:"Category"}),e.jsx("p",{children:t.category||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-white/50",children:"Stock"}),e.jsxs("p",{children:[t.quantity||0," ",t.unit||"units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-white/50",children:"Cost/Price"}),e.jsxs("p",{children:["₹",t.costPrice||t.cost||0," / ₹",t.sellingPrice||t.price||0]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-white/50",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[a(l),e.jsx("span",{className:"text-xs",children:l})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ne(t),className:"px-3 py-1 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/30 rounded text-blue-300 text-sm transition",children:e.jsx(ct,{})}),e.jsx("button",{onClick:()=>F(t.id,x),className:"px-3 py-1 bg-red-500/20 hover:bg-red-500/30 border border-red-400/30 rounded text-red-300 text-sm transition",children:e.jsx(nt,{})})]})]})]})},t.id)})}):e.jsxs("div",{className:"text-center py-12 text-white/50",children:[e.jsx(Me,{className:"inline-block text-5xl mb-4 text-white/20"}),e.jsx("p",{className:"text-lg mb-2",children:"No products found"}),e.jsx("p",{className:"text-sm",children:B||me!=="all"||ee!=="all"?"Try adjusting your filters":"Add your first product to get started"})]})}),b==="categories"&&e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:Le.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:Le.map(t=>{const l=L.filter(v=>v.category===t),x=l.reduce((v,J)=>v+(J.quantity||0)*(J.costPrice||J.cost||0),0);return e.jsxs(y.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"rounded-xl border border-white/10 bg-gradient-to-br from-white/5 to-white/0 backdrop-blur-xl p-4 hover:bg-white/10 transition cursor-pointer",onClick:()=>{te(t),T("view")},children:[e.jsx(Yt,{className:"text-2xl mb-2 text-emerald-400"}),e.jsx("h3",{className:"font-semibold mb-1",children:t}),e.jsxs("p",{className:"text-sm text-white/70",children:[l.length," product",l.length!==1?"s":""]}),e.jsxs("p",{className:"text-xs text-white/50 mt-1",children:["₹",x.toLocaleString()]})]},t)})}):e.jsx("div",{className:"text-center py-12 text-white/50",children:"No categories found. Add products to create categories."})}),b==="lowstock"&&e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:L.filter(t=>t.minStockLevel?(t.quantity||0)<t.minStockLevel:(t.quantity||0)<10).length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:L.filter(t=>t.minStockLevel?(t.quantity||0)<t.minStockLevel:(t.quantity||0)<10).map(t=>{const l=t.name||t.productName||"Unnamed Product";return e.jsx(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"rounded-xl border border-orange-400/30 bg-gradient-to-br from-orange-400/10 to-orange-400/5 backdrop-blur-xl p-4 hover:border-orange-400/50 transition",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(tt,{className:"text-orange-400 text-xl flex-shrink-0 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold mb-1",children:l}),e.jsxs("p",{className:"text-sm text-white/70 mb-2",children:["Current stock: ",t.quantity||0," ",t.unit||"units"]}),t.minStockLevel&&e.jsxs("p",{className:"text-xs text-orange-300",children:["Minimum required: ",t.minStockLevel," ",t.unit||"units"]}),e.jsx("button",{onClick:()=>ne(t),className:"mt-3 px-3 py-1 bg-orange-500/20 hover:bg-orange-500/30 border border-orange-400/30 rounded text-orange-300 text-sm transition",children:"Update Stock"})]})]})},t.id)})}):e.jsxs("div",{className:"text-center py-12 text-white/50",children:[e.jsx(ze,{className:"inline-block text-4xl mb-4 text-emerald-400/50"}),e.jsx("p",{className:"text-lg",children:"No low stock alerts"}),e.jsx("p",{className:"text-sm",children:"All products are well stocked!"})]})}),e.jsx(De,{children:E&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>{pe||(P(!1),ae(null))},children:e.jsxs(y.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},onClick:t=>t.stopPropagation(),className:"bg-slate-900 rounded-2xl border border-white/10 p-6 max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-white/10",children:[e.jsx("h3",{className:"text-2xl font-bold",children:d?"Edit Product":"Add New Product"}),e.jsx("button",{onClick:()=>{pe||(P(!1),ae(null))},className:"p-2 hover:bg-white/10 rounded-lg transition",disabled:pe,children:e.jsx(Ge,{})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2",children:e.jsxs("form",{onSubmit:d?C:M,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-emerald-400 flex items-center gap-2",children:[e.jsx(Jt,{})," Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Product Name *"}),e.jsx("input",{type:"text",required:!0,value:r.name,onChange:t=>N({...r,name:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"Enter product name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"SKU"}),e.jsx("input",{type:"text",value:r.sku,onChange:t=>N({...r,sku:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"Auto-generated if empty"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Barcode"}),e.jsx("input",{type:"text",value:r.barcode,onChange:t=>N({...r,barcode:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"EAN, UPC, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Brand"}),e.jsx("input",{type:"text",value:r.brand,onChange:t=>N({...r,brand:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Category"}),e.jsx("input",{type:"text",value:r.category,onChange:t=>N({...r,category:t.target.value}),list:"categories-list",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}),e.jsx("datalist",{id:"categories-list",children:Le.map(t=>e.jsx("option",{value:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Production Status"}),e.jsxs("select",{value:r.productionStatus,onChange:t=>N({...r,productionStatus:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:[e.jsx("option",{value:"inMaking",children:"In Making"}),e.jsx("option",{value:"built",children:"Built"}),e.jsx("option",{value:"dispatched",children:"Dispatched"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Description"}),e.jsx("textarea",{value:r.description,onChange:t=>N({...r,description:t.target.value}),rows:3,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50 resize-none",placeholder:"Product description, features, etc."})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-emerald-400 flex items-center gap-2",children:[e.jsx(ht,{})," Product Images (Max 5)"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[u.map((t,l)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,alt:`Product ${l+1}`,className:"w-full aspect-square object-cover rounded-lg border border-white/20"}),e.jsx("button",{type:"button",onClick:()=>ie(l),className:"absolute top-2 right-2 p-1 bg-red-500/80 hover:bg-red-600 rounded-full opacity-0 group-hover:opacity-100 transition",children:e.jsx(Ge,{className:"text-white text-xs"})})]},l)),u.length<5&&e.jsxs("label",{className:"aspect-square border-2 border-dashed border-white/30 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:border-emerald-400/50 transition bg-white/5 hover:bg-white/10",children:[e.jsx(ht,{className:"text-2xl mb-2 text-white/50"}),e.jsx("span",{className:"text-xs text-white/70 text-center px-2",children:"Add Image"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:t=>Q(Array.from(t.target.files)),className:"hidden",disabled:pe})]})]}),pe&&e.jsx("p",{className:"text-sm text-white/50",children:"Uploading images..."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-emerald-400 flex items-center gap-2",children:[e.jsx(js,{})," Stock & Pricing"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Quantity *"}),e.jsx("input",{type:"number",required:!0,min:"0",value:r.quantity,onChange:t=>N({...r,quantity:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Unit"}),e.jsxs("select",{value:r.unit,onChange:t=>N({...r,unit:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:[e.jsx("option",{value:"units",children:"Units"}),e.jsx("option",{value:"kg",children:"Kg"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"liters",children:"Liters"}),e.jsx("option",{value:"ml",children:"ML"}),e.jsx("option",{value:"pieces",children:"Pieces"}),e.jsx("option",{value:"boxes",children:"Boxes"}),e.jsx("option",{value:"packs",children:"Packs"}),e.jsx("option",{value:"pairs",children:"Pairs"}),e.jsx("option",{value:"dozen",children:"Dozen"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Location"}),e.jsx("input",{type:"text",value:r.location,onChange:t=>N({...r,location:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"Warehouse, Shelf, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Cost Price (₹)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:r.costPrice,onChange:t=>N({...r,costPrice:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Selling Price (₹)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:r.sellingPrice,onChange:t=>N({...r,sellingPrice:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"MRP (₹)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:r.mrp,onChange:t=>N({...r,mrp:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Min Stock Level"}),e.jsx("input",{type:"number",min:"0",value:r.minStockLevel,onChange:t=>N({...r,minStockLevel:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Max Stock Level"}),e.jsx("input",{type:"number",min:"0",value:r.maxStockLevel,onChange:t=>N({...r,maxStockLevel:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-emerald-400",children:"Tax Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"HSN Code"}),e.jsx("input",{type:"text",value:r.hsn,onChange:t=>N({...r,hsn:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"Harmonized System Nomenclature"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"GST Rate (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",step:"0.01",value:r.gst,onChange:t=>N({...r,gst:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]})]})]}),e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>K(!W),className:"flex items-center gap-2 text-emerald-400 hover:text-emerald-300 transition",children:[W?e.jsx(Rt,{}):e.jsx(Et,{}),"Advanced Fields (Dimensions, Weight, Supplier, etc.)"]}),e.jsx(De,{children:W&&e.jsxs(y.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm text-white/70 flex items-center gap-2",children:[e.jsx(vs,{})," Dimensions"]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsx("input",{type:"number",min:"0",step:"0.01",value:r.dimensions.length,onChange:t=>N({...r,dimensions:{...r.dimensions,length:t.target.value}}),className:"px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"Length"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:r.dimensions.width,onChange:t=>N({...r,dimensions:{...r.dimensions,width:t.target.value}}),className:"px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"Width"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:r.dimensions.height,onChange:t=>N({...r,dimensions:{...r.dimensions,height:t.target.value}}),className:"px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"Height"}),e.jsxs("select",{value:r.dimensions.unit,onChange:t=>N({...r,dimensions:{...r.dimensions,unit:t.target.value}}),className:"px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:[e.jsx("option",{value:"cm",children:"cm"}),e.jsx("option",{value:"m",children:"m"}),e.jsx("option",{value:"inch",children:"inch"}),e.jsx("option",{value:"ft",children:"ft"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-white/70 mb-1 flex items-center gap-2",children:[e.jsx(Ss,{})," Weight"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",min:"0",step:"0.01",value:r.weight,onChange:t=>N({...r,weight:t.target.value}),className:"flex-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"}),e.jsxs("select",{value:r.weightUnit,onChange:t=>N({...r,weightUnit:t.target.value}),className:"px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:[e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"lb",children:"lb"}),e.jsx("option",{value:"oz",children:"oz"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Color"}),e.jsx("input",{type:"text",value:r.color,onChange:t=>N({...r,color:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Size"}),e.jsx("input",{type:"text",value:r.size,onChange:t=>N({...r,size:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"S, M, L, XL, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Material"}),e.jsx("input",{type:"text",value:r.material,onChange:t=>N({...r,material:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Supplier"}),e.jsx("input",{type:"text",value:r.supplier,onChange:t=>N({...r,supplier:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Supplier Code"}),e.jsx("input",{type:"text",value:r.supplierCode,onChange:t=>N({...r,supplierCode:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Batch Number"}),e.jsx("input",{type:"text",value:r.batchNumber,onChange:t=>N({...r,batchNumber:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Expiry Date"}),e.jsx("input",{type:"date",value:r.expiryDate,onChange:t=>N({...r,expiryDate:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-white/70 mb-1 flex items-center gap-2",children:[e.jsx(ks,{})," Tags (comma-separated)"]}),e.jsx("input",{type:"text",value:r.tags,onChange:t=>N({...r,tags:t.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",placeholder:"tag1, tag2, tag3"})]})]})})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-white/10",children:[e.jsx("button",{type:"button",onClick:()=>{pe||(P(!1),ae(null),ve())},className:"flex-1 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition",disabled:pe,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-emerald-500 hover:bg-emerald-600 rounded-lg transition font-semibold disabled:opacity-50 disabled:cursor-not-allowed",disabled:pe,children:pe?"Saving...":d?"Update Product":"Add Product"})]})]})})]})})})]})},Xs=()=>{const[b,T]=i.useState({productionEfficiency:0,orderFulfillmentRate:0,averageProductionTime:0,distributorSatisfaction:0,revenueGrowth:0,productTurnover:0}),[L,q]=i.useState([]),[g,ce]=i.useState({total:0,completed:0,inProgress:0,pending:0}),[B,xe]=i.useState([]),[me,G]=i.useState(!0);i.useEffect(()=>{(async()=>{const d=Y.currentUser?.uid;if(d){G(!0);try{const ae=Pe(U,`businesses/${d}/products`),O=(await $e(ae)).docs.map(o=>({id:o.id,...o.data()})),_=Pe(U,`businesses/${d}/orders`),k=(await $e(_)).docs.map(o=>({id:o.id,...o.data()})),V=O.length,we=O.filter(o=>(o.productionStatus||o.status)==="built"||(o.productionStatus||o.status)==="dispatched").length,Ce=V>0?we/V*100:0,pe=k.length,oe=k.filter(o=>o.status==="delivered").length,u=pe>0?oe/pe*100:0,W=O.filter(o=>(o.productionStatus||o.status)==="inMaking").length*2,K=k.filter(o=>o.status==="delivered").reduce((o,M)=>o+(Number(M.totalAmount)||0),0),r=K>0?15:0,N=O.filter(o=>(o.productionStatus||o.status)==="dispatched").length,Q=V>0?N/V*100:0;T({productionEfficiency:Math.round(Ce),orderFulfillmentRate:Math.round(u),averageProductionTime:Math.round(W),distributorSatisfaction:85,revenueGrowth:Math.round(r),productTurnover:Math.round(Q)}),ce({total:pe,completed:oe,inProgress:k.filter(o=>o.status==="processing"||o.status==="in_transit").length,pending:k.filter(o=>o.status==="pending"||o.status==="assigned").length});const ie=[];for(let o=6;o>=0;o--){const M=new Date;M.setDate(M.getDate()-o);const C=M.toISOString().split("T")[0],F=O.filter(ne=>{const ve=ne.createdAt||ne.updatedAt;return ve?new Date(ve).toISOString().split("T")[0]===C:!1});ie.push({date:C,products:F.length,completed:F.filter(ne=>(ne.productionStatus||ne.status)==="built"||(ne.productionStatus||ne.status)==="dispatched").length})}q(ie),xe([{month:"Jan",revenue:K*.8},{month:"Feb",revenue:K*.85},{month:"Mar",revenue:K*.9},{month:"Apr",revenue:K*.95},{month:"May",revenue:K*1},{month:"Jun",revenue:K}])}catch(ae){console.error("Error fetching analytics:",ae)}finally{G(!1)}}})()},[]);const ee=({label:P,value:d,icon:ae,trend:re,subtitle:O})=>{const _=re>0?"text-emerald-400":re<0?"text-red-400":"text-white/50",m=re>0?Ot:re<0?Ds:null;return e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-5 hover:scale-[1.02] transition duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-sm uppercase tracking-wide text-white/70",children:P}),e.jsx("div",{className:"text-white/40",children:ae})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-white",children:d}),m&&e.jsxs("span",{className:`text-sm ${_}`,children:[e.jsx(m,{className:"inline"})," ",Math.abs(re),"%"]})]}),O&&e.jsx("p",{className:"text-xs text-white/60 mt-2",children:O})]})},te=Math.max(...L.map(P=>P.products),1),E=Math.max(...B.map(P=>P.revenue),1);return e.jsxs(y.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-6 text-white p-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Progress & Analytics"}),e.jsx("p",{className:"text-white/70 text-sm mt-1",children:"Track your production performance and business metrics"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(ee,{label:"Production Efficiency",value:`${b.productionEfficiency}%`,icon:e.jsx(Vt,{}),trend:5,subtitle:"Products completed vs total"}),e.jsx(ee,{label:"Order Fulfillment Rate",value:`${b.orderFulfillmentRate}%`,icon:e.jsx(ze,{}),trend:3,subtitle:"Orders delivered successfully"}),e.jsx(ee,{label:"Avg Production Time",value:`${b.averageProductionTime} days`,icon:e.jsx(Je,{}),trend:-2,subtitle:"Time to complete products"}),e.jsx(ee,{label:"Revenue Growth",value:`${b.revenueGrowth}%`,icon:e.jsx(Ot,{}),trend:b.revenueGrowth,subtitle:"Month over month growth"}),e.jsx(ee,{label:"Product Turnover",value:`${b.productTurnover}%`,icon:e.jsx(Cs,{}),trend:8,subtitle:"Products dispatched"}),e.jsx(ee,{label:"Distributor Satisfaction",value:`${b.distributorSatisfaction}%`,icon:e.jsx(Ps,{}),trend:2,subtitle:"Based on order completion"})]}),e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-5",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Order Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:g.total}),e.jsx("p",{className:"text-sm text-white/70 mt-1",children:"Total Orders"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-400",children:g.completed}),e.jsx("p",{className:"text-sm text-white/70 mt-1",children:"Completed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-orange-400",children:g.inProgress}),e.jsx("p",{className:"text-sm text-white/70 mt-1",children:"In Progress"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:g.pending}),e.jsx("p",{className:"text-sm text-white/70 mt-1",children:"Pending"})]})]})]}),e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-5",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Production Timeline (Last 7 Days)"}),e.jsx("div",{className:"space-y-3",children:L.map((P,d)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-24 text-xs text-white/70",children:new Date(P.date).toLocaleDateString("en-IN",{weekday:"short",day:"numeric",month:"short"})}),e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 bg-white/10 rounded-full h-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute left-0 top-0 h-full bg-emerald-400/50 rounded-full transition-all duration-500",style:{width:`${P.completed/Math.max(P.products,1)*100}%`}}),e.jsx("div",{className:"absolute left-0 top-0 h-full bg-orange-400/50 rounded-full transition-all duration-500",style:{width:`${P.products/Math.max(te,1)*100}%`}})]}),e.jsxs("div",{className:"w-20 text-right text-sm",children:[P.completed,"/",P.products]})]})]},d))})]}),e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-5",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Revenue Trend (Last 6 Months)"}),e.jsx("div",{className:"flex items-end justify-between gap-2 h-48",children:B.map((P,d)=>e.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[e.jsx("div",{className:"w-full flex flex-col justify-end h-40",children:e.jsx("div",{className:"w-full bg-gradient-to-t from-emerald-400/60 to-emerald-300/30 rounded-t transition-all duration-500 hover:from-emerald-400/80 hover:to-emerald-300/50",style:{height:`${P.revenue/E*100}%`}})}),e.jsx("div",{className:"mt-2 text-xs text-white/70",children:P.month}),e.jsxs("div",{className:"text-xs text-white/50 mt-1",children:["₹",Math.round(P.revenue/1e3),"k"]})]},d))})]}),e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-5",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Performance Insights"}),e.jsxs("div",{className:"space-y-3",children:[b.productionEfficiency>70?e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-emerald-400/10 border border-emerald-400/30",children:[e.jsx(ze,{className:"text-emerald-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Production efficiency is excellent"}),e.jsxs("p",{className:"text-sm text-white/70",children:[b.productionEfficiency,"% of products are completed"]})]})]}):e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-orange-400/10 border border-orange-400/30",children:[e.jsx(tt,{className:"text-orange-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Production efficiency needs improvement"}),e.jsxs("p",{className:"text-sm text-white/70",children:["Only ",b.productionEfficiency,"% of products are completed"]})]})]}),b.orderFulfillmentRate>80?e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-emerald-400/10 border border-emerald-400/30",children:[e.jsx(ze,{className:"text-emerald-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Order fulfillment rate is strong"}),e.jsxs("p",{className:"text-sm text-white/70",children:[b.orderFulfillmentRate,"% of orders are delivered successfully"]})]})]}):e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-orange-400/10 border border-orange-400/30",children:[e.jsx(tt,{className:"text-orange-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Order fulfillment needs attention"}),e.jsxs("p",{className:"text-sm text-white/70",children:["Only ",b.orderFulfillmentRate,"% of orders are delivered"]})]})]})]})]})]})},Zs=()=>{const[b,T]=i.useState([]),[L,q]=i.useState([]),[g,ce]=i.useState([]),[B,xe]=i.useState("automations"),[me,G]=i.useState(!1),[ee,te]=i.useState(!0),[E,P]=i.useState({name:"",type:"status_update",trigger:"time_based",condition:"",action:"",enabled:!0,schedule:""});i.useEffect(()=>{(async()=>{const k=Y.currentUser?.uid;if(k){te(!0);try{const V=Pe(U,`businesses/${k}/automations`),we=await $e(V);T(we.docs.map(f=>({id:f.id,...f.data()})));const Ce=Pe(U,`businesses/${k}/alerts`),pe=await $e(At(Ce,is("resolved","==",!1)));q(pe.docs.map(f=>({id:f.id,...f.data()})));const oe=Pe(U,`businesses/${k}/operations`),u=await $e(At(oe,ns("timestamp","desc")));ce(u.docs.slice(0,50).map(f=>({id:f.id,...f.data()})))}catch(V){console.error("Error fetching automation data:",V)}finally{te(!1)}}})()},[]);const d=async m=>{m.preventDefault();const k=Y.currentUser?.uid;if(k)try{await pt(Pe(U,`businesses/${k}/automations`),{...E,createdAt:new Date().toISOString(),lastRun:null,runCount:0}),alert("Automation created successfully!"),G(!1),P({name:"",type:"status_update",trigger:"time_based",condition:"",action:"",enabled:!0,schedule:""})}catch(V){console.error("Error creating automation:",V),alert("Failed to create automation.")}},ae=async(m,k)=>{const V=Y.currentUser?.uid;if(V)try{await qe(de(U,`businesses/${V}/automations`,m),{enabled:!k})}catch(we){console.error("Error toggling automation:",we)}},re=async m=>{const k=Y.currentUser?.uid;if(k)try{await qe(de(U,`businesses/${k}/alerts`,m),{resolved:!0,resolvedAt:new Date().toISOString()}),q(L.filter(V=>V.id!==m))}catch(V){console.error("Error resolving alert:",V)}},O=m=>{switch(m){case"critical":return"bg-red-400/20 text-red-300 border-red-400/30";case"warning":return"bg-orange-400/20 text-orange-300 border-orange-400/30";case"info":return"bg-blue-400/20 text-blue-300 border-blue-400/30";default:return"bg-gray-400/20 text-gray-300 border-gray-400/30"}},_=m=>{switch(m){case"success":return"text-emerald-400";case"error":return"text-red-400";case"warning":return"text-orange-400";default:return"text-white/70"}};return e.jsxs(y.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-6 text-white p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Automation & Operations"}),e.jsx("p",{className:"text-white/70 text-sm mt-1",children:"Automate workflows and track operations"})]}),e.jsxs("button",{onClick:()=>G(!0),className:"px-4 py-2 bg-emerald-500 hover:bg-emerald-600 rounded-lg flex items-center gap-2 transition",children:[e.jsx(st,{})," Create Automation"]})]}),e.jsx("div",{className:"flex gap-2 border-b border-white/10",children:[{id:"automations",label:"Automations",icon:e.jsx(As,{})},{id:"alerts",label:"Alerts",icon:e.jsx(Ut,{})},{id:"operations",label:"Operations Log",icon:e.jsx(Je,{})}].map(m=>e.jsxs("button",{onClick:()=>xe(m.id),className:`px-4 py-2 flex items-center gap-2 transition ${B===m.id?"border-b-2 border-emerald-400 text-emerald-300":"text-white/70 hover:text-white"}`,children:[m.icon," ",m.label]},m.id))}),B==="automations"&&e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:ee?e.jsx("div",{className:"text-center py-12 text-white/50",children:"Loading automations..."}):b.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:b.map(m=>e.jsxs(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:m.name}),e.jsxs("p",{className:"text-sm text-white/70 mt-1",children:["Type: ",m.type," • Trigger: ",m.trigger]})]}),e.jsx("button",{onClick:()=>ae(m.id,m.enabled),className:`px-3 py-1 rounded-lg text-sm transition ${m.enabled?"bg-emerald-500/20 text-emerald-300 border border-emerald-400/30":"bg-gray-500/20 text-gray-300 border border-gray-400/30"}`,children:m.enabled?e.jsxs(e.Fragment,{children:[e.jsx(Is,{className:"inline mr-1"})," Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ms,{className:"inline mr-1"})," Enable"]})})]}),e.jsxs("div",{className:"space-y-2 text-sm text-white/70 mb-4",children:[m.condition&&e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Condition:"})," ",m.condition]}),m.action&&e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Action:"})," ",m.action]}),m.schedule&&e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Schedule:"})," ",m.schedule]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-white/50 pt-3 border-t border-white/10",children:[e.jsxs("span",{children:["Runs: ",m.runCount||0]}),m.lastRun&&e.jsxs("span",{children:["Last run: ",new Date(m.lastRun).toLocaleDateString()]})]})]},m.id))}):e.jsx("div",{className:"text-center py-12 text-white/50",children:"No automations configured. Create your first automation to streamline operations."})}),B==="alerts"&&e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:L.length>0?e.jsx("div",{className:"space-y-3",children:L.map(m=>e.jsx(y.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:`rounded-xl border p-4 ${O(m.severity||"info")}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.severity==="critical"&&e.jsx(tt,{}),m.severity==="warning"&&e.jsx(tt,{}),m.severity==="info"&&e.jsx(Ut,{}),e.jsx("h4",{className:"font-semibold",children:m.title||"Alert"})]}),e.jsx("p",{className:"text-sm text-white/80",children:m.message||m.description}),m.timestamp&&e.jsx("p",{className:"text-xs text-white/60 mt-2",children:new Date(m.timestamp).toLocaleString()})]}),e.jsxs("button",{onClick:()=>re(m.id),className:"ml-4 px-3 py-1 bg-white/10 hover:bg-white/20 rounded-lg text-sm transition",children:[e.jsx(ze,{className:"inline mr-1"})," Resolve"]})]})},m.id))}):e.jsx("div",{className:"text-center py-12 text-white/50",children:"No active alerts. All systems operating normally!"})}),B==="operations"&&e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-xl overflow-hidden",children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:g.length>0?e.jsx("div",{className:"divide-y divide-white/10",children:g.map(m=>e.jsx("div",{className:"p-4 hover:bg-white/5 transition",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-sm font-medium ${_(m.type)}`,children:m.action||m.type}),m.status&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${m.status==="success"?"bg-emerald-400/20 text-emerald-300":m.status==="error"?"bg-red-400/20 text-red-300":"bg-gray-400/20 text-gray-300"}`,children:m.status})]}),e.jsx("p",{className:"text-sm text-white/70",children:m.description||m.message}),m.timestamp&&e.jsx("p",{className:"text-xs text-white/50 mt-1",children:new Date(m.timestamp).toLocaleString()})]})})},m.id))}):e.jsx("div",{className:"p-12 text-center text-white/50",children:"No operations logged yet"})})})}),e.jsx(De,{children:me&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>G(!1),children:e.jsxs(y.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:m=>m.stopPropagation(),className:"bg-slate-900 rounded-xl border border-white/10 p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create Automation"}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Name *"}),e.jsx("input",{type:"text",required:!0,value:E.name,onChange:m=>P({...E,name:m.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Type *"}),e.jsxs("select",{required:!0,value:E.type,onChange:m=>P({...E,type:m.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:[e.jsx("option",{value:"status_update",children:"Status Update"}),e.jsx("option",{value:"order_assignment",children:"Order Assignment"}),e.jsx("option",{value:"inventory_alert",children:"Inventory Alert"}),e.jsx("option",{value:"report_generation",children:"Report Generation"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Trigger *"}),e.jsxs("select",{required:!0,value:E.trigger,onChange:m=>P({...E,trigger:m.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50",children:[e.jsx("option",{value:"time_based",children:"Time Based"}),e.jsx("option",{value:"event_based",children:"Event Based"}),e.jsx("option",{value:"condition_based",children:"Condition Based"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Condition"}),e.jsx("input",{type:"text",value:E.condition,onChange:m=>P({...E,condition:m.target.value}),placeholder:"e.g., quantity < 10",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Action"}),e.jsx("textarea",{value:E.action,onChange:m=>P({...E,action:m.target.value}),rows:3,placeholder:"Describe the action to perform",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/70 mb-1",children:"Schedule"}),e.jsx("input",{type:"text",value:E.schedule,onChange:m=>P({...E,schedule:m.target.value}),placeholder:"e.g., Daily at 9 AM",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/50"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>G(!1),className:"flex-1 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-emerald-500 hover:bg-emerald-600 rounded-lg transition",children:"Create"})]})]})]})})})]})},ya=()=>{const{t:b}=Wt(),T=rs(),[L,q]=i.useState("home"),[g,ce]=i.useState(!1),[B,xe]=i.useState(null),me=ls(),G=O=>{const _=(O?.target?.tagName||"").toUpperCase();return _==="INPUT"||_==="TEXTAREA"||_==="SELECT"||O?.target?.isContentEditable===!0},ee={home:"home",distributors:"distributors",retailers:"retailers",inventory:"inventory",progress:"progress",automation:"automation",profile:"profile"},te={home:"home",distributors:"distributors",retailers:"retailers",inventory:"inventory",progress:"progress",automation:"automation",profile:"profile"};i.useEffect(()=>{const O=()=>{const _=window.location.hash||"",m=_.indexOf("?");if(m===-1)return;const V=(new URLSearchParams(_.substring(m+1)).get("tab")||"").toLowerCase();te[V]&&q(te[V])};return O(),window.addEventListener("hashchange",O),()=>window.removeEventListener("hashchange",O)},[]);const E=O=>{q(O);try{const _=window.location.hash||"#/product-owner-dashboard",[m,k=""]=_.split("?"),V=new URLSearchParams(k),we=ee[O]||"home";V.set("tab",we);const Ce=`${m}?${V.toString()}`;Ce!==_&&window.history.replaceState(null,"",Ce)}catch{}};i.useEffect(()=>{(async()=>{const _=Y.currentUser;if(!_)return;const m=de(me,"businesses",_.uid),k=await Te(m);k.exists()&&xe(k.data())})()},[]);const P=async()=>{try{await os(Y),T("/")}catch(O){console.error("Sign out error:",O)}},d=i.useRef(null);i.useEffect(()=>{const O=_=>{if(G(_)||_.ctrlKey||_.metaKey||_.altKey)return;const m=_.key.toLowerCase();if(/^[1-7]$/.test(m)){const V=["home","distributors","retailers","inventory","progress","automation","profile"],we=parseInt(m,10)-1;V[we]&&E(V[we]);return}const k=Date.now();if(d.current&&k-d.current.time<900){const V=d.current.key;d.current=null,V==="g"&&(m==="h"?E("home"):m==="d"?E("distributors"):m==="r"?E("retailers"):m==="i"?E("inventory"):m==="p"?E("progress"):m==="a"&&E("automation"));return}m==="g"&&(d.current={key:"g",time:k})};return window.addEventListener("keydown",O),()=>window.removeEventListener("keydown",O)},[]);const ae=[{id:"home",label:"Home",icon:"🏠"},{id:"distributors",label:"Distributors",icon:"👥"},{id:"retailers",label:"Retailers",icon:"🏪"},{id:"inventory",label:"Inventory",icon:"📦"},{id:"progress",label:"Progress",icon:"📊"},{id:"automation",label:"Automation",icon:"🤖"},{id:"profile",label:"Profile",icon:"⚙️"}],re={initial:{opacity:0,y:14},enter:{opacity:1,y:0,transition:{duration:.28,ease:"easeOut"}},exit:{opacity:0,y:-10,transition:{duration:.2,ease:"easeIn"}}};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        /* Custom scrollbar for sidebar */
        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.1);
          border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: rgba(255, 255, 255, 0.2);
        }

        /* FLYP Menu Animation - Flight-inspired wing opening */
        @keyframes flypMenuEnter {
          0% {
            transform: translateX(-100%) perspective(1000px) rotateY(-15deg) scale(0.95);
            opacity: 0;
            filter: blur(10px);
          }
          60% {
            transform: translateX(-5%) perspective(1000px) rotateY(-2deg) scale(1.02);
          }
          100% {
            transform: translateX(0) perspective(1000px) rotateY(0deg) scale(1);
            opacity: 1;
            filter: blur(0);
          }
        }

        @keyframes flypMenuExit {
          0% {
            transform: translateX(0) perspective(1000px) rotateY(0deg) scale(1);
            opacity: 1;
            filter: blur(0);
          }
          100% {
            transform: translateX(-100%) perspective(1000px) rotateY(-15deg) scale(0.95);
            opacity: 0;
            filter: blur(10px);
          }
        }

        .flyp-menu-enter {
          animation: flypMenuEnter 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .flyp-menu-exit {
          animation: flypMenuExit 0.4s cubic-bezier(0.55, 0.06, 0.68, 0.19) forwards;
        }

        /* Hamburger to X transformation - Flight path inspired */
        .hamburger-line {
          transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
          transform-origin: center;
        }

        .hamburger-open .hamburger-line:nth-child(1) {
          transform: translateY(8px) rotate(45deg);
        }

        .hamburger-open .hamburger-line:nth-child(2) {
          opacity: 0;
          transform: scaleX(0);
        }

        .hamburger-open .hamburger-line:nth-child(3) {
          transform: translateY(-8px) rotate(-45deg);
        }

        /* Menu item stagger animation */
        @keyframes menuItemFlyIn {
          0% {
            opacity: 0;
            transform: translateX(-20px) scale(0.9);
          }
          100% {
            opacity: 1;
            transform: translateX(0) scale(1);
          }
        }

        .menu-item-animate {
          animation: menuItemFlyIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        /* Glow effect on sidebar */
        .flyp-sidebar-glow {
          box-shadow: 
            -10px 0 40px rgba(16, 185, 129, 0.15),
            -20px 0 60px rgba(6, 182, 212, 0.1),
            inset 1px 0 0 rgba(16, 185, 129, 0.1);
        }

        /* Magnetic pull effect */
        .flyp-menu-trigger {
          position: relative;
          transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .flyp-menu-trigger:hover {
          transform: scale(1.1);
        }

        .flyp-menu-trigger::before {
          content: '';
          position: absolute;
          inset: -8px;
          border-radius: 50%;
          background: radial-gradient(circle, rgba(16, 185, 129, 0.2) 0%, transparent 70%);
          opacity: 0;
          transition: opacity 0.3s;
        }

        .flyp-menu-trigger:hover::before {
          opacity: 1;
        }
      `}),e.jsxs("div",{className:"flex min-h-[100dvh] w-full relative overflow-hidden bg-gradient-to-br from-[#0B0F14] via-[#0D1117] to-[#0B0F14] text-white",children:[e.jsx(De,{children:g&&e.jsxs(y.aside,{initial:"closed",animate:"open",exit:"closed",variants:{open:{x:0,opacity:1,transition:{type:"spring",stiffness:300,damping:30,mass:.8,staggerChildren:.05,delayChildren:.1}},closed:{x:"-100%",opacity:0,transition:{type:"spring",stiffness:400,damping:40}}},className:"fixed left-0 top-0 bottom-0 z-30 w-64 bg-gradient-to-br from-slate-900/98 via-slate-800/95 to-slate-900/98 backdrop-blur-2xl border-r border-emerald-500/20 flex flex-col h-screen flyp-sidebar-glow",style:{transformStyle:"preserve-3d"},children:[e.jsxs(y.div,{className:"p-4 border-b border-emerald-500/20 relative overflow-hidden",variants:{open:{opacity:1,y:0},closed:{opacity:0,y:-20}},transition:{delay:.1},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-500/5 via-cyan-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("h2",{className:"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-300 via-emerald-400 to-cyan-300 relative z-10",children:"Product Owner"}),e.jsx("p",{className:"text-xs text-white/60 mt-1 relative z-10",children:"Production Dashboard"}),e.jsx(y.div,{className:"absolute bottom-0 left-0 h-0.5 bg-gradient-to-r from-emerald-400 via-cyan-400 to-transparent",initial:{width:0},animate:{width:"100%"},transition:{delay:.3,duration:.5,ease:"easeOut"}})]}),e.jsx("nav",{className:"flex-1 overflow-y-auto p-3 space-y-1 custom-scrollbar",children:ae.map((O,_)=>e.jsxs(y.button,{variants:{open:{x:0,opacity:1,transition:{type:"spring",stiffness:500,damping:25,delay:_*.05}},closed:{x:-50,opacity:0,transition:{duration:.2}}},onClick:()=>{E(O.id),ce(!1)},className:`w-full text-left px-3 py-3 rounded-lg font-medium transition-all duration-300 hover:scale-[1.02] hover:translate-x-1 hover:bg-gradient-to-r hover:from-emerald-500/10 hover:to-cyan-500/10 active:bg-white/10 text-sm flex items-center gap-3 relative group ${L===O.id?"bg-gradient-to-r from-emerald-500/20 to-cyan-500/20 border-l-4 border-emerald-400 text-emerald-300 shadow-lg shadow-emerald-500/20":"text-white/80 hover:text-emerald-300"}`,children:[e.jsx(y.span,{className:"text-lg",whileHover:{scale:1.2,rotate:5},transition:{type:"spring",stiffness:400},children:O.icon}),e.jsx("span",{className:"relative z-10",children:O.label}),L===O.id&&e.jsx(y.div,{layoutId:"activeIndicator",className:"absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-emerald-400 to-cyan-400 rounded-r-full",initial:!1,transition:{type:"spring",stiffness:500,damping:30}})]},O.id))}),e.jsxs(y.div,{className:"p-4 border-t border-emerald-500/20",variants:{open:{opacity:1,y:0},closed:{opacity:0,y:20}},transition:{delay:.2},children:[e.jsxs("div",{className:"mb-3 text-xs text-white/60",children:[e.jsx("p",{className:"font-medium text-white/80",children:B?.businessName||"Business"}),e.jsx("p",{className:"text-white/50",children:Y.currentUser?.email})]}),e.jsxs(y.button,{onClick:P,className:"w-full bg-gradient-to-r from-red-600/20 to-red-500/20 hover:from-red-600/30 hover:to-red-500/30 border border-red-500/30 py-2 px-4 rounded-lg text-red-300 text-sm transition-all relative overflow-hidden group",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx("span",{className:"relative z-10",children:"Sign Out"}),e.jsx(y.div,{className:"absolute inset-0 bg-gradient-to-r from-red-600/20 to-transparent",initial:{x:"-100%"},whileHover:{x:0},transition:{duration:.3}})]})]})]})}),e.jsx(De,{children:g&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"fixed inset-0 z-20 bg-gradient-to-r from-black/70 via-black/60 to-transparent backdrop-blur-sm",onClick:()=>ce(!1),children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-500/5 via-transparent to-transparent"})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto transition-all duration-300 ease-in-out flex flex-col h-screen w-full",children:[e.jsxs("header",{className:"sticky top-0 z-10 bg-slate-900/80 backdrop-blur-md border-b border-slate-800/50 text-white px-4 sm:px-6 py-3 shadow-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(y.button,{onClick:()=>ce(!g),className:"flyp-menu-trigger flex items-center gap-3 px-4 py-2 hover:bg-white/10 rounded-xl transition-all relative group","aria-label":"Toggle sidebar",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(De,{mode:"wait",children:!g&&e.jsx(y.span,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2},className:"text-lg font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 via-emerald-300 to-cyan-400 tracking-wide",children:"FLYP"},"flyp-text")}),e.jsxs("div",{className:"relative w-6 h-6 flex flex-col justify-center gap-1.5",children:[e.jsx(y.span,{className:"hamburger-line w-6 h-0.5 bg-gradient-to-r from-emerald-400 to-cyan-400 rounded-full",animate:{rotate:g?45:0,y:g?8:0},transition:{type:"spring",stiffness:300,damping:20}}),e.jsx(y.span,{className:"hamburger-line w-6 h-0.5 bg-gradient-to-r from-emerald-400 to-cyan-400 rounded-full",animate:{opacity:g?0:1,scaleX:g?0:1},transition:{duration:.2}}),e.jsx(y.span,{className:"hamburger-line w-6 h-0.5 bg-gradient-to-r from-emerald-400 to-cyan-400 rounded-full",animate:{rotate:g?-45:0,y:g?-8:0},transition:{type:"spring",stiffness:300,damping:20}})]}),g&&e.jsx(y.div,{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-emerald-500/20 to-cyan-500/20 blur-xl -z-10",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1.2},exit:{opacity:0,scale:.8},transition:{duration:.3}})]}),e.jsx("div",{children:e.jsx("h1",{className:"text-lg sm:text-xl font-semibold bg-clip-text text-transparent bg-gradient-to-r from-emerald-300 to-cyan-300",children:"Product Owner Dashboard"})})]}),e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("p",{className:"text-sm text-white/80 font-medium",children:B?.businessName||"Business"}),e.jsx("p",{className:"text-xs text-white/50",children:Y.currentUser?.email})]})]}),e.jsx("div",{className:"flex-1 p-4 sm:p-6 overflow-y-auto",children:e.jsx(De,{mode:"wait",children:e.jsxs(y.div,{variants:re,initial:"initial",animate:"enter",exit:"exit",children:[L==="home"&&e.jsx(Fs,{}),L==="distributors"&&e.jsx(Js,{}),L==="retailers"&&e.jsx(Ws,{}),L==="inventory"&&e.jsx(Qs,{}),L==="progress"&&e.jsx(Xs,{}),L==="automation"&&e.jsx(Zs,{}),L==="profile"&&e.jsx($s,{})]},L)})})]})]})]})};export{ya as default};
